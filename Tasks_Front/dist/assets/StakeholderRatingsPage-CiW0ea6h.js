import{r as b,a as R,b as _,o as y,j as e,U as v,F as P,aK as C,d as k,e as S,f as w,I,g as D,B as F,L as M,aM as E,al as T,s as L,z as A}from"./index-BoroKU0h.js";import{C as j,a as B,b as U,d as f}from"./card-Dihqd1Tq.js";import{P as V,a as z,b as N,c as H,d as K,e as O,f as $}from"./pagination-BYrR7XPa.js";import{u as q}from"./ratingsStore-Bw7XB-jJ.js";import{S as G,R as J}from"./RatingDisplay-FEairSXe.js";import"./ellipsis-Kn7O6V0g.js";import"./ratingConfigService-Bv-NPdeM.js";import"./badge-B-NgAhQH.js";import"./progress-IEtkPirU.js";import"./calendar-DVQKPfrD.js";const Q=o=>{const{stakeholderRatings:c,stakeholderRatingConfigs:h,stakeholderRatingsPagination:s,isLoading:d,error:u,fetchStakeholderRatings:i,fetchStakeholderRatingConfigs:x,createStakeholderRating:p,updateStakeholderRating:m}=q(),n=typeof o=="string"?parseInt(o):o;b.useEffect(()=>{n&&!c.length&&(i(n,1),x())},[n,i,x,c.length]);const g=r=>{i(n,r)};return{stakeholderRatings:c,stakeholderRatingConfigs:h,pagination:s,isLoading:d,error:u,createRating:r=>p({...r,project_id:n}),updateRating:(r,l)=>m(r,l),refreshRatings:()=>i(n),goToPage:g,nextPage:()=>{s&&s.current_page<s.last_page&&g(s.current_page+1)},prevPage:()=>{s&&s.current_page>1&&g(s.current_page-1)}}},W=y({rating_data:E(L(),T().min(0).max(100))}),X=({projectId:o,config:c,onSubmit:h,isLoading:s})=>{const d=c.config_data,u=d.fields.reduce((a,t)=>(a[t.name]=0,a),{}),i=R({resolver:_(W),defaultValues:{rating_data:u}}),x=async a=>{const t={project_id:o,rating_data:a.rating_data};await h(t)},p=i.watch("rating_data"),m=Object.values(p||{}).reduce((a,t)=>a+(t||0),0),n=d.fields.reduce((a,t)=>a+t.max_value,0),g=n>0?Math.round(m/n*100):0;return e.jsxs(j,{className:"bg-card border-border",children:[e.jsx(B,{children:e.jsxs(U,{className:"text-foreground flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Stakeholder Rating - ",c.name]})}),e.jsx(f,{children:e.jsx(P,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(x),className:"space-y-6",children:[e.jsx("div",{className:"space-y-6",children:d.fields.map(a=>e.jsx("div",{children:e.jsx(C,{name:`rating_data.${a.name}`,control:i.control,render:({field:t,fieldState:r})=>e.jsxs(k,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(S,{className:"text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.value||0," / ",a.max_value]})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(G,{value:[t.value||0],onValueChange:l=>t.onChange(l[0]),max:a.max_value,step:1,className:"flex-1",disabled:s}),e.jsx(I,{type:"number",min:0,max:a.max_value,value:t.value||0,onChange:l=>t.onChange(Number(l.target.value)),disabled:s,className:"w-24 text-center"})]})}),r.error&&e.jsx(D,{className:"text-destructive",children:r.error.message})]})})},a.name))}),e.jsx("div",{className:"p-4 bg-accent/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Total Rating"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[g,"%"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m," / ",n]})]})]})}),e.jsxs(F,{type:"submit",disabled:s,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:[s&&e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Rating"]})]})})})]})},ce=()=>{const{projectId:o}=A(),{stakeholderRatings:c,stakeholderRatingConfigs:h,pagination:s,isLoading:d,createRating:u,goToPage:i,nextPage:x,prevPage:p}=Q(o),m=h.find(a=>a.is_active),n=async a=>{await u(a)},g=()=>{if(!s)return[];const a=[],{current_page:t,last_page:r}=s;t>3&&(a.push(1),t>4&&a.push("ellipsis-start"));for(let l=Math.max(1,t-2);l<=Math.min(r,t+2);l++)a.push(l);return t<r-2&&(t<r-3&&a.push("ellipsis-end"),a.push(r)),a};return o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:"Stakeholder Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Project evaluation from stakeholder perspective"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:m?e.jsx(X,{projectId:parseInt(o),config:m,onSubmit:n,isLoading:d}):e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No active stakeholder rating configuration found"})})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Previous Ratings"}),d?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((a,t)=>e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},t))}):c.length===0?e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No ratings yet for this project"})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:c.map(a=>e.jsx(J,{rating:a},a.id))}),s&&s.last_page>1&&e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total," results"]}),e.jsx(V,{children:e.jsxs(z,{children:[e.jsx(N,{children:e.jsx(H,{onClick:p,className:s.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),g().map((a,t)=>e.jsx(N,{children:a==="ellipsis-start"||a==="ellipsis-end"?e.jsx(K,{}):e.jsx(O,{onClick:()=>i(a),isActive:s.current_page===a,className:"cursor-pointer",children:a})},t)),e.jsx(N,{children:e.jsx($,{onClick:x,className:s.current_page===s.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]})]}):e.jsx("div",{children:"Project not found"})};export{ce as default};
