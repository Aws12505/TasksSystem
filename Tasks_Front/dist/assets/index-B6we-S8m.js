import{p as K,j as e,D as xe,q as me,B as W,v as he,w as j,x as _,R as ge,T as M,I as ue}from"./index-DB2dH0Gn.js";import{C as c,d as o,a as T,b as k}from"./card-Do0T9gHn.js";import{T as pe,a as je,b as q,c as R}from"./tabs-DCYmm2ap.js";import{P as H,a as F,b as f,c as V,d as O,e as Q,f as $}from"./pagination-DWrQc074.js";import{A as fe,a as Ne,b as be,c as ve,d as ye,e as we,f as Ce,g as Te}from"./alert-dialog-kR6fC0Dz.js";import{u as ke}from"./useTickets-Cucxd_fJ.js";import{u as Ae}from"./filtersStore-PoqRI4G2.js";import{T as Pe,a as De,b as X,c as d,d as _e,e as x}from"./table-DCUM-Sdy.js";import{A as z,a as G}from"./avatar-BZWEtldt.js";import{B as Ue}from"./badge-DBBjrr1q.js";import{T as Se,a as Be,b as Ee}from"./TicketPriorityBadge-Ds-Jb6hJ.js";import{E as Ie}from"./ellipsis--GZzgyTm.js";import{E as Le}from"./eye-CgvSI69L.js";import{S as Me}from"./square-pen-Cf53-zlk.js";import{U as qe,C as Re,a as He}from"./user-x-7Z5Ckg_Q.js";import{T as Fe}from"./trash-2-Dddariuc.js";import{P as Ve}from"./plus-BqnObetA.js";import{S as Oe}from"./search-JxzU8s3V.js";import{C as Qe}from"./circle-alert-CYb9jtZK.js";import{C as $e}from"./clock-B7DVr4d-.js";import{C as Xe}from"./circle-check-CvJTW8tj.js";import"./ticketsStore-BNxbAiTN.js";import"./index-D75iUVLY.js";const J=({tickets:i,isLoading:b,onDelete:t,onClaim:l,onComplete:v,onUnassign:A,showActions:y=!0})=>{const{hasPermission:N}=K();return b?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,u)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},u))}):i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tickets found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(Pe,{children:[e.jsx(De,{children:e.jsxs(X,{className:"border-border",children:[e.jsx(d,{className:"text-foreground",children:"Title"}),e.jsx(d,{className:"text-foreground",children:"Type"}),e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsx(d,{className:"text-foreground",children:"Priority"}),e.jsx(d,{className:"text-foreground",children:"Requester"}),e.jsx(d,{className:"text-foreground",children:"Assignee"}),e.jsx(d,{className:"text-foreground",children:"Created"}),y&&e.jsx(d,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(_e,{children:i.map(a=>{const u=N("view tickets"),m=N("edit tickets"),w=N("delete tickets"),P=u||m||w;return e.jsxs(X,{className:"border-border hover:bg-accent/50",children:[e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:a.description})]})}),e.jsx(x,{children:e.jsx(Se,{type:a.type})}),e.jsx(x,{children:e.jsx(Be,{status:a.status})}),e.jsx(x,{children:e.jsx(Ee,{priority:a.priority})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-6 h-6",children:e.jsx(G,{className:"bg-primary text-primary-foreground text-xs",children:a.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.requester?.name||"Unknown User"})]})}),e.jsx(x,{children:a.assignee?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-6 h-6",children:e.jsx(G,{className:"bg-chart-2 text-white text-xs",children:a.assignee.name?.charAt(0).toUpperCase()||"A"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.assignee.name})]}):e.jsx(Ue,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(x,{className:"text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),y&&e.jsx(x,{children:P?e.jsxs(xe,{children:[e.jsx(me,{asChild:!0,children:e.jsx(W,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(Ie,{className:"h-4 w-4"})})}),e.jsxs(he,{align:"end",className:"bg-popover border-border",children:[u&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/tickets/${a.id}`,className:"flex items-center",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"View"]})}),m&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/tickets/${a.id}/edit`,className:"flex items-center",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Edit"]})}),m&&a.is_available&&e.jsxs(j,{onClick:()=>l(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Claim"]}),m&&a.is_assigned&&a.status==="in_progress"&&e.jsxs(j,{onClick:()=>v(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Complete"]}),m&&a.is_assigned&&a.status!=="resolved"&&e.jsxs(j,{onClick:()=>A(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Unassign"]}),w&&e.jsxs(j,{onClick:()=>t(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},a.id)})})]})})},ps=()=>{const{tickets:i,availableTickets:b,pagination:t,availablePagination:l,isLoading:v,deleteTicket:A,claimTicket:y,assignTicket:N,completeTicket:a,unassignTicket:u,goToPage:m,goToAvailablePage:w,nextPage:P,prevPage:Y,nextAvailablePage:Z,prevAvailablePage:ee}=ke(),{searchQuery:se,setSearchQuery:ae}=Ae(),{hasPermission:h}=K(),[n,g]=ge.useState(null),U=async s=>{h("delete tickets")&&g({type:"delete",id:s})},S=async s=>{h("edit tickets")&&await y(s)},B=async(s,r)=>{h("edit tickets")&&await N(s,r)},E=async s=>{h("edit tickets")&&await a(s)},I=async s=>{h("edit tickets")&&g({type:"unassign",id:s})},re=async()=>{if(n){if(n.type==="delete"){if(!h("delete tickets")){g(null);return}await A(n.id)}else if(n.type==="unassign"){if(!h("edit tickets")){g(null);return}await u(n.id)}g(null)}},te=i.filter(s=>s.status==="open").length,le=i.filter(s=>s.status==="in_progress").length,ne=i.filter(s=>s.status==="resolved").length,L=s=>{if(!s)return[];const r=[],{current_page:p,last_page:C}=s;p>3&&(r.push(1),p>4&&r.push("ellipsis-start"));for(let D=Math.max(1,p-2);D<=Math.min(C,p+2);D++)r.push(D);return p<C-2&&(p<C-3&&r.push("ellipsis-end"),r.push(C)),r},ie=n?.type==="delete"?"Delete ticket":n?.type==="unassign"?"Unassign ticket":"",ce=n?.type==="delete"?"Are you sure you want to delete this ticket? This action cannot be undone.":n?.type==="unassign"?"Are you sure you want to unassign this ticket? It will become available for others to claim.":"",oe=n?.type==="delete"?"Delete":n?.type==="unassign"?"Unassign":"Confirm",de=n?.type==="delete"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-primary text-primary-foreground hover:bg-primary/90";return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(M,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support tickets and track resolution"})]})]}),e.jsx(W,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(_,{to:"/tickets/create",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"New Ticket"]})})]}),e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(ue,{placeholder:"Search tickets (subject, requester, ID)â€¦",value:se,onChange:s=>ae(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsx("div",{className:"hidden lg:block"}),e.jsx("div",{className:"hidden lg:block"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered/page)"}),e.jsx(M,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t?.total||i.length||0})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Open (page)"}),e.jsx(Qe,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:te})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx($e,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:le})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Resolved (page)"}),e.jsx(Xe,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ne})})]})]}),e.jsxs(pe,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(je,{className:"bg-muted",children:[e.jsxs(q,{value:"all",children:["All Tickets (",t?.total||i.length,")"]}),e.jsxs(q,{value:"available",children:["Available (",l?.total||b.length,")"]})]}),e.jsxs(R,{value:"all",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(J,{tickets:i,isLoading:v,onDelete:async s=>{await U(s)},onClaim:async s=>{await S(s)},onAssign:async(s,r)=>{await B(s,r)},onComplete:async s=>{await E(s)},onUnassign:async s=>{await I(s)}})})})}),t&&t.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",t.from||0," to ",t.to||0," of ",t.total||0," results"]}),e.jsx(H,{children:e.jsxs(F,{children:[e.jsx(f,{children:e.jsx(V,{onClick:Y,className:t.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),L(t).map((s,r)=>e.jsx(f,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(O,{}):e.jsx(Q,{onClick:()=>m(s),isActive:t.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(f,{children:e.jsx($,{onClick:P,className:t.current_page===t.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(R,{value:"available",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(J,{tickets:b,isLoading:v,onDelete:async s=>{await U(s)},onClaim:async s=>{await S(s)},onAssign:async(s,r)=>{await B(s,r)},onComplete:async s=>{await E(s)},onUnassign:async s=>{await I(s)}})})})}),l&&l.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",l.from||0," to ",l.to||0," of ",l.total||0," results"]}),e.jsx(H,{children:e.jsxs(F,{children:[e.jsx(f,{children:e.jsx(V,{onClick:ee,className:l.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),L(l).map((s,r)=>e.jsx(f,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(O,{}):e.jsx(Q,{onClick:()=>w(s),isActive:l.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(f,{children:e.jsx($,{onClick:Z,className:l.current_page===l.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]}),e.jsx(fe,{open:n!==null,onOpenChange:s=>!s&&g(null),children:e.jsxs(Ne,{className:"sm:max-w-[480px]",children:[e.jsxs(be,{children:[e.jsx(ve,{children:ie}),e.jsx(ye,{children:ce})]}),e.jsxs(we,{children:[e.jsx(Ce,{onClick:()=>g(null),children:"Cancel"}),e.jsx(Te,{onClick:re,className:de,children:oe})]})]})})]})};export{ps as default};
