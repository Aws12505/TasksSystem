import{R as s,j as e,C as F,f as y,I as p,bn as N,B as I,x as b}from"./index-Cj_ZlKJu.js";import{u as _}from"./useProfile-DKOeXGyL.js";import{L as E}from"./label-D5sTaFLO.js";const M=5*1024*1024,O=/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;function z(){const{me:r,loading:U,saveProfile:w}=_(),[u,P]=s.useState(""),[o,R]=s.useState(""),[v,S]=s.useState(null),[t,d]=s.useState(null),[l,x]=s.useState(null),[i,f]=s.useState(null),[c,m]=s.useState(null);s.useEffect(()=>(r&&(P(r.name),R(r.email),d(r.avatar_url||null),x(null),f(null),m(null)),()=>{t&&URL.revokeObjectURL(t)}),[r]);const h=a=>!a||a.trim().length<3?(x("Name must be at least 3 characters."),!1):(x(null),!0),g=a=>O.test(a)?(f(null),!0):(f("Please enter a valid email address."),!1),L=a=>a&&a.size>M?(m("Image must be 5 MB or smaller."),!1):(m(null),!0),A=a=>{const n=a.target.files?.[0]||null;if(t&&URL.revokeObjectURL(t),!L(n)){S(null),d(r?.avatar_url||null),b.error("Image must be 5 MB or smaller."),a.currentTarget.value="";return}if(S(n),n){const j=URL.createObjectURL(n);d(j)}else d(r?.avatar_url||null)},B=async a=>{a.preventDefault();const n=h(u),j=g(o),C=L(v);if(!n||!j||!C){b.error("Please fix the highlighted fields.");return}await w({name:u.trim(),email:o.trim(),avatar:v||void 0})&&(v&&t&&URL.revokeObjectURL(t),b.success("Saved"))},k=!!l||!!i||!!c||!u||!o;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Profile information"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Update your name, email, and photo"})]}),e.jsx(F,{children:e.jsx(y,{className:"pt-6",children:e.jsxs("form",{onSubmit:B,className:"space-y-6",noValidate:!0,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"name",children:"Name"}),e.jsx(p,{id:"name",value:u,onChange:a=>{P(a.target.value),l&&h(a.target.value)},onBlur:a=>h(a.target.value),required:!0,"aria-invalid":!!l,className:N(l&&"border-destructive")}),l&&e.jsx("p",{className:"text-xs text-destructive",children:l})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"email",children:"Email address"}),e.jsx(p,{id:"email",type:"email",value:o,onChange:a=>{R(a.target.value),i&&g(a.target.value)},onBlur:a=>g(a.target.value),required:!0,"aria-invalid":!!i,className:N(i&&"border-destructive")}),i&&e.jsx("p",{className:"text-xs text-destructive",children:i})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"avatar",children:"Photo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 rounded-full overflow-hidden bg-muted",children:t&&e.jsx("img",{src:t,alt:"avatar preview",className:"h-full w-full object-cover"})}),e.jsx(p,{id:"avatar",type:"file",accept:"image/*",onChange:A,className:N("max-w-xs",c&&"border-destructive"),"aria-invalid":!!c})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"JPG/PNG/WebP, up to 5MB."}),c&&e.jsx("p",{className:"text-xs text-destructive",children:c})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(I,{disabled:U||k,children:"Save"})})]})})})]})}export{z as default};
