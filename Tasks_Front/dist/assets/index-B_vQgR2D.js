import{p as te,j as e,D as je,q as pe,B as ne,v as ge,w as p,x as U,R as B,at as E,I as fe,U as Ne}from"./index-aIDF15FF.js";import{C as n,d as c,a as y,b as k}from"./card-DegwiSso.js";import{T as be,a as ve,b as I,c as L}from"./tabs-Db7uKoCT.js";import{P as R,a as F,b as h,c as Q,d as V,e as O,f as $}from"./pagination-B4XyrHhv.js";import{A as X,a as z,b as G,c as J,d as K,e as W,f as Y,g as Z}from"./alert-dialog-ds1JXdri.js";import{u as we}from"./useHelpRequests-3mItZqAs.js";import{u as Ce}from"./filtersStore-jmA0_qHt.js";import{T as ye,a as ke,b as ee,c as o,d as Ae,e as d}from"./table-DocBqU00.js";import{A as se,a as ae}from"./avatar-Dx134Ua-.js";import{B as re}from"./badge-D7aLlcYV.js";import{H as Te,a as De}from"./HelpRequestRatingBadge-D77yj2vd.js";import{E as Pe}from"./ellipsis-DsHtDR5U.js";import{E as Ue}from"./eye-C1We8Kzb.js";import{S as _e}from"./square-pen-B8hD18R8.js";import{U as qe,a as He,C as Se}from"./user-x-C9Gp7lqb.js";import{T as Me}from"./trash-2-CAuoNeFC.js";import{P as Be}from"./plus-DsrYCZRf.js";import{S as Ee}from"./search-xnRKQA1g.js";import{C as Ie}from"./clock-B8DslE4V.js";import"./helpRequestsStore-ChHQjAuT.js";import"./index-CT1d_Ntm.js";const le=({helpRequests:i,isLoading:u,onDelete:r,onClaim:l,onUnclaim:g,showActions:f=!0})=>{const{hasPermission:j}=te();return u?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,x)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},x))}):i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No help requests found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(ye,{children:[e.jsx(ke,{children:e.jsxs(ee,{className:"border-border",children:[e.jsx(o,{className:"text-foreground",children:"Description"}),e.jsx(o,{className:"text-foreground",children:"Task"}),e.jsx(o,{className:"text-foreground",children:"Requester"}),e.jsx(o,{className:"text-foreground",children:"Helper"}),e.jsx(o,{className:"text-foreground",children:"Status"}),e.jsx(o,{className:"text-foreground",children:"Rating"}),e.jsx(o,{className:"text-foreground",children:"Created"}),f&&e.jsx(o,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(Ae,{children:i.map(a=>{const x=j("view help requests"),N=j("edit help requests"),b=j("delete help requests"),A=x||N||b;return e.jsxs(ee,{className:"border-border hover:bg-accent/50",children:[e.jsx(d,{children:e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:a.description})})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.task?.name||"Unknown Task"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.task?.section?.project?.name||"Unknown Project"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-6 h-6",children:e.jsx(ae,{className:"bg-primary text-primary-foreground text-xs",children:a.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.requester?.name||"Unknown User"})]})}),e.jsx(d,{children:a.helper?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-6 h-6",children:e.jsx(ae,{className:"bg-chart-2 text-white text-xs",children:a.helper.name?.charAt(0).toUpperCase()||"H"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.helper.name})]}):e.jsx(re,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(d,{children:e.jsx(Te,{helpRequest:a})}),e.jsx(d,{children:a.rating?e.jsx(De,{rating:a.rating,penaltyMultiplier:a.penalty_multiplier}):e.jsx(re,{variant:"outline",className:"text-xs",children:"Not Rated"})}),e.jsx(d,{className:"text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),f&&e.jsx(d,{children:A?e.jsxs(je,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(ne,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",className:"bg-popover border-border",children:[x&&e.jsx(p,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(U,{to:`/help-requests/${a.id}`,className:"flex items-center",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"View"]})}),N&&e.jsx(p,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(U,{to:`/help-requests/${a.id}/edit`,className:"flex items-center",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Edit"]})}),a.is_available&&e.jsxs(p,{onClick:()=>l(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Claim"]}),a.is_claimed&&!a.is_completed&&e.jsxs(p,{onClick:()=>g(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),b&&e.jsxs(p,{onClick:()=>r(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},a.id)})})]})})},ns=()=>{const{helpRequests:i,availableHelpRequests:u,pagination:r,availablePagination:l,isLoading:g,deleteHelpRequest:f,claimHelpRequest:j,unclaimHelpRequest:a,goToPage:x,goToAvailablePage:N,nextPage:b,prevPage:A,nextAvailablePage:ce,prevAvailablePage:ie}=we(),{searchQuery:oe,setSearchQuery:de}=Ce(),{hasPermission:_}=te(),[T,v]=B.useState(null),[D,w]=B.useState(null),q=async s=>{_("delete help requests")&&v(s)},xe=async()=>{T!=null&&(await f(T),v(null))},H=async s=>{await j(s)},S=async s=>{w(s)},me=async()=>{D!=null&&(await a(D),w(null))},he=i.filter(s=>s.is_completed).length,ue=i.filter(s=>s.is_claimed&&!s.is_completed).length,M=s=>{if(!s)return[];const t=[],{current_page:m,last_page:C}=s;m>3&&(t.push(1),m>4&&t.push("ellipsis-start"));for(let P=Math.max(1,m-2);P<=Math.min(C,m+2);P++)t.push(P);return m<C-2&&(m<C-3&&t.push("ellipsis-end"),t.push(C)),t};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Help Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support requests and provide assistance"})]})]}),_("create help requests")&&e.jsx(ne,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(U,{to:"/help-requests/create",children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"Request Help"]})})]}),e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(fe,{placeholder:"Search help requestsâ€¦",value:oe,onChange:s=>de(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsx("div",{className:"hidden lg:block"}),e.jsx("div",{className:"hidden lg:block"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"}),e.jsx(E,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total||i.length||0})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Available"}),e.jsx(Ie,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:l?.total||u.length||0})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(Ne,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ue})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Completed (page)"}),e.jsx(Se,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:he})})]})]}),e.jsxs(be,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(ve,{className:"bg-muted",children:[e.jsxs(I,{value:"all",children:["All Requests (",r?.total||i.length,")"]}),e.jsxs(I,{value:"available",children:["Available (",l?.total||u.length,")"]})]}),e.jsxs(L,{value:"all",className:"space-y-4",children:[e.jsx(n,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(c,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(le,{helpRequests:i,isLoading:g,onDelete:q,onClaim:H,onUnclaim:S})})})}),r&&r.last_page>1&&e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total||0," results"]}),e.jsx(R,{children:e.jsxs(F,{children:[e.jsx(h,{children:e.jsx(Q,{onClick:A,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(r).map((s,t)=>e.jsx(h,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(V,{}):e.jsx(O,{onClick:()=>x(s),isActive:r.current_page===s,className:"cursor-pointer",children:s})},t)),e.jsx(h,{children:e.jsx($,{onClick:b,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(L,{value:"available",className:"space-y-4",children:[e.jsx(n,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(c,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(le,{helpRequests:u,isLoading:g,onDelete:q,onClaim:H,onUnclaim:S})})})}),l&&l.last_page>1&&e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",l.from||0," to ",l.to||0," of ",l.total||0," results"]}),e.jsx(R,{children:e.jsxs(F,{children:[e.jsx(h,{children:e.jsx(Q,{onClick:ie,className:l.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(l).map((s,t)=>e.jsx(h,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(V,{}):e.jsx(O,{onClick:()=>N(s),isActive:l.current_page===s,className:"cursor-pointer",children:s})},t)),e.jsx(h,{children:e.jsx($,{onClick:ce,className:l.current_page===l.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]}),e.jsx(X,{open:T!==null,onOpenChange:s=>!s&&v(null),children:e.jsxs(z,{className:"sm:max-w-[480px]",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Delete help request"}),e.jsx(K,{children:"Are you sure you want to delete this help request? This action cannot be undone."})]}),e.jsxs(W,{children:[e.jsx(Y,{onClick:()=>v(null),children:"Cancel"}),e.jsx(Z,{onClick:xe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(X,{open:D!==null,onOpenChange:s=>!s&&w(null),children:e.jsxs(z,{className:"sm:max-w-[480px]",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Unclaim help request"}),e.jsx(K,{children:"Are you sure you want to unclaim this help request? It will become available for others to claim."})]}),e.jsxs(W,{children:[e.jsx(Y,{onClick:()=>w(null),children:"Cancel"}),e.jsx(Z,{onClick:me,children:"Unclaim"})]})]})})]})};export{ns as default};
