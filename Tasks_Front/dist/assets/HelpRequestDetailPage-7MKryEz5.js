import{R as _,a as F,b as B,o as L,j as e,ax as O,ay as T,B as l,az as z,aA as M,aB as P,r as I,v as V,w as E,x as G,y as J,L as K,ar as Q,K as X,z as $,m as y,C as a,f as r,J as C,c as m,d as o,A as w,p as q,q as k,a4 as W}from"./index-eqiCeC4f.js";import{u as Y}from"./useHelpRequest-Be7i5J70.js";import{H as Z,a as ee}from"./HelpRequestRatingBadge-C_D06SRq.js";import{F as se,a as ae,b as re,c as le,d as te,e as ie}from"./form-BovIvNMg.js";import{B as ce}from"./badge-D0mLi0HD.js";import{C as ne}from"./circle-check-big-QfIh2BhI.js";import{A as de,a as me,b as oe,c as xe,d as he,e as pe,f as ue,g as je}from"./alert-dialog-fc__Rey7.js";import{A as R}from"./arrow-left-DkRCtrgk.js";import{U as ge,a as fe}from"./user-x-C7yK5Mtv.js";import{S as Ne}from"./square-pen-fLz-K25m.js";import{C as N}from"./calendar-mrwJJIgs.js";import{U as be}from"./user-C5sEVEL3.js";import"./helpRequestsStore-BP5r0281.js";import"./label-Bw_Gm6VM.js";const ve=L({rating:Q(["legitimate_learning","basic_skill_gap","careless_mistake","fixing_own_mistakes"])}),ye=({ratingOptions:u,onComplete:s,isLoading:i=!1,trigger:x})=>{const[h,d]=_.useState(!1),c=F({resolver:B(ve)}),j=async n=>{await s(n),d(!1),c.reset()};return e.jsxs(O,{open:h,onOpenChange:d,children:[e.jsx(T,{asChild:!0,children:x||e.jsxs(l,{className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Complete Request"]})}),e.jsxs(z,{className:"bg-card border-border",children:[e.jsx(M,{children:e.jsx(P,{className:"text-foreground",children:"Complete Help Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please rate this help request to help improve our system and provide feedback to users."}),e.jsx(se,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(j),className:"space-y-6",children:[e.jsx(ae,{control:c.control,name:"rating",render:({field:n})=>e.jsxs(re,{children:[e.jsx(le,{className:"text-foreground",children:"Rating Category"}),e.jsxs(I,{onValueChange:n.onChange,disabled:i,children:[e.jsx(te,{children:e.jsx(V,{className:"bg-background border-input text-foreground",children:e.jsx(E,{placeholder:"Select rating category"})})}),e.jsx(G,{children:u.map(t=>e.jsx(J,{value:t.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:t.label}),e.jsxs(ce,{variant:"outline",className:"ml-2 text-xs",children:[t.penalty,"x penalty"]})]})},t.value))})]}),e.jsx(ie,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-2 p-4 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Rating Guidelines:"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Legitimate Learning (0.1x):"})," Valid learning opportunity, minimal penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Basic Skill Gap (0.3x):"})," Missing fundamental skills, moderate penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Careless Mistake (0.6x):"})," Avoidable error, significant penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fixing Own Mistakes (0.8x):"})," Fixing self-created issues, high penalty"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:i,children:"Cancel"}),e.jsxs(l,{type:"submit",disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(K,{className:"mr-2 h-4 w-4 animate-spin"}),"Complete Request"]})]})]})})]})]})]})},Oe=()=>{const{id:u}=X(),{helpRequest:s,ratingOptions:i,isLoading:x,error:h,claimRequest:d,completeRequest:c,unclaimRequest:j}=Y(u),{user:n}=$(),t=!!n&&!!s&&n.id===s.helper_id,g=!!s&&s.is_claimed&&!s.is_completed&&t,b=!!s&&s.is_claimed&&!s.is_completed&&t,v=!!s&&s.is_available,[A,p]=_.useState(!1),S=async()=>{v&&await d()},U=()=>{g&&p(!0)},D=async()=>{g&&(await j(),p(!1))},H=async f=>{b&&await c(f)};return x?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-64 mt-2"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",disabled:!0,children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(a,{className:"bg-card border-border lg:col-span-2",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded w-40"}),e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-12 bg-muted animate-pulse rounded"})})}),e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-12 bg-muted animate-pulse rounded"})})}),e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded"})})})]})]})]})}):h||!s?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsx("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-8 text-center",children:e.jsx("p",{className:"text-destructive",children:h||"Help request not found"})})})})}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground font-sans",children:["Help Request #",s.id]}),e.jsx(Z,{helpRequest:s})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs(l,{variant:"outline",size:"sm",onClick:S,children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Claim"]}),g&&e.jsxs(l,{variant:"outline",size:"sm",onClick:U,children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),b&&e.jsx(ye,{ratingOptions:i,onComplete:H,isLoading:x}),e.jsx(l,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",size:"sm",children:e.jsxs(C,{to:`/help-requests/${s.id}/edit`,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Edit"]})}),e.jsx(l,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(C,{to:"/help-requests",className:"flex items-center",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Request Details"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Related Task"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.task?.name||"Unknown Task"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Project: ",s.task?.section?.project?.name||"Unknown Project"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Section: ",s.task?.section?.name||"Unknown Section"]})]})]}),s.is_completed&&s.completed_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed At"}),e.jsxs("p",{className:"text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),new Date(s.completed_at).toLocaleString()]})]})]})]}),s.rating&&e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Request Rating"})}),e.jsx(r,{children:e.jsx(ee,{rating:s.rating,penaltyMultiplier:s.penalty_multiplier})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Requester"]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(w,{className:"w-10 h-10",children:[typeof s.requester?.avatar_url=="string"&&s.requester?.avatar_url.trim()!==""&&e.jsx(q,{src:s.requester?.avatar_url,alt:s.requester?.name||"User avatar",className:"object-cover"}),e.jsx(k,{className:"bg-primary text-primary-foreground",children:s.requester?.name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.requester?.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.requester?.email})]})]})})]}),e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Helper"]})}),e.jsx(r,{children:s.helper?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(w,{className:"w-10 h-10",children:[typeof s.helper.avatar_url=="string"&&s.helper.avatar_url.trim()!==""&&e.jsx(q,{src:s.helper.avatar_url,alt:s.helper.name||"User avatar",className:"object-cover"}),e.jsx(k,{className:"bg-chart-2 text-white",children:s.helper.name?.charAt(0).toUpperCase()||"H"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.helper.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.helper.email})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No helper assigned yet"})})]}),e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Timeline"})}),e.jsxs(r,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.completed_at).toLocaleDateString()})]})]})]})]})]})]}),e.jsx(de,{open:A,onOpenChange:f=>!f&&p(!1),children:e.jsxs(me,{className:"sm:max-w-[480px]",children:[e.jsxs(oe,{children:[e.jsx(xe,{children:"Unclaim help request"}),e.jsx(he,{children:"Are you sure you want to unclaim this help request? It will become available for others to claim."})]}),e.jsxs(pe,{children:[e.jsx(ue,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(je,{onClick:D,children:"Unclaim"})]})]})})]})};export{Oe as default};
