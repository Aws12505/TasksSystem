import{a7 as y,a as C,b as w,o as q,j as e,ao as k,ap as R,B as a,aq as S,ar as _,as as H,F as U,c as D,d as F,e as A,K as B,f as L,M,N as P,O as T,P as O,g as z,L as V,ag as E,y as G,x as g,an as I,C as K,S as Q}from"./index-Bm-EtB5S.js";import{C as c,a as d,b as m,d as o}from"./card-AVhO3b2r.js";import{A as f,a as N}from"./avatar-CT6WevJD.js";import{u as X}from"./useHelpRequest-DV8e9rxq.js";import{H as $,a as J}from"./HelpRequestRatingBadge-Wz4opcQa.js";import{B as W}from"./badge-CeiX6K4U.js";import{C as Y}from"./circle-check-big-BxEeinY3.js";import{A as Z}from"./arrow-left-sngDabfr.js";import{U as ee,a as se}from"./user-x-Q3zYIH2d.js";import{S as ae}from"./square-pen-DiL2gMIn.js";import{C as j}from"./calendar-G9w6Qs0U.js";import"./index-CZG2v3aK.js";import"./helpRequestsStore-D2O53TCn.js";const re=q({rating:E(["legitimate_learning","basic_skill_gap","careless_mistake","fixing_own_mistakes"])}),te=({ratingOptions:p,onComplete:s,isLoading:r=!1,trigger:x})=>{const[h,i]=y.useState(!1),t=C({resolver:w(re)}),u=async n=>{await s(n),i(!1),t.reset()};return e.jsxs(k,{open:h,onOpenChange:i,children:[e.jsx(R,{asChild:!0,children:x||e.jsxs(a,{className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Complete Request"]})}),e.jsxs(S,{className:"bg-card border-border",children:[e.jsx(_,{children:e.jsx(H,{className:"text-foreground",children:"Complete Help Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please rate this help request to help improve our system and provide feedback to users."}),e.jsx(U,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(u),className:"space-y-6",children:[e.jsx(D,{control:t.control,name:"rating",render:({field:n})=>e.jsxs(F,{children:[e.jsx(A,{className:"text-foreground",children:"Rating Category"}),e.jsxs(B,{onValueChange:n.onChange,disabled:r,children:[e.jsx(L,{children:e.jsx(M,{className:"bg-background border-input text-foreground",children:e.jsx(P,{placeholder:"Select rating category"})})}),e.jsx(T,{children:p.map(l=>e.jsx(O,{value:l.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:l.label}),e.jsxs(W,{variant:"outline",className:"ml-2 text-xs",children:[l.penalty,"x penalty"]})]})},l.value))})]}),e.jsx(z,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-2 p-4 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Rating Guidelines:"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Legitimate Learning (0.1x):"})," Valid learning opportunity, minimal penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Basic Skill Gap (0.3x):"})," Missing fundamental skills, moderate penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Careless Mistake (0.6x):"})," Avoidable error, significant penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fixing Own Mistakes (0.8x):"})," Fixing self-created issues, high penalty"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(a,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:r,children:"Cancel"}),e.jsxs(a,{type:"submit",disabled:r,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[r&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Complete Request"]})]})]})})]})]})]})},fe=()=>{const{id:p}=G(),{helpRequest:s,ratingOptions:r,isLoading:x,error:h,claimRequest:i,completeRequest:t,unclaimRequest:u}=X(p);if(x)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(h||!s)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:h||"Help request not found"})});const n=async()=>{await i()},l=async()=>{window.confirm("Are you sure you want to unclaim this help request?")&&await u()},b=async v=>{await t(v)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(a,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(g,{to:"/help-requests",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground font-sans",children:["Help Request #",s.id]}),e.jsx($,{helpRequest:s})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.is_available&&e.jsxs(a,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Claim Request"]}),s.is_claimed&&!s.is_completed&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),e.jsx(te,{ratingOptions:r,onComplete:b,isLoading:x})]}),e.jsx(a,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(g,{to:`/help-requests/${s.id}/edit`,children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Edit"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Request Details"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Related Task"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.task?.name||"Unknown Task"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Project: ",s.task?.section?.project?.name||"Unknown Project"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Section: ",s.task?.section?.name||"Unknown Section"]})]})]}),s.is_completed&&s.completed_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed At"}),e.jsxs("p",{className:"text-foreground flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),new Date(s.completed_at).toLocaleString()]})]})]})]}),s.rating&&e.jsxs(c,{className:"bg-card border-border mt-6",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Request Rating"})}),e.jsx(o,{children:e.jsx(J,{rating:s.rating,penaltyMultiplier:s.penalty_multiplier})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(m,{className:"text-foreground flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Requester"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-10 h-10",children:e.jsx(N,{className:"bg-primary text-primary-foreground",children:s.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.requester?.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.requester?.email})]})]})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(m,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),"Helper"]})}),e.jsx(o,{children:s.helper?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-10 h-10",children:e.jsx(N,{className:"bg-chart-2 text-white",children:s.helper.name?.charAt(0).toUpperCase()||"H"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.helper.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.helper.email})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No helper assigned yet"})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Timeline"})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.completed_at).toLocaleDateString()})]})]})]})]})]})]})};export{fe as default};
