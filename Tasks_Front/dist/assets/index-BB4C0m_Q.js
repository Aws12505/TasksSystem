import{q as F,j as e,B as k,ag as R,D as $,v as q,w as H,x as w,y as S,n as V,W as Q,r as I,S as g,p as z,I as W,M as O,N as U,O as G,P as J,Q as j,ah as K}from"./index-CJetGwO1.js";import{C as f,d as p,a as y,b as C}from"./card-CM5R7BK3.js";import{u as X}from"./filtersStore-DwCfmhQz.js";import{T as Y,a as Z,b as _,c,d as ee,e as i}from"./table-aLBClH0g.js";import{B as L}from"./badge-B-I15EGM.js";import{T as se,a as re}from"./TaskPriorityBadge-Dy8eCiBf.js";import{C as ae}from"./calendar-Czyi2Tg8.js";import{P as te}from"./play-veIKrZ0X.js";import{E as ne}from"./ellipsis-DkHXBEp7.js";import{E as le}from"./eye-WaTqYOYn.js";import{S as ce}from"./square-pen-CzmLflYk.js";import{T as ie}from"./trash-2-DLQ2LF8Y.js";import{P as de}from"./plus-BrZxr_o5.js";const oe=({tasks:o,isLoading:T,onDelete:P,onStatusChange:N,assigneesMap:m={}})=>{const{hasPermission:t,hasAnyPermission:A}=F();return T?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((r,n)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},n))}):o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tasks found in this section"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(_,{className:"border-border",children:[e.jsx(c,{className:"text-foreground",children:"Task"}),e.jsx(c,{className:"text-foreground",children:"Status"}),e.jsx(c,{className:"text-foreground",children:"Priority"}),e.jsx(c,{className:"text-foreground",children:"Assignees"})," ",e.jsx(c,{className:"text-foreground",children:"Due Date"}),e.jsx(c,{className:"text-foreground",children:"Subtasks"}),e.jsx(c,{className:"text-foreground w-[260px]",children:"Actions"})," "]})}),e.jsx(ee,{children:o.map(r=>{const n=t("view tasks"),x=t("edit tasks"),h=t("delete tasks"),b=A(["create task ratings","edit task ratings"]),D=n||x||h||b,a=m[r.id]||[];return e.jsxs(_,{className:"border-border hover:bg-accent/50",children:[e.jsx(i,{children:e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:r.name})})}),e.jsx(i,{children:e.jsx(se,{status:r.status})}),e.jsx(i,{children:e.jsx(re,{priority:r.priority})}),e.jsx(i,{children:a.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:a.map(s=>e.jsxs(L,{variant:"outline",className:"text-xs",children:[s.name," ",typeof s.percentage=="number"?`· ${s.percentage}%`:""]},s.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"w-4 h-4"}),new Date(r.due_date).toLocaleDateString()]})}),e.jsx(i,{children:e.jsxs(L,{variant:"secondary",className:"text-xs",children:[r.subtasks?.length||0," subtasks"]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[x&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{size:"sm",variant:"secondary",className:"h-8",onClick:()=>N(r.id,"in_progress"),disabled:r.status==="in_progress"||r.status==="done",title:"Mark In Progress",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(k,{size:"sm",className:"h-8",onClick:()=>N(r.id,"done"),disabled:r.status==="done",title:"Mark Complete",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),D&&e.jsxs($,{children:[e.jsx(q,{asChild:!0,children:e.jsx(k,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",title:"More actions",children:e.jsx(ne,{className:"h-4 w-4"})})}),e.jsxs(H,{align:"end",className:"bg-popover border-border",children:[n&&e.jsx(w,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(S,{to:`/tasks/${r.id}`,className:"flex items-center",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"View"]})}),x&&e.jsx(w,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(S,{to:`/tasks/${r.id}/edit`,className:"flex items-center",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Edit"]})}),b&&e.jsx(w,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(S,{to:`/ratings/tasks/${r.id}`,className:"flex items-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),"Rate Task"]})}),h&&e.jsxs(w,{onClick:()=>P(r.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},r.id)})})]})})},Ce=()=>{const{tasks:o,isLoading:T,deleteTask:P,updateTaskStatus:N}=Q(),{searchQuery:m,statusFilter:t,setSearchQuery:A,setStatusFilter:r}=X(),{hasPermission:n}=F(),[x,h]=I.useState({}),b=async s=>{n("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await P(s)},D=async(s,l)=>{n("edit tasks")&&await N(s,{status:l})},a=I.useMemo(()=>{const s=m.toLowerCase();return o.filter(l=>{const M=l.name.toLowerCase().includes(s)||l.description?.toLowerCase().includes(s),v=t==="all"||l.status===t;return M&&v})},[o,m,t]);return I.useEffect(()=>{(async()=>{if(!a.length){h({});return}const l=Array.from(new Set(a.map(d=>d.section_id))),M=await Promise.allSettled(l.map(d=>K.getSectionTasksWithAssignments(d))),v={};M.forEach(d=>{if(d.status!=="fulfilled")return;const E=d.value;!E?.success||!Array.isArray(E.data)||E.data.forEach(B=>{v[B.id]=(B.assigned_users||[]).map(u=>({id:u.id,name:u.name??u.email??`User #${u.id}`,percentage:u.pivot?.percentage??0}))})}),h(v)})()},[a]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(g,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your tasks and track progress"})]})]}),n("create tasks")&&e.jsx(k,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(S,{to:"/tasks/create",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"New Task"]})})]}),e.jsx(f,{className:"bg-card border-border",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(W,{placeholder:"Search tasks...",value:m,onChange:s=>A(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsxs(O,{value:t,onValueChange:r,children:[e.jsx(U,{className:"w-48",children:e.jsx(G,{placeholder:"Filter by status"})}),e.jsxs(J,{children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"in_progress",children:"In Progress"}),e.jsx(j,{value:"done",children:"Done"}),e.jsx(j,{value:"rated",children:"Rated"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(f,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Total Tasks"}),e.jsx(g,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.length})})]}),e.jsxs(f,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"In Progress"}),e.jsx(g,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.filter(s=>s.status==="in_progress").length})})]}),e.jsxs(f,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx(g,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.filter(s=>s.status==="done").length})})]}),e.jsxs(f,{className:"bg-card border-border",children:[e.jsxs(y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(C,{className:"text-sm font-medium text-muted-foreground",children:"High Priority"}),e.jsx(g,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:a.filter(s=>s.priority==="high"||s.priority==="critical").length})})]})]}),e.jsx(oe,{tasks:a,isLoading:T,onDelete:b,onStatusChange:D,assigneesMap:x})]})};export{Ce as default};
