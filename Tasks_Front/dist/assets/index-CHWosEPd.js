import{q as z,j as e,D as ee,v as se,B as G,w as ae,x as j,y as k,aq as q,p as re,I as te,U as le}from"./index-BOfNqdHU.js";import{C as o,d,a as w,b as y}from"./card-VRr8nV95.js";import{T as ne,a as ce,b as D,c as S}from"./tabs-DMxlCYjJ.js";import{P as M,a as B,b as h,c as E,d as L,e as I,f as Q}from"./pagination-Dwx5XK5W.js";import{u as ie}from"./useHelpRequests-CIzjgfPz.js";import{u as oe}from"./filtersStore-BXwbMU63.js";import{T as de,a as me,b as V,c,d as xe,e as i}from"./table-C-IIjzmt.js";import{A as F,a as $}from"./avatar-topmWw3Q.js";import{B as R}from"./badge-XdKDng72.js";import{H as he,a as ue}from"./HelpRequestRatingBadge-CPeH9VZO.js";import{E as pe}from"./ellipsis-Br2SwrZN.js";import{E as je}from"./eye-BRQmxKBX.js";import{S as ge}from"./square-pen-DRxYo37W.js";import{U as fe,a as Ne}from"./user-x-C8FtvviY.js";import{T as be}from"./trash-2-DSrtDu12.js";import{P as ve}from"./plus-ZkbNUsEY.js";import{C as we}from"./clock-Bv9DBnNH.js";import{C as ye}from"./circle-check-big-BPiWnqi0.js";import"./helpRequestsStore-BJVX-bKs.js";import"./index-ChJeZxSk.js";const X=({helpRequests:n,isLoading:u,onDelete:r,onClaim:t,onUnclaim:g,showActions:f=!0})=>{const{hasPermission:p}=z();return u?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,m)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},m))}):n.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No help requests found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(de,{children:[e.jsx(me,{children:e.jsxs(V,{className:"border-border",children:[e.jsx(c,{className:"text-foreground",children:"Description"}),e.jsx(c,{className:"text-foreground",children:"Task"}),e.jsx(c,{className:"text-foreground",children:"Requester"}),e.jsx(c,{className:"text-foreground",children:"Helper"}),e.jsx(c,{className:"text-foreground",children:"Status"}),e.jsx(c,{className:"text-foreground",children:"Rating"}),e.jsx(c,{className:"text-foreground",children:"Created"}),f&&e.jsx(c,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(xe,{children:n.map(a=>{const m=p("view help requests"),N=p("edit help requests"),b=p("delete help requests"),C=m||N||b;return e.jsxs(V,{className:"border-border hover:bg-accent/50",children:[e.jsx(i,{children:e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:a.description})})}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.task?.name||"Unknown Task"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.task?.section?.project?.name||"Unknown Project"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-6 h-6",children:e.jsx($,{className:"bg-primary text-primary-foreground text-xs",children:a.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.requester?.name||"Unknown User"})]})}),e.jsx(i,{children:a.helper?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-6 h-6",children:e.jsx($,{className:"bg-chart-2 text-white text-xs",children:a.helper.name?.charAt(0).toUpperCase()||"H"})}),e.jsx("span",{className:"text-sm text-foreground",children:a.helper.name})]}):e.jsx(R,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(i,{children:e.jsx(he,{helpRequest:a})}),e.jsx(i,{children:a.rating?e.jsx(ue,{rating:a.rating,penaltyMultiplier:a.penalty_multiplier}):e.jsx(R,{variant:"outline",className:"text-xs",children:"Not Rated"})}),e.jsx(i,{className:"text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),f&&e.jsx(i,{children:C?e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(G,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(ae,{align:"end",className:"bg-popover border-border",children:[m&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(k,{to:`/help-requests/${a.id}`,className:"flex items-center",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"View"]})}),N&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(k,{to:`/help-requests/${a.id}/edit`,className:"flex items-center",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Edit"]})}),a.is_available&&e.jsxs(j,{onClick:()=>t(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Claim"]}),a.is_claimed&&!a.is_completed&&e.jsxs(j,{onClick:()=>g(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),b&&e.jsxs(j,{onClick:()=>r(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},a.id)})})]})})},Re=()=>{const{helpRequests:n,availableHelpRequests:u,pagination:r,availablePagination:t,isLoading:g,deleteHelpRequest:f,claimHelpRequest:p,unclaimHelpRequest:a,goToPage:m,goToAvailablePage:N,nextPage:b,prevPage:C,nextAvailablePage:J,prevAvailablePage:K}=ie(),{searchQuery:O,setSearchQuery:W}=oe(),{hasPermission:T}=z(),_=async s=>{T("delete help requests")&&window.confirm("Are you sure you want to delete this help request?")&&await f(s)},A=async s=>{await p(s)},H=async s=>{window.confirm("Are you sure you want to unclaim this help request?")&&await a(s)},Y=n.filter(s=>s.is_completed).length,Z=n.filter(s=>s.is_claimed&&!s.is_completed).length,U=s=>{if(!s)return[];const l=[],{current_page:x,last_page:v}=s;x>3&&(l.push(1),x>4&&l.push("ellipsis-start"));for(let P=Math.max(1,x-2);P<=Math.min(v,x+2);P++)l.push(P);return x<v-2&&(x<v-3&&l.push("ellipsis-end"),l.push(v)),l};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(q,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Help Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support requests and provide assistance"})]})]}),T("create help requests")&&e.jsx(G,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(k,{to:"/help-requests/create",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Request Help"]})})]}),e.jsx(o,{className:"bg-card border-border",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(te,{placeholder:"Search help requests...",value:O,onChange:s=>W(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(o,{className:"bg-card border-border",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"}),e.jsx(q,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total||n.length})})]}),e.jsxs(o,{className:"bg-card border-border",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Available"}),e.jsx(we,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t?.total||u.length})})]}),e.jsxs(o,{className:"bg-card border-border",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"In Progress"}),e.jsx(le,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:Z})})]}),e.jsxs(o,{className:"bg-card border-border",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx(ye,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(d,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:Y})})]})]}),e.jsxs(ne,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(ce,{className:"bg-muted",children:[e.jsxs(D,{value:"all",children:["All Requests (",r?.total||n.length,")"]}),e.jsxs(D,{value:"available",children:["Available (",t?.total||u.length,")"]})]}),e.jsxs(S,{value:"all",className:"space-y-4",children:[e.jsx(X,{helpRequests:n,isLoading:g,onDelete:_,onClaim:A,onUnclaim:H}),r&&r.last_page>1&&e.jsx(o,{className:"bg-card border-border",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total," results"]}),e.jsx(M,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(E,{onClick:C,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),U(r).map((s,l)=>e.jsx(h,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(L,{}):e.jsx(I,{onClick:()=>m(s),isActive:r.current_page===s,className:"cursor-pointer",children:s})},l)),e.jsx(h,{children:e.jsx(Q,{onClick:b,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(S,{value:"available",className:"space-y-4",children:[e.jsx(X,{helpRequests:u,isLoading:g,onDelete:_,onClaim:A,onUnclaim:H}),t&&t.last_page>1&&e.jsx(o,{className:"bg-card border-border",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",t.from||0," to ",t.to||0," of ",t.total," results"]}),e.jsx(M,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(E,{onClick:K,className:t.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),U(t).map((s,l)=>e.jsx(h,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(L,{}):e.jsx(I,{onClick:()=>N(s),isActive:t.current_page===s,className:"cursor-pointer",children:s})},l)),e.jsx(h,{children:e.jsx(Q,{onClick:J,className:t.current_page===t.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]})};export{Re as default};
