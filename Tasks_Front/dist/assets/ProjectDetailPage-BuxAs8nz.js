import{r as p,R as re,j as e,V as ne,W as ie,X as R,Y as oe,Z as ce,_ as le,$ as de,a as me,b as xe,o as ue,F as he,c as $,d as O,e as L,f as M,I as pe,g as U,a0 as ge,B as f,L as je,s as z,q as k,a1 as fe,a2 as Ne,a3 as be,a4 as ve,D as q,v as K,w as W,x as C,S as V,n as B,z as we,a5 as Ce,y,m as I,U as ye,K as Se}from"./index-C58fmmaK.js";import{C as D,a as Y,b as G,d as E}from"./card-DABWnaub.js";import{A as ke,a as Pe}from"./avatar-DOMpWbNP.js";import{P as De}from"./progress-ALQAo2K_.js";import{u as Ee}from"./useProject-D9WrNHjT.js";import{P as Re,K as Te}from"./ProjectStatusBadge-0C_Ye52m.js";import{B as H}from"./badge-BxREaLl8.js";import{L as _e}from"./list-DCrcvjgW.js";import{P as S}from"./plus-Cmz6ajDz.js";import{E as X}from"./ellipsis-CEyDMYb8.js";import{S as T}from"./square-pen-BcqTTc1Q.js";import{T as Z}from"./trash-2-CM04Bbc0.js";import{C as J}from"./calendar-B_b3D614.js";import{A as Ae}from"./arrow-left-0Q4T1YWb.js";import"./index-lYAioNtY.js";var P="Collapsible",[Fe,is]=ne(P),[$e,_]=Fe(P),Q=p.forwardRef((s,t)=>{const{__scopeCollapsible:d,open:n,defaultOpen:r,disabled:m,onOpenChange:o,...g}=s,[c,x]=re({prop:n,defaultProp:r??!1,onChange:o,caller:P});return e.jsx($e,{scope:d,disabled:m,contentId:ie(),open:c,onOpenToggle:p.useCallback(()=>x(u=>!u),[x]),children:e.jsx(R.div,{"data-state":F(c),"data-disabled":m?"":void 0,...g,ref:t})})});Q.displayName=P;var ee="CollapsibleTrigger",se=p.forwardRef((s,t)=>{const{__scopeCollapsible:d,...n}=s,r=_(ee,d);return e.jsx(R.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":F(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...n,ref:t,onClick:oe(s.onClick,r.onOpenToggle)})});se.displayName=ee;var A="CollapsibleContent",te=p.forwardRef((s,t)=>{const{forceMount:d,...n}=s,r=_(A,s.__scopeCollapsible);return e.jsx(ce,{present:d||r.open,children:({present:m})=>e.jsx(Oe,{...n,ref:t,present:m})})});te.displayName=A;var Oe=p.forwardRef((s,t)=>{const{__scopeCollapsible:d,present:n,children:r,...m}=s,o=_(A,d),[g,c]=p.useState(n),x=p.useRef(null),u=le(t,x),N=p.useRef(0),h=N.current,j=p.useRef(0),l=j.current,b=o.open||g,i=p.useRef(b),w=p.useRef(void 0);return p.useEffect(()=>{const a=requestAnimationFrame(()=>i.current=!1);return()=>cancelAnimationFrame(a)},[]),de(()=>{const a=x.current;if(a){w.current=w.current||{transitionDuration:a.style.transitionDuration,animationName:a.style.animationName},a.style.transitionDuration="0s",a.style.animationName="none";const v=a.getBoundingClientRect();N.current=v.height,j.current=v.width,i.current||(a.style.transitionDuration=w.current.transitionDuration,a.style.animationName=w.current.animationName),c(n)}},[o.open,n]),e.jsx(R.div,{"data-state":F(o.open),"data-disabled":o.disabled?"":void 0,id:o.contentId,hidden:!b,...m,ref:u,style:{"--radix-collapsible-content-height":h?`${h}px`:void 0,"--radix-collapsible-content-width":l?`${l}px`:void 0,...s.style},children:b&&r})});function F(s){return s?"open":"closed"}var Le=Q;function Me({...s}){return e.jsx(Le,{"data-slot":"collapsible",...s})}function Ue({...s}){return e.jsx(se,{"data-slot":"collapsible-trigger",...s})}function ze({...s}){return e.jsx(te,{"data-slot":"collapsible-content",...s})}const Be=ue({name:z().min(1,"Section name is required").max(255),description:z().optional()}),ae=({section:s,onSubmit:t,onCancel:d,isLoading:n})=>{const r=me({resolver:xe(Be),defaultValues:{name:s?.name||"",description:s?.description||""}}),m=async o=>{await t(o)};return e.jsx(he,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(m),className:"space-y-4",children:[e.jsx($,{control:r.control,name:"name",render:({field:o})=>e.jsxs(O,{children:[e.jsx(L,{className:"text-foreground",children:"Section Name"}),e.jsx(M,{children:e.jsx(pe,{placeholder:"Enter section name",...o,disabled:n,className:"bg-background border-input text-foreground"})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsx($,{control:r.control,name:"description",render:({field:o})=>e.jsxs(O,{children:[e.jsx(L,{className:"text-foreground",children:"Description"}),e.jsx(M,{children:e.jsx(ge,{placeholder:"Enter section description (optional)",...o,disabled:n,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{type:"submit",size:"sm",disabled:n,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[n&&e.jsx(je,{className:"mr-2 h-3 w-3 animate-spin"}),s?"Update":"Create"]}),e.jsx(f,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:n,children:"Cancel"})]})]})})},Ie=({sections:s,projectId:t,onCreateSection:d,onUpdateSection:n,onDeleteSection:r,isLoading:m})=>{const[o,g]=p.useState(!1),[c,x]=p.useState(null),[u,N]=p.useState(new Set),{hasPermission:h}=k(),{openTaskDialog:j}=fe(),l=async a=>{await d({...a,project_id:t}),g(!1)},b=async a=>{c&&(await n(c.id,a),x(null))},i=async a=>{window.confirm("Are you sure you want to delete this section?")&&await r(a)},w=a=>{const v=new Set(u);v.has(a)?v.delete(a):v.add(a),N(v)};return e.jsxs(D,{className:"bg-card border-border",children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(G,{className:"text-foreground flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5"}),"Sections & Tasks (",s.length,")"]}),h("create sections")&&e.jsxs(f,{type:"button",size:"sm",onClick:()=>g(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})}),e.jsxs(E,{className:"space-y-4",children:[o&&h("create sections")&&e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Section"}),e.jsx(ae,{onSubmit:l,onCancel:()=>g(!1),isLoading:m})]}),m?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((a,v)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},v))}):s.length===0?e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:["No sections yet. ",h("create sections")?"Create your first section to get started.":"No sections available."]}):s.map(a=>e.jsx(qe,{section:a,projectId:t,isExpanded:u.has(a.id),onToggle:()=>w(a.id),onEdit:()=>x(a),onDelete:()=>i(a.id),isEditing:c?.id===a.id,editingSection:c,onUpdateSection:b,onCancelEdit:()=>x(null),openTaskDialog:j,isLoading:m},a.id))]})]})},qe=({section:s,projectId:t,isExpanded:d,onToggle:n,onEdit:r,onDelete:m,isEditing:o,editingSection:g,onUpdateSection:c,onCancelEdit:x,openTaskDialog:u,isLoading:N})=>{const{tasks:h,deleteTask:j}=Ne(s.id),{hasPermission:l}=k(),b=async i=>{l("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await j(i)};return o?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Section"}),e.jsx(ae,{section:g,onSubmit:c,onCancel:x,isLoading:N})]}):e.jsx("div",{className:"border border-border rounded-lg",children:e.jsxs(Me,{open:d,onOpenChange:n,children:[e.jsx(Ue,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d?e.jsx(be,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(ve,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("div",{className:"w-3 h-3 bg-chart-2 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",className:"text-xs",children:[h.length," tasks"]}),(l("edit sections")||l("delete sections")||l("create tasks"))&&e.jsxs(q,{children:[e.jsx(K,{asChild:!0,onClick:i=>i.stopPropagation(),children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(X,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",className:"bg-popover border-border",children:[l("edit sections")&&e.jsxs(C,{onClick:i=>{i.stopPropagation(),r()},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Section"]}),l("create tasks")&&e.jsxs(C,{onClick:i=>{i.stopPropagation(),i.preventDefault(),u(s,t)},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add Task"]}),l("delete sections")&&e.jsxs(C,{onClick:i=>{i.stopPropagation(),m()},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Delete Section"]})]})]})]})]})}),e.jsx(ze,{children:e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{className:"p-4",children:h.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(V,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No tasks in this section yet"}),l("create tasks")&&e.jsxs(f,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:i=>{u(s,t),i.stopPropagation(),i.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add First Task"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-medium text-foreground",children:["Tasks (",h.length,")"]}),l("create tasks")&&e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:i=>{u(s,t),i.stopPropagation(),i.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Task"]})]}),h.map(i=>e.jsx(Ke,{task:i,onEdit:w=>l("edit tasks")&&u(s,t,w),onDelete:b},i.id))]})})})})]})})},Ke=({task:s,onEdit:t,onDelete:d})=>{const{hasPermission:n,hasAnyPermission:r}=k(),m=j=>{switch(j){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},o=j=>{switch(j){case"done":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"rated":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},g=new Date(s.due_date)<new Date&&s.status!=="done"&&s.status!=="rated",c=()=>{r(["create task ratings","edit task ratings"])&&window.open(`/ratings/tasks/${s.id}`,"_blank")},x=n("edit tasks"),u=n("delete tasks"),N=r(["create task ratings","edit task ratings"]),h=x||u||N;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${m(s.priority)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h6",{className:"font-medium text-foreground truncate",children:s.name}),e.jsx(H,{variant:"outline",className:`text-xs ${o(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),"Weight: ",s.weight]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Due: ",new Date(s.due_date).toLocaleDateString(),g&&e.jsx("span",{className:"text-red-500 font-medium",children:"(Overdue)"})]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:h?e.jsxs(q,{children:[e.jsx(K,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(X,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",className:"bg-popover border-border",children:[x&&e.jsxs(C,{onClick:()=>t(s),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Task"]}),N&&e.jsxs(C,{onClick:c,className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Rate Task"]}),u&&e.jsxs(C,{onClick:()=>d(s.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Delete Task"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]})},os=()=>{const{id:s}=we(),{project:t,sections:d,isLoading:n,error:r}=Ee(s),{createSection:m,updateSection:o,deleteSection:g}=Ce(),{hasPermission:c,hasAnyPermission:x}=k(),u=async l=>{c("create sections")&&await m(l)},N=async(l,b)=>{c("edit sections")&&await o(l,b)},h=async l=>{c("delete sections")&&await g(l)};if(n)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(r||!t)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:r||"Project not found"})});const j=x(["create stakeholder ratings","edit stakeholder ratings"]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(y,{to:"/projects",children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Back to Projects"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(I,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{status:t.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.progress_percentage,"% complete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[j&&t.stakeholder_will_rate&&e.jsx(f,{asChild:!0,variant:"outline",children:e.jsxs(y,{to:`/ratings/projects/${t.id}/stakeholder`,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Stakeholder Rating"]})}),c("view analytics")&&e.jsx(f,{asChild:!0,variant:"outline",children:e.jsxs(y,{to:`/analytics/projects/${t.id}`,children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Project Analytics"]})}),c("view projects")&&e.jsx(f,{variant:"outline",asChild:!0,children:e.jsxs(y,{to:`/projects/${t.id}/kanban`,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Kanban View"]})}),c("edit projects")&&e.jsx(f,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(y,{to:`/projects/${t.id}/edit`,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Project"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(D,{className:"bg-card border-border",children:[e.jsx(Y,{children:e.jsxs(G,{className:"text-foreground flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Project Information"]})}),e.jsxs(E,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground",children:t.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ke,{className:"w-8 h-8",children:e.jsx(Pe,{className:"bg-primary text-primary-foreground text-sm",children:t.stakeholder?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.stakeholder?.name||"Unassigned"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.stakeholder?.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progress"}),e.jsx(De,{value:t.progress_percentage,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progress_percentage,"% complete"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Will be rated"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(V,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:t.stakeholder_will_rate?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsxs("p",{className:"text-sm text-foreground flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),new Date(t.created_at).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:c("view sections")?e.jsx(Ie,{sections:d??[],projectId:t.id,onCreateSection:u,onUpdateSection:N,onDeleteSection:h,isLoading:!1}):e.jsx(D,{className:"bg-card border-border",children:e.jsx(E,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view sections"})})})})]})]})};export{os as default};
