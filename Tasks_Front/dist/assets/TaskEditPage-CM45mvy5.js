import{a0 as B,D as I,ac as E,R as P,j as e,ai as h,B as j,C as n,c as g,d as f,f as c,Z as A,aB as L,aC as D}from"./index-3bspv_4s.js";import{u as U,s as l}from"./subtaskService-Du0n1jiu.js";import{A as N}from"./arrow-left-CZGEooIc.js";const $=()=>{const{id:v}=B(),b=I(),k=Number(v),{task:a,taskWithAssignments:m,isLoading:w,error:o}=U(k),{updateTask:y}=E(),_=P.useMemo(()=>{if(!a)return;const t=m?.assigned_users?.map(i=>({user_id:i.id,percentage:i.pivot?.percentage??0}))??[],x=(a.subtasks||[]).map(i=>({id:i.id,name:i.name,description:i.description??"",due_date:i.due_date,priority:i.priority}))??[];return{name:a.name,description:a.description??"",weight:a.weight,due_date:a.due_date,priority:a.priority,project_id:a.project_id,section_id:a.section_id,subtasks:x,assignments:t}},[a,m]),T=async t=>{if(!a||!await y(a.id,{name:t.name,description:t.description,weight:t.weight,due_date:t.due_date,priority:t.priority,section_id:t.section_id}))return;await D.assignUsersToTask(a.id,{assignments:t.assignments.map(s=>({user_id:s.user_id,percentage:s.percentage}))});const i=a.subtasks||[],r=t.subtasks??[],u=new Map;r.forEach(s=>{s.id&&u.set(s.id,s)});const C=new Set(i.map(s=>s.id)),p=new Set(r.filter(s=>s.id).map(s=>s.id));await Promise.all(i.filter(s=>p.has(s.id)).map(s=>{const d=u.get(s.id);return l.updateSubtask(s.id,{name:d.name,description:d.description,due_date:d.due_date,priority:d.priority})})),await Promise.all(r.filter(s=>!s.id).map(s=>l.createSubtask({name:s.name,description:s.description,due_date:s.due_date,priority:s.priority,task_id:a.id})));const S=[...C].filter(s=>!p.has(s));await Promise.all(S.map(s=>l.deleteSubtask(s))),b(`/tasks/${a.id}`)};return w?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-64 mt-2"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{variant:"outline",size:"sm",disabled:!0,children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Back to Task"]})})]}),e.jsx("div",{className:"max-w-4xl",children:e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(g,{children:e.jsx(f,{className:"text-foreground",children:"Task Details"})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-10 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-10 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-10 bg-muted animate-pulse rounded w-32"}),e.jsx("div",{className:"h-10 bg-muted animate-pulse rounded w-24"})]})]})})]})})]})}):o||!a?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsx("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-8 text-center",children:e.jsx("p",{className:"text-destructive",children:o||"Task not found"})})})})}):e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Edit Task"}),e.jsxs("p",{className:"text-muted-foreground",children:["Update ",a.name]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(A,{to:`/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(N,{className:"mr-2 h-4 w-4"}),"Back to Task"]})})})]}),e.jsx("div",{className:"max-w-4xl",children:e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(g,{children:e.jsx(f,{className:"text-foreground",children:"Task Details"})}),e.jsx(c,{children:e.jsx(L,{mode:"edit",sectionId:a.section_id,initialValues:_,onSubmit:T,isLoading:!1})})]})})]})})};export{$ as default};
