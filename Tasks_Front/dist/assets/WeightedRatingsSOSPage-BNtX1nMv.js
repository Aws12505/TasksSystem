import{g as A,R as l,j as e,B as d,C as N,c as ee,d as se,e as ae,f as b,G as U,H as R,J as T,az as D,au as te,av as re,U as E,aw as le,a2 as ne,at as ce,ax as O,L as de,a5 as ie,v as me}from"./index-hR1LJjZT.js";import{L as v}from"./label-C7fLOv-N.js";import{T as oe,a as xe,b as q,c as h,d as he,e as u}from"./table-BDHg2Dg5.js";import{B as ue}from"./badge-4hw1HmH9.js";import{P as ge}from"./progress-Y-e7LYWa.js";import{C as pe,a as je,b as fe,c as Ne,d as be,e as ve}from"./command-DZq6IDEP.js";import{T as B}from"./trending-up-COF8cfiW.js";import{R as ye}from"./refresh-cw-B_RQJ8uY.js";import{C as L}from"./calculator-w4-gfz-V.js";import{T as H}from"./trophy-CqiMQNfZ.js";import"./search-jDQEqGpm.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Ce=A("arrow-up-down",we);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ke=A("award",Se);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M7.21 15 2.66 7.14a2 2 0 0 1 .13-2.2L4.4 2.8A2 2 0 0 1 6 2h12a2 2 0 0 1 1.6.8l1.6 2.14a2 2 0 0 1 .14 2.2L16.79 15",key:"143lza"}],["path",{d:"M11 12 5.12 2.2",key:"qhuxz6"}],["path",{d:"m13 12 5.88-9.8",key:"hbye0f"}],["path",{d:"M8 7h8",key:"i86dvs"}],["circle",{cx:"12",cy:"17",r:"5",key:"qbz8iq"}],["path",{d:"M12 18v-2h-.5",key:"fawc4q"}]],Ue=A("medal",_e),Ee=()=>{const[o,M]=l.useState(""),[g,$]=l.useState(""),[F,I]=l.useState(!1),[y,P]=l.useState(!1),[w,C]=l.useState(null),[c,S]=l.useState(null),[p,W]=l.useState(!0),[i,G]=l.useState([]),[n,x]=l.useState([]),[V,J]=l.useState(!1),X=s=>s?.data?s.data:s;l.useEffect(()=>{(async()=>{P(!0);try{const a=await ie.getAllUsers();G(a)}catch(a){console.error("Failed to fetch users:",a)}finally{P(!1)}})()},[]);const z=s=>{x(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},Y=()=>{M(""),$(""),x([]),C(null),S(null)},K=async s=>{if(s.preventDefault(),!(!o||!g||n.length===0)){I(!0),C(null),S(null);try{const a=await me.post("final-ratings/calculate-weighted-ratings-sos",{user_ids:n,start_date:o,end_date:g}),t=X(a);S(t),setTimeout(()=>{document.getElementById("sos-results-table")?.scrollIntoView({behavior:"smooth",block:"start"})},0)}catch(a){C(a?.message||"Something went wrong")}finally{I(!1)}}},k=l.useMemo(()=>{if(!c)return null;const s=a=>typeof a=="number"?a:-1/0;return[...c].sort((a,t)=>p?s(t.rating)-s(a.rating):s(a.rating)-s(t.rating))},[c,p]),m=l.useMemo(()=>{if(!c||c.length===0)return null;const s=c.filter(r=>typeof r.rating=="number");if(s.length===0)return{avg:null,top:null};const t=+(s.reduce((r,f)=>r+f.rating,0)/s.length).toFixed(2),j=s.reduce((r,f)=>f.rating>r.rating?f:r,s[0]);return{avg:t,top:j}},[c]),Q=s=>s===null?"bg-muted":s>=85?"bg-green-500":s>=70?"bg-blue-500":s>=50?"bg-yellow-500":"bg-red-500",_=i.filter(s=>n.includes(s.id)),Z=s=>{const a=s.trim().toLowerCase();return i.find(t=>t.name?.trim().toLowerCase()===a)||i.find(t=>t.user_name?.trim().toLowerCase()===a)||null};return e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl",children:e.jsx(B,{className:"w-7 h-7 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground tracking-tight",children:"Weighted Ratings (SOS)"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Latest task rating × user percentage, averaged per user (out of 100)"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>W(s=>!s),className:"gap-2",children:[e.jsx(Ce,{className:"w-4 h-4"}),p?"Descending":"Ascending"]}),e.jsxs(d,{variant:"outline",onClick:Y,className:"gap-2",children:[e.jsx(ye,{className:"w-4 h-4"}),"Reset"]})]})]})}),e.jsx("div",{className:"space-y-8",children:e.jsxs(N,{className:"border-border shadow-sm",children:[e.jsxs(ee,{className:"pb-4",children:[e.jsxs(se,{className:"flex items-center gap-2 text-xl",children:[e.jsx(L,{className:"w-5 h-5"}),"Calculate Weighted Ratings"]}),e.jsx(ae,{children:"Select users and date range to calculate weighted SOS ratings"})]}),e.jsxs(b,{className:"space-y-8",children:[_.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(v,{className:"text-sm font-medium",children:["Selected Users (",_.length,")"]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>x([]),className:"h-8 px-2 text-xs text-muted-foreground hover:text-foreground",children:"Clear all"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 p-3 border border-border rounded-lg bg-muted/20",children:_.map(s=>e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-background border border-border rounded-full hover:border-primary/50 transition-colors",children:[e.jsxs(U,{className:"w-6 h-6",children:[s.avatar_url?.trim()?e.jsx(R,{src:s.avatar_url,alt:s.name}):null,e.jsx(T,{className:"text-[10px] bg-primary/10",children:s.name?.[0]?.toUpperCase()??"U"})]}),e.jsx("span",{className:"text-sm font-medium truncate max-w-[140px]",children:s.name}),e.jsx(d,{type:"button",size:"sm",variant:"ghost",className:"h-5 w-5 p-0 ml-1 hover:bg-destructive/10 hover:text-destructive",onClick:()=>z(s.id),title:"Remove",children:e.jsx(D,{className:"w-3 h-3"})})]},s.id))})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{htmlFor:"user-select",className:"text-sm font-medium",children:"Select Users *"}),e.jsxs(te,{open:V,onOpenChange:J,children:[e.jsx(re,{asChild:!0,children:e.jsxs(d,{id:"user-select",type:"button",variant:"outline",className:"w-full justify-between h-11",disabled:y,children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(E,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:y?"Loading users...":n.length===0?"Select users...":`${n.length} user${n.length!==1?"s":""} selected`})]}),e.jsx(pe,{className:"w-4 h-4 opacity-60 flex-shrink-0"})]})}),e.jsxs(le,{className:"w-[340px] p-0",align:"start",children:[e.jsxs(je,{children:[e.jsx(fe,{placeholder:"Search users..."}),e.jsx(Ne,{children:"No users found"}),e.jsx(be,{children:e.jsx(ne,{className:"h-[300px]",children:i.map(s=>{const a=n.includes(s.id);return e.jsxs(ve,{onSelect:()=>z(s.id),className:"flex items-center justify-between gap-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(U,{className:"w-8 h-8",children:[s.avatar_url?.trim()?e.jsx(R,{src:s.avatar_url,alt:s.name}):null,e.jsx(T,{className:"text-xs",children:s.name?.[0]?.toUpperCase()??"U"})]}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s.name}),s.email&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.email})]})]}),a&&e.jsx(ce,{className:"w-4 h-4 text-primary flex-shrink-0"})]},s.id)})})})]}),e.jsxs("div",{className:"border-t p-3 flex gap-2",children:[e.jsx(d,{size:"sm",variant:"outline",type:"button",className:"flex-1",onClick:()=>x(i.map(s=>s.id)),disabled:i.length===0,children:"Select all"}),e.jsx(d,{size:"sm",variant:"outline",type:"button",className:"flex-1",onClick:()=>x([]),disabled:n.length===0,children:"Clear"})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{htmlFor:"start_date",className:"text-sm font-medium",children:"Start Date *"}),e.jsx(O,{id:"start_date",name:"start_date",value:o,onChange:M,required:!0,className:"h-11"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(v,{htmlFor:"end_date",className:"text-sm font-medium",children:"End Date *"}),e.jsx(O,{id:"end_date",name:"end_date",value:g,onChange:$,required:!0,min:o,className:"h-11"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:n.length===0?"Pick at least one user to calculate.":`Ready to calculate for ${n.length} user(s).`}),e.jsx(d,{type:"submit",size:"lg",className:"px-8",disabled:F||y||n.length===0||!o||!g,children:F?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-2 animate-spin"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Calculate Ratings"]})})]})]}),w&&e.jsx("div",{className:"rounded-lg border border-destructive/50 bg-destructive/10 p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("p",{className:"text-sm font-medium",children:w})]})}),k&&e.jsxs("div",{className:"space-y-6",children:[m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(N,{className:"bg-card border-border",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-lg",children:e.jsx(E,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Users Calculated"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:k.length})]})]})})}),e.jsx(N,{className:"bg-card border-border",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-green-500/10 rounded-lg",children:e.jsx(B,{className:"w-6 h-6 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Rating"}),e.jsx("p",{className:"text-3xl font-bold mt-1",children:m.avg===null?"—":m.avg.toFixed(2)})]})]})})}),e.jsx(N,{className:"bg-card border-border",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-amber-500/10 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Top Performer"}),e.jsx("p",{className:"text-lg font-semibold mt-1 truncate",children:m.top?`${m.top.user_name} • ${m.top.rating.toFixed(2)}`:"—"})]})]})})})]}),e.jsxs("div",{id:"sos-results-table",className:"rounded-xl border border-border overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"bg-muted/30 p-4 border-b",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Results"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Sorted by weighted rating ",p?"(highest first)":"(lowest first)"]})]}),e.jsxs(oe,{children:[e.jsx(xe,{className:"bg-muted/50",children:e.jsxs(q,{children:[e.jsx(h,{className:"w-[90px] font-semibold",children:"Rank"}),e.jsx(h,{className:"font-semibold",children:"User"}),e.jsx(h,{className:"text-right font-semibold",children:"Rating"}),e.jsx(h,{className:"w-[300px] font-semibold",children:"Progress"}),e.jsx(h,{className:"text-right w-[150px] font-semibold",children:"Achievement"})]})}),e.jsx(he,{children:k.map((s,a)=>{const t=s.rating,j=a<3&&typeof t=="number",r=Z(s.user_name);return e.jsxs(q,{className:"hover:bg-muted/20",children:[e.jsx(u,{className:"font-medium",children:e.jsx("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full ${j?"bg-primary/10 text-primary font-bold":"bg-muted text-muted-foreground"}`,children:a+1})}),e.jsx(u,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(U,{className:"w-8 h-8",children:[r?.avatar_url?.trim()?e.jsx(R,{src:r.avatar_url,alt:r.name}):null,e.jsx(T,{className:"text-xs bg-primary/10",children:(r?.name||s.user_name)?.charAt(0).toUpperCase()})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold truncate",children:s.user_name}),r?.email&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:r.email})]})]})}),e.jsx(u,{className:"text-right",children:e.jsx("div",{className:"tabular-nums font-semibold text-lg",children:t===null?"—":t.toFixed(2)})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t===null?"No data":`${Math.min(100,Math.max(0,t)).toFixed(1)}%`}),e.jsx("div",{className:`h-2 w-2 rounded-full ${Q(t)}`})]}),e.jsx(ge,{value:typeof t=="number"?Math.max(0,Math.min(100,t)):0,className:"h-2"})]})}),e.jsx(u,{className:"text-right",children:j?e.jsxs(ue,{variant:"secondary",className:`inline-flex items-center gap-2 px-3 py-1.5 ${a===0?"bg-amber-500/20 text-amber-700 border-amber-500/30":a===1?"bg-slate-500/20 text-slate-700 border-slate-500/30":"bg-orange-500/20 text-orange-700 border-orange-500/30"}`,children:[a===0&&e.jsx(H,{className:"w-4 h-4"}),a===1&&e.jsx(Ue,{className:"w-4 h-4"}),a===2&&e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold",children:a===0?"Top 1":a===1?"Top 2":"Top 3"})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"—"})})]},`${s.user_name}-${a}`)})})]})]})]}),!c&&!w&&e.jsx("div",{className:"text-center py-12 border-2 border-dashed border-border rounded-xl bg-muted/10",children:e.jsxs("div",{className:"max-w-md mx-auto space-y-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-full w-16 h-16 mx-auto flex items-center justify-center",children:e.jsx(L,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"No Results Yet"}),e.jsx("p",{className:"text-muted-foreground",children:'Select users, choose a date range, and click "Calculate Ratings" to see weighted SOS ratings.'})]})})]})]})})]})})};export{Ee as default};
