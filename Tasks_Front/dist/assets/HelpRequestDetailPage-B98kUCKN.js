import{a3 as R,a as S,b as _,o as H,j as e,ar as U,as as D,B as r,at as F,au as A,av as B,F as L,c as M,d as P,e as T,M as O,f as z,N as E,O as V,P as G,Q as I,g as Q,L as X,ak as $,z as J,l as K,y as b,aq as W,E as Y,S as Z}from"./index-C-8X4UdE.js";import{C as c,a as d,b as m,d as o}from"./card-C5R7LjTr.js";import{A as v,a as y}from"./avatar-BBN3R_k3.js";import{u as ee}from"./useHelpRequest-C6ZLA3x8.js";import{H as se,a as ae}from"./HelpRequestRatingBadge-goqQs5TA.js";import{B as re}from"./badge-CdenegGE.js";import{C as te}from"./circle-check-big-CO10XEoP.js";import{A as le}from"./arrow-left-Dv9e9ei1.js";import{U as ie,a as ne}from"./user-x-D1Mkh5uE.js";import{S as ce}from"./square-pen-95dMSlnU.js";import{C as j}from"./calendar-BtqsTB4H.js";import"./index-Bx1b4rw8.js";import"./helpRequestsStore-RDCJL201.js";const de=H({rating:$(["legitimate_learning","basic_skill_gap","careless_mistake","fixing_own_mistakes"])}),me=({ratingOptions:u,onComplete:s,isLoading:t=!1,trigger:x})=>{const[h,n]=R.useState(!1),l=S({resolver:_(de)}),p=async i=>{await s(i),n(!1),l.reset()};return e.jsxs(U,{open:h,onOpenChange:n,children:[e.jsx(D,{asChild:!0,children:x||e.jsxs(r,{className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Complete Request"]})}),e.jsxs(F,{className:"bg-card border-border",children:[e.jsx(A,{children:e.jsx(B,{className:"text-foreground",children:"Complete Help Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please rate this help request to help improve our system and provide feedback to users."}),e.jsx(L,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(p),className:"space-y-6",children:[e.jsx(M,{control:l.control,name:"rating",render:({field:i})=>e.jsxs(P,{children:[e.jsx(T,{className:"text-foreground",children:"Rating Category"}),e.jsxs(O,{onValueChange:i.onChange,disabled:t,children:[e.jsx(z,{children:e.jsx(E,{className:"bg-background border-input text-foreground",children:e.jsx(V,{placeholder:"Select rating category"})})}),e.jsx(G,{children:u.map(a=>e.jsx(I,{value:a.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:a.label}),e.jsxs(re,{variant:"outline",className:"ml-2 text-xs",children:[a.penalty,"x penalty"]})]})},a.value))})]}),e.jsx(Q,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-2 p-4 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Rating Guidelines:"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Legitimate Learning (0.1x):"})," Valid learning opportunity, minimal penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Basic Skill Gap (0.3x):"})," Missing fundamental skills, moderate penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Careless Mistake (0.6x):"})," Avoidable error, significant penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fixing Own Mistakes (0.8x):"})," Fixing self-created issues, high penalty"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:t,children:"Cancel"}),e.jsxs(r,{type:"submit",disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Complete Request"]})]})]})})]})]})]})},we=()=>{const{id:u}=J(),{helpRequest:s,ratingOptions:t,isLoading:x,error:h,claimRequest:n,completeRequest:l,unclaimRequest:p}=ee(u),{user:i}=K(),a=!!i&&!!s&&i.id===s.helper_id,g=!!s&&s.is_claimed&&!s.is_completed&&a,f=!!s&&s.is_claimed&&!s.is_completed&&a,N=!!s&&s.is_available;if(x)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(h||!s)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:h||"Help request not found"})});const C=async()=>{N&&await n()},w=async()=>{window.confirm("Are you sure you want to unclaim this help request?")&&g&&await p()},q=async k=>{f&&await l(k)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(b,{to:"/help-requests",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-foreground font-sans",children:["Help Request #",s.id]}),e.jsx(se,{helpRequest:s})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsxs(r,{variant:"outline",size:"sm",onClick:C,children:[e.jsx(ie,{className:"mr-2 h-4 w-4"}),"Claim Request"]}),g&&e.jsxs(r,{variant:"outline",size:"sm",onClick:w,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),f&&e.jsx(me,{ratingOptions:t,onComplete:q,isLoading:x}),e.jsx(r,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(b,{to:`/help-requests/${s.id}/edit`,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Edit"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Request Details"})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Related Task"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.task?.name||"Unknown Task"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Project: ",s.task?.section?.project?.name||"Unknown Project"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Section: ",s.task?.section?.name||"Unknown Section"]})]})]}),s.is_completed&&s.completed_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed At"}),e.jsxs("p",{className:"text-foreground flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),new Date(s.completed_at).toLocaleString()]})]})]})]}),s.rating&&e.jsxs(c,{className:"bg-card border-border mt-6",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Request Rating"})}),e.jsx(o,{children:e.jsx(ae,{rating:s.rating,penaltyMultiplier:s.penalty_multiplier})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(m,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Requester"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-10 h-10",children:e.jsx(y,{className:"bg-primary text-primary-foreground",children:s.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.requester?.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.requester?.email})]})]})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(m,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Helper"]})}),e.jsx(o,{children:s.helper?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-10 h-10",children:e.jsx(y,{className:"bg-chart-2 text-white",children:s.helper.name?.charAt(0).toUpperCase()||"H"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.helper.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.helper.email})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No helper assigned yet"})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsx(m,{className:"text-foreground",children:"Timeline"})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(j,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.completed_at).toLocaleDateString()})]})]})]})]})]})]})};export{we as default};
