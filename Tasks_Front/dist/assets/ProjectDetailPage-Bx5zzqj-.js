import{a as X,b as Z,o as G,j as e,F as J,c as A,d as E,e as _,f as F,I as Q,g as U,R as ee,B as x,L as se,s as z,r as k,q as C,V as te,W as ae,X as re,Y as ne,Z as ie,_ as ce,D as B,v as L,w as M,x as b,$ as oe,S as q,n as R,z as de,a0 as le,y as w,m as $,U as me,K as xe}from"./index-D14aCydU.js";import{C as P,a as K,b as O,d as D}from"./card-vgImVvDX.js";import{A as he,a as ue}from"./avatar--2bQ5FjZ.js";import{P as je}from"./progress-GSndDYFQ.js";import{u as pe}from"./useProject-Dplr2j7Q.js";import{P as ge,K as Ne}from"./ProjectStatusBadge-DMuT8zBP.js";import{B as W}from"./badge-CGZ4hFPH.js";import{L as fe}from"./list-DD8FSq23.js";import{P as y}from"./plus-CmWdoRfB.js";import{E as V}from"./ellipsis-CgSiJLvW.js";import{S as T}from"./square-pen-Dd2lxkdM.js";import{T as Y}from"./trash-2-BOZnMgTQ.js";import{C as H}from"./calendar-B4fBXIV8.js";import{A as be}from"./arrow-left-DmG7Vb3v.js";import"./index-BBhImiVH.js";const ve=G({name:z().min(1,"Section name is required").max(255),description:z().optional()}),I=({section:s,onSubmit:t,onCancel:u,isLoading:c})=>{const o=X({resolver:Z(ve),defaultValues:{name:s?.name||"",description:s?.description||""}}),h=async d=>{await t(d)};return e.jsx(J,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(h),className:"space-y-4",children:[e.jsx(A,{control:o.control,name:"name",render:({field:d})=>e.jsxs(E,{children:[e.jsx(_,{className:"text-foreground",children:"Section Name"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"Enter section name",...d,disabled:c,className:"bg-background border-input text-foreground"})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsx(A,{control:o.control,name:"description",render:({field:d})=>e.jsxs(E,{children:[e.jsx(_,{className:"text-foreground",children:"Description"}),e.jsx(F,{children:e.jsx(ee,{placeholder:"Enter section description (optional)",...d,disabled:c,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{type:"submit",size:"sm",disabled:c,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[c&&e.jsx(se,{className:"mr-2 h-3 w-3 animate-spin"}),s?"Update":"Create"]}),e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:u,disabled:c,children:"Cancel"})]})]})})},we=({sections:s,projectId:t,onCreateSection:u,onUpdateSection:c,onDeleteSection:o,isLoading:h})=>{const[d,p]=k.useState(!1),[i,j]=k.useState(null),[l,N]=k.useState(new Set),{hasPermission:m}=C(),{openTaskDialog:g}=te(),r=async n=>{await u({...n,project_id:t}),p(!1)},v=async n=>{i&&(await c(i.id,n),j(null))},a=async n=>{window.confirm("Are you sure you want to delete this section?")&&await o(n)},S=n=>{const f=new Set(l);f.has(n)?f.delete(n):f.add(n),N(f)};return e.jsxs(P,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"text-foreground flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),"Sections & Tasks (",s.length,")"]}),m("create sections")&&e.jsxs(x,{type:"button",size:"sm",onClick:()=>p(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})}),e.jsxs(D,{className:"space-y-4",children:[d&&m("create sections")&&e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Section"}),e.jsx(I,{onSubmit:r,onCancel:()=>p(!1),isLoading:h})]}),h?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((n,f)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},f))}):s.length===0?e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:["No sections yet. ",m("create sections")?"Create your first section to get started.":"No sections available."]}):s.map(n=>e.jsx(ye,{section:n,projectId:t,isExpanded:l.has(n.id),onToggle:()=>S(n.id),onEdit:()=>j(n),onDelete:()=>a(n.id),isEditing:i?.id===n.id,editingSection:i,onUpdateSection:v,onCancelEdit:()=>j(null),openTaskDialog:g,isLoading:h},n.id))]})]})},ye=({section:s,projectId:t,isExpanded:u,onToggle:c,onEdit:o,onDelete:h,isEditing:d,editingSection:p,onUpdateSection:i,onCancelEdit:j,openTaskDialog:l,isLoading:N})=>{const{tasks:m,deleteTask:g}=ae(s.id),{hasPermission:r}=C(),v=async a=>{r("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await g(a)};return d?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Section"}),e.jsx(I,{section:p,onSubmit:i,onCancel:j,isLoading:N})]}):e.jsx("div",{className:"border border-border rounded-lg",children:e.jsxs(re,{open:u,onOpenChange:c,children:[e.jsx(ne,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u?e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("div",{className:"w-3 h-3 bg-chart-2 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:"outline",className:"text-xs",children:[m.length," tasks"]}),(r("edit sections")||r("delete sections")||r("create tasks"))&&e.jsxs(B,{children:[e.jsx(L,{asChild:!0,onClick:a=>a.stopPropagation(),children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(M,{align:"end",className:"bg-popover border-border",children:[r("edit sections")&&e.jsxs(b,{onClick:a=>{a.stopPropagation(),o()},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Section"]}),r("create tasks")&&e.jsxs(b,{onClick:a=>{a.stopPropagation(),a.preventDefault(),l(s,t)},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Add Task"]}),r("delete sections")&&e.jsxs(b,{onClick:a=>{a.stopPropagation(),h()},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Delete Section"]})]})]})]})]})}),e.jsx(oe,{children:e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{className:"p-4",children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No tasks in this section yet"}),r("create tasks")&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:a=>{l(s,t),a.stopPropagation(),a.preventDefault()},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add First Task"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-medium text-foreground",children:["Tasks (",m.length,")"]}),r("create tasks")&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:a=>{l(s,t),a.stopPropagation(),a.preventDefault()},children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Task"]})]}),m.map(a=>e.jsx(Ce,{task:a,onEdit:S=>r("edit tasks")&&l(s,t,S),onDelete:v},a.id))]})})})})]})})},Ce=({task:s,onEdit:t,onDelete:u})=>{const{hasPermission:c,hasAnyPermission:o}=C(),h=g=>{switch(g){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},d=g=>{switch(g){case"done":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"rated":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},p=new Date(s.due_date)<new Date&&s.status!=="done"&&s.status!=="rated",i=()=>{o(["create task ratings","edit task ratings"])&&window.open(`/ratings/tasks/${s.id}`,"_blank")},j=c("edit tasks"),l=c("delete tasks"),N=o(["create task ratings","edit task ratings"]),m=j||l||N;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h(s.priority)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h6",{className:"font-medium text-foreground truncate",children:s.name}),e.jsx(W,{variant:"outline",className:`text-xs ${d(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"Weight: ",s.weight]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),"Due: ",new Date(s.due_date).toLocaleDateString(),p&&e.jsx("span",{className:"text-red-500 font-medium",children:"(Overdue)"})]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:m?e.jsxs(B,{children:[e.jsx(L,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(M,{align:"end",className:"bg-popover border-border",children:[j&&e.jsxs(b,{onClick:()=>t(s),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Task"]}),N&&e.jsxs(b,{onClick:i,className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Rate Task"]}),l&&e.jsxs(b,{onClick:()=>u(s.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Delete Task"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]})},Me=()=>{const{id:s}=de(),{project:t,sections:u,isLoading:c,error:o}=pe(s),{createSection:h,updateSection:d,deleteSection:p}=le(),{hasPermission:i,hasAnyPermission:j}=C(),l=async r=>{i("create sections")&&await h(r)},N=async(r,v)=>{i("edit sections")&&await d(r,v)},m=async r=>{i("delete sections")&&await p(r)};if(c)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(o||!t)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:o||"Project not found"})});const g=j(["create stakeholder ratings","edit stakeholder ratings"]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(w,{to:"/projects",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Back to Projects"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{status:t.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.progress_percentage,"% complete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&t.stakeholder_will_rate&&e.jsx(x,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/ratings/projects/${t.id}/stakeholder`,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Stakeholder Rating"]})}),i("view analytics")&&e.jsx(x,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/analytics/projects/${t.id}`,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Project Analytics"]})}),i("view projects")&&e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs(w,{to:`/projects/${t.id}/kanban`,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Kanban View"]})}),i("edit projects")&&e.jsx(x,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(w,{to:`/projects/${t.id}/edit`,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Project"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(P,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs(O,{className:"text-foreground flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Project Information"]})}),e.jsxs(D,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground",children:t.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(he,{className:"w-8 h-8",children:e.jsx(ue,{className:"bg-primary text-primary-foreground text-sm",children:t.stakeholder?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.stakeholder?.name||"Unassigned"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.stakeholder?.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progress"}),e.jsx(je,{value:t.progress_percentage,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progress_percentage,"% complete"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Will be rated"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:t.stakeholder_will_rate?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsxs("p",{className:"text-sm text-foreground flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),new Date(t.created_at).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:i("view sections")?e.jsx(we,{sections:u??[],projectId:t.id,onCreateSection:l,onUpdateSection:N,onDeleteSection:m,isLoading:!1}):e.jsx(P,{className:"bg-card border-border",children:e.jsx(D,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view sections"})})})})]})]})};export{Me as default};
