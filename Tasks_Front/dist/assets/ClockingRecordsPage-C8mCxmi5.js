import{g as z,D as o,j as e,C as b,c as N,d as _,f as C,l as A,ax as ee,az as se,aA as re,aB as te,b6 as ae,I as v,V as ne,b8 as ce,B as h,aq as oe}from"./index-Y4t2xSJ4.js";import{L as p}from"./label-CFqQSNl7.js";import{T as le,a as ie,b as P,c as B}from"./tabs-BiE200aK.js";import{u as T,c as j,b as de}from"./clockingCalculations-DW6o_X9M.js";import{D as xe,R as ue,C as me}from"./CorrectionTypeSelector-Dr9sVGGy.js";import{B as ge}from"./badge-8i_sBa4H.js";import{C as D}from"./circle-alert-BgPD_ERP.js";import"./table-D3vsoA0b.js";import"./chevron-left-nlq4slCJ.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],pe=z("funnel",he),je=a=>{const{records:c,recordsPagination:r,isLoading:s,isExporting:l,error:n,fetchRecords:i,exportRecords:d,clearError:x}=T();return o.useEffect(()=>{i(a)},[JSON.stringify(a)]),{records:c,pagination:r,isLoading:s,isExporting:l,error:n,refresh:()=>i(a),exportRecords:d,clearError:x}},fe=()=>{const{pendingCorrections:a,correctionLoading:c,correctionError:r,getPendingCorrections:s,requestCorrection:l,clearCorrectionError:n}=T();return o.useEffect(()=>{s()},[s]),{pendingCorrections:a,isLoading:c,error:r,requestCorrection:l,refresh:s,clearError:n}},be=({corrections:a,companyTimezone:c})=>{const r=a.filter(s=>s.status==="pending");return r.length?e.jsxs(b,{className:"bg-card border-chart-2/50",children:[e.jsx(N,{className:"bg-accent",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(_,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(D,{className:"w-5 h-5 text-chart-2"}),"Pending Corrections (",r.length,")"]})})}),e.jsx(C,{className:"pt-6 space-y-3",children:r.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-chart-2/30 bg-accent space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-chart-2"}),e.jsx("span",{className:"font-medium text-foreground capitalize",children:s.correction_type.replace("_"," ")})]}),e.jsx(ge,{variant:"outline",className:"text-chart-2",children:"Pending"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-foreground",children:"Original:"})," ",j(s.original_time_utc,c)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-foreground",children:"Requested:"})," ",j(s.requested_time_utc,c)]}),e.jsx("div",{className:"mt-2 p-3 bg-background rounded border border-border",children:e.jsx("p",{className:"text-foreground text-xs",children:s.reason})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Submitted ",new Date(s.created_at).toLocaleDateString()]})]},s.id))})]}):null},Ne=({open:a,onOpenChange:c,type:r,session:s,breakRecord:l,companyTimezone:n,onSubmit:i,isLoading:d})=>{const[x,y]=o.useState(""),[m,g]=o.useState(""),w=()=>r==="clock_in"&&s?.clock_in_utc?j(s.clock_in_utc,n):r==="clock_out"&&s?.clock_out_utc?j(s.clock_out_utc,n):r==="break_in"&&l?.break_start_utc?j(l.break_start_utc,n):r==="break_out"&&l?.break_end_utc?j(l.break_end_utc,n):"Not set",f=async()=>{if(!x||!m.trim()||m.length<10)return;const u=de(x,n);await i({clock_session_id:r.includes("clock")?s?.id:void 0,break_record_id:r.includes("break")?l?.id:void 0,correction_type:r,requested_time_utc:u,reason:m.trim()}),y(""),g(""),c(!1)};return e.jsx(ee,{open:a,onOpenChange:c,children:e.jsxs(se,{className:"bg-card border-border",children:[e.jsxs(re,{children:[e.jsxs(te,{className:"text-foreground",children:["Request ",r.replace("_"," ").toUpperCase()," Correction"]}),e.jsxs(ae,{className:"text-muted-foreground",children:["Original: ",w()]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(p,{htmlFor:"requested_time",className:"text-foreground",children:["Corrected Time (",n,")"]}),e.jsx(v,{id:"requested_time",type:"datetime-local",value:x,onChange:u=>y(u.target.value),className:"bg-background border-input text-foreground",disabled:d}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter time in ",n]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"reason",className:"text-foreground",children:"Reason (required - min 10 chars)"}),e.jsx(ne,{id:"reason",placeholder:"Explain why you need this correction...",value:m,onChange:u=>g(u.target.value),rows:4,maxLength:500,className:"bg-background border-input text-foreground",disabled:d}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[m.length,"/500"]})]})]}),e.jsxs(ce,{children:[e.jsx(h,{variant:"outline",onClick:()=>c(!1),disabled:d,children:"Cancel"}),e.jsx(h,{onClick:f,disabled:d||!x||m.length<10,className:"bg-primary hover:bg-primary/90",children:d?"Submitting...":"Submit Request"})]})]})})},De=()=>{const[a,c]=o.useState({per_page:15}),[r,s]=o.useState(!1),[l,n]=o.useState(!1),[i,d]=o.useState({start_date:"",end_date:""}),{records:x,pagination:y,isLoading:m,isExporting:g,exportRecords:w}=je(a),{companyTimezone:f}=T(),{pendingCorrections:u,isLoading:E,requestCorrection:H,refresh:V}=fe(),[I,F]=o.useState(!1),[k,q]=o.useState(null),[M,R]=o.useState(!1),[U,J]=o.useState("clock_in"),[X,L]=o.useState(null),O=(t,S)=>{c({...a,[t]:S,page:1})},Y=()=>{c({per_page:15})},G=t=>{c({...a,page:t})},K=()=>{const t={start_date:i.start_date||void 0,end_date:i.end_date||void 0};w(t),n(!1)},Q=t=>{q(t),F(!0)},W=(t,S)=>{J(t),S&&k?.break_records&&L(k.break_records.find($=>$.id===S)),R(!0)},Z=async t=>{await H(t),R(!1),q(null),L(null)};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Clocking Records"}),e.jsx("p",{className:"text-muted-foreground",children:"View your clocking history"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",onClick:()=>s(!r),className:"bg-background border-input",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),r?"Hide":"Show"," Filters"]}),e.jsxs(h,{onClick:()=>n(!0),disabled:g||x.length===0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),g?"Exporting...":"Export"]})]})]}),e.jsxs(le,{defaultValue:"records",className:"space-y-6",children:[e.jsxs(ie,{className:"bg-muted",children:[e.jsx(P,{value:"records",children:"Records"}),e.jsxs(P,{value:"corrections",children:["Corrections (",u.length,")"]})]}),e.jsxs(B,{value:"records",className:"space-y-4",children:[r&&e.jsxs(b,{className:"bg-card border-border",children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{className:"text-lg text-foreground",children:"Filters"}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:Y,children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Clear"]})]})}),e.jsx(C,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"start_date",className:"text-foreground",children:"Start Date"}),e.jsx(v,{id:"start_date",type:"date",value:a.start_date||"",onChange:t=>O("start_date",t.target.value),className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"end_date",className:"text-foreground",children:"End Date"}),e.jsx(v,{id:"end_date",type:"date",value:a.end_date||"",onChange:t=>O("end_date",t.target.value),className:"bg-background border-input text-foreground"})]})]})})]}),e.jsxs(b,{className:"bg-card border-border",children:[e.jsx(N,{children:e.jsx(_,{className:"text-foreground",children:"Your Records"})}),e.jsx(C,{children:e.jsx(ue,{records:x,companyTimezone:f,pagination:y,onPageChange:G,isLoading:m,onCorrectionClick:Q})})]})]}),e.jsx(B,{value:"corrections",className:"space-y-4",children:e.jsxs(b,{className:"bg-card border-border",children:[e.jsx(N,{className:"bg-accent",children:e.jsxs(_,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(D,{className:"w-5 h-5 text-chart-2"}),"My Pending Corrections"]})}),e.jsx(C,{className:"pt-6",children:u.length>0?e.jsx(be,{corrections:u,isLoading:E,onRefresh:V,companyTimezone:f}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending correction requests"})]})})]})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(b,{className:"bg-card border-border w-full max-w-md mx-4",children:[e.jsx(N,{children:e.jsx(_,{className:"text-foreground",children:"Export Records"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Choose a date range or leave empty to export all records"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"export_start_date",className:"text-foreground",children:"Start Date (Optional)"}),e.jsx(v,{id:"export_start_date",type:"date",value:i.start_date,onChange:t=>d({...i,start_date:t.target.value}),className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"export_end_date",className:"text-foreground",children:"End Date (Optional)"}),e.jsx(v,{id:"export_end_date",type:"date",value:i.end_date,onChange:t=>d({...i,end_date:t.target.value}),className:"bg-background border-input text-foreground"})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>n(!1),className:"border-input",children:"Cancel"}),e.jsx(h,{onClick:K,disabled:g,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:g?"Exporting...":"Export"})]})]})]})})]}),e.jsx(me,{open:I,onOpenChange:F,session:k,onSelect:W,isLoading:E}),e.jsx(Ne,{open:M,onOpenChange:R,type:U,session:k,breakRecord:X,companyTimezone:f,onSubmit:Z,isLoading:E})]})};export{De as default};
