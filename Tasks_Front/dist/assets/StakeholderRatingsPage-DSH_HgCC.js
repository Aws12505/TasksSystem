import{r as v,a as b,b as R,o as y,j as e,U as N,F as C,aG as k,d as S,e as _,f as w,I as P,g as I,B as D,L as F,aI as E,ai as B,s as L,z as M}from"./index-C58fmmaK.js";import{C as j,a as T,b as U,d as p}from"./card-DABWnaub.js";import{u as V}from"./ratingsStore-K1NAcgFF.js";import{S as z,R as A}from"./RatingDisplay-vlqJowQl.js";import"./ratingConfigService-ybqfUX_H.js";import"./badge-BxREaLl8.js";import"./progress-ALQAo2K_.js";import"./calendar-B_b3D614.js";const G=n=>{const{stakeholderRatings:c,stakeholderRatingConfigs:m,stakeholderRatingsPagination:i,isLoading:o,error:l,fetchStakeholderRatings:r,fetchStakeholderRatingConfigs:t,createStakeholderRating:x,updateStakeholderRating:h}=V(),d=typeof n=="string"?parseInt(n):n;return v.useEffect(()=>{d&&(r(d),t())},[d,r,t]),{stakeholderRatings:c,stakeholderRatingConfigs:m,pagination:i,isLoading:o,error:l,createRating:g=>x({...g,project_id:d}),updateRating:(g,a)=>h(g,a),refreshRatings:()=>r(d)}},H=y({rating_data:E(L(),B().min(0).max(100))}),O=({projectId:n,config:c,onSubmit:m,isLoading:i})=>{const o=c.config_data,l=o.fields.reduce((a,s)=>(a[s.name]=0,a),{}),r=b({resolver:R(H),defaultValues:{rating_data:l}}),t=async a=>{const s={project_id:n,rating_data:a.rating_data};await m(s)},x=r.watch("rating_data"),h=Object.values(x||{}).reduce((a,s)=>a+(s||0),0),d=o.fields.reduce((a,s)=>a+s.max_value,0),g=d>0?Math.round(h/d*100):0;return e.jsxs(j,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsxs(U,{className:"text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Stakeholder Rating - ",c.name]})}),e.jsx(p,{children:e.jsx(C,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(t),className:"space-y-6",children:[e.jsx("div",{className:"space-y-6",children:o.fields.map(a=>e.jsx("div",{children:e.jsx(k,{name:`rating_data.${a.name}`,control:r.control,render:({field:s,fieldState:f})=>e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(_,{className:"text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a.description})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.value||0," / ",a.max_value]})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{value:[s.value||0],onValueChange:u=>s.onChange(u[0]),max:a.max_value,step:1,className:"flex-1",disabled:i}),e.jsx(P,{type:"number",min:0,max:a.max_value,value:s.value||0,onChange:u=>s.onChange(Number(u.target.value)),disabled:i,className:"w-24 text-center"})]})}),f.error&&e.jsx(I,{className:"text-destructive",children:f.error.message})]})})},a.name))}),e.jsx("div",{className:"p-4 bg-accent/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Total Rating"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[g,"%"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h," / ",d]})]})]})}),e.jsxs(D,{type:"submit",disabled:i,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Rating"]})]})})})]})},Z=()=>{const{projectId:n}=M(),{stakeholderRatings:c,stakeholderRatingConfigs:m,isLoading:i,createRating:o}=G(n),l=m.find(t=>t.is_active),r=async t=>{await o(t)};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:"Stakeholder Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Project evaluation from stakeholder perspective"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:l?e.jsx(O,{projectId:parseInt(n),config:l,onSubmit:r,isLoading:i}):e.jsx(j,{className:"bg-card border-border",children:e.jsx(p,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No active stakeholder rating configuration found"})})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Previous Ratings"}),i?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,x)=>e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},x))}):c.length===0?e.jsx(j,{className:"bg-card border-border",children:e.jsx(p,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No ratings yet for this project"})})}):e.jsx("div",{className:"space-y-4",children:c.map(t=>e.jsx(A,{rating:t},t.id))})]})]})]}):e.jsx("div",{children:"Project not found"})};export{Z as default};
