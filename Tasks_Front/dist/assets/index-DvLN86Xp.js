import{g as se,r as k,m as ae,j as e,l as L,B as i,C as n,c as d,d as o,S as w,f as c,M as q,N as H,O as K,Q as W,V as G,F as y,U as Q,I as te}from"./index-CH0ELVhY.js";import{T as re,a as le,b as ie,c as ne}from"./tabs-CCvWbC_r.js";import{B as m}from"./badge-ClFdoHwc.js";import{u as ce}from"./ratingsStore-Dm_jS_Nb.js";import{R as de}from"./refresh-cw-BM4yvPha.js";import{A as X}from"./arrow-right-90xCRLu2.js";import{S as Z}from"./search-DCTwE3Jt.js";import{T as oe}from"./trending-up-BwXVcMdP.js";import{E as ee}from"./eye-CRLIawko.js";import{C as me}from"./circle-alert-DLbqUAcF.js";import"./ratingConfigService-DnG5SoOH.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]],he=se("calculator",xe),ge=()=>{const{taskRatings:h,stakeholderRatings:D,finalRatings:S,taskRatingConfigs:T,stakeholderRatingConfigs:f,finalRatingConfigs:_,availableTasks:x,availableProjects:R,availableUsers:l,taskRatingsPagination:I,stakeholderRatingsPagination:g,finalRatingsPagination:a,isLoading:M,error:P,fetchTaskRatings:V,fetchStakeholderRatings:u,fetchFinalRatings:j,fetchUserFinalRating:N,fetchTaskRatingConfigs:r,fetchStakeholderRatingConfigs:z,fetchFinalRatingConfigs:F,fetchAvailableTasks:p,fetchAvailableProjects:b,fetchAvailableUsers:A,createTaskRating:E,updateTaskRating:O,createStakeholderRating:U,updateStakeholderRating:$,calculateFinalRating:v}=ce();k.useEffect(()=>{T.length||r(),f.length||z(),_.length||F(),x.length||p(),R.length||b(),l.length||A()},[T.length,f.length,_.length,x.length,R.length,l.length,r,z,F,p,b,A]);const s=B=>{j(B)};return{taskRatings:h,stakeholderRatings:D,finalRatings:S,taskRatingConfigs:T,stakeholderRatingConfigs:f,finalRatingConfigs:_,availableTasks:x,availableProjects:R,availableUsers:l,taskRatingsPagination:I,stakeholderRatingsPagination:g,finalRatingsPagination:a,isLoading:M,error:P,fetchTaskRatings:V,fetchStakeholderRatings:u,fetchFinalRatings:j,fetchUserFinalRating:N,createTaskRating:E,updateTaskRating:O,createStakeholderRating:U,updateStakeholderRating:$,calculateFinalRating:v,goToFinalRatingsPage:s,nextFinalRatingsPage:()=>{a&&a.current_page<a.last_page&&s(a.current_page+1)},prevFinalRatingsPage:()=>{a&&a.current_page>1&&s(a.current_page-1)}}},Ce=()=>{const[h,D]=k.useState(""),[S,T]=k.useState(""),[f,_]=k.useState(""),[x,R]=k.useState({tasks:[],projects:[]}),{finalRatings:l,finalRatingsPagination:I,availableTasks:g,availableProjects:a,isLoading:M,fetchFinalRatings:P}=ge(),{hasPermission:V,hasAnyPermission:u}=ae(),j=u(["create task ratings","edit task ratings"]),N=u(["create stakeholder ratings","edit stakeholder ratings"]),r=V("view final ratings"),z=V("calculate final ratings");k.useEffect(()=>{const s=localStorage.getItem("ratings_recently_viewed");s&&R(JSON.parse(s))},[]),k.useEffect(()=>{r&&!l.length&&P(1)},[r,l.length,P]);const F=(s,t,J)=>{const B={id:t,name:J,viewedAt:new Date().toISOString()},C={...x};s==="task"?C.tasks=[B,...C.tasks.filter(Y=>Y.id!==t)].slice(0,5):C.projects=[B,...C.projects.filter(Y=>Y.id!==t)].slice(0,5),R(C),localStorage.setItem("ratings_recently_viewed",JSON.stringify(C))},p=(s,t)=>{j&&(F("task",s,t),window.open(`/ratings/tasks/${s}`,"_blank"))},b=(s,t)=>{N&&(F("project",s,t),window.open(`/ratings/projects/${s}/stakeholder`,"_blank"))},A=g.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.description?.toLowerCase().includes(h.toLowerCase())),E=a.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.description?.toLowerCase().includes(h.toLowerCase())),O=r?I?.total||l.length:0,U=r&&l.length>0?l.reduce((s,t)=>s+t.final_rating,0)/l.length:0,$=r?l.filter(s=>new Date(s.calculated_at)>new Date(Date.now()-720*60*60*1e3)).length:0,v=({message:s})=>e.jsx(n,{className:"bg-card border-border",children:e.jsxs(c,{className:"p-6 text-center",children:[e.jsx(me,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s})]})});return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(L,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Ratings Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Performance evaluation and rating management system"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(i,{variant:"outline",disabled:M,onClick:()=>r&&P(1),children:[e.jsx(de,{className:`w-4 h-4 mr-2 ${M?"animate-spin":""}`}),"Refresh"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[j?e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Task Ratings"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Select Task"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{value:S,onValueChange:T,children:[e.jsx(H,{className:"flex-1",children:e.jsx(K,{placeholder:"Choose a task..."})}),e.jsx(W,{className:"max-h-60",children:A.map(s=>e.jsx(G,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:["Weight: ",s.weight]})]})]})]})},s.id))})]}),e.jsxs(i,{disabled:!S,onClick:()=>{const s=g.find(t=>t.id.toString()===S);s&&p(s.id,s.name)},className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Rate"]})]})]}),x.tasks.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Recently Rated"}),e.jsx("div",{className:"space-y-2",children:x.tasks.map(s=>e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-between text-left",onClick:()=>p(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),s.name]}),e.jsx(X,{className:"w-4 h-4"})]},s.id))})]})]})]}):e.jsx(v,{message:"You don't have permission to create or edit task ratings"}),N?e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Stakeholder Ratings"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Select Project"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{value:f,onValueChange:_,children:[e.jsx(H,{className:"flex-1",children:e.jsx(K,{placeholder:"Choose a project..."})}),e.jsx(W,{className:"max-h-60",children:E.filter(s=>s.stakeholder_will_rate).map(s=>e.jsx(G,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:[s.progress_percentage,"% complete"]})]})]})]})},s.id))})]}),e.jsxs(i,{disabled:!f,onClick:()=>{const s=a.find(t=>t.id.toString()===f);s&&b(s.id,s.name)},className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Rate"]})]})]}),x.projects.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Recently Rated"}),e.jsx("div",{className:"space-y-2",children:x.projects.map(s=>e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-between text-left",onClick:()=>b(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),s.name]}),e.jsx(X,{className:"w-4 h-4"})]},s.id))})]})]})]}):e.jsx(v,{message:"You don't have permission to create or edit stakeholder ratings"}),u(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])?e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Quick Search"]})}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(te,{placeholder:"Search tasks or projects...",value:h,onChange:s=>D(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),h&&e.jsxs("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:[j&&e.jsxs("div",{children:[e.jsx("h6",{className:"text-xs font-medium text-muted-foreground mb-2",children:"TASKS"}),A.slice(0,3).map(s=>e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-between text-left mb-2",onClick:()=>p(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:s.name}),e.jsx(m,{variant:"secondary",className:"text-xs",children:"Task"})]})]}),e.jsx(L,{className:"w-4 h-4"})]},`task-${s.id}`))]}),N&&e.jsxs("div",{children:[e.jsx("h6",{className:"text-xs font-medium text-muted-foreground mb-2",children:"PROJECTS"}),E.filter(s=>s.stakeholder_will_rate).slice(0,3).map(s=>e.jsxs(i,{variant:"outline",size:"sm",className:"w-full justify-between text-left mb-2",onClick:()=>b(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:s.name}),e.jsx(m,{variant:"secondary",className:"text-xs",children:"Project"})]})]}),e.jsx(Q,{className:"w-4 h-4"})]},`project-${s.id}`))]})]})]})]}):e.jsx(v,{message:"You don't have permission to rate tasks or stakeholders"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Final Ratings"}),e.jsx(L,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?O:"—"})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Average Rating"}),e.jsx(oe,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?`${Math.round(U)}%`:"—"})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Available Tasks"}),e.jsx(w,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j?g.length:"—"})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Available Projects"}),e.jsx(y,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:N?a.filter(s=>s.stakeholder_will_rate).length:"—"})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"This Month"}),e.jsx(he,{className:"w-4 h-4 text-chart-5"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?$:"—"})})]})]}),e.jsxs(re,{defaultValue:z?"calculate":r?"history":"browse",className:"space-y-4",children:[e.jsx(le,{className:"bg-muted",children:u(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])&&e.jsx(ie,{value:"browse",children:"Browse Ratings"})}),u(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])&&e.jsx(ne,{value:"browse",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[j?e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Browse Tasks"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[g.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:["Due: ",new Date(s.due_date).toLocaleDateString()]})]})]})]}),e.jsxs(i,{size:"sm",onClick:()=>p(s.id,s.name),children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Rate"]})]},s.id)),g.length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"View All Tasks (",g.length,")"]})})]})})]}):e.jsx(v,{message:"You don't have permission to rate tasks"}),N?e.jsxs(n,{className:"bg-card border-border",children:[e.jsx(d,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"Browse Projects"]})}),e.jsx(c,{children:e.jsxs("div",{className:"space-y-4",children:[a.filter(s=>s.stakeholder_will_rate).slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(m,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(m,{variant:"secondary",className:"text-xs",children:[s.progress_percentage,"% complete"]})]})]})]}),e.jsxs(i,{size:"sm",onClick:()=>b(s.id,s.name),children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Rate"]})]},s.id)),a.filter(s=>s.stakeholder_will_rate).length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"View All Projects (",a.filter(s=>s.stakeholder_will_rate).length,")"]})})]})})]}):e.jsx(v,{message:"You don't have permission to rate stakeholders"})]})})]})]})})};export{Ce as default};
