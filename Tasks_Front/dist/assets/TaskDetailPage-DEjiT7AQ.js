import{g as H,w as pe,x as o,av as Be,R as y,j as e,C as T,c as K,d as X,U as ie,B as g,$ as je,f as F,K as fe,M as be,N as Ne,O as ve,P as V,I as se,a2 as ne,G as ye,H as Ie,J as ke,at as ae,aw as te,a as Ve,b as He,o as we,a7 as re,au as Oe,L as Re,ao as We,ax as Ce,s as U,ay as Ze,y as Se,ab as ce,E as _e,V as Ke,W as Xe,X as Ye,Y as de,az as Z,v as G,aA as Ge,Q as Je,a0 as Qe,ai as J,Z as R,S as oe,z as es}from"./index-Co4DmRwC.js";import{B as D}from"./badge-Cyh08Lie.js";import{s as M,u as ss}from"./subtaskService-C7ZviOKI.js";import{a as Le,T as as}from"./TaskPriorityBadge-CaU6NAqs.js";import{C as me}from"./circle-alert-9VA5AKXL.js";import{C as De}from"./checkbox-Dmoqfp2a.js";import{P as ts,a as rs,b as Q,c as ns,d as ls,e as is,f as cs}from"./pagination-DnjCelUz.js";import{A as Ae,a as Te,b as Fe,c as Pe,d as Me,e as Ue,f as Ee,g as ze}from"./alert-dialog-Oa9zMcQt.js";import{F as ds,a as $,b as q,c as B,d as I,e as W}from"./form-DSC5x_tv.js";import{E as os}from"./ellipsis-Bsjou73H.js";import{S as le}from"./square-pen-CE52VkCO.js";import{T as $e}from"./trash-2-Bmnt7nSb.js";import{A as ue}from"./arrow-left-CtWQeCHz.js";import{C as xe}from"./circle-check-CLhvW0rT.js";import"./label-D2VhrNjm.js";const ms=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],us=H("folder-kanban",ms);const xs=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],he=H("layers",xs);const hs=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],gs=H("message-square",hs);const ps=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],js=H("pen",ps);const fs=[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]],bs=H("weight",fs),Ns=pe((s,r)=>({subtasks:[],currentSubtask:null,pagination:null,taskPagination:{},currentTaskId:null,isLoading:!1,error:null,fetchSubtasksByTask:async(n,a=1)=>{s({isLoading:!0,error:null,currentTaskId:n});try{const t=await M.getSubtasksByTask(n,a);t.success?s(m=>({subtasks:t.data,taskPagination:{...m.taskPagination,[n]:t.pagination||{current_page:1,total:t.data.length,per_page:15,last_page:1,from:t.data.length>0?1:null,to:t.data.length}},pagination:t.pagination||{current_page:1,total:t.data.length,per_page:15,last_page:1,from:t.data.length>0?1:null,to:t.data.length},isLoading:!1})):(s({error:t.message,isLoading:!1}),o.error(t.message))}catch(t){const m=t.message||"Failed to fetch subtasks";s({error:m,isLoading:!1}),o.error(m)}},fetchSubtask:async n=>{s({isLoading:!0,error:null});try{const a=await M.getSubtask(n);a.success?s({currentSubtask:a.data,isLoading:!1}):(s({error:a.message,isLoading:!1}),o.error(a.message))}catch(a){const t=a.message||"Failed to fetch subtask";s({error:t,isLoading:!1}),o.error(t)}},createSubtask:async n=>{s({isLoading:!0,error:null});try{const a=await M.createSubtask(n);return a.success?(s({isLoading:!1}),o.success("Subtask created successfully"),r().fetchSubtasksByTask(n.task_id),a.data):(s({error:a.message,isLoading:!1}),o.error(a.message),null)}catch(a){const t=a.message||"Failed to create subtask";return s({error:t,isLoading:!1}),o.error(t),null}},updateSubtask:async(n,a)=>{s({isLoading:!0,error:null});try{const t=await M.updateSubtask(n,a);return t.success?(s({currentSubtask:t.data,isLoading:!1}),o.success("Subtask updated successfully"),a.task_id&&r().fetchSubtasksByTask(a.task_id),t.data):(s({error:t.message,isLoading:!1}),o.error(t.message),null)}catch(t){const m=t.message||"Failed to update subtask";return s({error:m,isLoading:!1}),o.error(m),null}},updateTaskStatus:async(n,a)=>{try{const t=await Be.updateTaskStatus(n,a);return t.success?(o.success("Task status updated"),t.data):(o.error(t.message),null)}catch(t){return o.error(t.message||"Failed to update task status"),null}},deleteSubtask:async n=>{s({isLoading:!0,error:null});try{const a=await M.deleteSubtask(n);return a.success?(s({isLoading:!1}),o.success("Subtask deleted successfully"),!0):(s({error:a.message,isLoading:!1}),o.error(a.message),!1)}catch(a){const t=a.message||"Failed to delete subtask";return s({error:t,isLoading:!1}),o.error(t),!1}},toggleSubtaskCompletion:async n=>{try{const a=await M.toggleSubtaskCompletion(n);return a.success?(o.success("Subtask completion toggled"),s(t=>({subtasks:t.subtasks.map(m=>m.id===n?a.data:m)})),a.data):(o.error(a.message),null)}catch(a){return o.error(a.message||"Failed to toggle subtask completion"),null}},clearCurrentSubtask:()=>s({currentSubtask:null,error:null})})),qe=s=>{const{subtasks:r,pagination:n,taskPagination:a,currentTaskId:t,isLoading:m,error:j,fetchSubtasksByTask:x,createSubtask:c,updateSubtask:v,updateTaskStatus:p,deleteSubtask:w,toggleSubtaskCompletion:N}=Ns();y.useEffect(()=>{s&&t!==s&&x(s,1)},[s,t,x]);const h=s?a[s]||null:n,u=_=>{s&&x(s,_)};return{subtasks:r,pagination:h,isLoading:m,error:j,fetchSubtasks:_=>x(_),createSubtask:c,updateSubtask:v,updateTaskStatus:p,deleteSubtask:w,toggleCompletion:N,goToPage:u,nextPage:()=>{h&&h.current_page<h.last_page&&u(h.current_page+1)},prevPage:()=>{h&&h.current_page>1&&u(h.current_page-1)}}},vs=({taskWithAssignments:s,availableUsers:r,onAddUser:n,onUpdateAssignment:a,onRemoveUser:t,isLoading:m=!1})=>{const[j,x]=y.useState(!1),[c,v]=y.useState(""),[p,w]=y.useState(10),[N,h]=y.useState(null),[u,f]=y.useState(0);if(!s)return null;const b=s.assigned_users||[],_=b.map(i=>i.id),P=r.filter(i=>!_.includes(i.id)),k=y.useMemo(()=>b.reduce((i,l)=>i+(Number(l.pivot?.percentage)||0),0),[b]),E=y.useMemo(()=>k>=100,[k]),S=100-k,A=async()=>{if(!c||p<=0)return;await n(Number(c),p)&&(v(""),w(10),x(!1))},z=(i,l)=>{h(i),f(l)},d=async i=>{u<=0||u>100||(await a(i,u),h(null))},L=()=>{h(null)};return e.jsxs(T,{className:"bg-card border-border w-full",children:[e.jsx(K,{className:"p-4 pb-3",children:e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(X,{className:"text-foreground flex items-center gap-1.5 text-base",children:[e.jsx(ie,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Assignments"})]}),e.jsx(D,{variant:"secondary",className:"text-xs font-semibold flex-shrink-0",children:b.length})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:[k,"%"]}),e.jsxs(D,{variant:k===100?"default":k>100?"destructive":"outline",className:"text-xs h-5",children:[S,"% left"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${k>100?"bg-destructive":k===100?"bg-chart-3":"bg-primary"}`,style:{width:`${Math.min(k,100)}%`}})})]}),P.length>0&&!j&&e.jsxs(g,{size:"sm",onClick:()=>x(!0),className:"w-full h-8 bg-primary text-primary-foreground hover:bg-primary/90",disabled:S<=0,children:[e.jsx(je,{className:"w-3.5 h-3.5 mr-1.5"}),"Assign User"]})]})}),e.jsxs(F,{className:"p-4 pt-0 space-y-2.5",children:[j&&e.jsxs("div",{className:"p-3 border border-primary/30 rounded-md bg-primary/5 space-y-2.5",children:[e.jsxs(fe,{value:c,onValueChange:v,children:[e.jsx(be,{className:"h-8 text-xs bg-background",children:e.jsx(Ne,{placeholder:"Select user"})}),e.jsx(ve,{children:P.map(i=>e.jsx(V,{value:i.id.toString(),className:"text-xs",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:i.name}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:i.email})]})},i.id))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{type:"number",value:p,onChange:i=>w(Number(i.target.value)),min:"1",max:S,className:"h-8 text-xs flex-1",placeholder:"%"}),e.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:"%"})]}),p>S&&S>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-destructive",children:[e.jsx(me,{className:"w-3 h-3 flex-shrink-0"}),e.jsxs("span",{children:["Max ",S,"%"]})]}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx(g,{size:"sm",onClick:A,disabled:!c||p<=0||p>S,className:"flex-1 h-7 text-xs",children:"Add"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>{x(!1),v(""),w(10)},className:"flex-1 h-7 text-xs",children:"Cancel"})]})]}),m?e.jsx("div",{className:"space-y-1.5",children:Array.from({length:2}).map((i,l)=>e.jsx("div",{className:"h-14 bg-muted/50 animate-pulse rounded-md"},l))}):b.length===0?e.jsxs("div",{className:"text-center py-8 px-2",children:[e.jsx("div",{className:"mx-auto w-10 h-10 rounded-full bg-muted flex items-center justify-center mb-2",children:e.jsx(ie,{className:"w-5 h-5 text-muted-foreground"})}),e.jsx("p",{className:"text-xs font-medium text-foreground",children:"No users assigned"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:"Click above to assign"})]}):e.jsx(ne,{className:"max-h-[350px] pr-2",children:e.jsx("div",{className:"space-y-1.5",children:b.map(i=>e.jsxs("div",{className:"flex items-center gap-2 p-2.5 border border-border rounded-md hover:border-primary/40 hover:bg-accent/20 transition-colors group",children:[e.jsxs(ye,{className:"w-7 h-7 flex-shrink-0",children:[typeof i.avatar_url=="string"&&i.avatar_url.trim()!==""&&e.jsx(Ie,{src:i.avatar_url,alt:i.name||"User"}),e.jsx(ke,{className:"bg-primary text-primary-foreground text-xs font-semibold",children:i.name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-foreground truncate leading-tight",children:i.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:N===i.id?e.jsx("span",{className:"text-primary",children:"Editing..."}):`${i.pivot.percentage}%`})]}),e.jsx("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:N===i.id?e.jsxs(e.Fragment,{children:[e.jsx(se,{type:"number",value:u,onChange:l=>f(Number(l.target.value)),min:"1",max:"100",className:"w-12 h-6 text-xs p-1 text-center",autoFocus:!0}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>d(i.id),className:"h-6 w-6 p-0 text-chart-3",title:"Save",children:e.jsx(ae,{className:"h-3.5 w-3.5"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:L,className:"h-6 w-6 p-0",title:"Cancel",children:e.jsx(te,{className:"h-3.5 w-3.5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>z(i.id,i.pivot.percentage),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100",title:"Edit percentage",children:e.jsx(js,{className:"h-3 w-3"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>t(i.id),className:"h-6 w-6 p-0 text-muted-foreground hover:text-destructive opacity-0 group-hover:opacity-100",title:"Remove",children:e.jsx(te,{className:"h-3.5 w-3.5"})})]})})]},i.id))})}),b.length>0&&e.jsxs("div",{className:"pt-2 space-y-1.5",children:[k>100&&e.jsxs("div",{className:"flex items-start gap-1.5 p-2 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsx(me,{className:"w-3.5 h-3.5 text-destructive flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-destructive leading-tight",children:["Over by ",k-100,"%"]})]}),E&&e.jsxs("div",{className:"flex items-center gap-1.5 p-2 bg-chart-3/10 border border-chart-3/20 rounded-md",children:[e.jsx(ae,{className:"w-3.5 h-3.5 text-chart-3 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-chart-3 font-medium",children:"Fully assigned"})]})]})]})]})},ys=we({name:U().min(1,"Subtask name is required").max(255),description:U().optional(),due_date:U().min(1,"Due date is required"),priority:Ce(["low","medium","high","critical"]),task_id:Ze()}),ks=we({name:U().min(1,"Subtask name is required").max(255),description:U().optional(),due_date:U().min(1,"Due date is required"),priority:Ce(["low","medium","high","critical"]),is_complete:We().optional()}),ge=({subtask:s,taskId:r,onSubmit:n,onCancel:a,isLoading:t})=>{const m=!!s,j=Ve({resolver:He(m?ks:ys),defaultValues:{name:s?.name||"",description:s?.description||"",due_date:s?.due_date?new Date(s.due_date).toISOString().split("T")[0]:"",priority:s?.priority||"medium",is_complete:s?.is_complete||!1,task_id:r}}),x=async c=>{const v={...c,...r&&{task_id:r}};await n(v)};return e.jsx(ds,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(x),className:"space-y-4",children:[e.jsx($,{control:j.control,name:"name",render:({field:c})=>e.jsxs(q,{children:[e.jsx(B,{className:"text-foreground",children:"Subtask Name"}),e.jsx(I,{children:e.jsx(se,{placeholder:"Enter subtask name",...c,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(W,{className:"text-destructive"})]})}),e.jsx($,{control:j.control,name:"description",render:({field:c})=>e.jsxs(q,{children:[e.jsx(B,{className:"text-foreground",children:"Description"}),e.jsx(I,{children:e.jsx(re,{placeholder:"Enter subtask description (optional)",...c,disabled:t,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(W,{className:"text-destructive"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx($,{control:j.control,name:"due_date",render:({field:c})=>e.jsxs(q,{children:[e.jsx(B,{className:"text-foreground",children:"Due Date"}),e.jsx(I,{children:e.jsx(Oe,{id:"due_date",name:"due_date",value:c.value,onChange:c.onChange,disabled:t,className:"border-input text-foreground",required:!0})}),e.jsx(W,{className:"text-destructive"})]})}),e.jsx($,{control:j.control,name:"priority",render:({field:c})=>e.jsxs(q,{children:[e.jsx(B,{className:"text-foreground",children:"Priority"}),e.jsxs(fe,{onValueChange:c.onChange,defaultValue:c.value,disabled:t,children:[e.jsx(I,{children:e.jsx(be,{className:"bg-background border-input text-foreground",children:e.jsx(Ne,{placeholder:"Select priority"})})}),e.jsxs(ve,{children:[e.jsx(V,{value:"low",children:"Low"}),e.jsx(V,{value:"medium",children:"Medium"}),e.jsx(V,{value:"high",children:"High"}),e.jsx(V,{value:"critical",children:"Critical"})]})]}),e.jsx(W,{className:"text-destructive"})]})})]}),m&&e.jsx($,{control:j.control,name:"is_complete",render:({field:c})=>e.jsxs(q,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(I,{children:e.jsx(De,{checked:c.value,onCheckedChange:c.onChange,disabled:t})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(B,{className:"text-foreground",children:"Mark as completed"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Check this box if the subtask is completed"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{type:"submit",size:"sm",disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(Re,{className:"mr-2 h-3 w-3 animate-spin"}),m?"Update":"Create"]}),e.jsx(g,{type:"button",variant:"outline",size:"sm",onClick:a,disabled:t,children:"Cancel"})]})]})})},ws=({taskId:s})=>{const{subtasks:r,pagination:n,isLoading:a,createSubtask:t,updateSubtask:m,deleteSubtask:j,toggleCompletion:x,goToPage:c,nextPage:v,prevPage:p}=qe(s),[w,N]=y.useState(!1),[h,u]=y.useState(null),[f,b]=y.useState(null),_=async l=>{await t({...l,task_id:s}),N(!1)},P=async l=>{h&&(await m(h.id,l),u(null))},k=async l=>{b(l)},E=async()=>{f!=null&&(await j(f),b(null))},S=async l=>{await x(l)},{hasPermission:A,hasAnyPermission:z}=Se(),d=r.filter(l=>l.is_complete).length,L=r.length>0?Math.round(d/r.length*100):0,i=()=>{if(!n)return[];const l=[],{current_page:C,last_page:O}=n;C>3&&(l.push(1),C>4&&l.push("ellipsis-start"));for(let Y=Math.max(1,C-2);Y<=Math.min(O,C+2);Y++)l.push(Y);return C<O-2&&(C<O-3&&l.push("ellipsis-end"),l.push(O)),l};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{className:"bg-card border-border",children:[e.jsxs(K,{className:"pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(X,{className:"text-foreground flex items-center gap-2 text-lg",children:[e.jsx(ce,{className:"w-5 h-5"}),"Subtasks (",n?.total||r.length,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(D,{variant:"outline",className:"text-xs",children:[d,"/",n?.total||r.length," completed"]}),e.jsxs(D,{variant:"secondary",className:"text-xs",children:[L,"%"]}),A("create subtasks")&&e.jsxs(g,{size:"sm",onClick:()=>N(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Add Subtask"]})]})]}),r.length>0&&e.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-chart-3 h-2 rounded-full transition-all duration-300",style:{width:`${L}%`}})})]}),e.jsxs(F,{className:"p-0",children:[w&&e.jsxs("div",{className:"p-4 border-b border-border bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Subtask"}),e.jsx(ge,{taskId:s,onSubmit:_,onCancel:()=>N(!1),isLoading:a})]}),e.jsx(ne,{className:"h-[400px]",children:e.jsx("div",{className:"p-4 space-y-3",children:a?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((l,C)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},C))}):r.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ce,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No subtasks yet."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Create your first subtask to break down this task."})]}):r.map((l,C)=>e.jsxs("div",{children:[h?.id===l.id?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Subtask"}),e.jsx(ge,{subtask:h,taskId:s,onSubmit:P,onCancel:()=>u(null),isLoading:a})]}):e.jsxs("div",{className:"flex items-start justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors group",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx(De,{checked:l.is_complete,onCheckedChange:()=>S(l.id),className:"mt-1 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("h4",{className:`font-medium text-foreground truncate ${l.is_complete?"line-through text-muted-foreground":""}`,children:l.name}),e.jsx(Le,{priority:l.priority})]}),l.description&&e.jsx("p",{className:`text-sm mt-1 line-clamp-2 ${l.is_complete?"line-through text-muted-foreground":"text-muted-foreground"}`,children:l.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(_e,{className:"w-3 h-3"}),new Date(l.due_date).toLocaleDateString()]}),l.is_complete&&e.jsx(D,{variant:"outline",className:"text-xs text-chart-3",children:"Completed"})]})]})]}),z(["edit subtasks","delete subtasks"])&&e.jsxs(Ke,{children:[e.jsx(Xe,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:e.jsx(os,{className:"h-4 w-4"})})}),e.jsxs(Ye,{align:"end",className:"bg-popover border-border",children:[A("edit subtasks")&&e.jsxs(de,{onClick:()=>u(l),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Edit"]}),A("delete subtasks")&&e.jsxs(de,{onClick:()=>k(l.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),C<r.length-1&&e.jsx(Z,{className:"my-3"})]},l.id))})})]})]}),n&&n.last_page>1&&e.jsx(T,{className:"bg-card border-border",children:e.jsx(F,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",n.from||0," to ",n.to||0," of ",n.total," results"]}),e.jsx(ts,{children:e.jsxs(rs,{children:[e.jsx(Q,{children:e.jsx(ns,{onClick:p,className:n.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),i().map((l,C)=>e.jsx(Q,{children:l==="ellipsis-start"||l==="ellipsis-end"?e.jsx(ls,{}):e.jsx(is,{onClick:()=>c(l),isActive:n.current_page===l,className:"cursor-pointer",children:l})},C)),e.jsx(Q,{children:e.jsx(cs,{onClick:v,className:n.current_page===n.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})}),e.jsx(Ae,{open:f!==null,onOpenChange:l=>!l&&b(null),children:e.jsxs(Te,{className:"sm:max-w-[480px]",children:[e.jsxs(Fe,{children:[e.jsx(Pe,{children:"Delete subtask"}),e.jsx(Me,{children:"Are you sure you want to delete this subtask? This action cannot be undone."})]}),e.jsxs(Ue,{children:[e.jsx(Ee,{onClick:()=>b(null),children:"Cancel"}),e.jsx(ze,{onClick:E,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};class Cs{async createComment(r,n){return G.post(`tasks/${r}/comments`,n)}async updateComment(r,n){return G.put(`comments/${r}`,n)}async deleteComment(r){return G.delete(`comments/${r}`)}}const ee=new Cs,Ss=pe(s=>({isLoading:!1,error:null,createComment:async(r,n)=>{s({isLoading:!0,error:null});try{const a=await ee.createComment(r,n);return a.success&&a.data?(s({isLoading:!1}),o.success("Comment added successfully"),a.data):(s({error:a.message||"Failed to create comment",isLoading:!1}),o.error(a.message||"Failed to create comment"),null)}catch(a){const t=a.message||"Failed to create comment";return s({error:t,isLoading:!1}),o.error(t),null}},updateComment:async(r,n)=>{s({isLoading:!0,error:null});try{const a=await ee.updateComment(r,n);return a.success&&a.data?(s({isLoading:!1}),o.success("Comment updated successfully"),a.data):(s({error:a.message||"Failed to update comment",isLoading:!1}),o.error(a.message||"Failed to update comment"),null)}catch(a){const t=a.message||"Failed to update comment";return s({error:t,isLoading:!1}),o.error(t),null}},deleteComment:async r=>{s({isLoading:!0,error:null});try{const n=await ee.deleteComment(r);return n.success?(s({isLoading:!1}),o.success("Comment deleted successfully"),!0):(s({error:n.message||"Failed to delete comment",isLoading:!1}),o.error(n.message||"Failed to delete comment"),!1)}catch(n){const a=n.message||"Failed to delete comment";return s({error:a,isLoading:!1}),o.error(a),!1}}})),_s=s=>{const{isLoading:r,error:n,createComment:a,updateComment:t,deleteComment:m}=Ss(),{currentTask:j,fetchTask:x}=Ge(),{user:c}=Je();return{comments:j?.comments||[],isLoading:r,error:n,createComment:async u=>{const f=await a(s,{content:u});return f&&await x(s),f},updateComment:async(u,f)=>{const b=await t(u,{content:f});return b&&await x(s),b},deleteComment:async u=>{const f=await m(u);return f&&await x(s),f},canModifyComment:u=>c?!!(u.user_id===c.id||c.permissions?.some(f=>f.name==="create tasks")):!1}},Ls=({taskId:s})=>{const{comments:r,isLoading:n,createComment:a,updateComment:t,deleteComment:m,canModifyComment:j}=_s(s),[x,c]=y.useState(""),[v,p]=y.useState(null),[w,N]=y.useState(""),[h,u]=y.useState(!1),[f,b]=y.useState(null),_=async()=>{if(!x.trim())return;await a(x)&&c("")},P=d=>{p(d.id),N(d.content)},k=async d=>{if(!w.trim())return;await t(d,w)&&(p(null),N(""))},E=()=>{p(null),N("")},S=d=>{b(d),u(!0)},A=async()=>{f!==null&&(await m(f),u(!1),b(null))},z=()=>{u(!1),b(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs(X,{className:"text-foreground flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5"}),"Comments",e.jsx(D,{variant:"secondary",className:"text-xs",children:r.length})]})}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(re,{placeholder:"Add a comment...",value:x,onChange:d=>c(d.target.value),disabled:n,rows:3,className:"bg-background border-input text-foreground"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(g,{onClick:_,disabled:n||!x.trim(),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"Add Comment"})})]}),e.jsx(ne,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-4 pr-4",children:n&&r.length===0?e.jsx("div",{className:"space-y-3",children:Array.from({length:2}).map((d,L)=>e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded-lg"},L))}):r.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No comments yet. Be the first to comment!"}):r.map(d=>e.jsx("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"w-8 h-8 flex-shrink-0",children:e.jsx(ke,{className:"bg-primary text-primary-foreground text-xs",children:d.user?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{className:"flex-1 space-y-2 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium text-foreground text-sm",children:d.user?.name||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(d.created_at).toLocaleString()})]}),j(d)&&e.jsx("div",{className:"flex items-center gap-1",children:v===d.id?e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>k(d.id),className:"h-8 w-8 p-0",title:"Save",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:E,className:"h-8 w-8 p-0",title:"Cancel",children:e.jsx(te,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>P(d),className:"h-8 w-8 p-0",title:"Edit",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>S(d.id),className:"h-8 w-8 p-0 text-destructive hover:bg-destructive hover:text-destructive-foreground",title:"Delete",children:e.jsx($e,{className:"h-4 w-4"})})]})})]}),v===d.id?e.jsx(re,{value:w,onChange:L=>N(L.target.value),rows:3,className:"bg-background border-input text-foreground"}):e.jsx("p",{className:"text-foreground whitespace-pre-wrap break-words",children:d.content}),d.updated_at!==d.created_at&&v!==d.id&&e.jsxs("p",{className:"text-xs text-muted-foreground italic",children:["Edited ",new Date(d.updated_at).toLocaleString()]})]})]})},d.id))})})]})]}),e.jsx(Ae,{open:h,onOpenChange:u,children:e.jsxs(Te,{className:"sm:max-w-[425px]",children:[e.jsxs(Fe,{children:[e.jsx(Pe,{children:"Delete Comment"}),e.jsx(Me,{children:"Are you sure you want to delete this comment? This action cannot be undone."})]}),e.jsxs(Ue,{children:[e.jsx(Ee,{onClick:z,children:"Cancel"}),e.jsx(ze,{onClick:A,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})},Os=()=>{const{id:s}=Qe(),{task:r,taskWithAssignments:n,availableUsers:a,isLoading:t,error:m,addUser:j,updateAssignment:x,removeUser:c}=ss(s),{updateTaskStatus:v}=qe(),{hasPermission:p,hasAnyPermission:w}=Se(),N=async h=>{!r||!p("edit tasks")||await v(r.id,{status:h})};return t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto max-w-[1600px] p-4 md:p-6 lg:p-8 space-y-6",children:[e.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 bg-card/50 backdrop-blur-sm border border-border rounded-xl p-4 lg:p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl animate-pulse",children:e.jsx("div",{className:"w-7 h-7 bg-primary/20 rounded"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-64"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded w-20"}),e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded w-20"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"xl:col-span-1 space-y-4",children:[e.jsx("div",{className:"h-96 bg-card/50 border border-border animate-pulse rounded-xl"}),e.jsx("div",{className:"h-64 bg-card/50 border border-border animate-pulse rounded-xl"})]}),e.jsxs("div",{className:"xl:col-span-3 space-y-4",children:[e.jsx("div",{className:"h-[500px] bg-card/50 border border-border animate-pulse rounded-xl"}),e.jsx("div",{className:"h-96 bg-card/50 border border-border animate-pulse rounded-xl"})]})]})]})}):m||!r?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto max-w-[1600px] p-4 md:p-6 lg:p-8",children:e.jsx(T,{className:"bg-card border-border",children:e.jsxs(F,{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mb-4",children:e.jsx(J,{className:"w-8 h-8 text-destructive"})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Task Not Found"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:m||"The task you are looking for does not exist."}),e.jsx(g,{asChild:!0,variant:"outline",children:e.jsxs(R,{to:"/tasks",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back to Tasks"]})})]})})})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto max-w-[1600px] p-4 md:p-6 lg:p-8 space-y-6",children:[e.jsx("div",{className:"bg-card/50 backdrop-blur-sm border border-border rounded-xl p-4 lg:p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary/10 rounded-xl flex-shrink-0",children:e.jsx(J,{className:"w-7 h-7 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-foreground leading-tight",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(as,{status:r.status}),e.jsx(Le,{priority:r.priority}),r.latest_final_rating&&e.jsxs(D,{variant:"outline",className:"bg-amber-500/10 text-amber-600 border-amber-500/20",children:[e.jsx(oe,{className:"w-3 h-3 mr-1 fill-current"}),r.latest_final_rating]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[p("view tasks")&&e.jsxs(e.Fragment,{children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>N("in_progress"),disabled:r.status==="in_progress"||r.status==="rated",className:"hover:bg-primary/10 hover:text-primary",children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>N("done"),disabled:r.status==="done"||r.status==="rated",className:"hover:bg-chart-3/10 hover:text-chart-3",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),p("edit tasks")&&e.jsx(g,{asChild:!0,size:"sm",className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(R,{to:`/tasks/${r.id}/edit`,children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Edit"]})}),w(["create task ratings","edit task ratings"])&&e.jsx(g,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(R,{to:`/ratings/tasks/${r.id}`,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),"Rate"]})}),e.jsx(g,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(R,{to:"/tasks",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back"]})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"xl:col-span-1 space-y-4",children:[e.jsxs(T,{className:"bg-card border-border shadow-sm hover:shadow-md transition-shadow",children:[e.jsx(K,{className:"pb-3",children:e.jsxs(X,{className:"text-foreground flex items-center gap-2 text-base",children:[e.jsx(J,{className:"w-4 h-4 text-primary"}),"Task Information"]})}),e.jsxs(F,{className:"space-y-4 text-sm",children:[r.description&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Description"}),e.jsx("p",{className:"text-foreground leading-relaxed",children:r.description})]}),e.jsx(Z,{})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide mb-2",children:"Location"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-accent/50 rounded-lg",children:[e.jsx(us,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:r.section?.project?.name||"Unknown Project"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:r.section?.name||"Unknown Section"})]})]})})]}),e.jsx(Z,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-accent/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(bs,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Weight"})]}),e.jsx(D,{variant:"outline",className:"text-sm font-semibold",children:r.weight})]}),e.jsxs("div",{className:"p-3 bg-accent/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(he,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:"Subtasks"})]}),e.jsx(D,{variant:"secondary",className:"text-sm font-semibold",children:r.subtasks?.length||0})]})]}),e.jsx(Z,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3 p-2 bg-accent/50 rounded-lg",children:[e.jsx(_e,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-0.5",children:"Due Date"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:new Date(r.due_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),r.completed_at&&e.jsxs("div",{className:"flex items-start gap-3 p-2 bg-chart-3/10 border border-chart-3/20 rounded-lg",children:[e.jsx(xe,{className:"w-4 h-4 text-chart-3 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-0.5",children:"Completed"}),e.jsx("p",{className:"text-sm font-medium text-chart-3",children:new Date(r.completed_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]})]})]})]}),p("edit tasks")&&e.jsx(vs,{taskWithAssignments:n,availableUsers:a,onAddUser:j,onUpdateAssignment:x,onRemoveUser:c,isLoading:t})]}),e.jsxs("div",{className:"xl:col-span-3 space-y-4",children:[p("view subtasks")?e.jsx(ws,{taskId:r.id}):e.jsx(T,{className:"bg-card border-border shadow-sm",children:e.jsxs(F,{className:"p-12 text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(he,{className:"w-6 h-6 text-muted-foreground"})}),e.jsx("p",{className:"text-sm font-medium text-foreground mb-1",children:"Subtasks Hidden"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You don't have permission to view subtasks"})]})}),e.jsx(Ls,{taskId:r.id})]})]})]})})};export{Os as default};
