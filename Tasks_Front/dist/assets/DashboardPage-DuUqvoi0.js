import{h as w,i as C,t as f,k as v,r as k,j as e,l as S,U as D,m as T,S as F,n as b,T as R,p as A,I as h,B as y}from"./index-DVPQua6C.js";import{a as L}from"./analyticsService-C_qLtc_v.js";import{u as _}from"./filtersStore-CYp_92GW.js";import{C as d,a as m,d as i,b as u}from"./card-Chf90Mg7.js";import{T as I}from"./trending-up-ByJ3q-uv.js";import{B as q}from"./badge-B3kg6diS.js";import{C as B}from"./clock-CSTVRaBf.js";import{C as p}from"./circle-check-big-_dPHnCTJ.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],O=w("rotate-ccw",U),E=C(s=>({data:null,isLoading:!1,error:null,fetchDashboardData:async(a,n,r)=>{s({isLoading:!0,error:null});try{const t=await L.getDashboardSummary(a,n,r);t.success?s({data:t.data,isLoading:!1}):(s({error:t.message||"Failed to load dashboard",isLoading:!1}),f.error(t.message||"Failed to load dashboard"))}catch(t){const c=t.message||"Failed to load dashboard data";s({error:c,isLoading:!1}),f.error(c)}}})),M=()=>{const{data:s,isLoading:a,error:n,fetchDashboardData:r}=E(),{dateRange:t}=_(),{user:c,isAuthenticated:o}=v(),l=()=>{!o||!c||r(c?.id,t.start?.toISOString().split("T")[0],t.end?.toISOString().split("T")[0])};return k.useEffect(()=>{l()},[t.start,t.end,c?.id,o]),{data:s,isLoading:a,error:n,refresh:l}};function x({className:s,...a}){return e.jsx("div",{"data-slot":"skeleton",className:S("bg-accent animate-pulse rounded-md",s),...a})}const N=(s,a=1)=>{if(s==null)return"0";const n=typeof s=="number"?s:Number(s);return Number.isFinite(n)?n.toFixed(a):"0"},$=s=>{if(s==null)return null;if(typeof s=="number")return Number.isFinite(s)?s.toFixed(1):null;const a=Number.parseFloat(String(s).trim());return Number.isFinite(a)?a.toFixed(1):null},j=s=>new Date(s).toLocaleDateString(),H=({data:s,isLoading:a})=>{if(a)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:Array.from({length:6}).map((r,t)=>e.jsxs(d,{className:"bg-card border-border",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"h-4 w-20 bg-muted"}),e.jsx(x,{className:"h-8 w-8 rounded-full bg-muted"})]}),e.jsx(i,{children:e.jsx(x,{className:"h-8 w-16 mb-2 bg-muted"})})]},t))});if(!s)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:e.jsx(d,{className:"bg-card border-border",children:e.jsx(i,{className:"p-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"No data available"})})})});const n=[{title:"Total Users",value:s.system_metrics?.general_stats?.total_users||0,icon:D,color:"text-chart-1",bgColor:"bg-chart-1/10"},{title:"Active Projects",value:s.project_health?.active_projects||0,icon:T,color:"text-chart-2",bgColor:"bg-chart-2/10"},{title:"Tasks Completed",value:s.system_metrics?.activity_stats?.tasks_completed||0,icon:F,color:"text-chart-3",bgColor:"bg-chart-3/10"},{title:"Average Rating",value:N(s.system_metrics?.quality_stats?.avg_task_rating,1),icon:b,color:"text-chart-4",bgColor:"bg-chart-4/10"},{title:"Tickets Resolved",value:s.system_metrics?.activity_stats?.tickets_resolved||0,icon:R,color:"text-chart-5",bgColor:"bg-chart-5/10"},{title:"Performance Score",value:N(s.user_metrics?.performance_score,0),icon:I,color:"text-primary",bgColor:"bg-primary/10"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:n.map((r,t)=>{const c=r.icon;return e.jsxs(d,{className:"hover:shadow-md transition-shadow bg-card border-border",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium text-muted-foreground",children:r.title}),e.jsx("div",{className:`p-2 rounded-lg ${r.bgColor}`,children:e.jsx(c,{className:`w-4 h-4 ${r.color}`})})]}),e.jsx(i,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground font-sans",children:r.value})})]},t)})})},P=({data:s,isLoading:a})=>{if(a)return e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(i,{className:"space-y-4",children:Array.from({length:4}).map((r,t)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(x,{className:"w-8 h-8 rounded-full bg-muted"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"h-4 w-3/4 mb-2 bg-muted"}),e.jsx(x,{className:"h-3 w-1/2 bg-muted"})]})]},t))})]});if(!s||!s.recent_activities)return e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(i,{children:e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No recent activity"})})]});const n=r=>{switch(r){case"task_rating":return{icon:b,color:"text-chart-4"};case"stakeholder_rating":return{icon:b,color:"text-chart-1"};case"ticket_completed":return{icon:p,color:"text-chart-2"};case"help_request_completed":return{icon:p,color:"text-chart-3"};default:return{icon:B,color:"text-muted-foreground"}}};return e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-foreground",children:"Recent Activity"})}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:s.recent_activities.map((r,t)=>{const{icon:c,color:o}=n(r.type);return e.jsxs("div",{className:"flex items-start space-x-3 p-3 rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsx("div",{className:"p-2 rounded-full bg-muted",children:e.jsx(c,{className:`w-4 h-4 ${o}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:[r.type.replace(/_/g," ").replace(/\b\w/g,l=>l.toUpperCase()),r.value&&` (${r.value})`]}),e.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["User ID: ",r.user_id]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(r.activity_date).toLocaleDateString()})]})]}),e.jsx(q,{variant:"secondary",className:"text-xs bg-secondary text-secondary-foreground",children:r.type})]},t)})})})]})},Q=({data:s,isLoading:a})=>{if(a)return e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:Array.from({length:3}).map((c,o)=>e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(x,{className:"h-5 w-32 bg-muted"})}),e.jsx(i,{children:e.jsx(x,{className:"h-32 w-full bg-muted"})})]},o))});if(!s||!s.trends)return e.jsx(d,{className:"bg-card border-border",children:e.jsx(i,{className:"p-6",children:e.jsx("p",{className:"text-muted-foreground text-center",children:"No trend data available"})})});const n=s.trends.task_ratings_trend??[],r=s.trends.tickets_solved_trend??[],t=s.trends.help_requests_trend??[];return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg text-foreground",children:"Task Ratings Trend"})}),e.jsx(i,{children:n.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No data"}):e.jsx("div",{className:"space-y-2",children:n.slice(0,5).map((c,o)=>{const g=$(c.avg_value)??c.count??"—";return e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:j(c.date)}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:g})]},o)})})})]}),e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg text-foreground",children:"Tickets Solved"})}),e.jsx(i,{children:r.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No data"}):e.jsx("div",{className:"space-y-2",children:r.slice(0,5).map((c,o)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:j(c.date)}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:c.count??"—"})]},o))})})]}),e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(u,{className:"text-lg text-foreground",children:"Help Requests"})}),e.jsx(i,{children:t.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No data"}):e.jsx("div",{className:"space-y-2",children:t.slice(0,5).map((c,o)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:j(c.date)}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:c.count??"—"})]},o))})})]})]})},z=()=>{const{dateRange:s,searchQuery:a,setDateRange:n,setSearchQuery:r,resetFilters:t}=_(),c=l=>{const g=l.target.value?new Date(l.target.value):null;n({start:g,end:s.end})},o=l=>{const g=l.target.value?new Date(l.target.value):null;n({start:s.start,end:g})};return e.jsx(d,{className:"mb-6 bg-card border-border",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(h,{placeholder:"Search activities...",value:a,onChange:l=>r(l.target.value),className:"pl-10 bg-background border-input text-foreground placeholder:text-muted-foreground"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{type:"date",value:s.start?.toISOString().split("T")[0]||"",onChange:c,className:"w-40 bg-background border-input text-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(h,{type:"date",value:s.end?.toISOString().split("T")[0]||"",onChange:o,className:"w-40 bg-background border-input text-foreground"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:t,className:"border-border hover:bg-accent hover:text-accent-foreground",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Reset"]})]})]})})})},ee=()=>{const{data:s,isLoading:a,error:n,refresh:r}=M(),{user:t}=v();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground mt-1 font-sans",children:["Welcome back, ",t?.name,"! Here's your project overview."]})]}),e.jsx(y,{variant:"outline",onClick:r,disabled:a,className:"border-border hover:bg-accent hover:text-accent-foreground",children:a?"Loading...":"Refresh"})]}),n&&e.jsx("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-4",children:e.jsx("p",{className:"text-destructive font-medium",children:n})}),e.jsx(z,{}),e.jsx(H,{data:s,isLoading:a}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx(P,{data:s,isLoading:a})}),e.jsx("div",{children:e.jsx(Q,{data:s,isLoading:a})})]})]})};export{ee as default};
