import{a as ie,b as ce,o as oe,j as e,F as le,c as U,d as z,e as B,f as R,I as de,g as $,R as me,B as h,L as xe,s as L,r as A,q as _,V as he,W as K,X as ue,Y as pe,Z as ge,_ as je,$ as fe,D as O,v as W,w as V,x as v,a0 as Ne,S as Y,n as M,z as be,a1 as ve,y as w,m as q,U as we,K as ye}from"./index-Zu_vECNa.js";import{C as k,a as H,b as I,d as P}from"./card-BEr3QNnL.js";import{A as Ce,a as Se}from"./avatar-DLajZ5eL.js";import{P as ke}from"./progress-CVtTVQ8C.js";import{u as Pe}from"./useProject-CAeF2ogu.js";import{P as _e,K as De}from"./ProjectStatusBadge-DEbMvb00.js";import{B as X}from"./badge-DxFSLxNv.js";import{P as Te,a as Ae,b as E,c as Ee,d as Fe,e as Ue,f as ze}from"./pagination-BuOP3ZWf.js";import{L as Be}from"./list-CSbr7xle.js";import{P as S}from"./plus-BVAq3NVV.js";import{E as Z}from"./ellipsis-BlRS9ixv.js";import{S as F}from"./square-pen-nXKqUES0.js";import{T as G}from"./trash-2-CfGhK2lt.js";import{C as J}from"./calendar-CxcshZSH.js";import{A as Re}from"./arrow-left-WdRhSVc9.js";import"./index-C8ilSr3e.js";const $e=oe({name:L().min(1,"Section name is required").max(255),description:L().optional()}),Q=({section:a,onSubmit:t,onCancel:p,isLoading:c})=>{const o=ie({resolver:ce($e),defaultValues:{name:a?.name||"",description:a?.description||""}}),u=async m=>{await t(m)};return e.jsx(le,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(u),className:"space-y-4",children:[e.jsx(U,{control:o.control,name:"name",render:({field:m})=>e.jsxs(z,{children:[e.jsx(B,{className:"text-foreground",children:"Section Name"}),e.jsx(R,{children:e.jsx(de,{placeholder:"Enter section name",...m,disabled:c,className:"bg-background border-input text-foreground"})}),e.jsx($,{className:"text-destructive"})]})}),e.jsx(U,{control:o.control,name:"description",render:({field:m})=>e.jsxs(z,{children:[e.jsx(B,{className:"text-foreground",children:"Description"}),e.jsx(R,{children:e.jsx(me,{placeholder:"Enter section description (optional)",...m,disabled:c,className:"bg-background border-input text-foreground",rows:2})}),e.jsx($,{className:"text-destructive"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{type:"submit",size:"sm",disabled:c,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[c&&e.jsx(xe,{className:"mr-2 h-3 w-3 animate-spin"}),a?"Update":"Create"]}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:p,disabled:c,children:"Cancel"})]})]})})},Le=({sections:a,projectId:t,onCreateSection:p,onUpdateSection:c,onDeleteSection:o,isLoading:u})=>{const[m,j]=A.useState(!1),[n,g]=A.useState(null),[l,b]=A.useState(new Set),{hasPermission:x}=_(),{openTaskDialog:f}=he(),{projectPagination:d,fetchSectionsByProject:N}=K(),s=d[t]||null,y=async r=>{await p({...r,project_id:t}),j(!1)},ee=async r=>{n&&(await c(n.id,r),g(null))},se=async r=>{window.confirm("Are you sure you want to delete this section?")&&await o(r)},te=r=>{const i=new Set(l);i.has(r)?i.delete(r):i.add(r),b(i)},D=r=>{N(t,r)},ae=()=>{s&&s.current_page<s.last_page&&D(s.current_page+1)},re=()=>{s&&s.current_page>1&&D(s.current_page-1)},ne=()=>{if(!s)return[];const r=[],{current_page:i,last_page:C}=s;i>3&&(r.push(1),i>4&&r.push("ellipsis-start"));for(let T=Math.max(1,i-2);T<=Math.min(C,i+2);T++)r.push(T);return i<C-2&&(i<C-3&&r.push("ellipsis-end"),r.push(C)),r};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{className:"bg-card border-border",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(I,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Sections & Tasks (",s?.total||a.length,")"]}),x("create sections")&&e.jsxs(h,{type:"button",size:"sm",onClick:()=>j(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})}),e.jsxs(P,{className:"space-y-4",children:[m&&x("create sections")&&e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Section"}),e.jsx(Q,{onSubmit:y,onCancel:()=>j(!1),isLoading:u})]}),u?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((r,i)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},i))}):a.length===0?e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:["No sections yet. ",x("create sections")?"Create your first section to get started.":"No sections available."]}):a.map(r=>e.jsx(Me,{section:r,projectId:t,isExpanded:l.has(r.id),onToggle:()=>te(r.id),onEdit:()=>g(r),onDelete:()=>se(r.id),isEditing:n?.id===r.id,editingSection:n,onUpdateSection:ee,onCancelEdit:()=>g(null),openTaskDialog:f,isLoading:u},r.id))]})]}),s&&s.last_page>1&&e.jsx(k,{className:"bg-card border-border",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",s.from||0," to ",s.to||0," of ",s.total," results"]}),e.jsx(Te,{children:e.jsxs(Ae,{children:[e.jsx(E,{children:e.jsx(Ee,{onClick:re,className:s.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),ne().map((r,i)=>e.jsx(E,{children:r==="ellipsis-start"||r==="ellipsis-end"?e.jsx(Fe,{}):e.jsx(Ue,{onClick:()=>D(r),isActive:s.current_page===r,className:"cursor-pointer",children:r})},i)),e.jsx(E,{children:e.jsx(ze,{onClick:ae,className:s.current_page===s.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})},Me=({section:a,projectId:t,isExpanded:p,onToggle:c,onEdit:o,onDelete:u,isEditing:m,editingSection:j,onUpdateSection:n,onCancelEdit:g,openTaskDialog:l,isLoading:b})=>{const{tasks:x,deleteTask:f}=ue(a.id),{hasPermission:d}=_(),N=async s=>{d("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await f(s)};return m?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Section"}),e.jsx(Q,{section:j,onSubmit:n,onCancel:g,isLoading:b})]}):e.jsx("div",{className:"border border-border rounded-lg",children:e.jsxs(pe,{open:p,onOpenChange:c,children:[e.jsx(ge,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p?e.jsx(je,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(fe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("div",{className:"w-3 h-3 bg-chart-2 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{variant:"outline",className:"text-xs",children:[x.length," tasks"]}),(d("edit sections")||d("delete sections")||d("create tasks"))&&e.jsxs(O,{children:[e.jsx(W,{asChild:!0,onClick:s=>s.stopPropagation(),children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(V,{align:"end",className:"bg-popover border-border",children:[d("edit sections")&&e.jsxs(v,{onClick:s=>{s.stopPropagation(),o()},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Edit Section"]}),d("create tasks")&&e.jsxs(v,{onClick:s=>{s.stopPropagation(),s.preventDefault(),l(a,t)},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add Task"]}),d("delete sections")&&e.jsxs(v,{onClick:s=>{s.stopPropagation(),u()},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Delete Section"]})]})]})]})]})}),e.jsx(Ne,{children:e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{className:"p-4",children:x.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No tasks in this section yet"}),d("create tasks")&&e.jsxs(h,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:s=>{l(a,t),s.stopPropagation(),s.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add First Task"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-medium text-foreground",children:["Tasks (",x.length,")"]}),d("create tasks")&&e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:s=>{l(a,t),s.stopPropagation(),s.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Task"]})]}),x.map(s=>e.jsx(qe,{task:s,onEdit:y=>d("edit tasks")&&l(a,t,y),onDelete:N},s.id))]})})})})]})})},qe=({task:a,onEdit:t,onDelete:p})=>{const{hasPermission:c,hasAnyPermission:o}=_(),u=f=>{switch(f){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},m=f=>{switch(f){case"done":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"rated":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},j=new Date(a.due_date)<new Date&&a.status!=="done"&&a.status!=="rated",n=()=>{o(["create task ratings","edit task ratings"])&&window.open(`/ratings/tasks/${a.id}`,"_blank")},g=c("edit tasks"),l=c("delete tasks"),b=o(["create task ratings","edit task ratings"]),x=g||l||b;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${u(a.priority)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h6",{className:"font-medium text-foreground truncate",children:a.name}),e.jsx(X,{variant:"outline",className:`text-xs ${m(a.status)}`,children:a.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"Weight: ",a.weight]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),"Due: ",new Date(a.due_date).toLocaleDateString(),j&&e.jsx("span",{className:"text-red-500 font-medium",children:"(Overdue)"})]})]}),a.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:a.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:x?e.jsxs(O,{children:[e.jsx(W,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsxs(V,{align:"end",className:"bg-popover border-border",children:[g&&e.jsxs(v,{onClick:()=>t(a),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Edit Task"]}),b&&e.jsxs(v,{onClick:n,className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Rate Task"]}),l&&e.jsxs(v,{onClick:()=>p(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Delete Task"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]})},rs=()=>{const{id:a}=be(),{project:t,sections:p,isLoading:c,error:o}=Pe(a),{createSection:u,updateSection:m,deleteSection:j}=K(),{hasPermission:n,hasAnyPermission:g}=_(),{fetchProjectSections:l}=ve(),b=async N=>{if(!n("create sections"))return;await u(N)&&t&&await l(t.id)},x=async(N,s)=>{if(!n("edit sections"))return;await m(N,s)&&t&&await l(t.id)},f=async N=>{if(!n("delete sections"))return;await j(N)&&t&&await l(t.id)};if(c)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(o||!t)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:o||"Project not found"})});const d=g(["create stakeholder ratings","edit stakeholder ratings"]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(h,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(w,{to:"/projects",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Back to Projects"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{status:t.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.progress_percentage,"% complete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&t.stakeholder_will_rate&&e.jsx(h,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/ratings/projects/${t.id}/stakeholder`,children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Stakeholder Rating"]})}),n("view analytics")&&e.jsx(h,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/analytics/projects/${t.id}`,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Project Analytics"]})}),n("view projects")&&e.jsx(h,{variant:"outline",asChild:!0,children:e.jsxs(w,{to:`/projects/${t.id}/kanban`,children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Kanban View"]})}),n("edit projects")&&e.jsx(h,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(w,{to:`/projects/${t.id}/edit`,children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Edit Project"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(k,{className:"bg-card border-border",children:[e.jsx(H,{children:e.jsxs(I,{className:"text-foreground flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Project Information"]})}),e.jsxs(P,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground",children:t.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ce,{className:"w-8 h-8",children:e.jsx(Se,{className:"bg-primary text-primary-foreground text-sm",children:t.stakeholder?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.stakeholder?.name||"Unassigned"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.stakeholder?.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progress"}),e.jsx(ke,{value:t.progress_percentage,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progress_percentage,"% complete"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Will be rated"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:t.stakeholder_will_rate?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsxs("p",{className:"text-sm text-foreground flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),new Date(t.created_at).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:n("view sections")?e.jsx(Le,{sections:p??[],projectId:t.id,onCreateSection:b,onUpdateSection:x,onDeleteSection:f,isLoading:!1}):e.jsx(k,{className:"bg-card border-border",children:e.jsx(P,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view sections"})})})})]})]})};export{rs as default};
