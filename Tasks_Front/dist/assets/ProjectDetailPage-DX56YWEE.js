import{r as x,Q as ae,j as e,R as re,V as ne,W as P,X as oe,Y as ie,Z as le,_ as ce,a as de,b as me,o as xe,F as ue,c as R,d as A,e as F,f as $,I as he,g as O,$ as pe,B as j,L as ge,s as L,a0 as je,a1 as fe,a2 as Ne,a3 as be,D as B,q as I,v as z,w,S as q,n as M,y as ve,a4 as we,x as C,m as U,U as Ce,J as ye}from"./index-CLnmuTsT.js";import{C as W,a as K,b as V,d as G}from"./card-nZHOKDYn.js";import{A as Se,a as Pe}from"./avatar-CboOXJkY.js";import{P as ke}from"./progress-CEx_PbLP.js";import{u as De}from"./useProject-DSkFcQSR.js";import{P as Te,K as _e}from"./ProjectStatusBadge-BCPwEBmj.js";import{B as H}from"./badge-DIlLlDgn.js";import{L as Ee}from"./list-BS7BilbE.js";import{P as y}from"./plus-Cy7w6WzI.js";import{E as Y}from"./ellipsis-CHNkC-sQ.js";import{S as k}from"./square-pen-B-GkR3As.js";import{T as J}from"./trash-2-H8DkiDTx.js";import{C as Q}from"./calendar-CFXc9u-5.js";import{A as Re}from"./arrow-left-8pt3QYXv.js";import"./index-CajK7wam.js";var S="Collapsible",[Ae,ns]=re(S),[Fe,D]=Ae(S),X=x.forwardRef((s,t)=>{const{__scopeCollapsible:l,open:n,defaultOpen:a,disabled:c,onOpenChange:i,...m}=s,[u,h]=ae({prop:n,defaultProp:a??!1,onChange:i,caller:S});return e.jsx(Fe,{scope:l,disabled:c,contentId:ne(),open:u,onOpenToggle:x.useCallback(()=>h(p=>!p),[h]),children:e.jsx(P.div,{"data-state":_(u),"data-disabled":c?"":void 0,...m,ref:t})})});X.displayName=S;var Z="CollapsibleTrigger",ee=x.forwardRef((s,t)=>{const{__scopeCollapsible:l,...n}=s,a=D(Z,l);return e.jsx(P.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":_(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...n,ref:t,onClick:oe(s.onClick,a.onOpenToggle)})});ee.displayName=Z;var T="CollapsibleContent",se=x.forwardRef((s,t)=>{const{forceMount:l,...n}=s,a=D(T,s.__scopeCollapsible);return e.jsx(ie,{present:l||a.open,children:({present:c})=>e.jsx($e,{...n,ref:t,present:c})})});se.displayName=T;var $e=x.forwardRef((s,t)=>{const{__scopeCollapsible:l,present:n,children:a,...c}=s,i=D(T,l),[m,u]=x.useState(n),h=x.useRef(null),p=le(t,h),g=x.useRef(0),f=g.current,N=x.useRef(0),b=N.current,r=i.open||m,v=x.useRef(r),o=x.useRef(void 0);return x.useEffect(()=>{const d=requestAnimationFrame(()=>v.current=!1);return()=>cancelAnimationFrame(d)},[]),ce(()=>{const d=h.current;if(d){o.current=o.current||{transitionDuration:d.style.transitionDuration,animationName:d.style.animationName},d.style.transitionDuration="0s",d.style.animationName="none";const E=d.getBoundingClientRect();g.current=E.height,N.current=E.width,v.current||(d.style.transitionDuration=o.current.transitionDuration,d.style.animationName=o.current.animationName),u(n)}},[i.open,n]),e.jsx(P.div,{"data-state":_(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!r,...c,ref:p,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":b?`${b}px`:void 0,...s.style},children:r&&a})});function _(s){return s?"open":"closed"}var Oe=X;function Le({...s}){return e.jsx(Oe,{"data-slot":"collapsible",...s})}function Me({...s}){return e.jsx(ee,{"data-slot":"collapsible-trigger",...s})}function Ue({...s}){return e.jsx(se,{"data-slot":"collapsible-content",...s})}const Be=xe({name:L().min(1,"Section name is required").max(255),description:L().optional()}),te=({section:s,onSubmit:t,onCancel:l,isLoading:n})=>{const a=de({resolver:me(Be),defaultValues:{name:s?.name||"",description:s?.description||""}}),c=async i=>{await t(i)};return e.jsx(ue,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(c),className:"space-y-4",children:[e.jsx(R,{control:a.control,name:"name",render:({field:i})=>e.jsxs(A,{children:[e.jsx(F,{className:"text-foreground",children:"Section Name"}),e.jsx($,{children:e.jsx(he,{placeholder:"Enter section name",...i,disabled:n,className:"bg-background border-input text-foreground"})}),e.jsx(O,{className:"text-destructive"})]})}),e.jsx(R,{control:a.control,name:"description",render:({field:i})=>e.jsxs(A,{children:[e.jsx(F,{className:"text-foreground",children:"Description"}),e.jsx($,{children:e.jsx(pe,{placeholder:"Enter section description (optional)",...i,disabled:n,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(O,{className:"text-destructive"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{type:"submit",size:"sm",disabled:n,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[n&&e.jsx(ge,{className:"mr-2 h-3 w-3 animate-spin"}),s?"Update":"Create"]}),e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:l,disabled:n,children:"Cancel"})]})]})})},Ie=({sections:s,projectId:t,onCreateSection:l,onUpdateSection:n,onDeleteSection:a,isLoading:c})=>{const[i,m]=x.useState(!1),[u,h]=x.useState(null),[p,g]=x.useState(new Set),{openTaskDialog:f}=je(),N=async o=>{await l({...o,project_id:t}),m(!1)},b=async o=>{u&&(await n(u.id,o),h(null))},r=async o=>{window.confirm("Are you sure you want to delete this section?")&&await a(o)},v=o=>{const d=new Set(p);d.has(o)?d.delete(o):d.add(o),g(d)};return e.jsxs(W,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(V,{className:"text-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),"Sections & Tasks (",s.length,")"]}),e.jsxs(j,{type:"button",size:"sm",onClick:()=>m(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})}),e.jsxs(G,{className:"space-y-4",children:[i&&e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Section"}),e.jsx(te,{onSubmit:N,onCancel:()=>m(!1),isLoading:c})]}),c?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((o,d)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},d))}):s.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No sections yet. Create your first section to get started."}):s.map(o=>e.jsx(ze,{section:o,projectId:t,isExpanded:p.has(o.id),onToggle:()=>v(o.id),onEdit:()=>h(o),onDelete:()=>r(o.id),isEditing:u?.id===o.id,editingSection:u,onUpdateSection:b,onCancelEdit:()=>h(null),openTaskDialog:f,isLoading:c},o.id))]})]})},ze=({section:s,projectId:t,isExpanded:l,onToggle:n,onEdit:a,onDelete:c,isEditing:i,editingSection:m,onUpdateSection:u,onCancelEdit:h,openTaskDialog:p,isLoading:g})=>{const{tasks:f,deleteTask:N}=fe(s.id),b=async r=>{window.confirm("Are you sure you want to delete this task?")&&await N(r)};return i?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Section"}),e.jsx(te,{section:m,onSubmit:u,onCancel:h,isLoading:g})]}):e.jsx("div",{className:"border border-border rounded-lg",children:e.jsxs(Le,{open:l,onOpenChange:n,children:[e.jsx(Me,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l?e.jsx(Ne,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(be,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("div",{className:"w-3 h-3 bg-chart-2 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(H,{variant:"outline",className:"text-xs",children:[f.length," tasks"]}),e.jsxs(B,{children:[e.jsx(I,{asChild:!0,onClick:r=>r.stopPropagation(),children:e.jsx(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(z,{align:"end",className:"bg-popover border-border",children:[e.jsxs(w,{onClick:r=>{r.stopPropagation(),a()},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Edit Section"]}),e.jsxs(w,{onClick:r=>{r.stopPropagation(),r.preventDefault(),p(s,t)},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Add Task"]}),e.jsxs(w,{onClick:r=>{r.stopPropagation(),c()},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Delete Section"]})]})]})]})]})}),e.jsx(Ue,{children:e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{className:"p-4",children:f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No tasks in this section yet"}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:r=>(p(s,t),r.stopPropagation(),r.preventDefault()),children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add First Task"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-medium text-foreground",children:["Tasks (",f.length,")"]}),e.jsxs(j,{type:"button",variant:"outline",size:"sm",onClick:r=>(p(s,t),r.stopPropagation(),r.preventDefault()),children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"Add Task"]})]}),f.map(r=>e.jsx(qe,{task:r,onEdit:v=>p(s,t,v),onDelete:b},r.id))]})})})})]})})},qe=({task:s,onEdit:t,onDelete:l})=>{const n=m=>{switch(m){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},a=m=>{switch(m){case"done":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"rated":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},c=new Date(s.due_date)<new Date&&s.status!=="done"&&s.status!=="rated",i=()=>{window.open(`/ratings/tasks/${s.id}`,"_blank")};return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${n(s.priority)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h6",{className:"font-medium text-foreground truncate",children:s.name}),e.jsx(H,{variant:"outline",className:`text-xs ${a(s.status)}`,children:s.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"Weight: ",s.weight]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Due: ",new Date(s.due_date).toLocaleDateString(),c&&e.jsx("span",{className:"text-red-500 font-medium",children:"(Overdue)"})]})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(B,{children:[e.jsx(I,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(z,{align:"end",className:"bg-popover border-border",children:[e.jsxs(w,{onClick:()=>t(s),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Edit Task"]}),e.jsxs(w,{onClick:i,className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Rate Task"]}),e.jsxs(w,{onClick:()=>l(s.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(J,{className:"mr-2 h-4 w-4"}),"Delete Task"]})]})]})})]})},os=()=>{const{id:s}=ve(),{project:t,sections:l,isLoading:n,error:a}=De(s),{createSection:c,updateSection:i,deleteSection:m}=we(),u=async g=>{await c(g)},h=async(g,f)=>{await i(g,f)},p=async g=>{await m(g)};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]}):a||!t?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:a||"Project not found"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(C,{to:"/projects",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Back to Projects"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{status:t.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.progress_percentage,"% complete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.stakeholder_will_rate&&e.jsx(j,{asChild:!0,variant:"outline",children:e.jsxs(C,{to:`/ratings/projects/${t.id}/stakeholder`,children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Stakeholder Rating"]})}),e.jsx(j,{asChild:!0,variant:"outline",children:e.jsxs(C,{to:`/analytics/projects/${t.id}`,children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Project Analytics"]})}),e.jsx(j,{variant:"outline",asChild:!0,children:e.jsxs(C,{to:`/projects/${t.id}/kanban`,children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Kanban View"]})}),e.jsx(j,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(C,{to:`/projects/${t.id}/edit`,children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Edit Project"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(W,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs(V,{className:"text-foreground flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Project Information"]})}),e.jsxs(G,{className:"space-y-4",children:[t.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground",children:t.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Se,{className:"w-8 h-8",children:e.jsx(Pe,{className:"bg-primary text-primary-foreground text-sm",children:t.stakeholder?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.stakeholder?.name||"Unassigned"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.stakeholder?.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progress"}),e.jsx(ke,{value:t.progress_percentage,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.progress_percentage,"% complete"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Will be rated"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:t.stakeholder_will_rate?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsxs("p",{className:"text-sm text-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),new Date(t.created_at).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Ie,{sections:l??[],projectId:t.id,onCreateSection:u,onUpdateSection:h,onDeleteSection:p,isLoading:!1})})]})]})};export{os as default};
