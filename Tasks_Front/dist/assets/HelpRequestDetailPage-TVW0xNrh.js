import{R,a as H,b as F,o as B,j as e,au as O,av as L,B as l,aw as M,ax as T,ay as P,F as z,c as I,d as V,e as E,K as G,f as K,M as Q,N as X,O as $,P as J,g as W,L as Y,am as Z,y as ee,l as se,at as y,x as C,C as ae,S as re}from"./index-aIDF15FF.js";import{C as a,d as r,a as m,b as o}from"./card-DegwiSso.js";import{A as w,a as k}from"./avatar-Dx134Ua-.js";import{u as le}from"./useHelpRequest-BLmAvOIs.js";import{H as te,a as ie}from"./HelpRequestRatingBadge-D77yj2vd.js";import{B as ne}from"./badge-D7aLlcYV.js";import{C as ce,U as de,a as me}from"./user-x-C9Gp7lqb.js";import{A as oe,a as xe,b as he,c as pe,d as ue,e as je,f as ge,g as fe}from"./alert-dialog-ds1JXdri.js";import{A as q}from"./arrow-left-Bs_v8bmx.js";import{S as Ne}from"./square-pen-B8hD18R8.js";import{C as N}from"./calendar-71jRTDor.js";import"./index-CT1d_Ntm.js";import"./helpRequestsStore-ChHQjAuT.js";const be=B({rating:Z(["legitimate_learning","basic_skill_gap","careless_mistake","fixing_own_mistakes"])}),ve=({ratingOptions:u,onComplete:s,isLoading:i=!1,trigger:x})=>{const[h,d]=R.useState(!1),n=H({resolver:F(be)}),j=async c=>{await s(c),d(!1),n.reset()};return e.jsxs(O,{open:h,onOpenChange:d,children:[e.jsx(L,{asChild:!0,children:x||e.jsxs(l,{className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Complete Request"]})}),e.jsxs(M,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsx(P,{className:"text-foreground",children:"Complete Help Request"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please rate this help request to help improve our system and provide feedback to users."}),e.jsx(z,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(j),className:"space-y-6",children:[e.jsx(I,{control:n.control,name:"rating",render:({field:c})=>e.jsxs(V,{children:[e.jsx(E,{className:"text-foreground",children:"Rating Category"}),e.jsxs(G,{onValueChange:c.onChange,disabled:i,children:[e.jsx(K,{children:e.jsx(Q,{className:"bg-background border-input text-foreground",children:e.jsx(X,{placeholder:"Select rating category"})})}),e.jsx($,{children:u.map(t=>e.jsx(J,{value:t.value,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:t.label}),e.jsxs(ne,{variant:"outline",className:"ml-2 text-xs",children:[t.penalty,"x penalty"]})]})},t.value))})]}),e.jsx(W,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-2 p-4 bg-accent/20 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground",children:"Rating Guidelines:"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Legitimate Learning (0.1x):"})," Valid learning opportunity, minimal penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Basic Skill Gap (0.3x):"})," Missing fundamental skills, moderate penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Careless Mistake (0.6x):"})," Avoidable error, significant penalty"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fixing Own Mistakes (0.8x):"})," Fixing self-created issues, high penalty"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:i,children:"Cancel"}),e.jsxs(l,{type:"submit",disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Complete Request"]})]})]})})]})]})]})},Be=()=>{const{id:u}=ee(),{helpRequest:s,ratingOptions:i,isLoading:x,error:h,claimRequest:d,completeRequest:n,unclaimRequest:j}=le(u),{user:c}=se(),t=!!c&&!!s&&c.id===s.helper_id,g=!!s&&s.is_claimed&&!s.is_completed&&t,b=!!s&&s.is_claimed&&!s.is_completed&&t,v=!!s&&s.is_available,[S,p]=R.useState(!1),D=async()=>{v&&await d()},A=()=>{g&&p(!0)},U=async()=>{g&&(await j(),p(!1))},_=async f=>{b&&await n(f)};return x?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-64 mt-2"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(l,{variant:"outline",size:"sm",disabled:!0,children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx(a,{className:"bg-card border-border lg:col-span-2",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded w-40"}),e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded"}),e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded"})]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-12 bg-muted animate-pulse rounded"})})}),e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-12 bg-muted animate-pulse rounded"})})}),e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-6",children:e.jsx("div",{className:"h-24 bg-muted animate-pulse rounded"})})})]})]})]})}):h||!s?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsx("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:e.jsx(a,{className:"bg-card border-border",children:e.jsx(r,{className:"p-8 text-center",children:e.jsx("p",{className:"text-destructive",children:h||"Help request not found"})})})})}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground font-sans",children:["Help Request #",s.id]}),e.jsx(te,{helpRequest:s})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsxs(l,{variant:"outline",size:"sm",onClick:D,children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Claim"]}),g&&e.jsxs(l,{variant:"outline",size:"sm",onClick:A,children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),b&&e.jsx(ve,{ratingOptions:i,onComplete:_,isLoading:x}),e.jsx(l,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",size:"sm",children:e.jsxs(C,{to:`/help-requests/${s.id}/edit`,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Edit"]})}),e.jsx(l,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(C,{to:"/help-requests",className:"flex items-center",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Back to Help Requests"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Request Details"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground mt-1",children:s.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Related Task"}),e.jsxs("div",{className:"mt-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.task?.name||"Unknown Task"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Project: ",s.task?.section?.project?.name||"Unknown Project"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Section: ",s.task?.section?.name||"Unknown Section"]})]})]}),s.is_completed&&s.completed_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed At"}),e.jsxs("p",{className:"text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),new Date(s.completed_at).toLocaleString()]})]})]})]}),s.rating&&e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Request Rating"})}),e.jsx(r,{children:e.jsx(ie,{rating:s.rating,penaltyMultiplier:s.penalty_multiplier})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4"}),"Requester"]})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-10 h-10",children:e.jsx(k,{className:"bg-primary text-primary-foreground",children:s.requester?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.requester?.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.requester?.email})]})]})})]}),e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsxs(o,{className:"text-foreground flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Helper"]})}),e.jsx(r,{children:s.helper?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-10 h-10",children:e.jsx(k,{className:"bg-chart-2 text-white",children:s.helper.name?.charAt(0).toUpperCase()||"H"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.helper.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.helper.email})]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No helper assigned yet"})})]}),e.jsxs(a,{className:"bg-card border-border",children:[e.jsx(m,{children:e.jsx(o,{className:"text-foreground",children:"Timeline"})}),e.jsxs(r,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.created_at).toLocaleDateString()})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-muted-foreground",children:"Completed:"}),e.jsx("span",{className:"text-foreground",children:new Date(s.completed_at).toLocaleDateString()})]})]})]})]})]})]}),e.jsx(oe,{open:S,onOpenChange:f=>!f&&p(!1),children:e.jsxs(xe,{className:"sm:max-w-[480px]",children:[e.jsxs(he,{children:[e.jsx(pe,{children:"Unclaim help request"}),e.jsx(ue,{children:"Are you sure you want to unclaim this help request? It will become available for others to claim."})]}),e.jsxs(je,{children:[e.jsx(ge,{onClick:()=>p(!1),children:"Cancel"}),e.jsx(fe,{onClick:U,children:"Unclaim"})]})]})})]})};export{Be as default};
