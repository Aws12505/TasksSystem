import{a as X,b as Z,o as G,j as e,F as J,c as A,d as E,e as _,f as F,I as Q,g as U,R as ee,B as x,L as se,s as z,r as k,q as C,V as te,W as ae,X as re,Y as ne,Z as ie,_ as ce,D as B,v as L,w as M,x as v,$ as oe,S as q,n as R,z as de,a0 as le,a1 as me,y as w,m as $,U as xe,K as he}from"./index-CJetGwO1.js";import{C as P,a as K,b as O,d as D}from"./card-CM5R7BK3.js";import{A as ue,a as je}from"./avatar-3aaxr_vA.js";import{P as pe}from"./progress-Tpga9w1n.js";import{u as ge}from"./useProject-DuYbAfN3.js";import{P as fe,K as Ne}from"./ProjectStatusBadge-CIPXlRqW.js";import{B as W}from"./badge-B-I15EGM.js";import{L as be}from"./list-DDmqjVNN.js";import{P as S}from"./plus-BrZxr_o5.js";import{E as V}from"./ellipsis-DkHXBEp7.js";import{S as T}from"./square-pen-CzmLflYk.js";import{T as Y}from"./trash-2-DLQ2LF8Y.js";import{C as H}from"./calendar-Czyi2Tg8.js";import{A as ve}from"./arrow-left-WPG_CFC6.js";import"./index-DrKw1nON.js";const we=G({name:z().min(1,"Section name is required").max(255),description:z().optional()}),I=({section:t,onSubmit:s,onCancel:u,isLoading:i})=>{const c=X({resolver:Z(we),defaultValues:{name:t?.name||"",description:t?.description||""}}),h=async l=>{await s(l)};return e.jsx(J,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(h),className:"space-y-4",children:[e.jsx(A,{control:c.control,name:"name",render:({field:l})=>e.jsxs(E,{children:[e.jsx(_,{className:"text-foreground",children:"Section Name"}),e.jsx(F,{children:e.jsx(Q,{placeholder:"Enter section name",...l,disabled:i,className:"bg-background border-input text-foreground"})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsx(A,{control:c.control,name:"description",render:({field:l})=>e.jsxs(E,{children:[e.jsx(_,{className:"text-foreground",children:"Description"}),e.jsx(F,{children:e.jsx(ee,{placeholder:"Enter section description (optional)",...l,disabled:i,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(U,{className:"text-destructive"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{type:"submit",size:"sm",disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(se,{className:"mr-2 h-3 w-3 animate-spin"}),t?"Update":"Create"]}),e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:u,disabled:i,children:"Cancel"})]})]})})},ye=({sections:t,projectId:s,onCreateSection:u,onUpdateSection:i,onDeleteSection:c,isLoading:h})=>{const[l,p]=k.useState(!1),[n,j]=k.useState(null),[o,N]=k.useState(new Set),{hasPermission:m}=C(),{openTaskDialog:g}=te(),d=async r=>{await u({...r,project_id:s}),p(!1)},f=async r=>{n&&(await i(n.id,r),j(null))},a=async r=>{window.confirm("Are you sure you want to delete this section?")&&await c(r)},y=r=>{const b=new Set(o);b.has(r)?b.delete(r):b.add(r),N(b)};return e.jsxs(P,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"text-foreground flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5"}),"Sections & Tasks (",t.length,")"]}),m("create sections")&&e.jsxs(x,{type:"button",size:"sm",onClick:()=>p(!0),className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Section"]})]})}),e.jsxs(D,{className:"space-y-4",children:[l&&m("create sections")&&e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Create New Section"}),e.jsx(I,{onSubmit:d,onCancel:()=>p(!1),isLoading:h})]}),h?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((r,b)=>e.jsx("div",{className:"h-20 bg-muted animate-pulse rounded-lg"},b))}):t.length===0?e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:["No sections yet. ",m("create sections")?"Create your first section to get started.":"No sections available."]}):t.map(r=>e.jsx(Se,{section:r,projectId:s,isExpanded:o.has(r.id),onToggle:()=>y(r.id),onEdit:()=>j(r),onDelete:()=>a(r.id),isEditing:n?.id===r.id,editingSection:n,onUpdateSection:f,onCancelEdit:()=>j(null),openTaskDialog:g,isLoading:h},r.id))]})]})},Se=({section:t,projectId:s,isExpanded:u,onToggle:i,onEdit:c,onDelete:h,isEditing:l,editingSection:p,onUpdateSection:n,onCancelEdit:j,openTaskDialog:o,isLoading:N})=>{const{tasks:m,deleteTask:g}=ae(t.id),{hasPermission:d}=C(),f=async a=>{d("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await g(a)};return l?e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-accent/20",children:[e.jsx("h4",{className:"text-sm font-medium text-foreground mb-3",children:"Edit Section"}),e.jsx(I,{section:p,onSubmit:n,onCancel:j,isLoading:N})]}):e.jsx("div",{className:"border border-border rounded-lg",children:e.jsxs(re,{open:u,onOpenChange:i,children:[e.jsx(ne,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-accent/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u?e.jsx(ie,{className:"w-4 h-4 text-muted-foreground"}):e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("div",{className:"w-3 h-3 bg-chart-2 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-foreground",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(W,{variant:"outline",className:"text-xs",children:[m.length," tasks"]}),(d("edit sections")||d("delete sections")||d("create tasks"))&&e.jsxs(B,{children:[e.jsx(L,{asChild:!0,onClick:a=>a.stopPropagation(),children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(M,{align:"end",className:"bg-popover border-border",children:[d("edit sections")&&e.jsxs(v,{onClick:a=>{a.stopPropagation(),c()},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Section"]}),d("create tasks")&&e.jsxs(v,{onClick:a=>{a.stopPropagation(),a.preventDefault(),o(t,s)},className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Add Task"]}),d("delete sections")&&e.jsxs(v,{onClick:a=>{a.stopPropagation(),h()},className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Delete Section"]})]})]})]})]})}),e.jsx(oe,{children:e.jsx("div",{className:"border-t border-border",children:e.jsx("div",{className:"p-4",children:m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(q,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No tasks in this section yet"}),d("create tasks")&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:a=>{o(t,s),a.stopPropagation(),a.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add First Task"]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h5",{className:"text-sm font-medium text-foreground",children:["Tasks (",m.length,")"]}),d("create tasks")&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:a=>{o(t,s),a.stopPropagation(),a.preventDefault()},children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),"Add Task"]})]}),m.map(a=>e.jsx(Ce,{task:a,onEdit:y=>d("edit tasks")&&o(t,s,y),onDelete:f},a.id))]})})})})]})})},Ce=({task:t,onEdit:s,onDelete:u})=>{const{hasPermission:i,hasAnyPermission:c}=C(),h=g=>{switch(g){case"critical":return"bg-red-500";case"high":return"bg-orange-500";case"medium":return"bg-yellow-500";case"low":return"bg-green-500";default:return"bg-gray-500"}},l=g=>{switch(g){case"done":return"text-green-600 bg-green-100";case"in_progress":return"text-blue-600 bg-blue-100";case"rated":return"text-purple-600 bg-purple-100";default:return"text-gray-600 bg-gray-100"}},p=new Date(t.due_date)<new Date&&t.status!=="done"&&t.status!=="rated",n=()=>{c(["create task ratings","edit task ratings"])&&window.open(`/ratings/tasks/${t.id}`,"_blank")},j=i("edit tasks"),o=i("delete tasks"),N=c(["create task ratings","edit task ratings"]),m=j||o||N;return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${h(t.priority)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h6",{className:"font-medium text-foreground truncate",children:t.name}),e.jsx(W,{variant:"outline",className:`text-xs ${l(t.status)}`,children:t.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"Weight: ",t.weight]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),"Due: ",new Date(t.due_date).toLocaleDateString(),p&&e.jsx("span",{className:"text-red-500 font-medium",children:"(Overdue)"})]})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 truncate",children:t.description})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:m?e.jsxs(B,{children:[e.jsx(L,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",type:"button",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs(M,{align:"end",className:"bg-popover border-border",children:[j&&e.jsxs(v,{onClick:()=>s(t),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Task"]}),N&&e.jsxs(v,{onClick:n,className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Rate Task"]}),o&&e.jsxs(v,{onClick:()=>u(t.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Delete Task"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]})},qe=()=>{const{id:t}=de(),{project:s,sections:u,isLoading:i,error:c}=ge(t),{createSection:h,updateSection:l,deleteSection:p}=le(),{hasPermission:n,hasAnyPermission:j}=C(),{fetchProjectSections:o}=me(),N=async f=>{if(!n("create sections"))return;await h(f)&&s&&await o(s.id)},m=async(f,a)=>{if(!n("edit sections"))return;await l(f,a)&&s&&await o(s.id)},g=async f=>{if(!n("delete sections"))return;await p(f)&&s&&await o(s.id)};if(i)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"}),e.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"})]})]});if(c||!s)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:c||"Project not found"})});const d=j(["create stakeholder ratings","edit stakeholder ratings"]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(w,{to:"/projects",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Back to Projects"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{status:s.status}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.progress_percentage,"% complete"]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[d&&s.stakeholder_will_rate&&e.jsx(x,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/ratings/projects/${s.id}/stakeholder`,children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Stakeholder Rating"]})}),n("view analytics")&&e.jsx(x,{asChild:!0,variant:"outline",children:e.jsxs(w,{to:`/analytics/projects/${s.id}`,children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Project Analytics"]})}),n("view projects")&&e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs(w,{to:`/projects/${s.id}/kanban`,children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Kanban View"]})}),n("edit projects")&&e.jsx(x,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(w,{to:`/projects/${s.id}/edit`,children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Edit Project"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 space-y-6",children:e.jsxs(P,{className:"bg-card border-border",children:[e.jsx(K,{children:e.jsxs(O,{className:"text-foreground flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Project Information"]})}),e.jsxs(D,{className:"space-y-4",children:[s.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-foreground",children:s.description})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ue,{className:"w-8 h-8",children:e.jsx(je,{className:"bg-primary text-primary-foreground text-sm",children:s.stakeholder?.name?.charAt(0).toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.stakeholder?.name||"Unassigned"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.stakeholder?.email})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Progress"}),e.jsx(pe,{value:s.progress_percentage,className:"mt-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.progress_percentage,"% complete"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Will be rated"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(q,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-foreground",children:s.stakeholder_will_rate?"Yes":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Created"}),e.jsxs("p",{className:"text-sm text-foreground flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),new Date(s.created_at).toLocaleDateString()]})]})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:n("view sections")?e.jsx(ye,{sections:u??[],projectId:s.id,onCreateSection:N,onUpdateSection:m,onDeleteSection:g,isLoading:!1}):e.jsx(P,{className:"bg-card border-border",children:e.jsx(D,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"You don't have permission to view sections"})})})})]})]})};export{qe as default};
