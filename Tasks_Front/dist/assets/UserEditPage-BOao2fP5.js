import{r as j,j as e,B as v,L as U,p as T,I as $,z as A,C as B,y as E,E as z,A as J}from"./index--vQxBrGw.js";import{C as b,a as y,b as S,d as C}from"./card-C8XzxF3O.js";import{T as O,a as F,b as g,c as N}from"./tabs-CF6I8q9p.js";import{u as I}from"./useUser-DBzsfm0y.js";import{u as K}from"./useUsers-Dr3VUwsi.js";import{U as Q}from"./UserForm-geAL8zFg.js";import{C as P}from"./checkbox-C7JMlxqm.js";import{B as k}from"./badge-BJLzQqS4.js";import{S as L}from"./save-BwgFgsFc.js";import{A as _}from"./arrow-left-B8spmGt3.js";import{K as D}from"./key-RXoh6O7B.js";import"./usersStore-DKEDjka_.js";import"./permissionService-CtVe6See.js";import"./filtersStore-CLkdRUnQ.js";const H=({userRoles:l,availableRoles:o,onSave:x,isLoading:r=!1})=>{const[t,h]=j.useState(l.map(a=>a.name)),[i,c]=j.useState(!1),d=(a,n)=>{h(m=>n?[...m,a]:m.filter(s=>s!==a))},u=async()=>{c(!0),await x(t),c(!1)},f=JSON.stringify(t.sort())!==JSON.stringify(l.map(a=>a.name).sort());return e.jsxs(b,{className:"bg-card border-border",children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:"text-foreground",children:"Roles"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[t.length," selected"]}),f&&e.jsxs(v,{size:"sm",onClick:u,disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(U,{className:"mr-2 h-3 w-3 animate-spin"}),e.jsx(L,{className:"mr-1 h-3 w-3"}),"Save"]})]})]})}),e.jsx(C,{children:r?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((a,n)=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},n))}):e.jsxs("div",{className:"space-y-3",children:[o.map(a=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{id:`role-${a.id}`,checked:t.includes(a.name),onCheckedChange:n=>d(a.name,n),disabled:i}),e.jsx("label",{htmlFor:`role-${a.id}`,className:"text-sm text-foreground cursor-pointer flex-1",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.permissions.length," permissions"]})]})})]},a.id)),o.length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:"No roles available"})]})})]})},V=({userPermissions:l,availablePermissions:o,onSave:x,isLoading:r=!1})=>{const[t,h]=j.useState(l.map(s=>s.name)),[i,c]=j.useState(!1),[d,u]=j.useState(""),f=(s,p)=>{h(w=>p?[...w,s]:w.filter(R=>R!==s))},a=async()=>{c(!0),await x(t),c(!1)},n=o.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())),m=JSON.stringify(t.sort())!==JSON.stringify(l.map(s=>s.name).sort());return e.jsxs(b,{className:"bg-card border-border",children:[e.jsxs(y,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{className:"text-foreground",children:"Direct Permissions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[t.length," selected"]}),m&&e.jsxs(v,{size:"sm",onClick:a,disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(U,{className:"mr-2 h-3 w-3 animate-spin"}),e.jsx(L,{className:"mr-1 h-3 w-3"}),"Save"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx($,{placeholder:"Search permissions...",value:d,onChange:s=>u(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]})]}),e.jsx(C,{children:r?e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((s,p)=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},p))}):e.jsxs("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[n.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{id:`permission-${s.id}`,checked:t.includes(s.name),onCheckedChange:p=>f(s.name,p),disabled:i}),e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-sm text-foreground cursor-pointer flex-1",children:s.name})]},s.id)),n.length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:d?"No permissions found matching your search":"No permissions available"})]})})]})},le=()=>{const{id:l}=A(),o=B(),{updateUser:x}=K(),{user:r,availableRoles:t,availablePermissions:h,isLoading:i,error:c,syncUserRoles:d,syncUserPermissions:u}=I(l),f=async m=>{if(!r)return;await x(r.id,m)&&o(`/users/${r.id}`)};if(i)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsx("div",{className:"h-96 bg-muted animate-pulse rounded-lg"})]});if(c||!r)return e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:c||"User not found"})});const a=r.roles||[],n=r.permissions||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(v,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(E,{to:`/users/${l}`,children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Back to User"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:"Edit User"}),e.jsxs("p",{className:"text-muted-foreground",children:["Update ",r.name,"'s profile and permissions"]})]})]})}),e.jsxs(O,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(F,{className:"bg-muted",children:[e.jsxs(g,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Profile"]}),e.jsxs(g,{value:"roles",className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Roles"]}),e.jsxs(g,{value:"permissions",className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4"}),"Permissions"]})]}),e.jsx(N,{value:"profile",children:e.jsxs(b,{className:"bg-card border-border",children:[e.jsx(y,{children:e.jsx(S,{className:"text-foreground",children:"User Profile"})}),e.jsx(C,{children:e.jsx(Q,{user:r,onSubmit:f,isLoading:!1})})]})}),e.jsx(N,{value:"roles",children:e.jsx(H,{userRoles:a,availableRoles:t,onSave:d,isLoading:i})}),e.jsx(N,{value:"permissions",children:e.jsx(V,{userPermissions:n,availablePermissions:h,onSave:u,isLoading:i})})]})]})};export{le as default};
