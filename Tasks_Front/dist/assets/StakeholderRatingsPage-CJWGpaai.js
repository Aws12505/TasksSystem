import{r as R,a as y,b as _,o as P,j as e,C as j,c as k,d as C,U as v,f,aX as w,I as S,B as b,L as I,b6 as D,ar as F,s as L,y as A,x as E}from"./index-CH0ELVhY.js";import{P as M,a as T,b as N,c as B,d as U,e as V,f as $}from"./pagination-DQgsaQqy.js";import{u as z}from"./ratingsStore-Dm_jS_Nb.js";import{F as H,b as O,c as X,d as q,e as G}from"./form-Cc8xCwqu.js";import{S as J,R as K}from"./RatingDisplay-aNKiyZy4.js";import{A as Q}from"./arrow-left-DrNK6yNg.js";import"./ellipsis-CcZBrH0l.js";import"./ratingConfigService-DnG5SoOH.js";import"./label-DI3SyrnA.js";import"./badge-ClFdoHwc.js";import"./progress-B6SqFd2z.js";import"./user-B23fmvdu.js";import"./calendar-JMIRorKA.js";const W=c=>{const{stakeholderRatings:o,stakeholderRatingConfigs:h,stakeholderRatingsPagination:a,isLoading:l,error:u,fetchStakeholderRatings:i,fetchStakeholderRatingConfigs:g,createStakeholderRating:p,updateStakeholderRating:m}=z(),n=typeof c=="string"?parseInt(c):c;R.useEffect(()=>{n&&!o.length&&(i(n,1),g())},[n,i,g,o.length]);const x=r=>{i(n,r)};return{stakeholderRatings:o,stakeholderRatingConfigs:h,pagination:a,isLoading:l,error:u,createRating:r=>p({...r,project_id:n}),updateRating:(r,d)=>m(r,d),refreshRatings:()=>i(n),goToPage:x,nextPage:()=>{a&&a.current_page<a.last_page&&x(a.current_page+1)},prevPage:()=>{a&&a.current_page>1&&x(a.current_page-1)}}},Y=P({rating_data:D(L(),F().min(0).max(100))}),Z=({projectId:c,config:o,onSubmit:h,isLoading:a})=>{const l=o.config_data,u=l.fields.reduce((s,t)=>(s[t.name]=0,s),{}),i=y({resolver:_(Y),defaultValues:{rating_data:u}}),g=async s=>{const t={project_id:c,rating_data:s.rating_data};await h(t)},p=i.watch("rating_data"),m=Object.values(p||{}).reduce((s,t)=>s+(t||0),0),n=l.fields.reduce((s,t)=>s+t.max_value,0),x=n>0?Math.round(m/n*100):0;return e.jsxs(j,{className:"bg-card border-border",children:[e.jsx(k,{children:e.jsxs(C,{className:"text-foreground flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5"}),"Stakeholder Rating - ",o.name]})}),e.jsx(f,{children:e.jsx(H,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(g),className:"space-y-6",children:[e.jsx("div",{className:"space-y-6",children:l.fields.map(s=>e.jsx("div",{children:e.jsx(w,{name:`rating_data.${s.name}`,control:i.control,render:({field:t,fieldState:r})=>e.jsxs(O,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(X,{className:"text-foreground",children:s.name}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.value||0," / ",s.max_value]})]}),e.jsx(q,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(J,{value:[t.value||0],onValueChange:d=>t.onChange(d[0]),max:s.max_value,step:1,className:"flex-1",disabled:a}),e.jsx(S,{type:"number",min:0,max:s.max_value,value:t.value||0,onChange:d=>t.onChange(Number(d.target.value)),disabled:a,className:"w-24 text-center"})]})}),r.error&&e.jsx(G,{className:"text-destructive",children:r.error.message})]})})},s.name))}),e.jsx("div",{className:"p-4 bg-accent/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Total Rating"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[x,"%"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m," / ",n]})]})]})}),e.jsxs(b,{type:"submit",disabled:a,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:[a&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Rating"]})]})})})]})},ge=()=>{const{projectId:c}=A(),{stakeholderRatings:o,stakeholderRatingConfigs:h,pagination:a,isLoading:l,createRating:u,goToPage:i,nextPage:g,prevPage:p}=W(c),m=h.find(s=>s.is_active),n=async s=>{await u(s)},x=()=>{if(!a)return[];const s=[],{current_page:t,last_page:r}=a;t>3&&(s.push(1),t>4&&s.push("ellipsis-start"));for(let d=Math.max(1,t-2);d<=Math.min(r,t+2);d++)s.push(d);return t<r-2&&(t<r-3&&s.push("ellipsis-end"),s.push(r)),s};return c?e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(v,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Stakeholder Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Project evaluation from stakeholder perspective"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(E,{to:`/projects/${c}`,className:"flex items-center",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Back to Project"]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:l?e.jsx("div",{className:"h-72 bg-muted animate-pulse rounded-lg"}):m?e.jsx(Z,{projectId:parseInt(c),config:m,onSubmit:n,isLoading:l}):e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No active stakeholder rating configuration found"})})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Previous Ratings"}),l?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,t)=>e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},t))}):o.length===0?e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No ratings yet for this project"})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsx(K,{rating:s},s.id))}),a&&a.last_page>1&&e.jsx(j,{className:"bg-card border-border",children:e.jsx(f,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",a.from||0," to ",a.to||0," of ",a.total," results"]}),e.jsx(M,{children:e.jsxs(T,{children:[e.jsx(N,{children:e.jsx(B,{onClick:p,className:a.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),x().map((s,t)=>e.jsx(N,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(U,{}):e.jsx(V,{onClick:()=>i(s),isActive:a.current_page===s,className:"cursor-pointer",children:s})},t)),e.jsx(N,{children:e.jsx($,{onClick:g,className:a.current_page===a.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]})]})}):e.jsx("div",{children:"Project not found"})};export{ge as default};
