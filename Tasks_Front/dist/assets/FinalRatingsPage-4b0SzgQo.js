<<<<<<<< HEAD:Tasks_Front/dist/assets/FinalRatingsPage-DgzUWZxy.js
import{g as xe,v as w,w as pe,x as f,R as m,j as e,C as S,c as L,d as T,e as H,f as q,au as G,I as N,K as fe,M as je,N as _e,O as ve,P as be,B as C,L as E,aU as X,b4 as Ne,aW as ke,aO as Z,aY as ye,ba as Ce,bb as we,a8 as K,aE as O,aG as I,aH as ee,aI as se,bk as ae,a2 as te,a7 as re,az as ie,bl as ne,a3 as U,F as $,E as Fe,G as Se,H as qe,J as Re,bm as De,af as Le}from"./index-zkLMKkdk.js";import{T as z,a as B,b as k,c as y}from"./tabs-BNkuV998.js";import{L as u}from"./label-Dk_wDnPY.js";import{C as V}from"./calculator-BAfHCbDI.js";import{B as R}from"./badge-9bYBpW9L.js";import{A as Te,a as Ee,b as Pe,c as Ae,d as Me,e as He,f as Oe,g as Ie}from"./alert-dialog-CwsIcwU8.js";import{S as M}from"./settings-DL2PHG5m.js";import{C as Q}from"./circle-check-big-XuKkQI1M.js";import{S as Ue}from"./square-pen-Cz5vqZmR.js";import{T as ze}from"./trash-2-q71w8ZL_.js";import{P as Be}from"./progress-CdjWIBkH.js";import{T as Y}from"./trending-up-CAGVaZC4.js";const Je=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],le=xe("file-text",Je);class We{async calculateRatings(s){return w.post("/final-ratings/calculate",s)}async exportPdf(s){return w.downloadFile("/final-ratings/export-pdf",s)}async getConfigs(){return w.get("/final-ratings/configs")}async getConfig(s){return w.get(`/final-ratings/configs/${s}`)}async getActiveConfig(){return w.get("/final-ratings/configs/active")}async getDefaultStructure(){return w.get("/final-ratings/configs/default-structure")}async createConfig(s){return w.post("/final-ratings/configs",s)}async updateConfig(s,a){return w.put(`/final-ratings/configs/${s}`,a)}async deleteConfig(s){return w.delete(`/final-ratings/configs/${s}`)}async activateConfig(s){return w.post(`/final-ratings/configs/${s}/activate`)}}const F=new We,ce=pe(r=>({configs:[],activeConfig:null,currentConfig:null,defaultStructure:null,calculationResult:null,isLoading:!1,isExporting:!1,error:null,fetchConfigs:async()=>{r({isLoading:!0,error:null});try{const s=await F.getConfigs();s.success&&s.data?r({configs:s.data,isLoading:!1}):(r({error:s.message||"Failed to fetch configs",isLoading:!1}),f.error(s.message||"Failed to fetch configs"))}catch(s){const a=s.message||"Failed to fetch configs";r({error:a,isLoading:!1}),f.error(a)}},fetchConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.getConfig(s);a.success&&a.data?r({currentConfig:a.data,isLoading:!1}):(r({error:a.message||"Failed to fetch config",isLoading:!1}),f.error(a.message||"Failed to fetch config"))}catch(a){const n=a.message||"Failed to fetch config";r({error:n,isLoading:!1}),f.error(n)}},fetchActiveConfig:async()=>{r({isLoading:!0,error:null});try{const s=await F.getActiveConfig();s.success&&s.data?r({activeConfig:s.data,isLoading:!1}):r({error:s.message||"No active config found",isLoading:!1})}catch(s){const a=s.message||"Failed to fetch active config";r({error:a,isLoading:!1})}},fetchDefaultStructure:async()=>{try{const s=await F.getDefaultStructure();s.success&&s.data&&r({defaultStructure:s.data})}catch(s){f.error(s.message||"Failed to fetch default structure")}},createConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.createConfig(s);return a.success&&a.data?(r(n=>({configs:[a.data,...n.configs],isLoading:!1})),f.success("Configuration created successfully"),a.data):(r({error:a.message||"Failed to create config",isLoading:!1}),f.error(a.message||"Failed to create config"),null)}catch(a){const n=a.message||"Failed to create config";return r({error:n,isLoading:!1}),f.error(n),null}},updateConfig:async(s,a)=>{r({isLoading:!0,error:null});try{const n=await F.updateConfig(s,a);return n.success&&n.data?(r(d=>({configs:d.configs.map(o=>o.id===s?n.data:o),currentConfig:d.currentConfig?.id===s?n.data:d.currentConfig,isLoading:!1})),f.success("Configuration updated successfully"),n.data):(r({error:n.message||"Failed to update config",isLoading:!1}),f.error(n.message||"Failed to update config"),null)}catch(n){const d=n.message||"Failed to update config";return r({error:d,isLoading:!1}),f.error(d),null}},deleteConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.deleteConfig(s);return a.success?(r(n=>({configs:n.configs.filter(d=>d.id!==s),currentConfig:n.currentConfig?.id===s?null:n.currentConfig,isLoading:!1})),f.success("Configuration deleted successfully"),!0):(r({error:a.message||"Failed to delete config",isLoading:!1}),f.error(a.message||"Failed to delete config"),!1)}catch(a){const n=a.message||"Failed to delete config";return r({error:n,isLoading:!1}),f.error(n),!1}},activateConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.activateConfig(s);return a.success&&a.data?(r(n=>({configs:n.configs.map(d=>({...d,is_active:d.id===s})),activeConfig:a.data,isLoading:!1})),f.success("Configuration activated successfully"),!0):(r({error:a.message||"Failed to activate config",isLoading:!1}),f.error(a.message||"Failed to activate config"),!1)}catch(a){const n=a.message||"Failed to activate config";return r({error:n,isLoading:!1}),f.error(n),!1}},calculateRatings:async s=>{r({isLoading:!0,error:null});try{const a=await F.calculateRatings(s);return a.success&&a.data?(r({calculationResult:a.data,isLoading:!1}),f.success("Ratings calculated successfully"),a.data):(r({error:a.message||"Failed to calculate ratings",isLoading:!1}),f.error(a.message||"Failed to calculate ratings"),null)}catch(a){const n=a.message||"Failed to calculate ratings";return r({error:n,isLoading:!1}),f.error(n),null}},exportPdf:async s=>{r({isExporting:!0,error:null});try{const{blob:a,filename:n}=await F.exportPdf(s),d=window.URL.createObjectURL(a),o=document.createElement("a");o.href=d,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(d),r({isExporting:!1}),f.success("PDF package exported successfully")}catch(a){const n=a.message||"Failed to export PDF";r({error:n,isExporting:!1}),f.error(n)}},clearCalculationResult:()=>r({calculationResult:null,error:null}),clearCurrentConfig:()=>r({currentConfig:null,error:null})})),P=()=>{const{configs:r,activeConfig:s,currentConfig:a,defaultStructure:n,calculationResult:d,isLoading:o,isExporting:g,error:x,fetchConfigs:i,fetchActiveConfig:l,fetchDefaultStructure:p,createConfig:c,updateConfig:t,deleteConfig:_,activateConfig:v,calculateRatings:b,exportPdf:h,clearCalculationResult:D,clearCurrentConfig:W}=ce();return m.useEffect(()=>{r.length===0&&i(),s||l()},[]),{configs:r,activeConfig:s,currentConfig:a,defaultStructure:n,calculationResult:d,isLoading:o,isExporting:g,error:x,fetchConfigs:i,fetchActiveConfig:l,fetchDefaultStructure:p,createConfig:c,updateConfig:t,deleteConfig:_,activateConfig:v,calculateRatings:b,exportPdf:h,clearCalculationResult:D,clearCurrentConfig:W}},$e=()=>{const{configs:r,activeConfig:s,isLoading:a,calculateRatings:n,fetchActiveConfig:d}=P(),[o,g]=m.useState({period_start:"",period_end:"",max_points:"",config_id:""});m.useEffect(()=>{s||d()},[s,d]),m.useEffect(()=>{s&&!o.config_id&&g(l=>({...l,config_id:s.id.toString()}))},[s,o.config_id]);const x=async l=>{if(l.preventDefault(),!o.period_start||!o.period_end||!o.max_points)return;if(await n({period_start:o.period_start,period_end:o.period_end,max_points:parseFloat(o.max_points),config_id:o.config_id?parseInt(o.config_id):void 0})){const c=document.querySelector('[value="results"]');c&&c.click()}},i=(l,p)=>{g(c=>({...c,[l]:p}))};return e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Calculate Final Ratings"]}),e.jsx(H,{children:"Select a period and specify the maximum points for 100% rating"})]}),e.jsx(q,{children:e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"period_start",children:"Period Start"}),e.jsx(G,{id:"period_start",name:"period_start",value:o.period_start,onChange:l=>i("period_start",l),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"period_end",children:"Period End"}),e.jsx(G,{id:"period_end",name:"period_end",value:o.period_end,onChange:l=>i("period_end",l),required:!0,min:o.period_start})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"max_points",children:["Maximum Points for 100%",e.jsx("span",{className:"text-muted-foreground text-sm ml-2",children:"(How many points equals 100% rating?)"})]}),e.jsx(N,{id:"max_points",type:"number",step:"0.01",min:"1",value:o.max_points,onChange:l=>i("max_points",l.target.value),placeholder:"e.g., 200",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"config_id",children:["Rating Configuration",e.jsx("span",{className:"text-muted-foreground text-sm ml-2",children:"(Leave as active to use current default)"})]}),e.jsxs(fe,{value:o.config_id,onValueChange:l=>i("config_id",l),children:[e.jsx(je,{children:e.jsx(_e,{placeholder:"Select configuration"})}),e.jsx(ve,{children:r.map(l=>e.jsxs(be,{value:l.id.toString(),children:[l.name," ",l.is_active&&"(Active)"]},l.id))})]})]}),e.jsxs("div",{className:"bg-muted/50 border border-border rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"How it works:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"All employees with tasks in the selected period will be calculated"}),e.jsx("li",{children:"Each employee's percentage = (their total points / max points) × 100"}),e.jsx("li",{children:"Maximum percentage is capped at 100%"}),e.jsx("li",{children:"Results show full breakdown of how points were calculated"})]})]}),e.jsx(C,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Calculate Ratings"]})})]})})]})};var J="Switch",[Ve,fs]=ke(J),[Ye,Ge]=Ve(J),de=m.forwardRef((r,s)=>{const{__scopeSwitch:a,name:n,checked:d,defaultChecked:o,required:g,disabled:x,value:i="on",onCheckedChange:l,form:p,...c}=r,[t,_]=m.useState(null),v=X(s,A=>_(A)),b=m.useRef(!1),h=t?p||!!t.closest("form"):!0,[D,W]=Ne({prop:d,defaultProp:o??!1,onChange:l,caller:J});return e.jsxs(Ye,{scope:a,checked:D,disabled:x,children:[e.jsx(Z.button,{type:"button",role:"switch","aria-checked":D,"aria-required":g,"data-state":ge(D),"data-disabled":x?"":void 0,disabled:x,value:i,...c,ref:v,onClick:ye(r.onClick,A=>{W(me=>!me),h&&(b.current=A.isPropagationStopped(),b.current||A.stopPropagation())})}),h&&e.jsx(he,{control:t,bubbles:!b.current,name:n,value:i,checked:D,required:g,disabled:x,form:p,style:{transform:"translateX(-100%)"}})]})});de.displayName=J;var oe="SwitchThumb",ue=m.forwardRef((r,s)=>{const{__scopeSwitch:a,...n}=r,d=Ge(oe,a);return e.jsx(Z.span,{"data-state":ge(d.checked),"data-disabled":d.disabled?"":void 0,...n,ref:s})});ue.displayName=oe;var Ke="SwitchBubbleInput",he=m.forwardRef(({__scopeSwitch:r,control:s,checked:a,bubbles:n=!0,...d},o)=>{const g=m.useRef(null),x=X(g,o),i=Ce(a),l=we(s);return m.useEffect(()=>{const p=g.current;if(!p)return;const c=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(c,"checked").set;if(i!==a&&_){const v=new Event("click",{bubbles:n});_.call(p,a),p.dispatchEvent(v)}},[i,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...d,tabIndex:-1,ref:x,style:{...d.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});he.displayName=Ke;function ge(r){return r?"checked":"unchecked"}var Qe=de,Xe=ue;function j({className:r,...s}){return e.jsx(Qe,{"data-slot":"switch",className:K("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(Xe,{"data-slot":"switch-thumb",className:K("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Ze=r=>{const{currentConfig:s,isLoading:a,error:n,fetchConfig:d,updateConfig:o,clearCurrentConfig:g}=ce();return m.useEffect(()=>(r&&d(r),()=>{g()}),[r,d,g]),{config:s,isLoading:a,error:n,updateConfig:o}},es=({open:r,onOpenChange:s,configId:a})=>{const{config:n,isLoading:d,updateConfig:o}=Ze(a),[g,x]=m.useState({name:"",description:""}),[i,l]=m.useState(null);m.useEffect(()=>{n&&(x({name:n.name,description:n.description||""}),l(JSON.parse(JSON.stringify(n.config))))},[n]);const p=async t=>{if(t.preventDefault(),!i)return;await o(a,{...g,config:i})&&s(!1)},c=(t,_)=>{if(!i)return;const v=JSON.parse(JSON.stringify(i));let b=v;for(let h=0;h<t.length-1;h++)b=b[t[h]];b[t[t.length-1]]=_,l(v)};return d||!i?e.jsx(O,{open:r,onOpenChange:s,children:e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"w-8 h-8 animate-spin"})})})}):e.jsx(O,{open:r,onOpenChange:s,children:e.jsxs(I,{className:"w-[95vw] max-w-3xl max-h-[90vh] p-0 overflow-hidden",children:[e.jsx("div",{className:"border-b px-6 py-5",children:e.jsxs(ee,{children:[e.jsx(se,{children:"Edit Configuration"}),e.jsx(ae,{children:"Update the rating calculation configuration"})]})}),e.jsxs(te,{className:"max-h-[calc(90vh-160px)]",children:[e.jsxs("form",{onSubmit:p,className:"space-y-6 px-6 py-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Configuration Name *"}),e.jsx(N,{id:"name",value:g.name,onChange:t=>x({...g,name:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(re,{id:"description",value:g.description,onChange:t=>x({...g,description:t.target.value}),rows:2})]})]}),e.jsx(ie,{}),e.jsxs(z,{defaultValue:"task_ratings",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"task_ratings",children:"Tasks"}),e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"other",children:"Other"})]}),e.jsxs(y,{value:"task_ratings",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_enabled",children:"Enable Task Ratings"}),e.jsx(j,{id:"task_enabled",checked:i.task_ratings.enabled,onCheckedChange:t=>c(["task_ratings","enabled"],t)})]}),i.task_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_weight",children:"Include Task Weight"}),e.jsx(j,{id:"task_weight",checked:i.task_ratings.include_task_weight,onCheckedChange:t=>c(["task_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_percentage",children:"Include User Assignment Percentage"}),e.jsx(j,{id:"task_percentage",checked:i.task_ratings.include_user_percentage,onCheckedChange:t=>c(["task_ratings","include_user_percentage"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"task_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"task_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.task_ratings.aggregation,onChange:t=>c(["task_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"stakeholder",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_enabled",children:"Enable Stakeholder Ratings"}),e.jsx(j,{id:"stakeholder_enabled",checked:i.stakeholder_ratings.enabled,onCheckedChange:t=>c(["stakeholder_ratings","enabled"],t)})]}),i.stakeholder_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_percentage",children:"Include Project Percentage"}),e.jsx(j,{id:"stakeholder_percentage",checked:i.stakeholder_ratings.include_project_percentage,onCheckedChange:t=>c(["stakeholder_ratings","include_project_percentage"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_weight",children:"Include Task Weight"}),e.jsx(j,{id:"stakeholder_weight",checked:i.stakeholder_ratings.include_task_weight,onCheckedChange:t=>c(["stakeholder_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"stakeholder_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"stakeholder_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.stakeholder_ratings.aggregation,onChange:t=>c(["stakeholder_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"other",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_helper_enabled",children:"Help Requests (as Helper)"}),e.jsx(j,{id:"help_helper_enabled",checked:i.help_requests_helper.enabled,onCheckedChange:t=>c(["help_requests_helper","enabled"],t)})]}),i.help_requests_helper.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_help",children:"Points per Help"}),e.jsx(N,{id:"points_per_help",type:"number",step:"0.01",value:i.help_requests_helper.points_per_help,onChange:t=>c(["help_requests_helper","points_per_help"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"helper_max_points",children:"Maximum Points"}),e.jsx(N,{id:"helper_max_points",type:"number",step:"0.01",value:i.help_requests_helper.max_points,onChange:t=>c(["help_requests_helper","max_points"],parseFloat(t.target.value))})]})]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_requester_enabled",children:"Help Requests (as Requester)"}),e.jsx(j,{id:"help_requester_enabled",checked:i.help_requests_requester.enabled,onCheckedChange:t=>c(["help_requests_requester","enabled"],t)})]}),i.help_requests_requester.enabled&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Penalties by Request Type"}),Object.entries(i.help_requests_requester.penalties).map(([t,_])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"flex-1 capitalize",children:t.replace(/_/g," ")}),e.jsx(N,{type:"number",step:"0.01",className:"w-24",value:_,onChange:v=>c(["help_requests_requester","penalties",t],parseFloat(v.target.value))})]},t))]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"tickets_enabled",children:"Tickets Resolved"}),e.jsx(j,{id:"tickets_enabled",checked:i.tickets_resolved.enabled,onCheckedChange:t=>c(["tickets_resolved","enabled"],t)})]}),i.tickets_resolved.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_ticket",children:"Points per Ticket"}),e.jsx(N,{id:"points_per_ticket",type:"number",step:"0.01",value:i.tickets_resolved.points_per_ticket,onChange:t=>c(["tickets_resolved","points_per_ticket"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"tickets_max_points",children:"Maximum Points"}),e.jsx(N,{id:"tickets_max_points",type:"number",step:"0.01",value:i.tickets_resolved.max_points,onChange:t=>c(["tickets_resolved","max_points"],parseFloat(t.target.value))})]})]})]})]})]}),e.jsxs(ne,{className:"sticky bottom-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70 -mx-6 px-6 py-4 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(C,{type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):"Update Configuration"})]})]}),e.jsx(U,{orientation:"horizontal"}),e.jsx(U,{orientation:"vertical"})]})]})})},ss=()=>{const{configs:r,isLoading:s,deleteConfig:a,activateConfig:n}=P(),[d,o]=m.useState(!1),[g,x]=m.useState(null),[i,l]=m.useState(!1),[p,c]=m.useState(null),t=h=>{x(h),o(!0)},_=async()=>{g&&await a(g)&&(o(!1),x(null))},v=h=>{c(h),l(!0)},b=async h=>{await n(h)};return s&&r.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading configurations..."})})}):r.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsxs(q,{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(M,{className:"w-12 h-12 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"No configurations yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Create your first rating configuration to get started"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:r.map(h=>e.jsxs(S,{className:"bg-card border-border",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{children:h.name}),h.is_active&&e.jsxs(R,{variant:"default",className:"gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Active"]})]}),h.description&&e.jsx(H,{children:h.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",$(new Date(h.created_at),"MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!h.is_active&&e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>b(h.id),disabled:s,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Activate"]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>v(h.id),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>t(h.id),disabled:h.is_active||s,children:e.jsx(ze,{className:"w-4 h-4"})})]})]})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Task Ratings"}),e.jsx("div",{className:"font-medium",children:h.config.task_ratings.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Stakeholder"}),e.jsx("div",{className:"font-medium",children:h.config.stakeholder_ratings.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Help (Helper)"}),e.jsx("div",{className:"font-medium",children:h.config.help_requests_helper.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Help (Requester)"}),e.jsx("div",{className:"font-medium",children:h.config.help_requests_requester.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Tickets"}),e.jsx("div",{className:"font-medium",children:h.config.tickets_resolved.enabled?"✓ Enabled":"✗ Disabled"})]})]})})]},h.id))}),e.jsx(Te,{open:d,onOpenChange:o,children:e.jsxs(Ee,{children:[e.jsxs(Pe,{children:[e.jsx(Ae,{children:"Are you sure?"}),e.jsx(Me,{children:"This will permanently delete this configuration. This action cannot be undone."})]}),e.jsxs(He,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(Ie,{onClick:_,className:"bg-destructive",children:"Delete"})]})]})}),p&&e.jsx(es,{open:i,onOpenChange:l,configId:p})]})},as=({user:r})=>{const{breakdown:s}=r;return e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[s.task_ratings.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Task Ratings"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["+",s.task_ratings.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.task_ratings.tasks_included," tasks"]})]}),s.stakeholder_ratings.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["+",s.stakeholder_ratings.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.stakeholder_ratings.projects_included," projects"]})]}),s.help_requests.helper.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Helped Others"}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["+",s.help_requests.helper.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.help_requests.helper.count," times"]})]}),s.help_requests.requester.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Help Requests"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.help_requests.requester.value}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"penalties"})]}),s.tickets_resolved.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tickets"}),e.jsxs("div",{className:"text-lg font-bold text-indigo-600",children:["+",s.tickets_resolved.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.tickets_resolved.count," resolved"]})]})]}),e.jsxs(z,{defaultValue:"tasks",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-2 md:grid-cols-4",children:[s.task_ratings.enabled&&e.jsx(k,{value:"tasks",children:"Tasks"}),s.stakeholder_ratings.enabled&&e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),s.help_requests.helper.enabled&&e.jsx(k,{value:"help",children:"Help"}),s.tickets_resolved.enabled&&e.jsx(k,{value:"tickets",children:"Tickets"})]}),s.task_ratings.enabled&&e.jsxs(y,{value:"tasks",className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Aggregation: ",s.task_ratings.aggregation," • Weight: ",s.task_ratings.include_task_weight?"Included":"Excluded"," • Percentage: ",s.task_ratings.include_user_percentage?"Included":"Excluded"]}),s.task_ratings.details.map(a=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.task_name}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Rating: ",a.task_rating,"/100",a.task_weight&&` • Weight: ${a.task_weight}/100`,a.user_percentage&&` • Your %: ${a.user_percentage}%`]})]}),e.jsxs(R,{variant:"outline",className:"text-blue-600",children:["+",a.contribution]})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground bg-background/50 p-2 rounded",children:a.calculation})]},a.task_id))]}),s.stakeholder_ratings.enabled&&e.jsxs(y,{value:"stakeholder",className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Aggregation: ",s.stakeholder_ratings.aggregation]}),s.stakeholder_ratings.details.map(a=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.project_name}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Stakeholder Rating: ",a.stakeholder_rating,"/100",a.user_project_percentage&&` • Your Project %: ${a.user_project_percentage}%`]})]}),e.jsxs(R,{variant:"outline",className:"text-purple-600",children:["+",a.contribution]})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground bg-background/50 p-2 rounded",children:a.calculation})]},a.project_id))]}),s.help_requests.helper.enabled&&e.jsxs(y,{value:"help",className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Helped Others"}),e.jsxs(R,{variant:"outline",className:"text-green-600",children:["+",s.help_requests.helper.value]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Completed ",s.help_requests.helper.count," help requests × ",s.help_requests.helper.points_per_help," points each",s.help_requests.helper.capped&&e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["(Capped at ",s.help_requests.helper.max_points," points maximum)"]})]})]}),s.help_requests.requester.enabled&&Object.keys(s.help_requests.requester.breakdown).length>0&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Requested Help"}),e.jsx(R,{variant:"outline",className:"text-red-600",children:s.help_requests.requester.value})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.help_requests.requester.breakdown).map(([a,n])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"capitalize",children:a.replace(/_/g," ")}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.count," requests × ",n.penalty_per_request," points"]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:n.total})]},a))})]})]}),s.tickets_resolved.enabled&&e.jsx(y,{value:"tickets",className:"space-y-3",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Tickets Resolved"}),e.jsxs(R,{variant:"outline",className:"text-indigo-600",children:["+",s.tickets_resolved.value]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Resolved ",s.tickets_resolved.count," tickets × ",s.tickets_resolved.points_per_ticket," points each",s.tickets_resolved.capped&&e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["(Capped at ",s.tickets_resolved.max_points," points maximum)"]})]})]})})]})]})},ts=({result:r})=>{const[s,a]=m.useState(null),{exportPdf:n,isExporting:d}=P(),o=l=>{a(s===l?null:l)},g=()=>{n({period_start:r.period.start,period_end:r.period.end,max_points:r.max_points_for_100_percent,config_id:r.config.id})},x=l=>l>=90?"text-green-600":l>=75?"text-blue-600":l>=60?"text-yellow-600":"text-red-600",i=l=>l.split(" ").map(p=>p[0]).join("").toUpperCase().slice(0,2);return r?!r.users||r.users.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"No employees found in this period"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{className:"bg-card border-border",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Rating Results"]}),e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),$(new Date(r.period.start),"MMM d, yyyy")," -"," ",$(new Date(r.period.end),"MMM d, yyyy")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(C,{variant:"outline",onClick:g,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Export PDF"]})})})]})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Employees"}),e.jsx("div",{className:"text-2xl font-bold",children:r.users.length})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Config Used"}),e.jsx("div",{className:"text-lg font-medium",children:r.config.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Max Points for 100%"}),e.jsx("div",{className:"text-2xl font-bold",children:r.max_points_for_100_percent})]})]})})]}),e.jsx("div",{className:"space-y-3",children:r.users.sort((l,p)=>p.final_percentage-l.final_percentage).map(l=>e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"cursor-pointer",onClick:()=>o(l.user_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs(Se,{className:"h-12 w-12 border-2 border-border",children:[e.jsx(qe,{src:l.avatar_url||void 0,alt:l.user_name}),e.jsx(Re,{className:"bg-primary text-primary-foreground font-semibold",children:i(l.user_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"text-lg",children:l.user_name}),e.jsxs(R,{variant:"outline",className:x(l.final_percentage),children:[l.final_percentage,"%"]})]}),e.jsx(H,{children:l.user_email})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Points"}),e.jsxs("div",{className:"text-lg font-bold",children:[l.total_points," / ",l.max_points]})]}),e.jsx(C,{variant:"ghost",size:"sm",children:s===l.user_id?e.jsx(De,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Be,{value:l.final_percentage,className:"h-2"})})]}),s===l.user_id&&e.jsx(q,{className:"pt-0",children:e.jsx(as,{user:l})})]},l.user_id))})]}):e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"No results to display"})})})},rs=({open:r,onOpenChange:s})=>{const{defaultStructure:a,isLoading:n,createConfig:d,fetchDefaultStructure:o}=P(),[g,x]=m.useState({name:"",description:"",is_active:!1}),[i,l]=m.useState(null);m.useEffect(()=>{r&&!a&&o()},[r,a,o]),m.useEffect(()=>{a&&!i&&l(JSON.parse(JSON.stringify(a)))},[a,i]);const p=async t=>{if(t.preventDefault(),!i)return;await d({...g,config:i})&&(s(!1),x({name:"",description:"",is_active:!1}),l(null))},c=(t,_)=>{if(!i)return;const v=JSON.parse(JSON.stringify(i));let b=v;for(let h=0;h<t.length-1;h++)b=b[t[h]];b[t[t.length-1]]=_,l(v)};return i?e.jsx(O,{open:r,onOpenChange:s,children:e.jsxs(I,{className:"w-[95vw] max-w-3xl max-h-[90vh] p-0 overflow-hidden",children:[e.jsx("div",{className:"border-b px-6 py-5",children:e.jsxs(ee,{children:[e.jsx(se,{children:"Create New Configuration"}),e.jsx(ae,{children:"Configure how ratings are calculated for different components"})]})}),e.jsxs(te,{className:"max-h-[calc(90vh-160px)]",children:[e.jsxs("form",{onSubmit:p,className:"space-y-6 px-6 py-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Configuration Name *"}),e.jsx(N,{id:"name",value:g.name,onChange:t=>x({...g,name:t.target.value}),placeholder:"Q1 2025 Performance Rating",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(re,{id:"description",value:g.description,onChange:t=>x({...g,description:t.target.value}),placeholder:"Optional description of this configuration",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"is_active",checked:g.is_active,onCheckedChange:t=>x({...g,is_active:t})}),e.jsx(u,{htmlFor:"is_active",children:"Set as active configuration"})]})]}),e.jsx(ie,{}),e.jsxs(z,{defaultValue:"task_ratings",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"task_ratings",children:"Tasks"}),e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"other",children:"Other"})]}),e.jsxs(y,{value:"task_ratings",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_enabled",children:"Enable Task Ratings"}),e.jsx(j,{id:"task_enabled",checked:i.task_ratings.enabled,onCheckedChange:t=>c(["task_ratings","enabled"],t)})]}),i.task_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_weight",children:"Include Task Weight"}),e.jsx(j,{id:"task_weight",checked:i.task_ratings.include_task_weight,onCheckedChange:t=>c(["task_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_percentage",children:"Include User Assignment Percentage"}),e.jsx(j,{id:"task_percentage",checked:i.task_ratings.include_user_percentage,onCheckedChange:t=>c(["task_ratings","include_user_percentage"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"task_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"task_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.task_ratings.aggregation,onChange:t=>c(["task_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"stakeholder",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_enabled",children:"Enable Stakeholder Ratings"}),e.jsx(j,{id:"stakeholder_enabled",checked:i.stakeholder_ratings.enabled,onCheckedChange:t=>c(["stakeholder_ratings","enabled"],t)})]}),i.stakeholder_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_percentage",children:"Include Project Percentage"}),e.jsx(j,{id:"stakeholder_percentage",checked:i.stakeholder_ratings.include_project_percentage,onCheckedChange:t=>c(["stakeholder_ratings","include_project_percentage"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_weight",children:"Include Task Weight"}),e.jsx(j,{id:"stakeholder_weight",checked:i.stakeholder_ratings.include_task_weight,onCheckedChange:t=>c(["stakeholder_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"stakeholder_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"stakeholder_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.stakeholder_ratings.aggregation,onChange:t=>c(["stakeholder_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"other",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_helper_enabled",children:"Help Requests (as Helper)"}),e.jsx(j,{id:"help_helper_enabled",checked:i.help_requests_helper.enabled,onCheckedChange:t=>c(["help_requests_helper","enabled"],t)})]}),i.help_requests_helper.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_help",children:"Points per Help"}),e.jsx(N,{id:"points_per_help",type:"number",step:"0.01",value:i.help_requests_helper.points_per_help,onChange:t=>c(["help_requests_helper","points_per_help"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"helper_max_points",children:"Maximum Points"}),e.jsx(N,{id:"helper_max_points",type:"number",step:"0.01",value:i.help_requests_helper.max_points,onChange:t=>c(["help_requests_helper","max_points"],parseFloat(t.target.value))})]})]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_requester_enabled",children:"Help Requests (as Requester)"}),e.jsx(j,{id:"help_requester_enabled",checked:i.help_requests_requester.enabled,onCheckedChange:t=>c(["help_requests_requester","enabled"],t)})]}),i.help_requests_requester.enabled&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Penalties by Request Type"}),Object.entries(i.help_requests_requester.penalties).map(([t,_])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"flex-1 capitalize",children:t.replace(/_/g," ")}),e.jsx(N,{type:"number",step:"0.01",className:"w-24",value:_,onChange:v=>c(["help_requests_requester","penalties",t],parseFloat(v.target.value))})]},t))]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"tickets_enabled",children:"Tickets Resolved"}),e.jsx(j,{id:"tickets_enabled",checked:i.tickets_resolved.enabled,onCheckedChange:t=>c(["tickets_resolved","enabled"],t)})]}),i.tickets_resolved.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_ticket",children:"Points per Ticket"}),e.jsx(N,{id:"points_per_ticket",type:"number",step:"0.01",value:i.tickets_resolved.points_per_ticket,onChange:t=>c(["tickets_resolved","points_per_ticket"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"tickets_max_points",children:"Maximum Points"}),e.jsx(N,{id:"tickets_max_points",type:"number",step:"0.01",value:i.tickets_resolved.max_points,onChange:t=>c(["tickets_resolved","max_points"],parseFloat(t.target.value))})]})]})]})]})]}),e.jsxs(ne,{className:"sticky bottom-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70 -mx-6 px-6 py-4 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(C,{type:"submit",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):"Create Configuration"})]})]}),e.jsx(U,{orientation:"horizontal"}),e.jsx(U,{orientation:"vertical"})]})]})}):e.jsx(O,{open:r,onOpenChange:s,children:e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"w-8 h-8 animate-spin"})})})})},js=()=>{const{configs:r,activeConfig:s,calculationResult:a}=P(),[n,d]=m.useState(!1);return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Final Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Calculate employee performance ratings for any period"})]})]}),e.jsxs(C,{onClick:()=>d(!0),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Config"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Total Configs"}),e.jsx(M,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(q,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r.length})})]}),e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Active Config"}),e.jsx(le,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(q,{children:e.jsx("div",{className:"text-xl font-bold text-foreground truncate",children:s?.name||"None"})})]})]}),e.jsxs(z,{defaultValue:"calculate",className:"space-y-4",children:[e.jsxs(B,{className:"bg-muted",children:[e.jsxs(k,{value:"calculate",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Calculate Ratings"]}),e.jsxs(k,{value:"configs",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Configurations"]}),a&&e.jsxs(k,{value:"results",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Results"]})]}),e.jsx(y,{value:"calculate",children:e.jsx($e,{})}),e.jsx(y,{value:"configs",children:e.jsx(ss,{})}),a&&e.jsx(y,{value:"results",children:e.jsx(ts,{result:a})})]})]}),e.jsx(rs,{open:n,onOpenChange:d})]})};export{js as default};
========
import{g as xe,v as w,w as pe,x as f,R as m,j as e,C as S,c as L,d as T,e as H,f as q,au as G,I as N,K as fe,M as je,N as _e,O as ve,P as be,B as C,L as E,aU as X,b4 as Ne,aW as ke,aO as Z,aY as ye,ba as Ce,bb as we,a8 as K,aE as O,aG as I,aH as ee,aI as se,bk as ae,a2 as te,a7 as re,az as ie,bl as ne,a3 as U,F as $,E as Fe,G as Se,H as qe,J as Re,bm as De,af as Le}from"./index-Cj_ZlKJu.js";import{T as z,a as B,b as k,c as y}from"./tabs-DmL4XNSD.js";import{L as u}from"./label-D5sTaFLO.js";import{C as V}from"./calculator-BRkRpldx.js";import{B as R}from"./badge-DE0BUwgy.js";import{A as Te,a as Ee,b as Pe,c as Ae,d as Me,e as He,f as Oe,g as Ie}from"./alert-dialog-Dlldy5Cb.js";import{S as M}from"./settings-DfoUw66P.js";import{C as Q}from"./circle-check-big-_oFq4Tds.js";import{S as Ue}from"./square-pen-DB_3-rr9.js";import{T as ze}from"./trash-2-CmFgeMTE.js";import{P as Be}from"./progress-BuvAklDR.js";import{T as Y}from"./trending-up-DkPLIKDU.js";const Je=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],le=xe("file-text",Je);class We{async calculateRatings(s){return w.post("/final-ratings/calculate",s)}async exportPdf(s){return w.downloadFile("/final-ratings/export-pdf",s)}async getConfigs(){return w.get("/final-ratings/configs")}async getConfig(s){return w.get(`/final-ratings/configs/${s}`)}async getActiveConfig(){return w.get("/final-ratings/configs/active")}async getDefaultStructure(){return w.get("/final-ratings/configs/default-structure")}async createConfig(s){return w.post("/final-ratings/configs",s)}async updateConfig(s,a){return w.put(`/final-ratings/configs/${s}`,a)}async deleteConfig(s){return w.delete(`/final-ratings/configs/${s}`)}async activateConfig(s){return w.post(`/final-ratings/configs/${s}/activate`)}}const F=new We,ce=pe(r=>({configs:[],activeConfig:null,currentConfig:null,defaultStructure:null,calculationResult:null,isLoading:!1,isExporting:!1,error:null,fetchConfigs:async()=>{r({isLoading:!0,error:null});try{const s=await F.getConfigs();s.success&&s.data?r({configs:s.data,isLoading:!1}):(r({error:s.message||"Failed to fetch configs",isLoading:!1}),f.error(s.message||"Failed to fetch configs"))}catch(s){const a=s.message||"Failed to fetch configs";r({error:a,isLoading:!1}),f.error(a)}},fetchConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.getConfig(s);a.success&&a.data?r({currentConfig:a.data,isLoading:!1}):(r({error:a.message||"Failed to fetch config",isLoading:!1}),f.error(a.message||"Failed to fetch config"))}catch(a){const n=a.message||"Failed to fetch config";r({error:n,isLoading:!1}),f.error(n)}},fetchActiveConfig:async()=>{r({isLoading:!0,error:null});try{const s=await F.getActiveConfig();s.success&&s.data?r({activeConfig:s.data,isLoading:!1}):r({error:s.message||"No active config found",isLoading:!1})}catch(s){const a=s.message||"Failed to fetch active config";r({error:a,isLoading:!1})}},fetchDefaultStructure:async()=>{try{const s=await F.getDefaultStructure();s.success&&s.data&&r({defaultStructure:s.data})}catch(s){f.error(s.message||"Failed to fetch default structure")}},createConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.createConfig(s);return a.success&&a.data?(r(n=>({configs:[a.data,...n.configs],isLoading:!1})),f.success("Configuration created successfully"),a.data):(r({error:a.message||"Failed to create config",isLoading:!1}),f.error(a.message||"Failed to create config"),null)}catch(a){const n=a.message||"Failed to create config";return r({error:n,isLoading:!1}),f.error(n),null}},updateConfig:async(s,a)=>{r({isLoading:!0,error:null});try{const n=await F.updateConfig(s,a);return n.success&&n.data?(r(d=>({configs:d.configs.map(o=>o.id===s?n.data:o),currentConfig:d.currentConfig?.id===s?n.data:d.currentConfig,isLoading:!1})),f.success("Configuration updated successfully"),n.data):(r({error:n.message||"Failed to update config",isLoading:!1}),f.error(n.message||"Failed to update config"),null)}catch(n){const d=n.message||"Failed to update config";return r({error:d,isLoading:!1}),f.error(d),null}},deleteConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.deleteConfig(s);return a.success?(r(n=>({configs:n.configs.filter(d=>d.id!==s),currentConfig:n.currentConfig?.id===s?null:n.currentConfig,isLoading:!1})),f.success("Configuration deleted successfully"),!0):(r({error:a.message||"Failed to delete config",isLoading:!1}),f.error(a.message||"Failed to delete config"),!1)}catch(a){const n=a.message||"Failed to delete config";return r({error:n,isLoading:!1}),f.error(n),!1}},activateConfig:async s=>{r({isLoading:!0,error:null});try{const a=await F.activateConfig(s);return a.success&&a.data?(r(n=>({configs:n.configs.map(d=>({...d,is_active:d.id===s})),activeConfig:a.data,isLoading:!1})),f.success("Configuration activated successfully"),!0):(r({error:a.message||"Failed to activate config",isLoading:!1}),f.error(a.message||"Failed to activate config"),!1)}catch(a){const n=a.message||"Failed to activate config";return r({error:n,isLoading:!1}),f.error(n),!1}},calculateRatings:async s=>{r({isLoading:!0,error:null});try{const a=await F.calculateRatings(s);return a.success&&a.data?(r({calculationResult:a.data,isLoading:!1}),f.success("Ratings calculated successfully"),a.data):(r({error:a.message||"Failed to calculate ratings",isLoading:!1}),f.error(a.message||"Failed to calculate ratings"),null)}catch(a){const n=a.message||"Failed to calculate ratings";return r({error:n,isLoading:!1}),f.error(n),null}},exportPdf:async s=>{r({isExporting:!0,error:null});try{const{blob:a,filename:n}=await F.exportPdf(s),d=window.URL.createObjectURL(a),o=document.createElement("a");o.href=d,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(d),r({isExporting:!1}),f.success("PDF package exported successfully")}catch(a){const n=a.message||"Failed to export PDF";r({error:n,isExporting:!1}),f.error(n)}},clearCalculationResult:()=>r({calculationResult:null,error:null}),clearCurrentConfig:()=>r({currentConfig:null,error:null})})),P=()=>{const{configs:r,activeConfig:s,currentConfig:a,defaultStructure:n,calculationResult:d,isLoading:o,isExporting:g,error:x,fetchConfigs:i,fetchActiveConfig:l,fetchDefaultStructure:p,createConfig:c,updateConfig:t,deleteConfig:_,activateConfig:v,calculateRatings:b,exportPdf:h,clearCalculationResult:D,clearCurrentConfig:W}=ce();return m.useEffect(()=>{r.length===0&&i(),s||l()},[]),{configs:r,activeConfig:s,currentConfig:a,defaultStructure:n,calculationResult:d,isLoading:o,isExporting:g,error:x,fetchConfigs:i,fetchActiveConfig:l,fetchDefaultStructure:p,createConfig:c,updateConfig:t,deleteConfig:_,activateConfig:v,calculateRatings:b,exportPdf:h,clearCalculationResult:D,clearCurrentConfig:W}},$e=()=>{const{configs:r,activeConfig:s,isLoading:a,calculateRatings:n,fetchActiveConfig:d}=P(),[o,g]=m.useState({period_start:"",period_end:"",max_points:"",config_id:""});m.useEffect(()=>{s||d()},[s,d]),m.useEffect(()=>{s&&!o.config_id&&g(l=>({...l,config_id:s.id.toString()}))},[s,o.config_id]);const x=async l=>{if(l.preventDefault(),!o.period_start||!o.period_end||!o.max_points)return;if(await n({period_start:o.period_start,period_end:o.period_end,max_points:parseFloat(o.max_points),config_id:o.config_id?parseInt(o.config_id):void 0})){const c=document.querySelector('[value="results"]');c&&c.click()}},i=(l,p)=>{g(c=>({...c,[l]:p}))};return e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Calculate Final Ratings"]}),e.jsx(H,{children:"Select a period and specify the maximum points for 100% rating"})]}),e.jsx(q,{children:e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"period_start",children:"Period Start"}),e.jsx(G,{id:"period_start",name:"period_start",value:o.period_start,onChange:l=>i("period_start",l),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"period_end",children:"Period End"}),e.jsx(G,{id:"period_end",name:"period_end",value:o.period_end,onChange:l=>i("period_end",l),required:!0,min:o.period_start})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"max_points",children:["Maximum Points for 100%",e.jsx("span",{className:"text-muted-foreground text-sm ml-2",children:"(How many points equals 100% rating?)"})]}),e.jsx(N,{id:"max_points",type:"number",step:"0.01",min:"1",value:o.max_points,onChange:l=>i("max_points",l.target.value),placeholder:"e.g., 200",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"config_id",children:["Rating Configuration",e.jsx("span",{className:"text-muted-foreground text-sm ml-2",children:"(Leave as active to use current default)"})]}),e.jsxs(fe,{value:o.config_id,onValueChange:l=>i("config_id",l),children:[e.jsx(je,{children:e.jsx(_e,{placeholder:"Select configuration"})}),e.jsx(ve,{children:r.map(l=>e.jsxs(be,{value:l.id.toString(),children:[l.name," ",l.is_active&&"(Active)"]},l.id))})]})]}),e.jsxs("div",{className:"bg-muted/50 border border-border rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-medium text-sm",children:"How it works:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"All employees with tasks in the selected period will be calculated"}),e.jsx("li",{children:"Each employee's percentage = (their total points / max points) × 100"}),e.jsx("li",{children:"Maximum percentage is capped at 100%"}),e.jsx("li",{children:"Results show full breakdown of how points were calculated"})]})]}),e.jsx(C,{type:"submit",className:"w-full",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Calculate Ratings"]})})]})})]})};var J="Switch",[Ve,fs]=ke(J),[Ye,Ge]=Ve(J),de=m.forwardRef((r,s)=>{const{__scopeSwitch:a,name:n,checked:d,defaultChecked:o,required:g,disabled:x,value:i="on",onCheckedChange:l,form:p,...c}=r,[t,_]=m.useState(null),v=X(s,A=>_(A)),b=m.useRef(!1),h=t?p||!!t.closest("form"):!0,[D,W]=Ne({prop:d,defaultProp:o??!1,onChange:l,caller:J});return e.jsxs(Ye,{scope:a,checked:D,disabled:x,children:[e.jsx(Z.button,{type:"button",role:"switch","aria-checked":D,"aria-required":g,"data-state":ge(D),"data-disabled":x?"":void 0,disabled:x,value:i,...c,ref:v,onClick:ye(r.onClick,A=>{W(me=>!me),h&&(b.current=A.isPropagationStopped(),b.current||A.stopPropagation())})}),h&&e.jsx(he,{control:t,bubbles:!b.current,name:n,value:i,checked:D,required:g,disabled:x,form:p,style:{transform:"translateX(-100%)"}})]})});de.displayName=J;var oe="SwitchThumb",ue=m.forwardRef((r,s)=>{const{__scopeSwitch:a,...n}=r,d=Ge(oe,a);return e.jsx(Z.span,{"data-state":ge(d.checked),"data-disabled":d.disabled?"":void 0,...n,ref:s})});ue.displayName=oe;var Ke="SwitchBubbleInput",he=m.forwardRef(({__scopeSwitch:r,control:s,checked:a,bubbles:n=!0,...d},o)=>{const g=m.useRef(null),x=X(g,o),i=Ce(a),l=we(s);return m.useEffect(()=>{const p=g.current;if(!p)return;const c=window.HTMLInputElement.prototype,_=Object.getOwnPropertyDescriptor(c,"checked").set;if(i!==a&&_){const v=new Event("click",{bubbles:n});_.call(p,a),p.dispatchEvent(v)}},[i,a,n]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...d,tabIndex:-1,ref:x,style:{...d.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});he.displayName=Ke;function ge(r){return r?"checked":"unchecked"}var Qe=de,Xe=ue;function j({className:r,...s}){return e.jsx(Qe,{"data-slot":"switch",className:K("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:e.jsx(Xe,{"data-slot":"switch-thumb",className:K("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const Ze=r=>{const{currentConfig:s,isLoading:a,error:n,fetchConfig:d,updateConfig:o,clearCurrentConfig:g}=ce();return m.useEffect(()=>(r&&d(r),()=>{g()}),[r,d,g]),{config:s,isLoading:a,error:n,updateConfig:o}},es=({open:r,onOpenChange:s,configId:a})=>{const{config:n,isLoading:d,updateConfig:o}=Ze(a),[g,x]=m.useState({name:"",description:""}),[i,l]=m.useState(null);m.useEffect(()=>{n&&(x({name:n.name,description:n.description||""}),l(JSON.parse(JSON.stringify(n.config))))},[n]);const p=async t=>{if(t.preventDefault(),!i)return;await o(a,{...g,config:i})&&s(!1)},c=(t,_)=>{if(!i)return;const v=JSON.parse(JSON.stringify(i));let b=v;for(let h=0;h<t.length-1;h++)b=b[t[h]];b[t[t.length-1]]=_,l(v)};return d||!i?e.jsx(O,{open:r,onOpenChange:s,children:e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"w-8 h-8 animate-spin"})})})}):e.jsx(O,{open:r,onOpenChange:s,children:e.jsxs(I,{className:"w-[95vw] max-w-3xl max-h-[90vh] p-0 overflow-hidden",children:[e.jsx("div",{className:"border-b px-6 py-5",children:e.jsxs(ee,{children:[e.jsx(se,{children:"Edit Configuration"}),e.jsx(ae,{children:"Update the rating calculation configuration"})]})}),e.jsxs(te,{className:"max-h-[calc(90vh-160px)]",children:[e.jsxs("form",{onSubmit:p,className:"space-y-6 px-6 py-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Configuration Name *"}),e.jsx(N,{id:"name",value:g.name,onChange:t=>x({...g,name:t.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(re,{id:"description",value:g.description,onChange:t=>x({...g,description:t.target.value}),rows:2})]})]}),e.jsx(ie,{}),e.jsxs(z,{defaultValue:"task_ratings",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"task_ratings",children:"Tasks"}),e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"other",children:"Other"})]}),e.jsxs(y,{value:"task_ratings",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_enabled",children:"Enable Task Ratings"}),e.jsx(j,{id:"task_enabled",checked:i.task_ratings.enabled,onCheckedChange:t=>c(["task_ratings","enabled"],t)})]}),i.task_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_weight",children:"Include Task Weight"}),e.jsx(j,{id:"task_weight",checked:i.task_ratings.include_task_weight,onCheckedChange:t=>c(["task_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_percentage",children:"Include User Assignment Percentage"}),e.jsx(j,{id:"task_percentage",checked:i.task_ratings.include_user_percentage,onCheckedChange:t=>c(["task_ratings","include_user_percentage"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"task_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"task_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.task_ratings.aggregation,onChange:t=>c(["task_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"stakeholder",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_enabled",children:"Enable Stakeholder Ratings"}),e.jsx(j,{id:"stakeholder_enabled",checked:i.stakeholder_ratings.enabled,onCheckedChange:t=>c(["stakeholder_ratings","enabled"],t)})]}),i.stakeholder_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_percentage",children:"Include Project Percentage"}),e.jsx(j,{id:"stakeholder_percentage",checked:i.stakeholder_ratings.include_project_percentage,onCheckedChange:t=>c(["stakeholder_ratings","include_project_percentage"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_weight",children:"Include Task Weight"}),e.jsx(j,{id:"stakeholder_weight",checked:i.stakeholder_ratings.include_task_weight,onCheckedChange:t=>c(["stakeholder_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"stakeholder_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"stakeholder_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.stakeholder_ratings.aggregation,onChange:t=>c(["stakeholder_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"other",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_helper_enabled",children:"Help Requests (as Helper)"}),e.jsx(j,{id:"help_helper_enabled",checked:i.help_requests_helper.enabled,onCheckedChange:t=>c(["help_requests_helper","enabled"],t)})]}),i.help_requests_helper.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_help",children:"Points per Help"}),e.jsx(N,{id:"points_per_help",type:"number",step:"0.01",value:i.help_requests_helper.points_per_help,onChange:t=>c(["help_requests_helper","points_per_help"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"helper_max_points",children:"Maximum Points"}),e.jsx(N,{id:"helper_max_points",type:"number",step:"0.01",value:i.help_requests_helper.max_points,onChange:t=>c(["help_requests_helper","max_points"],parseFloat(t.target.value))})]})]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_requester_enabled",children:"Help Requests (as Requester)"}),e.jsx(j,{id:"help_requester_enabled",checked:i.help_requests_requester.enabled,onCheckedChange:t=>c(["help_requests_requester","enabled"],t)})]}),i.help_requests_requester.enabled&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Penalties by Request Type"}),Object.entries(i.help_requests_requester.penalties).map(([t,_])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"flex-1 capitalize",children:t.replace(/_/g," ")}),e.jsx(N,{type:"number",step:"0.01",className:"w-24",value:_,onChange:v=>c(["help_requests_requester","penalties",t],parseFloat(v.target.value))})]},t))]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"tickets_enabled",children:"Tickets Resolved"}),e.jsx(j,{id:"tickets_enabled",checked:i.tickets_resolved.enabled,onCheckedChange:t=>c(["tickets_resolved","enabled"],t)})]}),i.tickets_resolved.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_ticket",children:"Points per Ticket"}),e.jsx(N,{id:"points_per_ticket",type:"number",step:"0.01",value:i.tickets_resolved.points_per_ticket,onChange:t=>c(["tickets_resolved","points_per_ticket"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"tickets_max_points",children:"Maximum Points"}),e.jsx(N,{id:"tickets_max_points",type:"number",step:"0.01",value:i.tickets_resolved.max_points,onChange:t=>c(["tickets_resolved","max_points"],parseFloat(t.target.value))})]})]})]})]})]}),e.jsxs(ne,{className:"sticky bottom-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70 -mx-6 px-6 py-4 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(C,{type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):"Update Configuration"})]})]}),e.jsx(U,{orientation:"horizontal"}),e.jsx(U,{orientation:"vertical"})]})]})})},ss=()=>{const{configs:r,isLoading:s,deleteConfig:a,activateConfig:n}=P(),[d,o]=m.useState(!1),[g,x]=m.useState(null),[i,l]=m.useState(!1),[p,c]=m.useState(null),t=h=>{x(h),o(!0)},_=async()=>{g&&await a(g)&&(o(!1),x(null))},v=h=>{c(h),l(!0)},b=async h=>{await n(h)};return s&&r.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading configurations..."})})}):r.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsxs(q,{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx(M,{className:"w-12 h-12 text-muted-foreground"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"No configurations yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Create your first rating configuration to get started"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:r.map(h=>e.jsxs(S,{className:"bg-card border-border",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{children:h.name}),h.is_active&&e.jsxs(R,{variant:"default",className:"gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Active"]})]}),h.description&&e.jsx(H,{children:h.description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created ",$(new Date(h.created_at),"MMM d, yyyy")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!h.is_active&&e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>b(h.id),disabled:s,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"Activate"]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>v(h.id),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>t(h.id),disabled:h.is_active||s,children:e.jsx(ze,{className:"w-4 h-4"})})]})]})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Task Ratings"}),e.jsx("div",{className:"font-medium",children:h.config.task_ratings.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Stakeholder"}),e.jsx("div",{className:"font-medium",children:h.config.stakeholder_ratings.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Help (Helper)"}),e.jsx("div",{className:"font-medium",children:h.config.help_requests_helper.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Help (Requester)"}),e.jsx("div",{className:"font-medium",children:h.config.help_requests_requester.enabled?"✓ Enabled":"✗ Disabled"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Tickets"}),e.jsx("div",{className:"font-medium",children:h.config.tickets_resolved.enabled?"✓ Enabled":"✗ Disabled"})]})]})})]},h.id))}),e.jsx(Te,{open:d,onOpenChange:o,children:e.jsxs(Ee,{children:[e.jsxs(Pe,{children:[e.jsx(Ae,{children:"Are you sure?"}),e.jsx(Me,{children:"This will permanently delete this configuration. This action cannot be undone."})]}),e.jsxs(He,{children:[e.jsx(Oe,{children:"Cancel"}),e.jsx(Ie,{onClick:_,className:"bg-destructive",children:"Delete"})]})]})}),p&&e.jsx(es,{open:i,onOpenChange:l,configId:p})]})},as=({user:r})=>{const{breakdown:s}=r;return e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[s.task_ratings.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Task Ratings"}),e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["+",s.task_ratings.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.task_ratings.tasks_included," tasks"]})]}),s.stakeholder_ratings.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Stakeholder"}),e.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["+",s.stakeholder_ratings.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.stakeholder_ratings.projects_included," projects"]})]}),s.help_requests.helper.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Helped Others"}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["+",s.help_requests.helper.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.help_requests.helper.count," times"]})]}),s.help_requests.requester.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Help Requests"}),e.jsx("div",{className:"text-lg font-bold text-red-600",children:s.help_requests.requester.value}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"penalties"})]}),s.tickets_resolved.enabled&&e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tickets"}),e.jsxs("div",{className:"text-lg font-bold text-indigo-600",children:["+",s.tickets_resolved.value]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.tickets_resolved.count," resolved"]})]})]}),e.jsxs(z,{defaultValue:"tasks",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-2 md:grid-cols-4",children:[s.task_ratings.enabled&&e.jsx(k,{value:"tasks",children:"Tasks"}),s.stakeholder_ratings.enabled&&e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),s.help_requests.helper.enabled&&e.jsx(k,{value:"help",children:"Help"}),s.tickets_resolved.enabled&&e.jsx(k,{value:"tickets",children:"Tickets"})]}),s.task_ratings.enabled&&e.jsxs(y,{value:"tasks",className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Aggregation: ",s.task_ratings.aggregation," • Weight: ",s.task_ratings.include_task_weight?"Included":"Excluded"," • Percentage: ",s.task_ratings.include_user_percentage?"Included":"Excluded"]}),s.task_ratings.details.map(a=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.task_name}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Rating: ",a.task_rating,"/100",a.task_weight&&` • Weight: ${a.task_weight}/100`,a.user_percentage&&` • Your %: ${a.user_percentage}%`]})]}),e.jsxs(R,{variant:"outline",className:"text-blue-600",children:["+",a.contribution]})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground bg-background/50 p-2 rounded",children:a.calculation})]},a.task_id))]}),s.stakeholder_ratings.enabled&&e.jsxs(y,{value:"stakeholder",className:"space-y-3",children:[e.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:["Aggregation: ",s.stakeholder_ratings.aggregation]}),s.stakeholder_ratings.details.map(a=>e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.project_name}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Stakeholder Rating: ",a.stakeholder_rating,"/100",a.user_project_percentage&&` • Your Project %: ${a.user_project_percentage}%`]})]}),e.jsxs(R,{variant:"outline",className:"text-purple-600",children:["+",a.contribution]})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground bg-background/50 p-2 rounded",children:a.calculation})]},a.project_id))]}),s.help_requests.helper.enabled&&e.jsxs(y,{value:"help",className:"space-y-3",children:[e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Helped Others"}),e.jsxs(R,{variant:"outline",className:"text-green-600",children:["+",s.help_requests.helper.value]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Completed ",s.help_requests.helper.count," help requests × ",s.help_requests.helper.points_per_help," points each",s.help_requests.helper.capped&&e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["(Capped at ",s.help_requests.helper.max_points," points maximum)"]})]})]}),s.help_requests.requester.enabled&&Object.keys(s.help_requests.requester.breakdown).length>0&&e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Requested Help"}),e.jsx(R,{variant:"outline",className:"text-red-600",children:s.help_requests.requester.value})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.help_requests.requester.breakdown).map(([a,n])=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"capitalize",children:a.replace(/_/g," ")}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[n.count," requests × ",n.penalty_per_request," points"]})]}),e.jsx("div",{className:"text-red-600 font-medium",children:n.total})]},a))})]})]}),s.tickets_resolved.enabled&&e.jsx(y,{value:"tickets",className:"space-y-3",children:e.jsxs("div",{className:"bg-muted/30 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:"font-medium",children:"Tickets Resolved"}),e.jsxs(R,{variant:"outline",className:"text-indigo-600",children:["+",s.tickets_resolved.value]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Resolved ",s.tickets_resolved.count," tickets × ",s.tickets_resolved.points_per_ticket," points each",s.tickets_resolved.capped&&e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["(Capped at ",s.tickets_resolved.max_points," points maximum)"]})]})]})})]})]})},ts=({result:r})=>{const[s,a]=m.useState(null),{exportPdf:n,isExporting:d}=P(),o=l=>{a(s===l?null:l)},g=()=>{n({period_start:r.period.start,period_end:r.period.end,max_points:r.max_points_for_100_percent,config_id:r.config.id})},x=l=>l>=90?"text-green-600":l>=75?"text-blue-600":l>=60?"text-yellow-600":"text-red-600",i=l=>l.split(" ").map(p=>p[0]).join("").toUpperCase().slice(0,2);return r?!r.users||r.users.length===0?e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"No employees found in this period"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{className:"bg-card border-border",children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Rating Results"]}),e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),$(new Date(r.period.start),"MMM d, yyyy")," -"," ",$(new Date(r.period.end),"MMM d, yyyy")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(C,{variant:"outline",onClick:g,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Export PDF"]})})})]})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Employees"}),e.jsx("div",{className:"text-2xl font-bold",children:r.users.length})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Config Used"}),e.jsx("div",{className:"text-lg font-medium",children:r.config.name})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Max Points for 100%"}),e.jsx("div",{className:"text-2xl font-bold",children:r.max_points_for_100_percent})]})]})})]}),e.jsx("div",{className:"space-y-3",children:r.users.sort((l,p)=>p.final_percentage-l.final_percentage).map(l=>e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"cursor-pointer",onClick:()=>o(l.user_id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsxs(Se,{className:"h-12 w-12 border-2 border-border",children:[e.jsx(qe,{src:l.avatar_url||void 0,alt:l.user_name}),e.jsx(Re,{className:"bg-primary text-primary-foreground font-semibold",children:i(l.user_name)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{className:"text-lg",children:l.user_name}),e.jsxs(R,{variant:"outline",className:x(l.final_percentage),children:[l.final_percentage,"%"]})]}),e.jsx(H,{children:l.user_email})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Points"}),e.jsxs("div",{className:"text-lg font-bold",children:[l.total_points," / ",l.max_points]})]}),e.jsx(C,{variant:"ghost",size:"sm",children:s===l.user_id?e.jsx(De,{className:"w-4 h-4"}):e.jsx(Le,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(Be,{value:l.final_percentage,className:"h-2"})})]}),s===l.user_id&&e.jsx(q,{className:"pt-0",children:e.jsx(as,{user:l})})]},l.user_id))})]}):e.jsx(S,{className:"bg-card border-border",children:e.jsx(q,{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"No results to display"})})})},rs=({open:r,onOpenChange:s})=>{const{defaultStructure:a,isLoading:n,createConfig:d,fetchDefaultStructure:o}=P(),[g,x]=m.useState({name:"",description:"",is_active:!1}),[i,l]=m.useState(null);m.useEffect(()=>{r&&!a&&o()},[r,a,o]),m.useEffect(()=>{a&&!i&&l(JSON.parse(JSON.stringify(a)))},[a,i]);const p=async t=>{if(t.preventDefault(),!i)return;await d({...g,config:i})&&(s(!1),x({name:"",description:"",is_active:!1}),l(null))},c=(t,_)=>{if(!i)return;const v=JSON.parse(JSON.stringify(i));let b=v;for(let h=0;h<t.length-1;h++)b=b[t[h]];b[t[t.length-1]]=_,l(v)};return i?e.jsx(O,{open:r,onOpenChange:s,children:e.jsxs(I,{className:"w-[95vw] max-w-3xl max-h-[90vh] p-0 overflow-hidden",children:[e.jsx("div",{className:"border-b px-6 py-5",children:e.jsxs(ee,{children:[e.jsx(se,{children:"Create New Configuration"}),e.jsx(ae,{children:"Configure how ratings are calculated for different components"})]})}),e.jsxs(te,{className:"max-h-[calc(90vh-160px)]",children:[e.jsxs("form",{onSubmit:p,className:"space-y-6 px-6 py-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"name",children:"Configuration Name *"}),e.jsx(N,{id:"name",value:g.name,onChange:t=>x({...g,name:t.target.value}),placeholder:"Q1 2025 Performance Rating",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"description",children:"Description"}),e.jsx(re,{id:"description",value:g.description,onChange:t=>x({...g,description:t.target.value}),placeholder:"Optional description of this configuration",rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{id:"is_active",checked:g.is_active,onCheckedChange:t=>x({...g,is_active:t})}),e.jsx(u,{htmlFor:"is_active",children:"Set as active configuration"})]})]}),e.jsx(ie,{}),e.jsxs(z,{defaultValue:"task_ratings",className:"w-full",children:[e.jsxs(B,{className:"grid w-full grid-cols-3",children:[e.jsx(k,{value:"task_ratings",children:"Tasks"}),e.jsx(k,{value:"stakeholder",children:"Stakeholder"}),e.jsx(k,{value:"other",children:"Other"})]}),e.jsxs(y,{value:"task_ratings",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_enabled",children:"Enable Task Ratings"}),e.jsx(j,{id:"task_enabled",checked:i.task_ratings.enabled,onCheckedChange:t=>c(["task_ratings","enabled"],t)})]}),i.task_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_weight",children:"Include Task Weight"}),e.jsx(j,{id:"task_weight",checked:i.task_ratings.include_task_weight,onCheckedChange:t=>c(["task_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"task_percentage",children:"Include User Assignment Percentage"}),e.jsx(j,{id:"task_percentage",checked:i.task_ratings.include_user_percentage,onCheckedChange:t=>c(["task_ratings","include_user_percentage"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"task_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"task_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.task_ratings.aggregation,onChange:t=>c(["task_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"stakeholder",className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_enabled",children:"Enable Stakeholder Ratings"}),e.jsx(j,{id:"stakeholder_enabled",checked:i.stakeholder_ratings.enabled,onCheckedChange:t=>c(["stakeholder_ratings","enabled"],t)})]}),i.stakeholder_ratings.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_percentage",children:"Include Project Percentage"}),e.jsx(j,{id:"stakeholder_percentage",checked:i.stakeholder_ratings.include_project_percentage,onCheckedChange:t=>c(["stakeholder_ratings","include_project_percentage"],t)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"stakeholder_weight",children:"Include Task Weight"}),e.jsx(j,{id:"stakeholder_weight",checked:i.stakeholder_ratings.include_task_weight,onCheckedChange:t=>c(["stakeholder_ratings","include_task_weight"],t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"stakeholder_aggregation",children:"Aggregation Method"}),e.jsxs("select",{id:"stakeholder_aggregation",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.stakeholder_ratings.aggregation,onChange:t=>c(["stakeholder_ratings","aggregation"],t.target.value),children:[e.jsx("option",{value:"sum",children:"Sum"}),e.jsx("option",{value:"average",children:"Average"})]})]})]})]}),e.jsxs(y,{value:"other",className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_helper_enabled",children:"Help Requests (as Helper)"}),e.jsx(j,{id:"help_helper_enabled",checked:i.help_requests_helper.enabled,onCheckedChange:t=>c(["help_requests_helper","enabled"],t)})]}),i.help_requests_helper.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_help",children:"Points per Help"}),e.jsx(N,{id:"points_per_help",type:"number",step:"0.01",value:i.help_requests_helper.points_per_help,onChange:t=>c(["help_requests_helper","points_per_help"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"helper_max_points",children:"Maximum Points"}),e.jsx(N,{id:"helper_max_points",type:"number",step:"0.01",value:i.help_requests_helper.max_points,onChange:t=>c(["help_requests_helper","max_points"],parseFloat(t.target.value))})]})]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"help_requester_enabled",children:"Help Requests (as Requester)"}),e.jsx(j,{id:"help_requester_enabled",checked:i.help_requests_requester.enabled,onCheckedChange:t=>c(["help_requests_requester","enabled"],t)})]}),i.help_requests_requester.enabled&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Penalties by Request Type"}),Object.entries(i.help_requests_requester.penalties).map(([t,_])=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"flex-1 capitalize",children:t.replace(/_/g," ")}),e.jsx(N,{type:"number",step:"0.01",className:"w-24",value:_,onChange:v=>c(["help_requests_requester","penalties",t],parseFloat(v.target.value))})]},t))]})]}),e.jsxs("div",{className:"space-y-4 bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{htmlFor:"tickets_enabled",children:"Tickets Resolved"}),e.jsx(j,{id:"tickets_enabled",checked:i.tickets_resolved.enabled,onCheckedChange:t=>c(["tickets_resolved","enabled"],t)})]}),i.tickets_resolved.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"points_per_ticket",children:"Points per Ticket"}),e.jsx(N,{id:"points_per_ticket",type:"number",step:"0.01",value:i.tickets_resolved.points_per_ticket,onChange:t=>c(["tickets_resolved","points_per_ticket"],parseFloat(t.target.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"tickets_max_points",children:"Maximum Points"}),e.jsx(N,{id:"tickets_max_points",type:"number",step:"0.01",value:i.tickets_resolved.max_points,onChange:t=>c(["tickets_resolved","max_points"],parseFloat(t.target.value))})]})]})]})]})]}),e.jsxs(ne,{className:"sticky bottom-0 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/70 -mx-6 px-6 py-4 border-t",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancel"}),e.jsx(C,{type:"submit",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2 animate-spin"}),"Creating..."]}):"Create Configuration"})]})]}),e.jsx(U,{orientation:"horizontal"}),e.jsx(U,{orientation:"vertical"})]})]})}):e.jsx(O,{open:r,onOpenChange:s,children:e.jsx(I,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"w-8 h-8 animate-spin"})})})})},js=()=>{const{configs:r,activeConfig:s,calculationResult:a}=P(),[n,d]=m.useState(!1);return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Final Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Calculate employee performance ratings for any period"})]})]}),e.jsxs(C,{onClick:()=>d(!0),children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"New Config"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Total Configs"}),e.jsx(M,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(q,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r.length})})]}),e.jsxs(S,{className:"bg-card border-border",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Active Config"}),e.jsx(le,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(q,{children:e.jsx("div",{className:"text-xl font-bold text-foreground truncate",children:s?.name||"None"})})]})]}),e.jsxs(z,{defaultValue:"calculate",className:"space-y-4",children:[e.jsxs(B,{className:"bg-muted",children:[e.jsxs(k,{value:"calculate",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Calculate Ratings"]}),e.jsxs(k,{value:"configs",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Configurations"]}),a&&e.jsxs(k,{value:"results",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Results"]})]}),e.jsx(y,{value:"calculate",children:e.jsx($e,{})}),e.jsx(y,{value:"configs",children:e.jsx(ss,{})}),a&&e.jsx(y,{value:"results",children:e.jsx(ts,{result:a})})]})]}),e.jsx(rs,{open:n,onOpenChange:d})]})};export{js as default};
>>>>>>>> 4d77d51 (edits for pizza):Tasks_Front/dist/assets/FinalRatingsPage-4b0SzgQo.js
