import{y as J,j as e,a2 as ee,Z as C,E as se,B as p,at as me,V as he,W as ue,X as ge,Y as T,S as je,a3 as V,ac as pe,an as fe,R as n,a5 as Ne,ai as y,$ as ve,C as u,f as g,I as be,K as W,M as G,N as K,O as X,P as j,U as we,au as Y,c as _,d as I}from"./index-Co4DmRwC.js";import{P as ye,a as Ce,b as L,c as Pe,d as Se,e as ke,f as Ae}from"./pagination-DnjCelUz.js";import{A as De,a as Te,b as _e,c as Ie,d as Ee,e as Fe,f as Me,g as Be}from"./alert-dialog-Oa9zMcQt.js";import{u as Re}from"./filtersStore-BU5eurUr.js";import{T as $e,a as ze,b as Z,c as i,d as Le,e as c}from"./table-Cs0GUHJ9.js";import{B as U}from"./badge-Cyh08Lie.js";import{T as Ue,a as Ve}from"./TaskPriorityBadge-CaU6NAqs.js";import{P as He}from"./play-CB7FJBVh.js";import{E as Oe}from"./ellipsis-Bsjou73H.js";import{E as qe}from"./eye-D3oClCpU.js";import{S as Qe}from"./square-pen-CE52VkCO.js";import{T as We}from"./trash-2-Bmnt7nSb.js";import{S as Ge}from"./search-CtMfcpEt.js";const Ke=({tasks:d,isLoading:r,onDelete:E,onStatusChange:P,assigneesMap:F={}})=>{const{hasPermission:x,hasAnyPermission:M}=J();return r?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,m)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},m))}):d.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tasks found"})}):e.jsx("div",{className:"h-full border border-border rounded-lg bg-card overflow-hidden",children:e.jsxs(ee,{className:"h-full w-full",children:[e.jsxs($e,{className:"w-full",children:[e.jsx(ze,{children:e.jsxs(Z,{className:"border-border sticky top-0 z-10 bg-card",children:[e.jsx(i,{className:"text-foreground",children:"Task"}),e.jsx(i,{className:"text-foreground",children:"Status"}),e.jsx(i,{className:"text-foreground",children:"Priority"}),e.jsx(i,{className:"text-foreground",children:"Assignees"}),e.jsx(i,{className:"text-foreground",children:"Project"}),e.jsx(i,{className:"text-foreground",children:"Latest Rating"}),e.jsx(i,{className:"text-foreground",children:"Due Date"}),e.jsx(i,{className:"text-foreground",children:"Subtasks"}),e.jsx(i,{className:"text-foreground w-[260px]",children:"Actions"})]})}),e.jsx(Le,{children:d.map(a=>{const m=x("view tasks"),f=x("edit tasks"),N=x("delete tasks"),S=M(["create task ratings","edit task ratings"]),B=m||f||N||S,h=(a.assigned_users||[]).map(t=>({id:t.id,name:t.name??void 0,email:t.email??void 0,percentage:t.pivot?.percentage})),R=F[a.id]||[],v=h.length?h:R;return e.jsxs(Z,{className:"border-border hover:bg-accent/50",children:[e.jsx(c,{children:e.jsx("div",{className:"space-y-1",children:e.jsx(C,{to:`/tasks/${a.id}`,className:"text-sm font-medium text-foreground hover:text-primary hover:underline",children:a.name})})}),e.jsx(c,{children:e.jsx(Ue,{status:a.status})}),e.jsx(c,{children:e.jsx(Ve,{priority:a.priority})}),e.jsx(c,{children:v.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:v.map(t=>e.jsxs(U,{variant:"outline",className:"text-xs",children:[t.name||t.email||`User #${t.id}`,typeof t.percentage=="number"?` · ${t.percentage}%`:""]},t.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(c,{children:e.jsx("span",{className:"text-sm text-foreground",children:a.project?.name||a.section?.project?.name||"—"})}),e.jsx(c,{children:a.latest_final_rating!=null?e.jsxs(U,{variant:"secondary",className:"text-xs",children:[Number(a.latest_final_rating).toFixed(1),"%"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(se,{className:"w-4 h-4"}),new Date(a.due_date).toLocaleDateString()]})}),e.jsx(c,{children:e.jsxs(U,{variant:"secondary",className:"text-xs",children:[a.subtasks?.length||0," subtasks"]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{size:"sm",variant:"secondary",className:"h-8",onClick:()=>P(a.id,"in_progress"),disabled:a.status==="in_progress"||a.status==="rated",title:"Mark In Progress",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(p,{size:"sm",className:"h-8",onClick:()=>P(a.id,"done"),disabled:a.status==="done"||a.status==="rated",title:"Mark Complete",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),B&&e.jsxs(he,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(p,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",title:"More actions",children:e.jsx(Oe,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",className:"bg-popover border-border",children:[m&&e.jsx(T,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"View"]})}),f&&e.jsx(T,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/tasks/${a.id}/edit`,className:"flex items-center",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Edit"]})}),S&&e.jsx(T,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/ratings/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Rate Task"]})}),N&&e.jsxs(T,{onClick:()=>E(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(We,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},a.id)})})]}),e.jsx(V,{orientation:"vertical"}),e.jsx(V,{orientation:"horizontal"})]})})},Xe=15,ds=()=>{const{tasks:d,pagination:r,isLoading:E,deleteTask:P,updateTaskStatus:F,fetchTasks:x,goToPage:M,nextPage:a,prevPage:m}=pe(),{searchQuery:f,statusFilter:N,setSearchQuery:S,setStatusFilter:B}=Re(),{hasPermission:h}=J(),{projects:R,fetchProjects:v}=fe(),[t,ae]=n.useState("all"),[b,H]=n.useState([]),[k,O]=n.useState(""),[A,q]=n.useState(""),[re,te]=n.useState([]),[le,Q]=n.useState(!1),[$,w]=n.useState(null);n.useEffect(()=>{v(),(async()=>{try{const s=await Ne.getUsers(1,200);s.success&&Array.isArray(s.data)&&te(s.data)}catch{}})()},[v]);const D=n.useMemo(()=>({status:N,project_id:t,assignees:b,due_from:k||void 0,due_to:A||void 0,search:f||void 0,per_page:Xe}),[N,t,b,k,A,f]);n.useEffect(()=>{x(1,D)},[D]);const ne=s=>H(l=>l.includes(s)?l.filter(o=>o!==s):[...l,s]),ie=()=>H([]),ce=()=>{if(!r)return[];const{current_page:s,last_page:l}=r,o=[];s>3&&(o.push(1),s>4&&o.push("ellipsis-start"));for(let z=Math.max(1,s-2);z<=Math.min(l,s+2);z++)o.push(z);return s<l-2&&(s<l-3&&o.push("ellipsis-end"),o.push(l)),o},oe=async s=>{h("delete tasks")&&w(s)},de=async()=>{if(!h("delete tasks")){w(null);return}$!=null&&(await P($),w(null),r&&x(r.current_page,D))},xe=async(s,l)=>{h("view tasks")&&(await F(s,{status:l}),r&&x(r.current_page,D))};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your tasks and track progress"})]})]}),h("create tasks")&&e.jsx(p,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(C,{to:"/tasks/create",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"New Task"]})})]}),e.jsx(u,{className:"bg-card border-border",children:e.jsxs(g,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(be,{placeholder:"Search tasks, projects, assignees, IDs…",value:f,onChange:s=>S(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsxs(W,{value:N,onValueChange:B,children:[e.jsx(G,{children:e.jsx(K,{placeholder:"Filter by status"})}),e.jsxs(X,{children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"in_progress",children:"In Progress"}),e.jsx(j,{value:"done",children:"Done"}),e.jsx(j,{value:"rated",children:"Rated"})]})]}),e.jsxs(W,{value:t==="all"?"all":String(t),onValueChange:s=>ae(s==="all"?"all":Number(s)),children:[e.jsx(G,{children:e.jsx(K,{placeholder:"Project"})}),e.jsxs(X,{children:[e.jsx(j,{value:"all",children:"All Projects"}),R.map(s=>e.jsx(j,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(p,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>Q(s=>!s),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),b.length?`${b.length} assignee(s)`:"Filter assignees"]}),le&&e.jsxs("div",{className:"absolute z-20 mt-2 w-full rounded-md border bg-popover p-2 shadow",onMouseLeave:()=>Q(!1),children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Assignees"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:ie,children:"Clear"})]}),e.jsxs(ee,{className:"max-h-64",children:[e.jsx("div",{className:"space-y-1 pr-2",children:re.map(s=>{const l=b.includes(s.id);return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-accent cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>ne(s.id)}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id)})}),e.jsx(V,{orientation:"vertical"})]})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(Y,{id:"due_from",name:"due_from",value:k,onChange:O,className:"min-w-[140px]"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"to"}),e.jsx(Y,{id:"due_to",name:"due_to",value:A,onChange:q,className:"min-w-[140px]"}),(k||A)&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{O(""),q("")},children:"Clear"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered)"}),e.jsx(y,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total??0})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.status==="in_progress").length})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Completed (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.status==="done").length})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(_,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"High Priority (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.priority==="high"||s.priority==="critical").length})})]})]}),e.jsx(u,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(g,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ke,{tasks:d,isLoading:E,onDelete:async s=>{await oe(s)},onStatusChange:async(s,l)=>{await xe(s,l)}})})})}),r&&r.last_page>1&&e.jsx(u,{className:"bg-card border-border",children:e.jsx(g,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total||0," results"]}),e.jsx(ye,{children:e.jsxs(Ce,{children:[e.jsx(L,{children:e.jsx(Pe,{onClick:m,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),ce().map((s,l)=>e.jsx(L,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(Se,{}):e.jsx(ke,{onClick:()=>M(s),isActive:r.current_page===s,className:"cursor-pointer",children:s})},l)),e.jsx(L,{children:e.jsx(Ae,{onClick:a,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsx(De,{open:$!==null,onOpenChange:s=>!s&&w(null),children:e.jsxs(Te,{className:"sm:max-w-[480px]",children:[e.jsxs(_e,{children:[e.jsx(Ie,{children:"Delete task"}),e.jsx(Ee,{children:"Are you sure you want to delete this task? This action cannot be undone."})]}),e.jsxs(Fe,{children:[e.jsx(Me,{onClick:()=>w(null),children:"Cancel"}),e.jsx(Be,{onClick:de,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{ds as default};
