import{r as G,a as J,b as K,aO as X,au as M,j as e,F as Y,c as o,d as c,e as l,f as d,I as p,g as u,W as A,N as C,O as S,P as F,Q as R,V as i,B as b,L as Z,o as N,s as m,aq as L,av as q,aP as ee,ap as se,a8 as O,aQ as ae,H as w}from"./index-DswDhpz2.js";import{C as f,a as T,b as V,d as v}from"./card-DHEPJeJJ.js";import{C as re}from"./checkbox-Cppt1Y-V.js";import{S as te}from"./settings-BmT1BLEV.js";import{P as $}from"./plus-CCocBn2e.js";import{T as E}from"./trash-2-JR_tJt8Y.js";const H={TaskRating:["task_id","rater_id","rating_data","final_rating","config_snapshot","rated_at","created_at","updated_at"],StakeholderRating:["project_id","stakeholder_id","rating_data","final_rating","config_snapshot","rated_at","created_at","updated_at"],Ticket:["title","description","status","type","priority","requester_id","assigned_to","completed_at","created_at","updated_at"],HelpRequest:["description","task_id","requester_id","helper_id","rating","is_completed","completed_at","created_at","updated_at"]},ne=N({name:m().min(1,"Field name is required"),max_value:L().min(1,"Max value must be at least 1"),description:m().optional()}),le=N({name:m().min(1,"Variable name is required"),model:m().min(1,"Model is required"),column:m().min(1,"Column is required"),operation:se(["sum","avg","count","min","max"]),conditions:q(N({column:m(),operator:m(),value:ee()})).optional()}),ie=N({type:ae([w("task_rating"),w("stakeholder_rating")]),name:m().min(1,"Name is required").max(255),description:m().optional(),is_active:O(),fields:q(ne).min(1,"At least one field is required")}),oe=N({type:w("final_rating"),name:m().min(1,"Name is required").max(255),description:m().optional(),is_active:O(),expression:m().min(1,"Expression is required"),variables:q(le).min(1,"At least one variable is required")}),ce=X("type",[ie,oe]),ge=({ratingConfig:x,onSubmit:z,isLoading:t})=>{const I=!!x,[_,P]=G.useState(x?.type||"task_rating"),D=s=>{const a={name:x?.name||"",description:x?.description||"",is_active:x?.is_active??!1};if(s==="final_rating"){if(x&&x.type==="final_rating"){const n=x.config_data;return{type:"final_rating",...a,expression:n.expression||"",variables:n.variables||[{name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}]}}return{type:"final_rating",...a,expression:"",variables:[{name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}]}}else{if(x&&x.type!=="final_rating"){const n=x.config_data;return{type:s,...a,fields:n.fields||[{name:"",max_value:50,description:""}]}}return{type:s,...a,fields:[{name:"",max_value:50,description:""}]}}},r=J({resolver:K(ce),defaultValues:D(_),mode:"onSubmit"}),k=M({control:r.control,name:"fields"}),y=M({control:r.control,name:"variables"}),U=r.watch("variables")||[],B=async s=>{console.log("âœ… Form validation passed, submitting:",s);let a;s.type==="final_rating"?a={expression:s.expression,variables:s.variables}:a={fields:s.fields};const n={name:s.name,description:s.description,type:s.type,config_data:a,is_active:s.is_active};await z(n)},Q=s=>{console.log("ðŸ”„ Changing type from",_,"to",s),P(s);const a=D(s);r.reset(a)},W=(s,a)=>{const j=(H[a]||[])[0]||"";r.setValue(`variables.${s}.model`,a),r.setValue(`variables.${s}.column`,j)};return e.jsx(Y,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(B,s=>{console.log("âŒ Form validation errors:",s)}),className:"space-y-6",children:[e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsxs(V,{className:"text-foreground flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Basic Information"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(o,{control:r.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Name"}),e.jsx(d,{children:e.jsx(p,{placeholder:"Enter configuration name",...s,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Description"}),e.jsx(d,{children:e.jsx(A,{placeholder:"Enter configuration description (optional)",...s,disabled:t,className:"bg-background border-input text-foreground",rows:3})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:r.control,name:"type",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Type"}),e.jsxs(C,{onValueChange:Q,value:s.value,disabled:t,children:[e.jsx(d,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select configuration type"})})}),e.jsxs(R,{children:[e.jsx(i,{value:"task_rating",children:"Task Rating"}),e.jsx(i,{value:"stakeholder_rating",children:"Stakeholder Rating"}),e.jsx(i,{value:"final_rating",children:"Final Rating"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:"is_active",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 mt-8",children:[e.jsx(d,{children:e.jsx(re,{checked:s.value,onCheckedChange:s.onChange,disabled:t})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(l,{className:"text-foreground",children:"Active Configuration"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set as the active configuration for this type"})]})]})})]})]})]}),_==="final_rating"?e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsx(V,{className:"text-foreground",children:"Final Rating Formula"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(o,{control:r.control,name:"expression",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Formula Expression"}),e.jsx(d,{children:e.jsx(p,{placeholder:"e.g., (task_avg + stakeholder_avg) * tickets_bonus / penalty_factor",...s,disabled:t,className:"bg-background border-input text-foreground font-mono"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use variable names defined below in your mathematical expression"}),e.jsx(u,{className:"text-destructive"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(l,{className:"text-foreground",children:"Variables"}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:()=>y.append({name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}),disabled:t,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add Variable"]})]}),y.fields.map((s,a)=>{const n=U[a]?.model||"TaskRating",j=H[n]||[];return e.jsx(f,{className:"mb-4 bg-accent/20",children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground",children:["Variable ",a+1]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>y.remove(a),disabled:t||y.fields.length<=1,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:r.control,name:`variables.${a}.name`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Variable Name"}),e.jsx(d,{children:e.jsx(p,{placeholder:"e.g., task_avg",...h,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:`variables.${a}.operation`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Operation"}),e.jsxs(C,{onValueChange:h.onChange,value:h.value,disabled:t,children:[e.jsx(d,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{})})}),e.jsxs(R,{children:[e.jsx(i,{value:"sum",children:"Sum"}),e.jsx(i,{value:"avg",children:"Average"}),e.jsx(i,{value:"count",children:"Count"}),e.jsx(i,{value:"min",children:"Minimum"}),e.jsx(i,{value:"max",children:"Maximum"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:`variables.${a}.model`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Model"}),e.jsxs(C,{onValueChange:g=>W(a,g),value:h.value,disabled:t,children:[e.jsx(d,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select model"})})}),e.jsxs(R,{children:[e.jsx(i,{value:"TaskRating",children:"TaskRating"}),e.jsx(i,{value:"StakeholderRating",children:"StakeholderRating"}),e.jsx(i,{value:"Ticket",children:"Ticket"}),e.jsx(i,{value:"HelpRequest",children:"HelpRequest"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:`variables.${a}.column`,render:({field:h})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Column"}),e.jsxs(C,{onValueChange:h.onChange,value:h.value,disabled:t,children:[e.jsx(d,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select column"})})}),e.jsx(R,{children:j.map(g=>e.jsx(i,{value:g,children:g},g))})]}),e.jsx(u,{className:"text-destructive"})]})})]})]})},s.id)})]})]})]}):e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsx(V,{className:"text-foreground",children:"Rating Fields"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Define the fields that will be used for ",_.replace("_"," ")]}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:()=>k.append({name:"",max_value:50,description:""}),disabled:t,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Add Field"]})]}),k.fields.map((s,a)=>e.jsx(f,{className:"bg-accent/20",children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground",children:["Field ",a+1]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>k.remove(a),disabled:t||k.fields.length<=1,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{control:r.control,name:`fields.${a}.name`,render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Field Name"}),e.jsx(d,{children:e.jsx(p,{placeholder:"e.g., Code Cleanliness",...n,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:`fields.${a}.description`,render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Description"}),e.jsx(d,{children:e.jsx(A,{placeholder:"Describe what this field measures...",...n,disabled:t,className:"bg-background border-input text-foreground",rows:2})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(o,{control:r.control,name:`fields.${a}.max_value`,render:({field:n})=>e.jsxs(c,{children:[e.jsx(l,{className:"text-foreground",children:"Max Value"}),e.jsx(d,{children:e.jsx(p,{type:"number",placeholder:"50",...n,onChange:j=>n.onChange(Number(j.target.value)),disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})})]})]})},s.id))]})]}),e.jsxs(b,{type:"submit",disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),I?"Update Configuration":"Create Configuration"]})]})})};export{ge as R};
