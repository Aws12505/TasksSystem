import{g as q,R as y,y as K,j as e,S as A,C as d,c as p,d as v,ai as b,f as o,K as E,M as I,N as O,O as Y,P as D,B as t,a6 as w,U as B,I as U,a2 as F,a3 as H}from"./index-DrMenJXL.js";import{T as W,a as G,b as X,c as Z}from"./tabs-DoTn38NQ.js";import{B as r}from"./badge-CXd3393S.js";import{u as ee}from"./ratingsStore-zWhajgmq.js";import{S as $}from"./search-CZfQ6JL4.js";import{E as J}from"./eye-Cnzsz-tQ.js";import{C as se}from"./circle-alert-TCTDUJeR.js";import"./ratingConfigService-CldmkKA_.js";const ae=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],M=q("arrow-right",ae),te=()=>{const{taskRatings:l,stakeholderRatings:L,taskRatingConfigs:m,stakeholderRatingConfigs:S,availableTasks:x,availableProjects:R,taskRatingsPagination:h,stakeholderRatingsPagination:T,isLoading:i,error:n,fetchTaskRatings:g,fetchStakeholderRatings:j,fetchTaskRatingConfigs:c,fetchStakeholderRatingConfigs:C,fetchAvailableTasks:f,fetchAvailableProjects:u,createTaskRating:_,updateTaskRating:P,createStakeholderRating:N,updateStakeholderRating:s}=ee();return y.useEffect(()=>{m.length||c(),S.length||C(),x.length||f(),R.length||u()},[m.length,S.length,x.length,R.length,c,C,f,u]),{taskRatings:l,stakeholderRatings:L,taskRatingConfigs:m,stakeholderRatingConfigs:S,availableTasks:x,availableProjects:R,taskRatingsPagination:h,stakeholderRatingsPagination:T,isLoading:i,error:n,fetchTaskRatings:g,fetchStakeholderRatings:j,createTaskRating:_,updateTaskRating:P,createStakeholderRating:N,updateStakeholderRating:s}},xe=()=>{const[l,L]=y.useState(""),[m,S]=y.useState(""),[x,R]=y.useState(""),[h,T]=y.useState({tasks:[],projects:[]}),{availableTasks:i,availableProjects:n}=te(),{hasAnyPermission:g}=K(),j=g(["create task ratings","edit task ratings"]),c=g(["create stakeholder ratings","edit stakeholder ratings"]);y.useEffect(()=>{const s=localStorage.getItem("ratings_recently_viewed");s&&T(JSON.parse(s))},[]);const C=(s,a,Q)=>{const V={id:a,name:Q,viewedAt:new Date().toISOString()},k={...h};s==="task"?k.tasks=[V,...k.tasks.filter(z=>z.id!==a)].slice(0,5):k.projects=[V,...k.projects.filter(z=>z.id!==a)].slice(0,5),T(k),localStorage.setItem("ratings_recently_viewed",JSON.stringify(k))},f=(s,a)=>{j&&(C("task",s,a),window.open(`/ratings/tasks/${s}`,"_blank"))},u=(s,a)=>{c&&(C("project",s,a),window.open(`/ratings/projects/${s}/stakeholder`,"_blank"))},_=i.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.description?.toLowerCase().includes(l.toLowerCase())),P=n.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.description?.toLowerCase().includes(l.toLowerCase())),N=({message:s})=>e.jsx(d,{className:"bg-card border-border",children:e.jsxs(o,{className:"p-6 text-center",children:[e.jsx(se,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:s})]})});return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Ratings Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Performance evaluation and rating management system"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[j?e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-foreground flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Task Ratings"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Select Task"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{value:m,onValueChange:S,children:[e.jsx(I,{className:"flex-1",children:e.jsx(O,{placeholder:"Choose a task..."})}),e.jsx(Y,{className:"max-h-60",children:_.map(s=>e.jsx(D,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(r,{variant:"secondary",className:"text-xs",children:["Weight: ",s.weight]})]})]})]})},s.id))})]}),e.jsxs(t,{disabled:!m,onClick:()=>{const s=i.find(a=>a.id.toString()===m);s&&f(s.id,s.name)},className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Rate"]})]})]}),h.tasks.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Recently Rated"}),e.jsx("div",{className:"space-y-2",children:h.tasks.map(s=>e.jsxs(t,{variant:"outline",size:"sm",className:"w-full justify-between text-left",onClick:()=>f(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),s.name]}),e.jsx(M,{className:"w-4 h-4"})]},s.id))})]})]})]}):e.jsx(N,{message:"You don't have permission to create or edit task ratings"}),c?e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Stakeholder Ratings"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Select Project"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(E,{value:x,onValueChange:R,children:[e.jsx(I,{className:"flex-1",children:e.jsx(O,{placeholder:"Choose a project..."})}),e.jsx(Y,{className:"max-h-60",children:P.filter(s=>s.stakeholder_will_rate).map(s=>e.jsx(D,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-primary"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(r,{variant:"secondary",className:"text-xs",children:[s.progress_percentage,"% complete"]})]})]})]})},s.id))})]}),e.jsxs(t,{disabled:!x,onClick:()=>{const s=n.find(a=>a.id.toString()===x);s&&u(s.id,s.name)},className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Rate"]})]})]}),h.projects.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-foreground",children:"Recently Rated"}),e.jsx("div",{className:"space-y-2",children:h.projects.map(s=>e.jsxs(t,{variant:"outline",size:"sm",className:"w-full justify-between text-left",onClick:()=>u(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),s.name]}),e.jsx(M,{className:"w-4 h-4"})]},s.id))})]})]})]}):e.jsx(N,{message:"You don't have permission to create or edit stakeholder ratings"}),g(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])?e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-foreground flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Quick Search"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(U,{placeholder:"Search tasks or projects...",value:l,onChange:s=>L(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),l&&e.jsxs(F,{className:"max-h-60",children:[e.jsxs("div",{className:"space-y-3 pr-2",children:[j&&e.jsxs("div",{children:[e.jsx("h6",{className:"text-xs font-medium text-muted-foreground mb-2",children:"TASKS"}),_.slice(0,3).map(s=>e.jsxs(t,{variant:"outline",size:"sm",className:"w-full justify-between text-left mb-2",onClick:()=>f(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:s.name}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Task"})]})]}),e.jsx(A,{className:"w-4 h-4"})]},`task-${s.id}`))]}),c&&e.jsxs("div",{children:[e.jsx("h6",{className:"text-xs font-medium text-muted-foreground mb-2",children:"PROJECTS"}),P.filter(s=>s.stakeholder_will_rate).slice(0,3).map(s=>e.jsxs(t,{variant:"outline",size:"sm",className:"w-full justify-between text-left mb-2",onClick:()=>u(s.id,s.name),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-xs",children:s.name}),e.jsx(r,{variant:"secondary",className:"text-xs",children:"Project"})]})]}),e.jsx(B,{className:"w-4 h-4"})]},`project-${s.id}`))]})]}),e.jsx(H,{orientation:"vertical"})]})]})]}):e.jsx(N,{message:"You don't have permission to rate tasks or stakeholders"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(d,{className:"bg-card border-border",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:"Available Tasks"}),e.jsx(b,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j?i.length:"—"})})]}),e.jsxs(d,{className:"bg-card border-border",children:[e.jsxs(p,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(v,{className:"text-sm font-medium text-muted-foreground",children:"Available Projects"}),e.jsx(w,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:c?n.filter(s=>s.stakeholder_will_rate).length:"—"})})]})]}),e.jsxs(W,{defaultValue:"browse",className:"space-y-4",children:[e.jsx(G,{className:"bg-muted",children:g(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])&&e.jsx(X,{value:"browse",children:"Browse Ratings"})}),g(["create task ratings","edit task ratings","create stakeholder ratings","edit stakeholder ratings"])&&e.jsx(Z,{value:"browse",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[j?e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-foreground flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),"Browse Tasks"]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[i.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(r,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(r,{variant:"secondary",className:"text-xs",children:["Due: ",new Date(s.due_date).toLocaleDateString()]})]})]})]}),e.jsxs(t,{size:"sm",onClick:()=>f(s.id,s.name),children:[e.jsx(A,{className:"w-4 h-4 mr-1"}),"Rate"]})]},s.id)),i.length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"View All Tasks (",i.length,")"]})})]})})]}):e.jsx(N,{message:"You don't have permission to rate tasks"}),c?e.jsxs(d,{className:"bg-card border-border",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-foreground flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5"}),"Browse Projects"]})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[n.filter(s=>s.stakeholder_will_rate).slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:s.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(r,{variant:"outline",className:"text-xs",children:s.status}),e.jsxs(r,{variant:"secondary",className:"text-xs",children:[s.progress_percentage,"% complete"]})]})]})]}),e.jsxs(t,{size:"sm",onClick:()=>u(s.id,s.name),children:[e.jsx(B,{className:"w-4 h-4 mr-1"}),"Rate"]})]},s.id)),n.filter(s=>s.stakeholder_will_rate).length>5&&e.jsx("div",{className:"text-center pt-4",children:e.jsxs(t,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"View All Projects (",n.filter(s=>s.stakeholder_will_rate).length,")"]})})]})})]}):e.jsx(N,{message:"You don't have permission to rate stakeholders"})]})})]})]})})};export{xe as default};
