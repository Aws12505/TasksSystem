import{r as v,a as b,b as R,o as y,j as e,U as N,F as C,aF as k,d as S,e as _,f as w,I as P,g as D,B as F,L as I,aH as E,ah as B,s as H,y as L}from"./index-DVPQua6C.js";import{C as j,a as M,b as T,d as p}from"./card-Chf90Mg7.js";import{u as U}from"./ratingsStore-BQml-5N7.js";import{S as V,R as A}from"./RatingDisplay-CCGBLkZb.js";import"./ratingConfigService-CboAdWmN.js";import"./badge-B3kg6diS.js";import"./progress-COQSRJkg.js";import"./calendar-Dq9Hg-h_.js";const O=n=>{const{stakeholderRatings:o,stakeholderRatingConfigs:m,stakeholderRatingsPagination:i,isLoading:c,error:l,fetchStakeholderRatings:r,fetchStakeholderRatingConfigs:t,createStakeholderRating:x,updateStakeholderRating:h}=U(),d=typeof n=="string"?parseInt(n):n;return v.useEffect(()=>{d&&(r(d),t())},[d,r,t]),{stakeholderRatings:o,stakeholderRatingConfigs:m,pagination:i,isLoading:c,error:l,createRating:g=>x({...g,project_id:d}),updateRating:(g,a)=>h(g,a),refreshRatings:()=>r(d)}},$=y({rating_data:E(H(),B().min(0).max(100))}),q=({projectId:n,config:o,onSubmit:m,isLoading:i})=>{const c=o.config_data,l=c.fields.reduce((a,s)=>(a[s.name]=0,a),{}),r=b({resolver:R($),defaultValues:{rating_data:l}}),t=async a=>{const s={project_id:n,rating_data:a.rating_data};await m(s)},x=r.watch("rating_data"),h=Object.values(x||{}).reduce((a,s)=>a+(s||0),0),d=c.fields.reduce((a,s)=>a+s.max_value,0),g=d>0?Math.round(h/d*100):0;return e.jsxs(j,{className:"bg-card border-border",children:[e.jsx(M,{children:e.jsxs(T,{className:"text-foreground flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Stakeholder Rating - ",o.name]})}),e.jsx(p,{children:e.jsx(C,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(t),className:"space-y-6",children:[e.jsx("div",{className:"space-y-6",children:c.fields.map(a=>e.jsx("div",{children:e.jsx(k,{name:`rating_data.${a.name}`,control:r.control,render:({field:s,fieldState:f})=>e.jsxs(S,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(_,{className:"text-foreground",children:a.name}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.value||0," / ",a.max_value]})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(V,{value:[s.value||0],onValueChange:u=>s.onChange(u[0]),max:a.max_value,step:1,className:"flex-1",disabled:i}),e.jsx(P,{type:"number",min:0,max:a.max_value,value:s.value||0,onChange:u=>s.onChange(Number(u.target.value)),disabled:i,className:"w-24 text-center"})]})}),f.error&&e.jsx(D,{className:"text-destructive",children:f.error.message})]})})},a.name))}),e.jsx("div",{className:"p-4 bg-accent/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Total Rating"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[g,"%"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h," / ",d]})]})]})}),e.jsxs(F,{type:"submit",disabled:i,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Rating"]})]})})})]})},Z=()=>{const{projectId:n}=L(),{stakeholderRatings:o,stakeholderRatingConfigs:m,isLoading:i,createRating:c}=O(n),l=m.find(t=>t.is_active),r=async t=>{await c(t)};return n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:"Stakeholder Ratings"}),e.jsx("p",{className:"text-muted-foreground",children:"Project evaluation from stakeholder perspective"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:l?e.jsx(q,{projectId:parseInt(n),config:l,onSubmit:r,isLoading:i}):e.jsx(j,{className:"bg-card border-border",children:e.jsx(p,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No active stakeholder rating configuration found"})})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Previous Ratings"}),i?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,x)=>e.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},x))}):o.length===0?e.jsx(j,{className:"bg-card border-border",children:e.jsx(p,{className:"p-6 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No ratings yet for this project"})})}):e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsx(A,{rating:t},t.id))})]})]})]}):e.jsx("div",{children:"Project not found"})};export{Z as default};
