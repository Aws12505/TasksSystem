import{g as ne,j as e,a as G,b as J,o as Q,_ as v,I as R,a7 as ee,K as D,M as k,N as w,O as S,P as c,B as A,az as U,L as se,s as E,aN as te,aM as V,x as I}from"./index-ClQ2iEwo.js";import{F as re,a as m,b as x,c as d,d as u,e as h}from"./form-BWu5y93Z.js";import{F as W}from"./file-D03lJ9FR.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],ae=ne("upload",le),ie=5*1024*1024,oe=["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/csv","video/mp4","video/x-msvideo","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],T=["jpg","jpeg","png","pdf","doc","docx","csv","mp4","avi","xlsx","xls"],ce=a=>Q({title:E().min(1,"Title is required").max(255),description:E().min(1,"Description is required"),type:V(["quick_fix","bug_investigation","user_support"]),priority:V(["low","medium","high","critical"]),assigned_to:te().optional(),requester_name:a?E().min(1,"Your name is required").max(255):E().max(255).optional()}),de=Q({title:E().min(1,"Title is required").max(255),description:E().min(1,"Description is required"),type:V(["quick_fix","bug_investigation","user_support"]),priority:V(["low","medium","high","critical"]),status:V(["open","in_progress","resolved"]).optional(),assigned_to:te().optional(),requester_name:E().max(255).optional()}),O=a=>{if(a.size>ie)return I.error(`File "${a.name}" exceeds 5MB limit`),!1;const p=a.name.split(".").pop()?.toLowerCase();return!p||!T.includes(p)?(I.error(`File "${a.name}" has invalid type. Allowed: ${T.join(", ")}`),!1):!oe.includes(a.type)&&a.type!==""?(I.error(`File "${a.name}" has invalid MIME type`),!1):!0},Z=a=>{if(a===0)return"0 Bytes";const p=1024,N=["Bytes","KB","MB"],i=Math.floor(Math.log(a)/Math.log(p));return Math.round(a/Math.pow(p,i)*100)/100+" "+N[i]},me=({availableUsers:a,typeOptions:p,onSubmit:N,isLoading:i,isAuthenticated:l})=>{const C=v.useMemo(()=>ce(!l),[l]),o=G({resolver:J(C),defaultValues:{title:"",description:"",type:"quick_fix",priority:"medium",assigned_to:void 0,requester_name:""}}),[g,_]=v.useState([]),[F,M]=v.useState(!1),P=v.useRef(null),q=t=>{if(!t)return;const n=[];Array.from(t).forEach(f=>{O(f)&&n.push(f)}),_(f=>[...f,...n])},z=t=>{t.preventDefault(),t.stopPropagation(),M(!0)},$=t=>{t.preventDefault(),t.stopPropagation(),M(!1)},Y=t=>{t.preventDefault(),t.stopPropagation()},H=t=>{t.preventDefault(),t.stopPropagation(),M(!1);const n=t.dataTransfer.files;q(n)};v.useEffect(()=>{const t=n=>{const f=n.clipboardData?.items;if(!f)return;const b=[];Array.from(f).forEach(s=>{if(s.kind==="file"){const r=s.getAsFile();r&&O(r)&&b.push(r)}}),b.length>0&&(_(s=>[...s,...b]),I.success(`${b.length} file(s) added from clipboard`))};return document.addEventListener("paste",t),()=>document.removeEventListener("paste",t)},[]);const X=t=>{_(n=>n.filter((f,b)=>b!==t))},K=async t=>{const n={title:t.title,description:t.description,type:t.type,priority:t.priority,assigned_to:t.assigned_to,...t.requester_name?{requester_name:t.requester_name}:{},attachments:g.length>0?g:void 0};await N(n)};return e.jsx(re,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(K),className:"space-y-6",children:[e.jsx(m,{control:o.control,name:"title",render:({field:t})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Title"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter ticket title",...t,disabled:i,className:"bg-background border-input text-foreground"})}),e.jsx(h,{className:"text-destructive"})]})}),e.jsx(m,{control:o.control,name:"description",render:({field:t})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Description"}),e.jsx(u,{children:e.jsx(ee,{placeholder:"Describe the issue or request...",...t,disabled:i,className:"bg-background border-input text-foreground",rows:4})}),e.jsx(h,{className:"text-destructive"})]})}),!l&&e.jsx(m,{control:o.control,name:"requester_name",render:({field:t})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Your name"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter your name",...t,disabled:i,className:"bg-background border-input text-foreground"})}),e.jsx(h,{className:"text-destructive"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{control:o.control,name:"type",render:({field:t})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Type"}),e.jsxs(D,{onValueChange:t.onChange,defaultValue:t.value,disabled:i,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Select ticket type"})})}),e.jsx(S,{children:p.map(n=>e.jsx(c,{value:n.value,children:e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{className:"font-medium",children:n.label})})},n.value))})]}),e.jsx(h,{className:"text-destructive"})]})}),e.jsx(m,{control:o.control,name:"priority",render:({field:t})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Priority"}),e.jsxs(D,{onValueChange:t.onChange,defaultValue:t.value,disabled:i,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Select priority"})})}),e.jsxs(S,{children:[e.jsx(c,{value:"low",children:"Low"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"critical",children:"Critical"})]})]}),e.jsx(h,{className:"text-destructive"})]})})]}),l&&e.jsx(m,{control:o.control,name:"assigned_to",render:({field:t})=>e.jsxs(x,{children:[e.jsxs(d,{className:"text-foreground",children:["Assign to"," ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsxs(D,{onValueChange:n=>t.onChange(n==="unassigned"?void 0:Number(n)),value:t.value===void 0?"unassigned":t.value.toString(),disabled:i,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Leave unassigned or select a user"})})}),e.jsxs(S,{children:[e.jsx(c,{value:"unassigned",children:"Leave unassigned"}),a.map(n=>e.jsx(c,{value:n.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:n.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n.email})]})},n.id))]})]}),e.jsx(h,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{className:"text-foreground",children:["Attachments"," ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional, max 5MB per file)"})]}),e.jsxs("div",{onDragEnter:z,onDragLeave:$,onDragOver:Y,onDrop:H,className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${F?"border-primary bg-primary/10":"border-input bg-background"}`,children:[e.jsx("input",{ref:P,type:"file",multiple:!0,accept:T.map(t=>`.${t}`).join(","),onChange:t=>q(t.target.files),className:"hidden",disabled:i}),e.jsx(ae,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-foreground",children:["Drag and drop files here, or"," ",e.jsx("button",{type:"button",onClick:()=>P.current?.click(),className:"text-primary hover:underline font-medium",disabled:i,children:"browse"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can also paste files from clipboard (Ctrl+V)"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Supported: ",T.join(", ")]})]})]}),g.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Attached Files (",g.length,")"]}),e.jsx("div",{className:"space-y-2",children:g.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(W,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z(t.size)})]})]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>X(n),disabled:i,className:"flex-shrink-0 ml-2",children:e.jsx(U,{className:"h-4 w-4"})})]},n))})]})]}),e.jsxs(A,{type:"submit",disabled:i,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Ticket"]})]})})},xe=({ticket:a,availableUsers:p,typeOptions:N,onSubmit:i,isLoading:l,isAuthenticated:C})=>{const o=G({resolver:J(de),defaultValues:{title:a.title,description:a.description,type:a.type,priority:a.priority,status:a.status,assigned_to:a.assigned_to||void 0,requester_name:a.requester_name||""}}),[g,_]=v.useState([]),[F,M]=v.useState(a.attachments||[]),[P,q]=v.useState(!1),z=v.useRef(null),$=s=>{if(!s)return;const r=[];Array.from(s).forEach(j=>{O(j)&&r.push(j)}),_(j=>[...j,...r])},Y=s=>{s.preventDefault(),s.stopPropagation(),q(!0)},H=s=>{s.preventDefault(),s.stopPropagation(),q(!1)},X=s=>{s.preventDefault(),s.stopPropagation()},K=s=>{s.preventDefault(),s.stopPropagation(),q(!1);const r=s.dataTransfer.files;$(r)};v.useEffect(()=>{const s=r=>{const j=r.clipboardData?.items;if(!j)return;const y=[];Array.from(j).forEach(B=>{if(B.kind==="file"){const L=B.getAsFile();L&&O(L)&&y.push(L)}}),y.length>0&&(_(B=>[...B,...y]),I.success(`${y.length} file(s) added from clipboard`))};return document.addEventListener("paste",s),()=>document.removeEventListener("paste",s)},[]);const t=s=>{_(r=>r.filter((j,y)=>y!==s))},n=s=>{M(r=>r.filter((j,y)=>y!==s))},f=async s=>{const r={title:s.title,description:s.description,type:s.type,priority:s.priority,status:s.status,assigned_to:s.assigned_to,requester_name:s.requester_name,attachments:g.length>0?g:void 0,keep_attachments:F.map(j=>j.id)};await i(r)},b=!a.requester;return e.jsx(re,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(f),className:"space-y-6",children:[e.jsx(m,{control:o.control,name:"title",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Title"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter ticket title",...s,disabled:l,className:"bg-background border-input text-foreground"})}),e.jsx(h,{className:"text-destructive"})]})}),e.jsx(m,{control:o.control,name:"description",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Description"}),e.jsx(u,{children:e.jsx(ee,{placeholder:"Describe the issue or request...",...s,disabled:l,className:"bg-background border-input text-foreground",rows:4})}),e.jsx(h,{className:"text-destructive"})]})}),b&&e.jsx(m,{control:o.control,name:"requester_name",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Requester Name"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter requester name",...s,disabled:l,className:"bg-background border-input text-foreground"})}),e.jsx(h,{className:"text-destructive"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(m,{control:o.control,name:"type",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Type"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:l,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Select ticket type"})})}),e.jsx(S,{children:N.map(r=>e.jsx(c,{value:r.value,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.estimatedTime})]})},r.value))})]}),e.jsx(h,{className:"text-destructive"})]})}),e.jsx(m,{control:o.control,name:"priority",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Priority"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:l,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Select priority"})})}),e.jsxs(S,{children:[e.jsx(c,{value:"low",children:"Low"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"high",children:"High"}),e.jsx(c,{value:"critical",children:"Critical"})]})]}),e.jsx(h,{className:"text-destructive"})]})}),e.jsx(m,{control:o.control,name:"status",render:({field:s})=>e.jsxs(x,{children:[e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:l,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Select status"})})}),e.jsxs(S,{children:[e.jsx(c,{value:"open",children:"Open"}),e.jsx(c,{value:"in_progress",children:"In Progress"}),e.jsx(c,{value:"resolved",children:"Resolved"})]})]}),e.jsx(h,{className:"text-destructive"})]})})]}),C&&e.jsx(m,{control:o.control,name:"assigned_to",render:({field:s})=>e.jsxs(x,{children:[e.jsxs(d,{className:"text-foreground",children:["Assign to"," ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional)"})]}),e.jsxs(D,{onValueChange:r=>s.onChange(r==="unassigned"?void 0:Number(r)),value:s.value===void 0?"unassigned":s.value.toString(),disabled:l,children:[e.jsx(u,{children:e.jsx(k,{className:"bg-background border-input text-foreground",children:e.jsx(w,{placeholder:"Leave unassigned or select a user"})})}),e.jsxs(S,{children:[e.jsx(c,{value:"unassigned",children:"Leave unassigned"}),p.map(r=>e.jsx(c,{value:r.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:r.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r.email})]})},r.id))]})]}),e.jsx(h,{className:"text-destructive"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(d,{className:"text-foreground",children:["Attachments"," ",e.jsx("span",{className:"text-xs text-muted-foreground",children:"(optional, max 5MB per file)"})]}),F.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["Existing Attachments (",F.length,")"]}),e.jsx("div",{className:"space-y-2",children:F.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(W,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.file_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z(s.file_size)})]})]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>n(r),disabled:l,className:"flex-shrink-0 ml-2",children:e.jsx(U,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs("div",{onDragEnter:Y,onDragLeave:H,onDragOver:X,onDrop:K,className:`border-2 border-dashed rounded-lg p-6 text-center transition-colors ${P?"border-primary bg-primary/10":"border-input bg-background"}`,children:[e.jsx("input",{ref:z,type:"file",multiple:!0,accept:T.map(s=>`.${s}`).join(","),onChange:s=>$(s.target.files),className:"hidden",disabled:l}),e.jsx(ae,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-foreground",children:["Drag and drop files here, or"," ",e.jsx("button",{type:"button",onClick:()=>z.current?.click(),className:"text-primary hover:underline font-medium",disabled:l,children:"browse"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"You can also paste files from clipboard (Ctrl+V)"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Supported: ",T.join(", ")]})]})]}),g.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-foreground",children:["New Files to Upload (",g.length,")"]}),e.jsx("div",{className:"space-y-2",children:g.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1 min-w-0",children:[e.jsx(W,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Z(s.size)})]})]}),e.jsx(A,{type:"button",variant:"ghost",size:"sm",onClick:()=>t(r),disabled:l,className:"flex-shrink-0 ml-2",children:e.jsx(U,{className:"h-4 w-4"})})]},r))})]})]}),e.jsxs(A,{type:"submit",disabled:l,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[l&&e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Ticket"]})]})})},ge=({ticket:a,availableUsers:p=[],typeOptions:N,onSubmit:i,isLoading:l,isAuthenticated:C})=>a?e.jsx(xe,{ticket:a,availableUsers:p,typeOptions:N,onSubmit:i,isLoading:l,isAuthenticated:C}):e.jsx(me,{availableUsers:p,typeOptions:N,onSubmit:i,isLoading:l,isAuthenticated:C});export{ge as T};
