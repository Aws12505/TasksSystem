import{R as b,j as e,C as x,c as h,d as u,B as C,L as P,f,I as B,a2 as $,a3 as A,a0 as E,D as J,Z as O,a1 as z}from"./index-DGKWiW23.js";import{T as F,a as D,b as y,c as w}from"./tabs-CuakvSoz.js";import{u as I}from"./useUser-akO_i5zV.js";import{u as K}from"./useUsers-PStov3jl.js";import{U as Q}from"./UserForm-nndneS3w.js";import{C as L}from"./checkbox-DwHYlV2V.js";import{B as k}from"./badge-B-0Jsbei.js";import{S as R}from"./save-D16MrZcI.js";import{S as _}from"./search-Ck55xEAL.js";import{U as S}from"./user-BziXo3IO.js";import{A as H}from"./arrow-left-D3wclxtP.js";import{K as V}from"./key-GMMjVIHF.js";import"./usersStore-CrIMUv6i.js";import"./permissionService-BdsGb_AC.js";import"./filtersStore-D3G9_E1J.js";import"./form-BQoQdfZP.js";import"./label-3-GGM7xQ.js";const Z=({userRoles:n,availableRoles:m,onSave:j,isLoading:r=!1})=>{const[l,p]=b.useState(n.map(a=>a.name)),[t,c]=b.useState(!1),d=(a,i)=>{p(o=>i?[...o,a]:o.filter(s=>s!==a))},g=async()=>{c(!0),await j(l),c(!1)},N=JSON.stringify(l.sort())!==JSON.stringify(n.map(a=>a.name).sort());return e.jsxs(x,{className:"bg-card border-border",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-foreground",children:"Roles"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[l.length," selected"]}),N&&e.jsxs(C,{size:"sm",onClick:g,disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(P,{className:"mr-2 h-3 w-3 animate-spin"}),e.jsx(R,{className:"mr-1 h-3 w-3"}),"Save"]})]})]})}),e.jsx(f,{children:r?e.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map((a,i)=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},i))}):e.jsxs("div",{className:"space-y-3",children:[m.map(a=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{id:`role-${a.id}`,checked:l.includes(a.name),onCheckedChange:i=>d(a.name,i),disabled:t}),e.jsx("label",{htmlFor:`role-${a.id}`,className:"text-sm text-foreground cursor-pointer flex-1",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.permissions.length," permissions"]})]})})]},a.id)),m.length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:"No roles available"})]})})]})},q=({userPermissions:n,availablePermissions:m,onSave:j,isLoading:r=!1})=>{const[l,p]=b.useState(n.map(s=>s.name)),[t,c]=b.useState(!1),[d,g]=b.useState(""),N=(s,v)=>{p(U=>v?[...U,s]:U.filter(T=>T!==s))},a=async()=>{c(!0),await j(l),c(!1)},i=m.filter(s=>s.name.toLowerCase().includes(d.toLowerCase())),o=JSON.stringify([...l].sort())!==JSON.stringify([...n.map(s=>s.name)].sort());return e.jsxs(x,{className:"bg-card border-border overflow-hidden",children:[e.jsxs(h,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{className:"text-foreground",children:"Direct Permissions"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",className:"text-xs",children:[l.length," selected"]}),o&&e.jsxs(C,{size:"sm",onClick:a,disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(P,{className:"mr-2 h-3 w-3 animate-spin"}),e.jsx(R,{className:"mr-1 h-3 w-3"}),"Save"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(B,{placeholder:"Search permissions...",value:d,onChange:s=>g(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]})]}),e.jsx(f,{className:"p-0",children:r?e.jsx("div",{className:"space-y-3 p-4",children:Array.from({length:5}).map((s,v)=>e.jsx("div",{className:"h-6 bg-muted animate-pulse rounded"},v))}):e.jsxs($,{className:"h-64",children:[e.jsxs("div",{className:"space-y-3 p-4 pr-6",children:[i.map(s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{id:`permission-${s.id}`,checked:l.includes(s.name),onCheckedChange:v=>N(s.name,v),disabled:t}),e.jsx("label",{htmlFor:`permission-${s.id}`,className:"text-sm text-foreground cursor-pointer flex-1",children:s.name})]},s.id)),i.length===0&&e.jsx("p",{className:"text-muted-foreground text-sm",children:d?"No permissions found matching your search":"No permissions available"})]}),e.jsx(A,{orientation:"vertical"})]})})]})},xe=()=>{const{id:n}=E(),m=J(),{updateUser:j}=K(),{user:r,availableRoles:l,availablePermissions:p,isLoading:t,error:c,syncUserRoles:d,syncUserPermissions:g}=I(n),N=async o=>{if(!r)return;await j(r.id,o)&&m(`/users/${r.id}`)};if(t)return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-muted animate-pulse rounded w-48"}),e.jsx("div",{className:"h-4 bg-muted animate-pulse rounded w-64 mt-2"})]})]}),e.jsx("div",{className:"h-9 w-36 bg-muted animate-pulse rounded"})]}),e.jsxs(x,{className:"bg-card border-border",children:[e.jsx(h,{children:e.jsx(u,{className:"text-foreground",children:"User Profile"})}),e.jsx(f,{children:e.jsx("div",{className:"h-96 bg-muted animate-pulse rounded-lg"})})]})]})});if(c||!r)return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsx("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-destructive",children:c||"User not found"})})})});const a=r.roles||[],i=r.permissions||[];return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(S,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Edit User"}),e.jsxs("p",{className:"text-muted-foreground",children:["Update ",e.jsx("span",{className:"font-medium",children:r.name}),"'s profile and permissions"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(C,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(O,{to:`/users/${n}`,children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Back to User"]})})})]}),e.jsxs(F,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(D,{className:"bg-muted",children:[e.jsxs(y,{value:"profile",className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"Profile"]}),e.jsxs(y,{value:"roles",className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4"}),"Roles"]}),e.jsxs(y,{value:"permissions",className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"Permissions"]})]}),e.jsx(w,{value:"profile",children:e.jsxs(x,{className:"bg-card border-border",children:[e.jsx(h,{children:e.jsx(u,{className:"text-foreground",children:"User Profile"})}),e.jsx(f,{children:e.jsx(Q,{user:r,onSubmit:N,isLoading:!1})})]})}),e.jsx(w,{value:"roles",children:e.jsxs(x,{className:"bg-card border-border",children:[e.jsx(h,{children:e.jsx(u,{className:"text-foreground",children:"Roles"})}),e.jsx(f,{children:e.jsx(Z,{userRoles:a,availableRoles:l,onSave:d,isLoading:!1})})]})}),e.jsx(w,{value:"permissions",children:e.jsxs(x,{className:"bg-card border-border",children:[e.jsx(h,{children:e.jsx(u,{className:"text-foreground",children:"Permissions"})}),e.jsx(f,{children:e.jsx(q,{userPermissions:i,availablePermissions:p,onSave:g,isLoading:!1})})]})})]})]})})};export{xe as default};
