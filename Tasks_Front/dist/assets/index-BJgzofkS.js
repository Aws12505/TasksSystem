import{p as X,j as e,B as p,ad as de,D as xe,w as me,x as he,y as D,z as I,n as ue,Z as ge,a7 as je,r as n,J as pe,S as w,I as U,N as G,O as J,P as Z,Q as K,V as u,U as fe}from"./index-DswDhpz2.js";import{C as g,d as j,a as T,b as _}from"./card-DHEPJeJJ.js";import{P as Ne,a as be,b as V,c as ve,d as ye,e as we,f as Ce}from"./pagination-CC2foofY.js";import{A as Pe,a as Se,b as ke,c as Ae,d as De,e as Te,f as _e,g as Ie}from"./alert-dialog-CiQ5mFiM.js";import{u as Ee}from"./filtersStore-CKo-nj-z.js";import{T as Fe,a as Me,b as W,c as i,d as Be,e as c}from"./table-Cg8n6fLm.js";import{B as $}from"./badge-DzLjXeAx.js";import{T as Le,a as Re}from"./TaskPriorityBadge-vhW6RDcM.js";import{S as ze}from"./scroll-area-BwKpjLxc.js";import{C as Y}from"./calendar-CyIxLDvs.js";import{P as Ue}from"./play-zEqFjueq.js";import{E as Ve}from"./ellipsis-HHEpgaFa.js";import{E as $e}from"./eye-CBRvwtnZ.js";import{S as He}from"./square-pen-DQqsBbkZ.js";import{T as Oe}from"./trash-2-JR_tJt8Y.js";import{P as Qe}from"./plus-CCocBn2e.js";import{S as qe}from"./search-JJls1o8W.js";const Ge=({tasks:d,isLoading:r,onDelete:E,onStatusChange:C,assigneesMap:F={}})=>{const{hasPermission:x,hasAnyPermission:M}=X();return r?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,m)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},m))}):d.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tasks found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsx(Fe,{children:e.jsxs(ze,{children:[e.jsx(Me,{children:e.jsxs(W,{className:"border-border",children:[e.jsx(i,{className:"text-foreground",children:"Task"}),e.jsx(i,{className:"text-foreground",children:"Status"}),e.jsx(i,{className:"text-foreground",children:"Priority"}),e.jsx(i,{className:"text-foreground",children:"Assignees"}),e.jsx(i,{className:"text-foreground",children:"Project"}),e.jsx(i,{className:"text-foreground",children:"Latest Rating"}),e.jsx(i,{className:"text-foreground",children:"Due Date"}),e.jsx(i,{className:"text-foreground",children:"Subtasks"}),e.jsx(i,{className:"text-foreground w-[260px]",children:"Actions"})]})}),e.jsx(Be,{children:d.map(a=>{const m=x("view tasks"),f=x("edit tasks"),N=x("delete tasks"),P=M(["create task ratings","edit task ratings"]),B=m||f||N||P,h=(a.assigned_users||[]).map(t=>({id:t.id,name:t.name??void 0,email:t.email??void 0,percentage:t.pivot?.percentage})),L=F[a.id]||[],b=h.length?h:L;return e.jsxs(W,{className:"border-border hover:bg-accent/50",children:[e.jsx(c,{children:e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.name})})}),e.jsx(c,{children:e.jsx(Le,{status:a.status})}),e.jsx(c,{children:e.jsx(Re,{priority:a.priority})}),e.jsx(c,{children:b.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:b.map(t=>e.jsxs($,{variant:"outline",className:"text-xs",children:[t.name||t.email||`User #${t.id}`,typeof t.percentage=="number"?` · ${t.percentage}%`:""]},t.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(c,{children:e.jsx("span",{className:"text-sm text-foreground",children:a.project?.name||a.section?.project?.name||"—"})}),e.jsx(c,{children:a.latest_final_rating!=null?e.jsxs($,{variant:"secondary",className:"text-xs",children:[Number(a.latest_final_rating).toFixed(1),"%"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Y,{className:"w-4 h-4"}),new Date(a.due_date).toLocaleDateString()]})}),e.jsx(c,{children:e.jsxs($,{variant:"secondary",className:"text-xs",children:[a.subtasks?.length||0," subtasks"]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{size:"sm",variant:"secondary",className:"h-8",onClick:()=>C(a.id,"in_progress"),disabled:a.status==="in_progress"||a.status==="done"||a.status==="rated",title:"Mark In Progress",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(p,{size:"sm",className:"h-8",onClick:()=>C(a.id,"done"),disabled:a.status==="done"||a.status==="rated",title:"Mark Complete",children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),B&&e.jsxs(xe,{children:[e.jsx(me,{asChild:!0,children:e.jsx(p,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",title:"More actions",children:e.jsx(Ve,{className:"h-4 w-4"})})}),e.jsxs(he,{align:"end",className:"bg-popover border-border",children:[m&&e.jsx(D,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(I,{to:`/tasks/${a.id}`,className:"flex items-center",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"View"]})}),f&&e.jsx(D,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(I,{to:`/tasks/${a.id}/edit`,className:"flex items-center",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Edit"]})}),P&&e.jsx(D,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(I,{to:`/ratings/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Rate Task"]})}),N&&e.jsxs(D,{onClick:()=>E(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},a.id)})})]})})})},Je=15,ms=()=>{const{tasks:d,pagination:r,isLoading:E,deleteTask:C,updateTaskStatus:F,fetchTasks:x,goToPage:M,nextPage:a,prevPage:m}=ge(),{searchQuery:f,statusFilter:N,setSearchQuery:P,setStatusFilter:B}=Ee(),{hasPermission:h}=X(),{projects:L,fetchProjects:b}=je(),[t,ee]=n.useState("all"),[v,H]=n.useState([]),[S,O]=n.useState(""),[k,Q]=n.useState(""),[se,ae]=n.useState([]),[re,q]=n.useState(!1),[R,y]=n.useState(null);n.useEffect(()=>{b(),(async()=>{try{const s=await pe.getUsers(1,200);s.success&&Array.isArray(s.data)&&ae(s.data)}catch{}})()},[b]);const A=n.useMemo(()=>({status:N,project_id:t,assignees:v,due_from:S||void 0,due_to:k||void 0,search:f||void 0,per_page:Je}),[N,t,v,S,k,f]);n.useEffect(()=>{x(1,A)},[A]);const te=s=>H(l=>l.includes(s)?l.filter(o=>o!==s):[...l,s]),le=()=>H([]),ne=()=>{if(!r)return[];const{current_page:s,last_page:l}=r,o=[];s>3&&(o.push(1),s>4&&o.push("ellipsis-start"));for(let z=Math.max(1,s-2);z<=Math.min(l,s+2);z++)o.push(z);return s<l-2&&(s<l-3&&o.push("ellipsis-end"),o.push(l)),o},ie=async s=>{h("delete tasks")&&y(s)},ce=async()=>{if(!h("delete tasks")){y(null);return}R!=null&&(await C(R),y(null),r&&x(r.current_page,A))},oe=async(s,l)=>{h("view tasks")&&(await F(s,{status:l}),r&&x(r.current_page,A))};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(w,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your tasks and track progress"})]})]}),h("create tasks")&&e.jsx(p,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(I,{to:"/tasks/create",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"New Task"]})})]}),e.jsx(g,{className:"bg-card border-border",children:e.jsxs(j,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(U,{placeholder:"Search tasks, projects, assignees, IDs…",value:f,onChange:s=>P(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsxs(G,{value:N,onValueChange:B,children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Filter by status"})}),e.jsxs(K,{children:[e.jsx(u,{value:"all",children:"All Status"}),e.jsx(u,{value:"pending",children:"Pending"}),e.jsx(u,{value:"in_progress",children:"In Progress"}),e.jsx(u,{value:"done",children:"Done"}),e.jsx(u,{value:"rated",children:"Rated"})]})]}),e.jsxs(G,{value:t==="all"?"all":String(t),onValueChange:s=>ee(s==="all"?"all":Number(s)),children:[e.jsx(J,{children:e.jsx(Z,{placeholder:"Project"})}),e.jsxs(K,{children:[e.jsx(u,{value:"all",children:"All Projects"}),L.map(s=>e.jsx(u,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(p,{type:"button",variant:"outline",className:"w-full justify-start",onClick:()=>q(s=>!s),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),v.length?`${v.length} assignee(s)`:"Filter assignees"]}),re&&e.jsxs("div",{className:"absolute z-20 mt-2 w-full max-h-64 overflow-auto rounded-md border bg-popover p-2 shadow",onMouseLeave:()=>q(!1),children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Assignees"}),e.jsx(p,{variant:"ghost",size:"sm",onClick:le,children:"Clear"})]}),e.jsx("div",{className:"space-y-1",children:se.map(s=>{const l=v.includes(s.id);return e.jsxs("label",{className:"flex items-center gap-2 px-2 py-1 rounded hover:bg-accent cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>te(s.id)}),e.jsx("span",{className:"text-sm",children:s.name})]},s.id)})})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(U,{type:"date",value:S,onChange:s=>O(s.target.value),className:"min-w-[140px]"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"to"}),e.jsx(U,{type:"date",value:k,onChange:s=>Q(s.target.value),className:"min-w-[140px]"}),(S||k)&&e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{O(""),Q("")},children:"Clear"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(g,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered)"}),e.jsx(w,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total??0})})]}),e.jsxs(g,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(w,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.status==="in_progress").length})})]}),e.jsxs(g,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"Completed (page)"}),e.jsx(w,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.status==="done").length})})]}),e.jsxs(g,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(_,{className:"text-sm font-medium text-muted-foreground",children:"High Priority (page)"}),e.jsx(w,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(j,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:d.filter(s=>s.priority==="high"||s.priority==="critical").length})})]})]}),e.jsx(g,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(j,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Ge,{tasks:d,isLoading:E,onDelete:async s=>{await ie(s)},onStatusChange:async(s,l)=>{await oe(s,l)}})})})}),r&&r.last_page>1&&e.jsx(g,{className:"bg-card border-border",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total||0," results"]}),e.jsx(Ne,{children:e.jsxs(be,{children:[e.jsx(V,{children:e.jsx(ve,{onClick:m,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),ne().map((s,l)=>e.jsx(V,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(ye,{}):e.jsx(we,{onClick:()=>M(s),isActive:r.current_page===s,className:"cursor-pointer",children:s})},l)),e.jsx(V,{children:e.jsx(Ce,{onClick:a,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsx(Pe,{open:R!==null,onOpenChange:s=>!s&&y(null),children:e.jsxs(Se,{className:"sm:max-w-[480px]",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:"Delete task"}),e.jsx(De,{children:"Are you sure you want to delete this task? This action cannot be undone."})]}),e.jsxs(Te,{children:[e.jsx(_e,{onClick:()=>y(null),children:"Cancel"}),e.jsx(Ie,{onClick:ce,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{ms as default};
