import{g as ee,R as o,j as e,C,c as v,d as k,f as y,z as H,aE as se,aG as re,aH as te,aI as ae,bk as B,a7 as ne,bl as ce,B as f,aw as oe,au as T}from"./index-Cj_ZlKJu.js";import{L as N}from"./label-D5sTaFLO.js";import{T as ie,a as le,b as $,c as A}from"./tabs-DmL4XNSD.js";import{u as q,c as b,b as de}from"./clockingCalculations-ByakmvoK.js";import{C as xe,D as me,R as ue,a as he}from"./CorrectionTypeSelector-zxgTyUPI.js";import{B as ge}from"./badge-DE0BUwgy.js";import{C as D}from"./circle-alert-B-dqlWNT.js";import"./table-BldDzxlW.js";import"./user-Ljt4tTFY.js";import"./play-DZnk9Zrp.js";const pe=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],je=ee("funnel",pe),fe=n=>{const{records:c,recordsPagination:r,isLoading:s,isExporting:d,error:a,fetchRecords:x,exportRecords:m,clearError:i}=q();return o.useEffect(()=>{x(n)},[JSON.stringify(n)]),{records:c,pagination:r,isLoading:s,isExporting:d,error:a,refresh:()=>x(n),exportRecords:m,clearError:i}},Ne=()=>{const{pendingCorrections:n,correctionLoading:c,correctionError:r,getPendingCorrections:s,requestCorrection:d,clearCorrectionError:a}=q();return o.useEffect(()=>{s()},[s]),{pendingCorrections:n,isLoading:c,error:r,requestCorrection:d,refresh:s,clearError:a}},be=({corrections:n,companyTimezone:c})=>{const r=n.filter(s=>s.status==="pending");return r.length?e.jsxs(C,{className:"bg-card border-chart-2/50",children:[e.jsx(v,{className:"bg-accent",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(k,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(D,{className:"w-5 h-5 text-chart-2"}),"Pending Corrections (",r.length,")"]})})}),e.jsx(y,{className:"pt-6 space-y-3",children:r.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-chart-2/30 bg-accent space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-chart-2"}),e.jsx("span",{className:"font-medium text-foreground capitalize",children:s.correction_type.replace("_"," ")})]}),e.jsx(ge,{variant:"outline",className:"text-chart-2",children:"Pending"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-foreground",children:"Original:"})," ",b(s.original_time_utc,c)]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-foreground",children:"Requested:"})," ",b(s.requested_time_utc,c)]}),e.jsx("div",{className:"mt-2 p-3 bg-background rounded border border-border",children:e.jsx("p",{className:"text-foreground text-xs",children:s.reason})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Submitted ",new Date(s.created_at).toLocaleDateString()]})]},s.id))})]}):null},_e=({open:n,onOpenChange:c,type:r,session:s,breakRecord:d,companyTimezone:a,onSubmit:x,isLoading:m})=>{const[i,g]=o.useState(""),[h,p]=o.useState(""),E=()=>r==="clock_in"&&s?.clock_in_utc?b(s.clock_in_utc,a):r==="clock_out"&&s?.clock_out_utc?b(s.clock_out_utc,a):r==="break_in"&&d?.break_start_utc?b(d.break_start_utc,a):r==="break_out"&&d?.break_end_utc?b(d.break_end_utc,a):"Not set",_=async()=>{if(!i||!h.trim()||h.length<10)return;const l=de(i,a);await x({clock_session_id:r.includes("clock")?s?.id:void 0,break_record_id:r.includes("break")?d?.id:void 0,correction_type:r,requested_time_utc:l,reason:h.trim()}),g(""),p(""),c(!1)},u=i?i.split("T")[0]:"",j=i&&i.split("T")[1]||"";return e.jsx(se,{open:n,onOpenChange:c,children:e.jsxs(re,{className:"bg-card border-border",children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"text-foreground",children:["Request ",r.replace("_"," ").toUpperCase()," Correction"]}),e.jsxs(B,{className:"text-muted-foreground",children:["Original: ",E()]}),e.jsxs(B,{className:"text-muted-foreground",children:["Enter corrected time in ",a]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"requested_time",className:"text-foreground",children:["Corrected Time (",a,")"]}),e.jsx(xe,{id:"requested_time",name:"requested_time",value:u,onChange:l=>{if(!l)return g("");g(j?`${l}T${j}`:`${l}T00:00`)},timeId:"requested_time_clock",timeName:"requested_time_clock",timeValue:j,onTimeChange:l=>{if(!l)return g(u?`${u}T00:00`:"");g(u?`${u}T${l}`:"")},timeFormat:"hh:mm aa",required:!0,disabled:m,dateLabel:"Date",timeLabel:"Time",className:"border-input text-foreground",timeClassName:"border-input text-foreground",wrapperClassName:"items-start"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter time in ",a]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"reason",className:"text-foreground",children:"Reason (required - min 10 chars)"}),e.jsx(ne,{id:"reason",placeholder:"Explain why you need this correction...",value:h,onChange:l=>p(l.target.value),rows:4,maxLength:500,className:"bg-background border-input text-foreground",disabled:m}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[h.length,"/500"]})]})]}),e.jsxs(ce,{children:[e.jsx(f,{variant:"outline",onClick:()=>c(!1),disabled:m,children:"Cancel"}),e.jsx(f,{onClick:_,disabled:m||!i||h.length<10,className:"bg-primary hover:bg-primary/90",children:m?"Submitting...":"Submit Request"})]})]})})},qe=()=>{const[n,c]=o.useState({per_page:15}),[r,s]=o.useState(!1),[d,a]=o.useState(!1),[x,m]=o.useState({start_date:"",end_date:""}),{records:i,pagination:g,isLoading:h,isExporting:p,exportRecords:E}=fe(n),{companyTimezone:_}=q(),{pendingCorrections:u,isLoading:j,requestCorrection:l,refresh:I}=Ne(),[V,F]=o.useState(!1),[S,L]=o.useState(null),[M,R]=o.useState(!1),[U,W]=o.useState("clock_in"),[G,P]=o.useState(null),O=(t,w)=>{c({...n,[t]:w,page:1})},J=()=>{c({per_page:15})},X=t=>{c({...n,page:t})},Y=()=>{const t={start_date:x.start_date||void 0,end_date:x.end_date||void 0};E(t),a(!1)},K=t=>{L(t),F(!0)},Q=(t,w)=>{W(t),w&&S?.break_records&&P(S.break_records.find(z=>z.id===w)),R(!0)},Z=async t=>{await l(t),R(!1),L(null),P(null)};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(H,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Clocking Records"}),e.jsx("p",{className:"text-muted-foreground",children:"View your clocking history"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(f,{variant:"outline",onClick:()=>s(!r),className:"bg-background border-input",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),r?"Hide":"Show"," Filters"]}),e.jsxs(f,{onClick:()=>a(!0),disabled:p||i.length===0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),p?"Exporting...":"Export"]})]})]}),e.jsxs(ie,{defaultValue:"records",className:"space-y-6",children:[e.jsxs(le,{className:"bg-muted",children:[e.jsx($,{value:"records",children:"Records"}),e.jsxs($,{value:"corrections",children:["Corrections (",u.length,")"]})]}),e.jsxs(A,{value:"records",className:"space-y-4",children:[r&&e.jsxs(C,{className:"bg-card border-border",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{className:"text-lg text-foreground",children:"Filters"}),e.jsxs(f,{variant:"ghost",size:"sm",onClick:J,children:[e.jsx(oe,{className:"w-4 h-4 mr-1"}),"Clear"]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"start_date",className:"text-foreground",children:"Start Date"}),e.jsx(T,{id:"start_date",value:n.start_date||"",onChange:t=>O("start_date",t)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"end_date",className:"text-foreground",children:"End Date"}),e.jsx(T,{id:"end_date",value:n.end_date||"",onChange:t=>O("end_date",t)})]})]})})]}),e.jsxs(C,{className:"bg-card border-border",children:[e.jsx(v,{children:e.jsx(k,{className:"text-foreground",children:"Your Records"})}),e.jsx(y,{children:e.jsx(ue,{records:i,companyTimezone:_,pagination:g,onPageChange:X,isLoading:h,onCorrectionClick:K})})]})]}),e.jsx(A,{value:"corrections",className:"space-y-4",children:e.jsxs(C,{className:"bg-card border-border",children:[e.jsx(v,{className:"bg-accent",children:e.jsxs(k,{className:"flex items-center gap-2 text-foreground",children:[e.jsx(D,{className:"w-5 h-5 text-chart-2"}),"My Pending Corrections"]})}),e.jsx(y,{className:"pt-6",children:u.length>0?e.jsx(be,{corrections:u,isLoading:j,onRefresh:I,companyTimezone:_}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"No pending correction requests"})]})})]})})]}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(C,{className:"bg-card border-border w-full max-w-md mx-4",children:[e.jsx(v,{children:e.jsx(k,{className:"text-foreground",children:"Export Records"})}),e.jsxs(y,{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:"Choose a date range or leave empty to export all records"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"export_start_date",className:"text-foreground",children:"Start Date (Optional)"}),e.jsx(T,{id:"export_start_date",value:x.start_date,onChange:t=>m({...x,start_date:t})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"export_end_date",className:"text-foreground",children:"End Date (Optional)"}),e.jsx(T,{id:"export_end_date",value:x.end_date,onChange:t=>m({...x,end_date:t})})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-4",children:[e.jsx(f,{variant:"outline",onClick:()=>a(!1),className:"border-input",children:"Cancel"}),e.jsx(f,{onClick:Y,disabled:p,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:p?"Exporting...":"Export"})]})]})]})})]}),e.jsx(he,{open:V,onOpenChange:F,session:S,onSelect:Q,isLoading:j}),e.jsx(_e,{open:M,onOpenChange:R,type:U,session:S,breakRecord:G,companyTimezone:_,onSubmit:Z,isLoading:j})]})};export{qe as default};
