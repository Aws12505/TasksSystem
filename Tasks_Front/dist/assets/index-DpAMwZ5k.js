import{q,j as e,B as A,ag as z,D as O,v as U,w as W,x as P,y as _,n as X,X as G,r as B,S as b,p as J,I as K,M as Y,N as Z,O as ee,P as se,Q as v,ah as ae}from"./index-BOfNqdHU.js";import{C as u,d as g,a as S,b as T}from"./card-VRr8nV95.js";import{P as re,a as te,b as L,c as ne,d as ie,e as le,f as ce}from"./pagination-Dwx5XK5W.js";import{u as oe}from"./filtersStore-BXwbMU63.js";import{T as de,a as xe,b as R,c as x,d as me,e as m}from"./table-C-IIjzmt.js";import{B as $}from"./badge-XdKDng72.js";import{T as he,a as ue}from"./TaskPriorityBadge-m8ZUfrJY.js";import{C as ge}from"./calendar-Mvv9E9t0.js";import{P as je}from"./play-C3aOFtv6.js";import{E as pe}from"./ellipsis-Br2SwrZN.js";import{E as fe}from"./eye-BRQmxKBX.js";import{S as Ne}from"./square-pen-DRxYo37W.js";import{T as be}from"./trash-2-DSrtDu12.js";import{P as ve}from"./plus-ZkbNUsEY.js";const we=({tasks:j,isLoading:D,onDelete:M,onStatusChange:w,assigneesMap:t={}})=>{const{hasPermission:p,hasAnyPermission:E}=q();return D?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,n)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},n))}):j.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tasks found in this section"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs(R,{className:"border-border",children:[e.jsx(x,{className:"text-foreground",children:"Task"}),e.jsx(x,{className:"text-foreground",children:"Status"}),e.jsx(x,{className:"text-foreground",children:"Priority"}),e.jsx(x,{className:"text-foreground",children:"Assignees"}),e.jsx(x,{className:"text-foreground",children:"Due Date"}),e.jsx(x,{className:"text-foreground",children:"Subtasks"}),e.jsx(x,{className:"text-foreground w-[260px]",children:"Actions"})]})}),e.jsx(me,{children:j.map(a=>{const n=p("view tasks"),o=p("edit tasks"),y=p("delete tasks"),C=E(["create task ratings","edit task ratings"]),f=n||o||y||C,k=t[a.id]||[];return e.jsxs(R,{className:"border-border hover:bg-accent/50",children:[e.jsx(m,{children:e.jsx("div",{className:"space-y-1",children:e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.name})})}),e.jsx(m,{children:e.jsx(he,{status:a.status})}),e.jsx(m,{children:e.jsx(ue,{priority:a.priority})}),e.jsx(m,{children:k.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:k.map(d=>e.jsxs($,{variant:"outline",className:"text-xs",children:[d.name," ",typeof d.percentage=="number"?`· ${d.percentage}%`:""]},d.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ge,{className:"w-4 h-4"}),new Date(a.due_date).toLocaleDateString()]})}),e.jsx(m,{children:e.jsxs($,{variant:"secondary",className:"text-xs",children:[a.subtasks?.length||0," subtasks"]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsxs(e.Fragment,{children:[e.jsxs(A,{size:"sm",variant:"secondary",className:"h-8",onClick:()=>w(a.id,"in_progress"),disabled:a.status==="in_progress"||a.status==="done",title:"Mark In Progress",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(A,{size:"sm",className:"h-8",onClick:()=>w(a.id,"done"),disabled:a.status==="done",title:"Mark Complete",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),f&&e.jsxs(O,{children:[e.jsx(U,{asChild:!0,children:e.jsx(A,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",title:"More actions",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",className:"bg-popover border-border",children:[n&&e.jsx(P,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"View"]})}),o&&e.jsx(P,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/tasks/${a.id}/edit`,className:"flex items-center",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Edit"]})}),C&&e.jsx(P,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/ratings/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Rate Task"]})}),y&&e.jsxs(P,{onClick:()=>M(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(be,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},a.id)})})]})})},Fe=()=>{const{tasks:j,isLoading:D,deleteTask:M,updateTaskStatus:w,pagination:t,goToPage:p,nextPage:E,prevPage:a}=G(),{searchQuery:n,statusFilter:o,setSearchQuery:y,setStatusFilter:C}=oe(),{hasPermission:f}=q(),[k,d]=B.useState({}),H=async s=>{f("delete tasks")&&window.confirm("Are you sure you want to delete this task?")&&await M(s)},V=async(s,r)=>{f("edit tasks")&&await w(s,{status:r})},i=B.useMemo(()=>{const s=n.toLowerCase();return j.filter(r=>{const l=r.name.toLowerCase().includes(s)||r.description?.toLowerCase().includes(s),c=o==="all"||r.status===o;return l&&c})},[j,n,o]);B.useEffect(()=>{(async()=>{if(!i.length){d({});return}const r=Array.from(new Set(i.map(h=>h.section_id))),l=await Promise.allSettled(r.map(h=>ae.getSectionTasksWithAssignments(h))),c={};l.forEach(h=>{if(h.status!=="fulfilled")return;const I=h.value;!I?.success||!Array.isArray(I.data)||I.data.forEach(F=>{c[F.id]=(F.assigned_users||[]).map(N=>({id:N.id,name:N.name??N.email??`User #${N.id}`,percentage:N.pivot?.percentage??0}))})}),d(c)})()},[i]);const Q=()=>{if(!t)return[];const s=[],{current_page:r,last_page:l}=t;r>3&&(s.push(1),r>4&&s.push("ellipsis-start"));for(let c=Math.max(1,r-2);c<=Math.min(l,r+2);c++)s.push(c);return r<l-2&&(r<l-3&&s.push("ellipsis-end"),s.push(l)),s};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(b,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your tasks and track progress"})]})]}),f("create tasks")&&e.jsx(A,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(_,{to:"/tasks/create",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"New Task"]})})]}),e.jsx(u,{className:"bg-card border-border",children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(K,{placeholder:"Search tasks...",value:n,onChange:s=>y(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsxs(Y,{value:o,onValueChange:C,children:[e.jsx(Z,{className:"w-48",children:e.jsx(ee,{placeholder:"Filter by status"})}),e.jsxs(se,{children:[e.jsx(v,{value:"all",children:"All Status"}),e.jsx(v,{value:"pending",children:"Pending"}),e.jsx(v,{value:"in_progress",children:"In Progress"}),e.jsx(v,{value:"done",children:"Done"}),e.jsx(v,{value:"rated",children:"Rated"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Total Tasks"}),e.jsx(b,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t?.total||i.length})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"In Progress"}),e.jsx(b,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:i.filter(s=>s.status==="in_progress").length})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Completed"}),e.jsx(b,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:i.filter(s=>s.status==="done").length})})]}),e.jsxs(u,{className:"bg-card border-border",children:[e.jsxs(S,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"High Priority"}),e.jsx(b,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(g,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:i.filter(s=>s.priority==="high"||s.priority==="critical").length})})]})]}),e.jsx(we,{tasks:i,isLoading:D,onDelete:H,onStatusChange:V,assigneesMap:k}),t&&t.last_page>1&&e.jsx(u,{className:"bg-card border-border",children:e.jsx(g,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",t.from||0," to ",t.to||0," of ",t.total," results"]}),e.jsx(re,{children:e.jsxs(te,{children:[e.jsx(L,{children:e.jsx(ne,{onClick:a,className:t.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Q().map((s,r)=>e.jsx(L,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(ie,{}):e.jsx(le,{onClick:()=>p(s),isActive:t.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(L,{children:e.jsx(ce,{onClick:E,className:t.current_page===t.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})};export{Fe as default};
