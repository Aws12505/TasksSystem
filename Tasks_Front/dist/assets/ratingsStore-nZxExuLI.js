import{J as o,k as u,t as n,H as d,aI as f,ag as k}from"./index-MKnohTjv.js";import{r as g}from"./ratingConfigService-AJfUho4U.js";class h{async createTaskRating(t){return o.post("/task-ratings",t)}async updateTaskRating(t,a){return o.put(`/task-ratings/${t}`,a)}async getTaskRatingsByTask(t,a=1,s=15){return o.getPaginated(`/tasks/${t}/ratings`,{page:a,per_page:s})}async createStakeholderRating(t){return o.post("/stakeholder-ratings",t)}async updateStakeholderRating(t,a){return o.put(`/stakeholder-ratings/${t}`,a)}async getStakeholderRatingsByProject(t,a=1,s=15){return o.getPaginated(`/projects/${t}/stakeholder-ratings`,{page:a,per_page:s})}async getAllFinalRatings(t=1,a=15){return o.getPaginated("/final-ratings",{page:t,per_page:a})}async calculateFinalRating(t,a){return o.post(`/users/${t}/calculate-final-rating`,a)}async getUserFinalRating(t,a,s){return o.get(`/users/${t}/final-rating/${a}/${s}`)}}const l=new h,y=u((r,t)=>({taskRatings:[],stakeholderRatings:[],finalRatings:[],taskRatingConfigs:[],stakeholderRatingConfigs:[],finalRatingConfigs:[],availableTasks:[],availableProjects:[],availableUsers:[],taskRatingsPagination:null,stakeholderRatingsPagination:null,finalRatingsPagination:null,isLoading:!1,error:null,fetchTaskRatings:async(a,s=1)=>{r({isLoading:!0,error:null});try{const e=await l.getTaskRatingsByTask(a,s);e.success?r({taskRatings:e.data,taskRatingsPagination:e.pagination,isLoading:!1}):(r({error:e.message,isLoading:!1}),n.error(e.message))}catch(e){const i=e.message||"Failed to fetch task ratings";r({error:i,isLoading:!1}),n.error(i)}},fetchStakeholderRatings:async(a,s=1)=>{r({isLoading:!0,error:null});try{const e=await l.getStakeholderRatingsByProject(a,s);e.success?r({stakeholderRatings:e.data,stakeholderRatingsPagination:e.pagination,isLoading:!1}):(r({error:e.message,isLoading:!1}),n.error(e.message))}catch(e){const i=e.message||"Failed to fetch stakeholder ratings";r({error:i,isLoading:!1}),n.error(i)}},fetchFinalRatings:async(a=1)=>{r({isLoading:!0,error:null});try{const s=await l.getAllFinalRatings(a);s.success?r({finalRatings:s.data,finalRatingsPagination:s.pagination,isLoading:!1}):(r({error:s.message,isLoading:!1}),n.error(s.message))}catch(s){const e=s.message||"Failed to fetch final ratings";r({error:e,isLoading:!1}),n.error(e)}},fetchUserFinalRating:async(a,s,e)=>{r({isLoading:!0,error:null});try{const i=await l.getUserFinalRating(a,s,e);return i.success?(r({isLoading:!1}),i.data):(r({error:i.message,isLoading:!1}),n.error(i.message),null)}catch(i){const c=i.message||"Failed to fetch user final rating";return r({error:c,isLoading:!1}),n.error(c),null}},fetchTaskRatingConfigs:async()=>{try{const a=await g.getRatingConfigsByType("task_rating");a.success&&r({taskRatingConfigs:a.data})}catch(a){console.error("Failed to fetch task rating configs:",a)}},fetchStakeholderRatingConfigs:async()=>{try{const a=await g.getRatingConfigsByType("stakeholder_rating");a.success&&r({stakeholderRatingConfigs:a.data})}catch(a){console.error("Failed to fetch stakeholder rating configs:",a)}},fetchFinalRatingConfigs:async()=>{try{const a=await g.getRatingConfigsByType("final_rating");a.success&&r({finalRatingConfigs:a.data})}catch(a){console.error("Failed to fetch final rating configs:",a)}},fetchAvailableTasks:async()=>{try{const a=await k.getTasks(1,100);a.success&&r({availableTasks:a.data})}catch(a){console.error("Failed to fetch tasks:",a)}},fetchAvailableProjects:async()=>{try{const a=await f.getProjects(1,100);a.success&&r({availableProjects:a.data})}catch(a){console.error("Failed to fetch projects:",a)}},fetchAvailableUsers:async()=>{try{const a=await d.getUsers(1,100);a.success&&r({availableUsers:a.data})}catch(a){console.error("Failed to fetch users:",a)}},createTaskRating:async a=>{r({isLoading:!0,error:null});try{const s=await l.createTaskRating(a);if(s.success){r({isLoading:!1}),n.success("Task rating created successfully");const e=t().taskRatings;return e.length>0&&e[0].task_id===a.task_id&&t().fetchTaskRatings(a.task_id),s.data}else return r({error:s.message,isLoading:!1}),n.error(s.message),null}catch(s){const e=s.message||"Failed to create task rating";return r({error:e,isLoading:!1}),n.error(e),null}},updateTaskRating:async(a,s)=>{r({isLoading:!0,error:null});try{const e=await l.updateTaskRating(a,s);return e.success?(r({isLoading:!1}),n.success("Task rating updated successfully"),s.task_id&&t().fetchTaskRatings(s.task_id),e.data):(r({error:e.message,isLoading:!1}),n.error(e.message),null)}catch(e){const i=e.message||"Failed to update task rating";return r({error:i,isLoading:!1}),n.error(i),null}},createStakeholderRating:async a=>{r({isLoading:!0,error:null});try{const s=await l.createStakeholderRating(a);if(s.success){r({isLoading:!1}),n.success("Stakeholder rating created successfully");const e=t().stakeholderRatings;return e.length>0&&e[0].project_id===a.project_id&&t().fetchStakeholderRatings(a.project_id),s.data}else return r({error:s.message,isLoading:!1}),n.error(s.message),null}catch(s){const e=s.message||"Failed to create stakeholder rating";return r({error:e,isLoading:!1}),n.error(e),null}},updateStakeholderRating:async(a,s)=>{r({isLoading:!0,error:null});try{const e=await l.updateStakeholderRating(a,s);return e.success?(r({isLoading:!1}),n.success("Stakeholder rating updated successfully"),s.project_id&&t().fetchStakeholderRatings(s.project_id),e.data):(r({error:e.message,isLoading:!1}),n.error(e.message),null)}catch(e){const i=e.message||"Failed to update stakeholder rating";return r({error:i,isLoading:!1}),n.error(i),null}},calculateFinalRating:async(a,s)=>{r({isLoading:!0,error:null});try{const e=await l.calculateFinalRating(a,s);return e.success?(r({isLoading:!1}),n.success("Final rating calculated successfully"),t().fetchFinalRatings(),e.data):(r({error:e.message,isLoading:!1}),n.error(e.message),null)}catch(e){const i=e.message||"Failed to calculate final rating";return r({error:i,isLoading:!1}),n.error(i),null}},clearAllRatings:()=>{r({taskRatings:[],stakeholderRatings:[],finalRatings:[],taskRatingsPagination:null,stakeholderRatingsPagination:null,finalRatingsPagination:null,error:null})}}));export{y as u};
