import{k as Z,j as e,A as R,n as H,p as F,D as me,E as he,B as ee,F as ge,G as j,H as q,R as ue,T as V,P as pe,C as c,f as o,I as je,c as T,d as A}from"./index-_pEC-YhN.js";import{T as fe,a as Ne,b as O,c as Q}from"./tabs-CGhV8HEc.js";import{P as $,a as G,b as f,c as X,d as z,e as J,f as K}from"./pagination-DTg-2Pth.js";import{A as be,a as ve,b as ye,c as we,d as Ce,e as Te,f as Ae,g as ke}from"./alert-dialog-CbA5-RXH.js";import{u as Pe}from"./useTickets-B4Q-Vqxh.js";import{u as _e}from"./filtersStore-wvAPfbny.js";import{T as De,a as Ue,b as W,c as d,d as qe,e as x}from"./table-yTOOjivd.js";import{B as Se}from"./badge-BxwzyqRU.js";import{T as Be,a as Ee,b as Ie}from"./TicketPriorityBadge-Oa4rdtAD.js";import{E as Le}from"./ellipsis-C2lGuzYK.js";import{E as Me}from"./eye-CXlq4_R3.js";import{S as Re}from"./square-pen-Y2vNlbvp.js";import{U as He,a as Fe}from"./user-x-zQ8iTnWx.js";import{C as Ve}from"./circle-check-big-C_XnZrKi.js";import{T as Oe}from"./trash-2-BhvShus8.js";import{S as Qe}from"./search-CMnV52oX.js";import{C as $e}from"./circle-alert-DdSxg3sn.js";import{C as Ge}from"./clock-BaatRaQ4.js";import{C as Xe}from"./circle-check-CqxyxMtZ.js";import"./ticketsStore-GtA1Dqq5.js";const Y=({tickets:i,isLoading:b,onDelete:t,onClaim:l,onComplete:v,onUnassign:k,showActions:y=!0})=>{const{hasPermission:N}=Z();return b?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,u)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},u))}):i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tickets found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(De,{children:[e.jsx(Ue,{children:e.jsxs(W,{className:"border-border",children:[e.jsx(d,{className:"text-foreground",children:"Title"}),e.jsx(d,{className:"text-foreground",children:"Type"}),e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsx(d,{className:"text-foreground",children:"Priority"}),e.jsx(d,{className:"text-foreground",children:"Requester"}),e.jsx(d,{className:"text-foreground",children:"Assignee"}),e.jsx(d,{className:"text-foreground",children:"Created"}),y&&e.jsx(d,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(qe,{children:i.map(a=>{const u=N("view tickets"),m=N("edit tickets"),w=N("delete tickets"),P=u||m||w,_=a.requester?.name||a.requester_name||"Unknown Requester",D=(a.requester?.name||a.requester_name||"U").charAt(0).toUpperCase();return e.jsxs(W,{className:"border-border hover:bg-accent/50",children:[e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:a.description})]})}),e.jsx(x,{children:e.jsx(Be,{type:a.type})}),e.jsx(x,{children:e.jsx(Ee,{status:a.status})}),e.jsx(x,{children:e.jsx(Ie,{priority:a.priority})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(R,{className:"w-6 h-6",children:[typeof a.requester?.avatar_url=="string"&&a.requester?.avatar_url.trim()!==""&&e.jsx(H,{src:a.requester.avatar_url,alt:a.requester.name||"User avatar",className:"object-cover"}),e.jsx(F,{className:"bg-primary text-primary-foreground text-xs",children:D})]}),e.jsx("span",{className:"text-sm text-foreground",children:_})]})}),e.jsx(x,{children:a.assignee?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(R,{className:"w-6 h-6",children:[typeof a.assignee.avatar_url=="string"&&a.assignee.avatar_url.trim()!==""&&e.jsx(H,{src:a.assignee.avatar_url,alt:a.assignee.name||"User avatar",className:"object-cover"}),e.jsx(F,{className:"bg-chart-2 text-white text-xs",children:a.assignee.name?.charAt(0).toUpperCase()||"A"})]}),e.jsx("span",{className:"text-sm text-foreground",children:a.assignee.name})]}):e.jsx(Se,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(x,{className:"text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),y&&e.jsx(x,{children:P?e.jsxs(me,{children:[e.jsx(he,{asChild:!0,children:e.jsx(ee,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",className:"bg-popover border-border",children:[u&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(q,{to:`/tickets/${a.id}`,className:"flex items-center",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"View"]})}),m&&e.jsx(j,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(q,{to:`/tickets/${a.id}/edit`,className:"flex items-center",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Edit"]})}),m&&a.is_available&&e.jsxs(j,{onClick:()=>l(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Claim"]}),m&&a.is_assigned&&a.status==="in_progress"&&e.jsxs(j,{onClick:()=>v(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Complete"]}),m&&a.is_assigned&&a.status!=="resolved"&&e.jsxs(j,{onClick:()=>k(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Unassign"]}),w&&e.jsxs(j,{onClick:()=>t(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},a.id)})})]})})},gs=()=>{const{tickets:i,availableTickets:b,pagination:t,availablePagination:l,isLoading:v,deleteTicket:k,claimTicket:y,assignTicket:N,completeTicket:a,unassignTicket:u,goToPage:m,goToAvailablePage:w,nextPage:P,prevPage:_,nextAvailablePage:D,prevAvailablePage:se}=Pe(),{searchQuery:ae,setSearchQuery:re}=_e(),{hasPermission:h}=Z(),[n,g]=ue.useState(null),S=async s=>{h("delete tickets")&&g({type:"delete",id:s})},B=async s=>{h("edit tickets")&&await y(s)},E=async(s,r)=>{h("edit tickets")&&await N(s,r)},I=async s=>{h("edit tickets")&&await a(s)},L=async s=>{h("edit tickets")&&g({type:"unassign",id:s})},te=async()=>{if(n){if(n.type==="delete"){if(!h("delete tickets")){g(null);return}await k(n.id)}else if(n.type==="unassign"){if(!h("edit tickets")){g(null);return}await u(n.id)}g(null)}},le=i.filter(s=>s.status==="open").length,ne=i.filter(s=>s.status==="in_progress").length,ie=i.filter(s=>s.status==="resolved").length,M=s=>{if(!s)return[];const r=[],{current_page:p,last_page:C}=s;p>3&&(r.push(1),p>4&&r.push("ellipsis-start"));for(let U=Math.max(1,p-2);U<=Math.min(C,p+2);U++)r.push(U);return p<C-2&&(p<C-3&&r.push("ellipsis-end"),r.push(C)),r},ce=n?.type==="delete"?"Delete ticket":n?.type==="unassign"?"Unassign ticket":"",oe=n?.type==="delete"?"Are you sure you want to delete this ticket? This action cannot be undone.":n?.type==="unassign"?"Are you sure you want to unassign this ticket? It will become available for others to claim.":"",de=n?.type==="delete"?"Delete":n?.type==="unassign"?"Unassign":"Confirm",xe=n?.type==="delete"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-primary text-primary-foreground hover:bg-primary/90";return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support tickets and track resolution"})]})]}),e.jsx(ee,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(q,{to:"/tickets/create",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"New Ticket"]})})]}),e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(je,{placeholder:"Search tickets (subject, requester, ID)â€¦",value:ae,onChange:s=>re(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsx("div",{className:"hidden lg:block"}),e.jsx("div",{className:"hidden lg:block"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered/page)"}),e.jsx(V,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t?.total||i.length||0})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium text-muted-foreground",children:"Open (page)"}),e.jsx($e,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:le})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(Ge,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ne})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(A,{className:"text-sm font-medium text-muted-foreground",children:"Resolved (page)"}),e.jsx(Xe,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ie})})]})]}),e.jsxs(fe,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(Ne,{className:"bg-muted",children:[e.jsxs(O,{value:"all",children:["All Tickets (",t?.total||i.length,")"]}),e.jsxs(O,{value:"available",children:["Available (",l?.total||b.length,")"]})]}),e.jsxs(Q,{value:"all",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Y,{tickets:i,isLoading:v,onDelete:async s=>{await S(s)},onClaim:async s=>{await B(s)},onAssign:async(s,r)=>{await E(s,r)},onComplete:async s=>{await I(s)},onUnassign:async s=>{await L(s)}})})})}),t&&t.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",t.from||0," to ",t.to||0," of ",t.total||0," results"]}),e.jsx($,{children:e.jsxs(G,{children:[e.jsx(f,{children:e.jsx(X,{onClick:_,className:t.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(t).map((s,r)=>e.jsx(f,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(z,{}):e.jsx(J,{onClick:()=>m(s),isActive:t.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(f,{children:e.jsx(K,{onClick:P,className:t.current_page===t.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(Q,{value:"available",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Y,{tickets:b,isLoading:v,onDelete:async s=>{await S(s)},onClaim:async s=>{await B(s)},onAssign:async(s,r)=>{await E(s,r)},onComplete:async s=>{await I(s)},onUnassign:async s=>{await L(s)}})})})}),l&&l.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",l.from||0," to ",l.to||0," of ",l.total||0," results"]}),e.jsx($,{children:e.jsxs(G,{children:[e.jsx(f,{children:e.jsx(X,{onClick:se,className:l.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(l).map((s,r)=>e.jsx(f,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(z,{}):e.jsx(J,{onClick:()=>w(s),isActive:l.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(f,{children:e.jsx(K,{onClick:D,className:l.current_page===l.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]}),e.jsx(be,{open:n!==null,onOpenChange:s=>!s&&g(null),children:e.jsxs(ve,{className:"sm:max-w-[480px]",children:[e.jsxs(ye,{children:[e.jsx(we,{children:ce}),e.jsx(Ce,{children:oe})]}),e.jsxs(Te,{children:[e.jsx(Ae,{onClick:()=>g(null),children:"Cancel"}),e.jsx(ke,{onClick:te,className:xe,children:de})]})]})})]})};export{gs as default};
