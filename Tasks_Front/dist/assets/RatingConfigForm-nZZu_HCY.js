import{r as G,a as J,b as Q,at as W,ak as A,j as e,F as X,c,d,e as i,f as m,I as p,g as u,$ as Y,K as C,M as S,N as F,O as R,P as l,B as b,L as Z,o as N,ah as L,s as x,al as q,au as ee,ag as se,a5 as z,av as ae,E as w}from"./index-BIXuByyq.js";import{C as f,a as T,b as V,d as v}from"./card-DXKjgZZu.js";import{C as re}from"./checkbox-B5fYxkEl.js";import{S as te}from"./ratingConfigsStore-M3edn9Rb.js";import{P as D}from"./plus-Dd03PpEI.js";import{T as E}from"./trash-2-xlj9cGPo.js";const $={TaskRating:["task_id","rater_id","rating_data","final_rating","config_snapshot","rated_at","created_at","updated_at"],StakeholderRating:["project_id","stakeholder_id","rating_data","final_rating","config_snapshot","rated_at","created_at","updated_at"],Ticket:["title","description","status","type","priority","requester_id","assigned_to","completed_at","created_at","updated_at"],HelpRequest:["description","task_id","requester_id","helper_id","rating","is_completed","completed_at","created_at","updated_at"]},ne=N({name:x().min(1,"Field name is required"),max_value:L().min(1,"Max value must be at least 1")}),le=N({name:x().min(1,"Variable name is required"),model:x().min(1,"Model is required"),column:x().min(1,"Column is required"),operation:se(["sum","avg","count","min","max"]),conditions:q(N({column:x(),operator:x(),value:ee()})).optional()}),ie=N({type:ae([w("task_rating"),w("stakeholder_rating")]),name:x().min(1,"Name is required").max(255),description:x().optional(),is_active:z(),fields:q(ne).min(1,"At least one field is required")}),oe=N({type:w("final_rating"),name:x().min(1,"Name is required").max(255),description:x().optional(),is_active:z(),expression:x().min(1,"Expression is required"),variables:q(le).min(1,"At least one variable is required")}),ce=W("type",[ie,oe]),ge=({ratingConfig:o,onSubmit:H,isLoading:t})=>{const I=!!o,[_,O]=G.useState(o?.type||"task_rating"),M=s=>{const a={name:o?.name||"",description:o?.description||"",is_active:o?.is_active??!1};if(s==="final_rating"){if(o&&o.type==="final_rating"){const n=o.config_data;return{type:"final_rating",...a,expression:n.expression||"",variables:n.variables||[{name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}]}}return{type:"final_rating",...a,expression:"",variables:[{name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}]}}else{if(o&&o.type!=="final_rating"){const n=o.config_data;return{type:s,...a,fields:n.fields||[{name:"",max_value:50}]}}return{type:s,...a,fields:[{name:"",max_value:50}]}}},r=J({resolver:Q(ce),defaultValues:M(_),mode:"onSubmit"}),k=A({control:r.control,name:"fields"}),y=A({control:r.control,name:"variables"}),U=r.watch("variables")||[],B=async s=>{console.log("âœ… Form validation passed, submitting:",s);let a;s.type==="final_rating"?a={expression:s.expression,variables:s.variables}:a={fields:s.fields};const n={name:s.name,description:s.description,type:s.type,config_data:a,is_active:s.is_active};await H(n)},P=s=>{console.log("ðŸ”„ Changing type from",_,"to",s),O(s);const a=M(s);r.reset(a)},K=(s,a)=>{const j=($[a]||[])[0]||"";r.setValue(`variables.${s}.model`,a),r.setValue(`variables.${s}.column`,j)};return e.jsx(X,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(B,s=>{console.log("âŒ Form validation errors:",s)}),className:"space-y-6",children:[e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsxs(V,{className:"text-foreground flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Basic Information"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"name",render:({field:s})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Name"}),e.jsx(m,{children:e.jsx(p,{placeholder:"Enter configuration name",...s,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:"description",render:({field:s})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Description"}),e.jsx(m,{children:e.jsx(Y,{placeholder:"Enter configuration description (optional)",...s,disabled:t,className:"bg-background border-input text-foreground",rows:3})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"type",render:({field:s})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Type"}),e.jsxs(C,{onValueChange:P,value:s.value,disabled:t,children:[e.jsx(m,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select configuration type"})})}),e.jsxs(R,{children:[e.jsx(l,{value:"task_rating",children:"Task Rating"}),e.jsx(l,{value:"stakeholder_rating",children:"Stakeholder Rating"}),e.jsx(l,{value:"final_rating",children:"Final Rating"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:"is_active",render:({field:s})=>e.jsxs(d,{className:"flex flex-row items-start space-x-3 space-y-0 mt-8",children:[e.jsx(m,{children:e.jsx(re,{checked:s.value,onCheckedChange:s.onChange,disabled:t})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{className:"text-foreground",children:"Active Configuration"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set as the active configuration for this type"})]})]})})]})]})]}),_==="final_rating"?e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsx(V,{className:"text-foreground",children:"Final Rating Formula"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"expression",render:({field:s})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Formula Expression"}),e.jsx(m,{children:e.jsx(p,{placeholder:"e.g., (task_avg + stakeholder_avg) * tickets_bonus / penalty_factor",...s,disabled:t,className:"bg-background border-input text-foreground font-mono"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use variable names defined below in your mathematical expression"}),e.jsx(u,{className:"text-destructive"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(i,{className:"text-foreground",children:"Variables"}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:()=>y.append({name:"",model:"TaskRating",column:"final_rating",operation:"avg",conditions:[]}),disabled:t,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Variable"]})]}),y.fields.map((s,a)=>{const n=U[a]?.model||"TaskRating",j=$[n]||[];return e.jsx(f,{className:"mb-4 bg-accent/20",children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground",children:["Variable ",a+1]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>y.remove(a),disabled:t||y.fields.length<=1,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:`variables.${a}.name`,render:({field:h})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Variable Name"}),e.jsx(m,{children:e.jsx(p,{placeholder:"e.g., task_avg",...h,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:`variables.${a}.operation`,render:({field:h})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Operation"}),e.jsxs(C,{onValueChange:h.onChange,value:h.value,disabled:t,children:[e.jsx(m,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{})})}),e.jsxs(R,{children:[e.jsx(l,{value:"sum",children:"Sum"}),e.jsx(l,{value:"avg",children:"Average"}),e.jsx(l,{value:"count",children:"Count"}),e.jsx(l,{value:"min",children:"Minimum"}),e.jsx(l,{value:"max",children:"Maximum"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:`variables.${a}.model`,render:({field:h})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Model"}),e.jsxs(C,{onValueChange:g=>K(a,g),value:h.value,disabled:t,children:[e.jsx(m,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select model"})})}),e.jsxs(R,{children:[e.jsx(l,{value:"TaskRating",children:"TaskRating"}),e.jsx(l,{value:"StakeholderRating",children:"StakeholderRating"}),e.jsx(l,{value:"Ticket",children:"Ticket"}),e.jsx(l,{value:"HelpRequest",children:"HelpRequest"})]})]}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:`variables.${a}.column`,render:({field:h})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Column"}),e.jsxs(C,{onValueChange:h.onChange,value:h.value,disabled:t,children:[e.jsx(m,{children:e.jsx(S,{className:"bg-background border-input text-foreground",children:e.jsx(F,{placeholder:"Select column"})})}),e.jsx(R,{children:j.map(g=>e.jsx(l,{value:g,children:g},g))})]}),e.jsx(u,{className:"text-destructive"})]})})]})]})},s.id)})]})]})]}):e.jsxs(f,{className:"bg-card border-border",children:[e.jsx(T,{children:e.jsx(V,{className:"text-foreground",children:"Rating Fields"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Define the fields that will be used for ",_.replace("_"," ")]}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:()=>k.append({name:"",max_value:50}),disabled:t,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Field"]})]}),k.fields.map((s,a)=>e.jsx(f,{className:"bg-accent/20",children:e.jsxs(v,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-foreground",children:["Field ",a+1]}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>k.remove(a),disabled:t||k.fields.length<=1,children:e.jsx(E,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:`fields.${a}.name`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Field Name"}),e.jsx(m,{children:e.jsx(p,{placeholder:"e.g., Code Cleanliness",...n,disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})}),e.jsx(c,{control:r.control,name:`fields.${a}.max_value`,render:({field:n})=>e.jsxs(d,{children:[e.jsx(i,{className:"text-foreground",children:"Max Value"}),e.jsx(m,{children:e.jsx(p,{type:"number",placeholder:"50",...n,onChange:j=>n.onChange(Number(j.target.value)),disabled:t,className:"bg-background border-input text-foreground"})}),e.jsx(u,{className:"text-destructive"})]})})]})]})},s.id))]})]}),e.jsxs(b,{type:"submit",disabled:t,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:[t&&e.jsx(Z,{className:"mr-2 h-4 w-4 animate-spin"}),I?"Update Configuration":"Create Configuration"]})]})})};export{ge as R};
