import{y as Z,j as e,a2 as ee,Z as C,E as se,B as x,at as ae,V as xe,W as me,X as he,Y as _,S as ue,a3 as O,ac as ge,an as je,R as i,a5 as pe,ai as y,$ as fe,C as j,f as p,I as Ne,K as Q,M as W,N as J,O as K,P as f,au as ve,av as be,U as we,aw as ye,G as Ce,H as Pe,J as ke,ax as X,c as I,d as F}from"./index-ClQ2iEwo.js";import{P as Se,a as Ae,b as L,c as Te,d as De,e as _e,f as Ie}from"./pagination-D7wuWZvp.js";import{A as Fe,a as Ee,b as Me,c as Be,d as $e,e as Ue,f as Re,g as ze}from"./alert-dialog-BIQUiZYv.js";import{C as He,a as Le,b as Ve,c as Ge,d as qe,e as Oe}from"./command-D7wLJDSM.js";import{u as Qe}from"./filtersStore-lv9cmxQL.js";import{T as We,a as Je,b as Y,c,d as Ke,e as o}from"./table-D1t_occO.js";import{B as V}from"./badge-Dke9IkX-.js";import{T as Xe,a as Ye}from"./TaskPriorityBadge-CPQEWMl0.js";import{P as Ze}from"./play-rVCXIahb.js";import{E as es}from"./ellipsis-B8Lcp3WX.js";import{E as ss}from"./eye-wlSAM2Al.js";import{S as as}from"./square-pen-DXwq6A3D.js";import{T as rs}from"./trash-2-CmUMwomX.js";import{S as ts}from"./search-C4nDnTHI.js";const ls=({tasks:m,isLoading:r,onDelete:E,onStatusChange:P,assigneesMap:M={}})=>{const{hasPermission:h,hasAnyPermission:B}=Z();return r?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,u)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},u))}):m.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tasks found"})}):e.jsx("div",{className:"h-full border border-border rounded-lg bg-card overflow-hidden",children:e.jsxs(ee,{className:"h-full w-full",children:[e.jsxs(We,{className:"w-full",children:[e.jsx(Je,{children:e.jsxs(Y,{className:"border-border sticky top-0 z-10 bg-card",children:[e.jsx(c,{className:"text-foreground",children:"Task"}),e.jsx(c,{className:"text-foreground",children:"Status"}),e.jsx(c,{className:"text-foreground",children:"Priority"}),e.jsx(c,{className:"text-foreground",children:"Assignees"}),e.jsx(c,{className:"text-foreground",children:"Project"}),e.jsx(c,{className:"text-foreground",children:"Latest Rating"}),e.jsx(c,{className:"text-foreground",children:"Due Date"}),e.jsx(c,{className:"text-foreground",children:"Subtasks"}),e.jsx(c,{className:"text-foreground w-[260px]",children:"Actions"})]})}),e.jsx(Ke,{children:m.map(a=>{const u=h("view tasks"),N=h("edit tasks"),v=h("delete tasks"),k=B(["create task ratings","edit task ratings"]),$=u||N||v||k,g=(a.assigned_users||[]).map(t=>({id:t.id,name:t.name??void 0,email:t.email??void 0,percentage:t.pivot?.percentage})),U=M[a.id]||[],b=g.length?g:U;return e.jsxs(Y,{className:"border-border hover:bg-accent/50",children:[e.jsx(o,{children:e.jsx("div",{className:"space-y-1",children:e.jsx(C,{to:`/tasks/${a.id}`,className:"text-sm font-medium text-foreground hover:text-primary hover:underline",children:a.name})})}),e.jsx(o,{children:e.jsx(Xe,{status:a.status})}),e.jsx(o,{children:e.jsx(Ye,{priority:a.priority})}),e.jsx(o,{children:b.length?e.jsx("div",{className:"flex flex-wrap gap-1",children:b.map(t=>e.jsxs(V,{variant:"outline",className:"text-xs",children:[t.name||t.email||`User #${t.id}`,typeof t.percentage=="number"?` · ${t.percentage}%`:""]},t.id))}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(o,{children:e.jsx("span",{className:"text-sm text-foreground",children:a.project?.name||a.section?.project?.name||"—"})}),e.jsx(o,{children:a.latest_final_rating!=null?e.jsxs(V,{variant:"secondary",className:"text-xs",children:[Number(a.latest_final_rating).toFixed(1),"%"]}):e.jsx("span",{className:"text-xs text-muted-foreground",children:"—"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(se,{className:"w-4 h-4"}),new Date(a.due_date).toLocaleDateString()]})}),e.jsx(o,{children:e.jsxs(V,{variant:"secondary",className:"text-xs",children:[a.subtasks?.length||0," subtasks"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{size:"sm",variant:"secondary",className:"h-8",onClick:()=>P(a.id,"in_progress"),disabled:a.status==="in_progress"||a.status==="rated",title:"Mark In Progress",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"In Progress"]}),e.jsxs(x,{size:"sm",className:"h-8",onClick:()=>P(a.id,"done"),disabled:a.status==="done"||a.status==="rated",title:"Mark Complete",children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Complete"]})]}),$&&e.jsxs(xe,{children:[e.jsx(me,{asChild:!0,children:e.jsx(x,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",title:"More actions",children:e.jsx(es,{className:"h-4 w-4"})})}),e.jsxs(he,{align:"end",className:"bg-popover border-border",children:[u&&e.jsx(_,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(ss,{className:"mr-2 h-4 w-4"}),"View"]})}),N&&e.jsx(_,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/tasks/${a.id}/edit`,className:"flex items-center",children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Edit"]})}),k&&e.jsx(_,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(C,{to:`/ratings/tasks/${a.id}`,className:"flex items-center",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Rate Task"]})}),v&&e.jsxs(_,{onClick:()=>E(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},a.id)})})]}),e.jsx(O,{orientation:"vertical"}),e.jsx(O,{orientation:"horizontal"})]})})},ns=15,bs=()=>{const{tasks:m,pagination:r,isLoading:E,deleteTask:P,updateTaskStatus:M,fetchTasks:h,goToPage:B,nextPage:a,prevPage:u}=ge(),{searchQuery:N,statusFilter:v,setSearchQuery:k,setStatusFilter:$}=Qe(),{hasPermission:g}=Z(),{projects:U,fetchProjects:b}=je(),[t,re]=i.useState("all"),[n,R]=i.useState([]),[S,G]=i.useState(""),[A,q]=i.useState(""),[T,te]=i.useState([]),[z,w]=i.useState(null);i.useEffect(()=>{b(),(async()=>{try{const s=await pe.getAllUsers();te(s)}catch(s){console.error("Failed to fetch all users:",s)}})()},[b]);const D=i.useMemo(()=>({status:v,project_id:t,assignees:n,due_from:S||void 0,due_to:A||void 0,search:N||void 0,per_page:ns}),[v,t,n,S,A,N]);i.useEffect(()=>{h(1,D)},[D]);const le=s=>R(l=>l.includes(s)?l.filter(d=>d!==s):[...l,s]),ne=()=>R([]),ie=()=>{if(!r)return[];const{current_page:s,last_page:l}=r,d=[];s>3&&(d.push(1),s>4&&d.push("ellipsis-start"));for(let H=Math.max(1,s-2);H<=Math.min(l,s+2);H++)d.push(H);return s<l-2&&(s<l-3&&d.push("ellipsis-end"),d.push(l)),d},ce=async s=>{g("delete tasks")&&w(s)},oe=async()=>{if(!g("delete tasks")){w(null);return}z!=null&&(await P(z),w(null),r&&h(r.current_page,D))},de=async(s,l)=>{g("view tasks")&&(await M(s,{status:l}),r&&h(r.current_page,D))};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tasks"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your tasks and track progress"})]})]}),g("create tasks")&&e.jsx(x,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(C,{to:"/tasks/create",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"New Task"]})})]}),e.jsx(j,{className:"bg-card border-border",children:e.jsxs(p,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ts,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Ne,{placeholder:"Search tasks, projects, assignees, IDs…",value:N,onChange:s=>k(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsxs(Q,{value:v,onValueChange:$,children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Filter by status"})}),e.jsxs(K,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"pending",children:"Pending"}),e.jsx(f,{value:"in_progress",children:"In Progress"}),e.jsx(f,{value:"done",children:"Done"}),e.jsx(f,{value:"rated",children:"Rated"})]})]}),e.jsxs(Q,{value:t==="all"?"all":String(t),onValueChange:s=>re(s==="all"?"all":Number(s)),children:[e.jsx(W,{children:e.jsx(J,{placeholder:"Project"})}),e.jsxs(K,{children:[e.jsx(f,{value:"all",children:"All Projects"}),U.map(s=>e.jsx(f,{value:String(s.id),children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ve,{children:[e.jsx(be,{asChild:!0,children:e.jsxs(x,{type:"button",variant:"outline",className:"w-full justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 truncate",children:[e.jsx(we,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.length?`${n.length} assignee${n.length!==1?"s":""}`:"Filter assignees"})]}),e.jsx(He,{className:"w-4 h-4 opacity-60 flex-shrink-0"})]})}),e.jsxs(ye,{className:"p-0 w-[320px]",align:"start",children:[e.jsxs(Le,{children:[e.jsx(Ve,{placeholder:"Search assignees..."}),e.jsx(Ge,{children:"No users found"}),e.jsx(qe,{children:e.jsx(ee,{className:"h-[260px]",children:e.jsx("div",{className:"pr-2",children:T.map(s=>{const l=n.includes(s.id);return e.jsxs(Oe,{onSelect:()=>le(s.id),className:"flex items-center justify-between gap-2 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsxs(Ce,{className:"w-7 h-7 flex-shrink-0",children:[s.avatar_url?.trim()?e.jsx(Pe,{src:s.avatar_url,alt:s.name}):null,e.jsx(ke,{className:"text-[10px] bg-primary/10",children:s.name?.[0]?.toUpperCase()??"U"})]}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s.name}),s.email&&e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.email})]})]}),l&&e.jsx(ae,{className:"w-4 h-4 text-primary flex-shrink-0"})]},s.id)})})})})]}),e.jsxs("div",{className:"border-t p-2 flex gap-2",children:[e.jsx(x,{size:"sm",variant:"outline",type:"button",className:"flex-1",onClick:()=>R(T.map(s=>s.id)),disabled:T.length===0,children:"Select all"}),e.jsx(x,{size:"sm",variant:"outline",type:"button",className:"flex-1",onClick:ne,disabled:n.length===0,children:"Clear"})]})]})]}),n.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Filtering by:"," ",T.filter(s=>n.includes(s.id)).map(s=>s.name).slice(0,2).join(", "),n.length>2&&` +${n.length-2} more`]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(se,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(X,{id:"due_from",name:"due_from",value:S,onChange:G,className:"min-w-[140px]"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:"to"}),e.jsx(X,{id:"due_to",name:"due_to",value:A,onChange:q,className:"min-w-[140px]"}),(S||A)&&e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>{G(""),q("")},children:"Clear"})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(j,{className:"bg-card border-border",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered)"}),e.jsx(y,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total??0})})]}),e.jsxs(j,{className:"bg-card border-border",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.filter(s=>s.status==="in_progress").length})})]}),e.jsxs(j,{className:"bg-card border-border",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"Completed (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.filter(s=>s.status==="done").length})})]}),e.jsxs(j,{className:"bg-card border-border",children:[e.jsxs(I,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(F,{className:"text-sm font-medium text-muted-foreground",children:"High Priority (page)"}),e.jsx(y,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(p,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:m.filter(s=>s.priority==="high"||s.priority==="critical").length})})]})]}),e.jsx(j,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(p,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ls,{tasks:m,isLoading:E,onDelete:async s=>{await ce(s)},onStatusChange:async(s,l)=>{await de(s,l)}})})})}),r&&r.last_page>1&&e.jsx(j,{className:"bg-card border-border",children:e.jsx(p,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total||0," results"]}),e.jsx(Se,{children:e.jsxs(Ae,{children:[e.jsx(L,{children:e.jsx(Te,{onClick:u,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),ie().map((s,l)=>e.jsx(L,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(De,{}):e.jsx(_e,{onClick:()=>B(s),isActive:r.current_page===s,className:"cursor-pointer",children:s})},l)),e.jsx(L,{children:e.jsx(Ie,{onClick:a,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsx(Fe,{open:z!==null,onOpenChange:s=>!s&&w(null),children:e.jsxs(Ee,{className:"sm:max-w-[480px]",children:[e.jsxs(Me,{children:[e.jsx(Be,{children:"Delete task"}),e.jsx($e,{children:"Are you sure you want to delete this task? This action cannot be undone."})]}),e.jsxs(Ue,{children:[e.jsx(Re,{onClick:()=>w(null),children:"Cancel"}),e.jsx(ze,{onClick:oe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})})]})};export{bs as default};
