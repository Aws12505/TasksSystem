import{m as ne,j as e,A as B,n as E,p as I,D as ge,q as pe,B as ce,v as fe,w as g,x as _,R as L,aw as F,P as Ne,C as n,f as c,I as be,c as C,d as k,U as ve}from"./index-CH0ELVhY.js";import{T as we,a as ye,b as Q,c as V}from"./tabs-CCvWbC_r.js";import{P as O,a as $,b as h,c as X,d as z,e as G,f as J}from"./pagination-DQgsaQqy.js";import{A as K,a as W,b as Y,c as Z,d as R,e as ee,f as se,g as ae}from"./alert-dialog-C51kXGeh.js";import{u as Ce}from"./useHelpRequests-DbTm1wf7.js";import{u as ke}from"./filtersStore-sgPrGl3k.js";import{T as Ae,a as Te,b as re,c as o,d as De,e as d}from"./table-BnCtu9P2.js";import{B as le}from"./badge-ClFdoHwc.js";import{H as Pe,a as _e}from"./HelpRequestRatingBadge-B4W4sL2p.js";import{E as Ue}from"./ellipsis-CcZBrH0l.js";import{E as He}from"./eye-CRLIawko.js";import{S as qe}from"./square-pen-lpRejJL1.js";import{U as Se,a as Me,C as Be}from"./user-x-BIVlcD-d.js";import{T as Ee}from"./trash-2-CVjnEfDf.js";import{S as Ie}from"./search-DCTwE3Jt.js";import{C as Le}from"./clock-DtsH-V7j.js";import"./helpRequestsStore-l4_dH5-f.js";const te=({helpRequests:i,isLoading:u,onDelete:r,onClaim:l,onUnclaim:p,showActions:f=!0})=>{const{hasPermission:j}=ne();return u?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((s,x)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},x))}):i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No help requests found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(Ae,{children:[e.jsx(Te,{children:e.jsxs(re,{className:"border-border",children:[e.jsx(o,{className:"text-foreground",children:"Description"}),e.jsx(o,{className:"text-foreground",children:"Task"}),e.jsx(o,{className:"text-foreground",children:"Requester"}),e.jsx(o,{className:"text-foreground",children:"Helper"}),e.jsx(o,{className:"text-foreground",children:"Status"}),e.jsx(o,{className:"text-foreground",children:"Rating"}),e.jsx(o,{className:"text-foreground",children:"Created"}),f&&e.jsx(o,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(De,{children:i.map(s=>{const x=j("view help requests"),N=j("edit help requests"),b=j("delete help requests"),A=x||N||b;return e.jsxs(re,{className:"border-border hover:bg-accent/50",children:[e.jsx(d,{children:e.jsx("div",{className:"max-w-xs",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:s.description})})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.task?.name||"Unknown Task"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.task?.section?.project?.name||"Unknown Project"})]})}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(B,{className:"w-6 h-6",children:[typeof s.requester?.avatar_url=="string"&&s.requester?.avatar_url.trim()!==""&&e.jsx(E,{src:s.requester?.avatar_url,alt:s.requester?.name||"User avatar",className:"object-cover"}),e.jsx(I,{className:"bg-primary text-primary-foreground text-xs",children:s.requester?.name?.charAt(0).toUpperCase()||"U"})]}),e.jsx("span",{className:"text-sm text-foreground",children:s.requester?.name||"Unknown User"})]})}),e.jsx(d,{children:s.helper?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(B,{className:"w-6 h-6",children:[typeof s.helper.avatar_url=="string"&&s.helper.avatar_url.trim()!==""&&e.jsx(E,{src:s.helper.avatar_url,alt:s.helper.name||"User avatar",className:"object-cover"}),e.jsx(I,{className:"bg-chart-2 text-white text-xs",children:s.helper.name?.charAt(0).toUpperCase()||"H"})]}),e.jsx("span",{className:"text-sm text-foreground",children:s.helper.name})]}):e.jsx(le,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(d,{children:e.jsx(Pe,{helpRequest:s})}),e.jsx(d,{children:s.rating?e.jsx(_e,{rating:s.rating,penaltyMultiplier:s.penalty_multiplier}):e.jsx(le,{variant:"outline",className:"text-xs",children:"Not Rated"})}),e.jsx(d,{className:"text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()}),f&&e.jsx(d,{children:A?e.jsxs(ge,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(ce,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(Ue,{className:"h-4 w-4"})})}),e.jsxs(fe,{align:"end",className:"bg-popover border-border",children:[x&&e.jsx(g,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/help-requests/${s.id}`,className:"flex items-center",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"View"]})}),N&&e.jsx(g,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(_,{to:`/help-requests/${s.id}/edit`,className:"flex items-center",children:[e.jsx(qe,{className:"mr-2 h-4 w-4"}),"Edit"]})}),s.is_available&&e.jsxs(g,{onClick:()=>l(s.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Claim"]}),s.is_claimed&&!s.is_completed&&e.jsxs(g,{onClick:()=>p(s.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Me,{className:"mr-2 h-4 w-4"}),"Unclaim"]}),b&&e.jsxs(g,{onClick:()=>r(s.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},s.id)})})]})})},rs=()=>{const{helpRequests:i,availableHelpRequests:u,pagination:r,availablePagination:l,isLoading:p,deleteHelpRequest:f,claimHelpRequest:j,unclaimHelpRequest:s,goToPage:x,goToAvailablePage:N,nextPage:b,prevPage:A,nextAvailablePage:ie,prevAvailablePage:oe}=Ce(),{searchQuery:de,setSearchQuery:xe}=ke(),{hasPermission:U}=ne(),[T,v]=L.useState(null),[D,w]=L.useState(null),H=async a=>{U("delete help requests")&&v(a)},me=async()=>{T!=null&&(await f(T),v(null))},q=async a=>{await j(a)},S=async a=>{w(a)},he=async()=>{D!=null&&(await s(D),w(null))},ue=i.filter(a=>a.is_completed).length,je=i.filter(a=>a.is_claimed&&!a.is_completed).length,M=a=>{if(!a)return[];const t=[],{current_page:m,last_page:y}=a;m>3&&(t.push(1),m>4&&t.push("ellipsis-start"));for(let P=Math.max(1,m-2);P<=Math.min(y,m+2);P++)t.push(P);return m<y-2&&(m<y-3&&t.push("ellipsis-end"),t.push(y)),t};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(F,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Help Requests"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support requests and provide assistance"})]})]}),U("create help requests")&&e.jsx(ce,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(_,{to:"/help-requests/create",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Request Help"]})})]}),e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(be,{placeholder:"Search help requestsâ€¦",value:de,onChange:a=>xe(a.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsx("div",{className:"hidden lg:block"}),e.jsx("div",{className:"hidden lg:block"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Total Requests"}),e.jsx(F,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:r?.total||i.length||0})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Available"}),e.jsx(Le,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:l?.total||u.length||0})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(ve,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:je})})]}),e.jsxs(n,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-muted-foreground",children:"Completed (page)"}),e.jsx(Be,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(c,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ue})})]})]}),e.jsxs(we,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(ye,{className:"bg-muted",children:[e.jsxs(Q,{value:"all",children:["All Requests (",r?.total||i.length,")"]}),e.jsxs(Q,{value:"available",children:["Available (",l?.total||u.length,")"]})]}),e.jsxs(V,{value:"all",className:"space-y-4",children:[e.jsx(n,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(c,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(te,{helpRequests:i,isLoading:p,onDelete:H,onClaim:q,onUnclaim:S})})})}),r&&r.last_page>1&&e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",r.from||0," to ",r.to||0," of ",r.total||0," results"]}),e.jsx(O,{children:e.jsxs($,{children:[e.jsx(h,{children:e.jsx(X,{onClick:A,className:r.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(r).map((a,t)=>e.jsx(h,{children:a==="ellipsis-start"||a==="ellipsis-end"?e.jsx(z,{}):e.jsx(G,{onClick:()=>x(a),isActive:r.current_page===a,className:"cursor-pointer",children:a})},t)),e.jsx(h,{children:e.jsx(J,{onClick:b,className:r.current_page===r.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(V,{value:"available",className:"space-y-4",children:[e.jsx(n,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(c,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(te,{helpRequests:u,isLoading:p,onDelete:H,onClaim:q,onUnclaim:S})})})}),l&&l.last_page>1&&e.jsx(n,{className:"bg-card border-border",children:e.jsx(c,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",l.from||0," to ",l.to||0," of ",l.total||0," results"]}),e.jsx(O,{children:e.jsxs($,{children:[e.jsx(h,{children:e.jsx(X,{onClick:oe,className:l.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(l).map((a,t)=>e.jsx(h,{children:a==="ellipsis-start"||a==="ellipsis-end"?e.jsx(z,{}):e.jsx(G,{onClick:()=>N(a),isActive:l.current_page===a,className:"cursor-pointer",children:a})},t)),e.jsx(h,{children:e.jsx(J,{onClick:ie,className:l.current_page===l.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]}),e.jsx(K,{open:T!==null,onOpenChange:a=>!a&&v(null),children:e.jsxs(W,{className:"sm:max-w-[480px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Delete help request"}),e.jsx(R,{children:"Are you sure you want to delete this help request? This action cannot be undone."})]}),e.jsxs(ee,{children:[e.jsx(se,{onClick:()=>v(null),children:"Cancel"}),e.jsx(ae,{onClick:me,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(K,{open:D!==null,onOpenChange:a=>!a&&w(null),children:e.jsxs(W,{className:"sm:max-w-[480px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Unclaim help request"}),e.jsx(R,{children:"Are you sure you want to unclaim this help request? It will become available for others to claim."})]}),e.jsxs(ee,{children:[e.jsx(se,{onClick:()=>w(null),children:"Cancel"}),e.jsx(ae,{onClick:he,children:"Unclaim"})]})]})})]})};export{rs as default};
