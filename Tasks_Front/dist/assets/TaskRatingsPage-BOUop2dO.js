import{r as b,a as v,b as R,o as y,j as a,n as N,F as k,aF as C,d as _,e as T,f as w,I as S,g as D,B as F,L as I,aG as P,ah as E,s as B,y as L}from"./index-Bm-EtB5S.js";import{C as j,a as M,b as V,d as f}from"./card-AVhO3b2r.js";import{u as q}from"./ratingsStore-B4MESdk_.js";import{S as A,R as G}from"./RatingDisplay-2ZCXxQS2.js";import"./ratingConfigService-B8wwqDOh.js";import"./badge-CeiX6K4U.js";import"./progress-DKnph9mm.js";import"./calendar-G9w6Qs0U.js";const H=n=>{const{taskRatings:d,taskRatingConfigs:m,taskRatingsPagination:i,isLoading:o,error:l,fetchTaskRatings:r,fetchTaskRatingConfigs:t,createTaskRating:x,updateTaskRating:u}=q(),c=typeof n=="string"?parseInt(n):n;return b.useEffect(()=>{c&&(r(c),t())},[c,r,t]),{taskRatings:d,taskRatingConfigs:m,pagination:i,isLoading:o,error:l,createRating:g=>x({...g,task_id:c}),updateRating:(g,s)=>u(g,s),refreshRatings:()=>r(c)}},O=y({rating_data:P(B(),E().min(0).max(100))}),$=({taskId:n,config:d,onSubmit:m,isLoading:i})=>{const o=d.config_data,l=o.fields.reduce((s,e)=>(s[e.name]=0,s),{}),r=v({resolver:R(O),defaultValues:{rating_data:l}}),t=async s=>{const e={task_id:n,rating_data:s.rating_data};await m(e)},x=r.watch("rating_data"),u=Object.values(x||{}).reduce((s,e)=>s+(e||0),0),c=o.fields.reduce((s,e)=>s+e.max_value,0),g=c>0?Math.round(u/c*100):0;return a.jsxs(j,{className:"bg-card border-border",children:[a.jsx(M,{children:a.jsxs(V,{className:"text-foreground flex items-center gap-2",children:[a.jsx(N,{className:"w-5 h-5"}),"Task Rating - ",d.name]})}),a.jsx(f,{children:a.jsx(k,{...r,children:a.jsxs("form",{onSubmit:r.handleSubmit(t),className:"space-y-6",children:[a.jsx("div",{className:"space-y-6",children:o.fields.map(s=>a.jsx("div",{children:a.jsx(C,{name:`rating_data.${s.name}`,control:r.control,render:({field:e,fieldState:p})=>a.jsxs(_,{children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx(T,{className:"text-foreground",children:s.name}),a.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.value||0," / ",s.max_value]})]}),a.jsx(w,{children:a.jsxs("div",{className:"space-y-3",children:[a.jsx(A,{value:[e.value||0],onValueChange:h=>e.onChange(h[0]),max:s.max_value,step:1,className:"flex-1",disabled:i}),a.jsx(S,{type:"number",min:0,max:s.max_value,value:e.value||0,onChange:h=>e.onChange(Number(h.target.value)),disabled:i,className:"w-24 text-center"})]})}),p.error&&a.jsx(D,{className:"text-destructive",children:p.error.message})]})})},s.name))}),a.jsx("div",{className:"p-4 bg-accent/20 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium text-foreground",children:"Total Rating"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-2xl font-bold text-foreground",children:[g,"%"]}),a.jsxs("div",{className:"text-sm text-muted-foreground",children:[u," / ",c]})]})]})}),a.jsxs(F,{type:"submit",disabled:i,className:"w-full bg-primary text-primary-foreground hover:bg-primary/90",children:[i&&a.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Submit Rating"]})]})})})]})},Z=()=>{const{taskId:n}=L(),{taskRatings:d,taskRatingConfigs:m,isLoading:i,createRating:o}=H(n),l=m.find(t=>t.is_active),r=async t=>{await o(t)};return n?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:a.jsx(N,{className:"w-6 h-6 text-primary"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-foreground font-sans",children:"Task Ratings"}),a.jsx("p",{className:"text-muted-foreground",children:"Rate task performance and quality"})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsx("div",{children:l?a.jsx($,{taskId:parseInt(n),config:l,onSubmit:r,isLoading:i}):a.jsx(j,{className:"bg-card border-border",children:a.jsx(f,{className:"p-6 text-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No active task rating configuration found"})})})}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-foreground",children:"Previous Ratings"}),i?a.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((t,x)=>a.jsx("div",{className:"h-32 bg-muted animate-pulse rounded-lg"},x))}):d.length===0?a.jsx(j,{className:"bg-card border-border",children:a.jsx(f,{className:"p-6 text-center",children:a.jsx("p",{className:"text-muted-foreground",children:"No ratings yet for this task"})})}):a.jsx("div",{className:"space-y-4",children:d.map(t=>a.jsx(G,{rating:t},t.id))})]})]})]}):a.jsx("div",{children:"Task not found"})};export{Z as default};
