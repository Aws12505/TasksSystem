import{g as F,D as l,j as e,B as b,C as E,c as H,d as M,e as P,f as U,I as C,L as $,h as q}from"./index-DgAmBmQE.js";import{L as S}from"./label-DkBQ70RM.js";import{T as A,a as O,b as T,c,d as W,e as o}from"./table-BStaWaig.js";import{B as V}from"./badge-COIORWR3.js";import{P as z}from"./progress-DxTlFxA9.js";import{T as G}from"./trending-up-CCHD0pMU.js";import{R as J}from"./refresh-cw-B9hQq2Qq.js";import{C as R}from"./calculator-NHtRSlhM.js";/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Q=F("arrow-up-down",K),le=()=>{const[m,N]=l.useState(""),[h,v]=l.useState(""),[w,y]=l.useState(!1),[g,j]=l.useState(null),[r,p]=l.useState(null),[f,_]=l.useState(!0),k=[1,4,5,6],L=s=>s?.data?s.data:s,I=async s=>{if(s.preventDefault(),!(!m||!h)){y(!0),j(null),p(null);try{const a=await q.post("final-ratings/calculate-weighted-ratings-sos",{user_ids:k,start_date:m,end_date:h}),t=L(a);p(t),setTimeout(()=>{document.getElementById("sos-results-table")?.scrollIntoView({behavior:"smooth",block:"start"})},0)}catch(a){j(a?.message||"Something went wrong")}finally{y(!1)}}},B=()=>{N(""),v(""),j(null),p(null)},u=l.useMemo(()=>{if(!r)return null;const s=t=>typeof t=="number"?t:-1/0;return[...r].sort((t,d)=>f?s(d.rating)-s(t.rating):s(t.rating)-s(d.rating))},[r,f]),n=l.useMemo(()=>{if(!r||r.length===0)return null;const s=r.filter(i=>typeof i.rating=="number");if(s.length===0)return{avg:null,top:null};const t=+(s.reduce((i,x)=>i+x.rating,0)/s.length).toFixed(2),d=s.reduce((i,x)=>x.rating>i.rating?x:i,s[0]);return{avg:t,top:d}},[r]),D=s=>s===null?"bg-muted":s>=85?"bg-green-500":s>=70?"bg-blue-500":s>=50?"bg-yellow-500":"bg-red-500";return e.jsx("div",{className:"min-h-screen flex flex-col",children:e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(G,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Weighted Ratings (SOS)"}),e.jsx("p",{className:"text-muted-foreground",children:"Latest task rating × user percentage, averaged per user (out of 100)"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",onClick:()=>_(s=>!s),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),f?"Highest → Lowest":"Lowest → Highest"]}),e.jsxs(b,{variant:"outline",onClick:B,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Reset"]})]})]}),e.jsxs(E,{className:"bg-card border-border",children:[e.jsxs(H,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Calculate Weighted Ratings (SOS)"]}),e.jsx(P,{children:"Hardcoded users: 1, 4, 5, 6"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"start_date",children:"Start Date"}),e.jsx(C,{id:"start_date",type:"date",value:m,onChange:s=>N(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"end_date",children:"End Date"}),e.jsx(C,{id:"end_date",type:"date",min:m,value:h,onChange:s=>v(s.target.value),required:!0})]}),e.jsx(b,{type:"submit",className:"w-full md:w-auto",disabled:w,children:w?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2 animate-spin"}),"Calculating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Calculate"]})})]}),g&&e.jsx("div",{className:"text-sm text-red-600 border border-red-200 bg-red-50 rounded-md p-3",children:g}),u&&n&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"bg-muted/40 border border-border rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Users Calculated"}),e.jsx("div",{className:"text-2xl font-semibold",children:u.length})]}),e.jsxs("div",{className:"bg-muted/40 border border-border rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Average Rating"}),e.jsx("div",{className:"text-2xl font-semibold",children:n.avg===null?"—":n.avg})]}),e.jsxs("div",{className:"bg-muted/40 border border-border rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Top Performer"}),e.jsx("div",{className:"text-sm font-medium",children:n.top?`${n.top.user_name} • ${n.top.rating.toFixed(2)}`:"—"})]})]}),u&&e.jsx("div",{id:"sos-results-table",className:"rounded-md border border-border overflow-hidden",children:e.jsxs(A,{children:[e.jsx(O,{className:"bg-muted/50",children:e.jsxs(T,{children:[e.jsx(c,{className:"w-[70px]",children:"Rank"}),e.jsx(c,{children:"User"}),e.jsx(c,{className:"text-right",children:"Rating"}),e.jsx(c,{className:"w-[240px]",children:"Progress"}),e.jsx(c,{className:"text-right w-[120px]",children:"Badge"})]})}),e.jsx(W,{children:u.map((s,a)=>{const t=s.rating,d=a<3&&typeof t=="number";return e.jsxs(T,{className:"hover:bg-muted/30",children:[e.jsx(o,{className:"font-medium",children:a+1}),e.jsx(o,{className:"font-medium",children:s.user_name}),e.jsx(o,{className:"text-right tabular-nums",children:t===null?"—":t.toFixed(2)}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(z,{value:typeof t=="number"?Math.max(0,Math.min(100,t)):0,className:"h-2"})}),e.jsx("div",{className:`h-2 w-2 rounded-full ${D(t)}`})]})}),e.jsx(o,{className:"text-right",children:d?e.jsx(V,{variant:"secondary",children:a===0?"🏆 Top 1":a===1?"🥈 Top 2":"🥉 Top 3"}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"—"})})]},`${s.user_name}-${a}`)})})]})}),!r&&!g&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Choose a date range and click ",e.jsx("span",{className:"font-medium",children:"Calculate"})," to see ratings."]})]})]})]})})};export{le as default};
