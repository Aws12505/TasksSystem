import{k as Z,j as e,A as R,p as H,q as F,E as me,F as he,B as ee,G as ge,H as u,J as q,R as ue,T as V,P as pe,C as c,f as o,I as je,c as C,d as T,l as fe}from"./index-BTqHZwA1.js";import{T as Ne,a as be,b as O,c as Q}from"./tabs-DHJGmw2V.js";import{P as $,a as G,b as p,c as J,d as X,e as z,f as K}from"./pagination-B7PNVZD_.js";import{A as ve,a as ye,b as we,c as Ce,d as Te,e as Ae,f as Pe,g as ke}from"./alert-dialog-D-J7FH7M.js";import{u as _e}from"./useTickets-B51PgHwq.js";import{u as De}from"./filtersStore-CQup6u5q.js";import{T as Ue,a as qe,b as W,c as d,d as Se,e as x}from"./table-Ctuw66jL.js";import{B as Be}from"./badge-CU20wJPc.js";import{T as Ee,a as Ie,b as Le}from"./TicketPriorityBadge-D0z9KmRw.js";import{E as Me}from"./ellipsis-DLhstFX9.js";import{E as Re}from"./eye-CGUH_QIL.js";import{S as He}from"./square-pen-BoNfvRa4.js";import{U as Fe,a as Ve}from"./user-x-W5bwAoWJ.js";import{C as Oe}from"./circle-check-big-CcVJwppl.js";import{T as Qe}from"./trash-2-BKGkHXWM.js";import{S as $e}from"./search-BR2izW0h.js";import{C as Ge}from"./circle-alert-CgpKnTLe.js";import{C as Je}from"./circle-check-CfRmyBBC.js";import"./chevron-left-ChVO2ggo.js";import"./ticketsStore-BBIwqqzH.js";const Y=({tickets:i,isLoading:f,onDelete:t,onClaim:l,onComplete:N,onUnassign:A,showActions:b=!0})=>{const{hasPermission:j}=Z();return f?e.jsx("div",{className:"space-y-4",children:Array.from({length:5}).map((a,h)=>e.jsx("div",{className:"h-16 bg-muted animate-pulse rounded-lg"},h))}):i.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No tickets found"})}):e.jsx("div",{className:"border border-border rounded-lg bg-card",children:e.jsxs(Ue,{children:[e.jsx(qe,{children:e.jsxs(W,{className:"border-border",children:[e.jsx(d,{className:"text-foreground",children:"Title"}),e.jsx(d,{className:"text-foreground",children:"Type"}),e.jsx(d,{className:"text-foreground",children:"Status"}),e.jsx(d,{className:"text-foreground",children:"Priority"}),e.jsx(d,{className:"text-foreground",children:"Requester"}),e.jsx(d,{className:"text-foreground",children:"Assignee"}),e.jsx(d,{className:"text-foreground",children:"Created"}),b&&e.jsx(d,{className:"text-foreground w-[50px]",children:"Actions"})]})}),e.jsx(Se,{children:i.map(a=>{const h=j("view tickets"),v=j("edit tickets"),y=j("delete tickets"),P=h||v||y,k=a.requester?.name||a.requester_name||"Unknown Requester",_=(a.requester?.name||a.requester_name||"U").charAt(0).toUpperCase();return e.jsxs(W,{className:"border-border hover:bg-accent/50",children:[e.jsx(x,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:a.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:a.description})]})}),e.jsx(x,{children:e.jsx(Ee,{type:a.type})}),e.jsx(x,{children:e.jsx(Ie,{status:a.status})}),e.jsx(x,{children:e.jsx(Le,{priority:a.priority})}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(R,{className:"w-6 h-6",children:[typeof a.requester?.avatar_url=="string"&&a.requester?.avatar_url.trim()!==""&&e.jsx(H,{src:a.requester.avatar_url,alt:a.requester.name||"User avatar",className:"object-cover"}),e.jsx(F,{className:"bg-primary text-primary-foreground text-xs",children:_})]}),e.jsx("span",{className:"text-sm text-foreground",children:k})]})}),e.jsx(x,{children:a.assignee?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(R,{className:"w-6 h-6",children:[typeof a.assignee.avatar_url=="string"&&a.assignee.avatar_url.trim()!==""&&e.jsx(H,{src:a.assignee.avatar_url,alt:a.assignee.name||"User avatar",className:"object-cover"}),e.jsx(F,{className:"bg-chart-2 text-white text-xs",children:a.assignee.name?.charAt(0).toUpperCase()||"A"})]}),e.jsx("span",{className:"text-sm text-foreground",children:a.assignee.name})]}):e.jsx(Be,{variant:"outline",className:"text-xs",children:"Unassigned"})}),e.jsx(x,{className:"text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()}),b&&e.jsx(x,{children:P?e.jsxs(me,{children:[e.jsx(he,{asChild:!0,children:e.jsx(ee,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-accent",children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsxs(ge,{align:"end",className:"bg-popover border-border",children:[h&&e.jsx(u,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(q,{to:`/tickets/${a.id}`,className:"flex items-center",children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"View"]})}),v&&e.jsx(u,{asChild:!0,className:"hover:bg-accent hover:text-accent-foreground",children:e.jsxs(q,{to:`/tickets/${a.id}/edit`,className:"flex items-center",children:[e.jsx(He,{className:"mr-2 h-4 w-4"}),"Edit"]})}),a.is_available&&e.jsxs(u,{onClick:()=>l(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"Claim"]}),a.is_assigned&&a.status==="in_progress"&&e.jsxs(u,{onClick:()=>N(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Complete"]}),a.is_assigned&&a.status!=="resolved"&&e.jsxs(u,{onClick:()=>A(a.id),className:"hover:bg-accent hover:text-accent-foreground",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Unassign"]}),y&&e.jsxs(u,{onClick:()=>t(a.id),className:"text-destructive hover:bg-destructive hover:text-destructive-foreground",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"No actions"})})]},a.id)})})]})})},gs=()=>{const{tickets:i,availableTickets:f,pagination:t,availablePagination:l,isLoading:N,deleteTicket:A,claimTicket:b,assignTicket:j,completeTicket:a,unassignTicket:h,goToPage:v,goToAvailablePage:y,nextPage:P,prevPage:k,nextAvailablePage:_,prevAvailablePage:se}=_e(),{searchQuery:ae,setSearchQuery:re}=De(),{hasPermission:D}=Z(),[n,m]=ue.useState(null),S=async s=>{D("delete tickets")&&m({type:"delete",id:s})},B=async s=>{await b(s)},E=async(s,r)=>{await j(s,r)},I=async s=>{await a(s)},L=async s=>{m({type:"unassign",id:s})},te=async()=>{if(n){if(n.type==="delete"){if(!D("delete tickets")){m(null);return}await A(n.id)}else if(n.type==="unassign"){if(!D("edit tickets")){m(null);return}await h(n.id)}m(null)}},le=i.filter(s=>s.status==="open").length,ne=i.filter(s=>s.status==="in_progress").length,ie=i.filter(s=>s.status==="resolved").length,M=s=>{if(!s)return[];const r=[],{current_page:g,last_page:w}=s;g>3&&(r.push(1),g>4&&r.push("ellipsis-start"));for(let U=Math.max(1,g-2);U<=Math.min(w,g+2);U++)r.push(U);return g<w-2&&(g<w-3&&r.push("ellipsis-end"),r.push(w)),r},ce=n?.type==="delete"?"Delete ticket":n?.type==="unassign"?"Unassign ticket":"",oe=n?.type==="delete"?"Are you sure you want to delete this ticket? This action cannot be undone.":n?.type==="unassign"?"Are you sure you want to unassign this ticket? It will become available for others to claim.":"",de=n?.type==="delete"?"Delete":n?.type==="unassign"?"Unassign":"Confirm",xe=n?.type==="delete"?"bg-destructive text-destructive-foreground hover:bg-destructive/90":"bg-primary text-primary-foreground hover:bg-primary/90";return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsxs("div",{className:"flex-1 space-y-6 p-4 md:p-6 max-w-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(V,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground font-sans",children:"Tickets"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage support tickets and track resolution"})]})]}),e.jsx(ee,{asChild:!0,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:e.jsxs(q,{to:"/tickets/create",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"New Ticket"]})})]}),e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-4 space-y-3",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(je,{placeholder:"Search tickets (subject, requester, ID)â€¦",value:ae,onChange:s=>re(s.target.value),className:"pl-10 bg-background border-input text-foreground"})]}),e.jsx("div",{className:"hidden lg:block"}),e.jsx("div",{className:"hidden lg:block"})]})})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Total (filtered/page)"}),e.jsx(V,{className:"w-4 h-4 text-chart-1"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:t?.total||i.length||0})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Open (page)"}),e.jsx(Ge,{className:"w-4 h-4 text-chart-2"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:le})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"In Progress (page)"}),e.jsx(fe,{className:"w-4 h-4 text-chart-3"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ne})})]}),e.jsxs(c,{className:"bg-card border-border",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(T,{className:"text-sm font-medium text-muted-foreground",children:"Resolved (page)"}),e.jsx(Je,{className:"w-4 h-4 text-chart-4"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold text-foreground",children:ie})})]})]}),e.jsxs(Ne,{defaultValue:"all",className:"space-y-4",children:[e.jsxs(be,{className:"bg-muted",children:[e.jsxs(O,{value:"all",children:["All Tickets (",t?.total||i.length,")"]}),e.jsxs(O,{value:"available",children:["Available (",l?.total||f.length,")"]})]}),e.jsxs(Q,{value:"all",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Y,{tickets:i,isLoading:N,onDelete:async s=>{await S(s)},onClaim:async s=>{await B(s)},onAssign:async(s,r)=>{await E(s,r)},onComplete:async s=>{await I(s)},onUnassign:async s=>{await L(s)}})})})}),t&&t.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",t.from||0," to ",t.to||0," of ",t.total||0," results"]}),e.jsx($,{children:e.jsxs(G,{children:[e.jsx(p,{children:e.jsx(J,{onClick:k,className:t.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(t).map((s,r)=>e.jsx(p,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(X,{}):e.jsx(z,{onClick:()=>v(s),isActive:t.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(p,{children:e.jsx(K,{onClick:P,className:t.current_page===t.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]}),e.jsxs(Q,{value:"available",className:"space-y-4",children:[e.jsx(c,{className:"bg-card border-border flex-1 flex flex-col min-h-0",children:e.jsx(o,{className:"p-0 flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(Y,{tickets:f,isLoading:N,onDelete:async s=>{await S(s)},onClaim:async s=>{await B(s)},onAssign:async(s,r)=>{await E(s,r)},onComplete:async s=>{await I(s)},onUnassign:async s=>{await L(s)}})})})}),l&&l.last_page>1&&e.jsx(c,{className:"bg-card border-border",children:e.jsx(o,{className:"p-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground text-center sm:text-left",children:["Showing ",l.from||0," to ",l.to||0," of ",l.total||0," results"]}),e.jsx($,{children:e.jsxs(G,{children:[e.jsx(p,{children:e.jsx(J,{onClick:se,className:l.current_page===1?"pointer-events-none opacity-50":"cursor-pointer"})}),M(l).map((s,r)=>e.jsx(p,{children:s==="ellipsis-start"||s==="ellipsis-end"?e.jsx(X,{}):e.jsx(z,{onClick:()=>y(s),isActive:l.current_page===s,className:"cursor-pointer",children:s})},r)),e.jsx(p,{children:e.jsx(K,{onClick:_,className:l.current_page===l.last_page?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})})]})]})]}),e.jsx(ve,{open:n!==null,onOpenChange:s=>!s&&m(null),children:e.jsxs(ye,{className:"sm:max-w-[480px]",children:[e.jsxs(we,{children:[e.jsx(Ce,{children:ce}),e.jsx(Te,{children:oe})]}),e.jsxs(Ae,{children:[e.jsx(Pe,{onClick:()=>m(null),children:"Cancel"}),e.jsx(ke,{onClick:te,className:xe,children:de})]})]})})]})};export{gs as default};
